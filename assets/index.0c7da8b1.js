const Rs=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=i(r);fetch(r.href,o)}};Rs();function Sn(e,t){const i=Object.create(null),n=e.split(",");for(let r=0;r<n.length;r++)i[n[r]]=!0;return t?r=>!!i[r.toLowerCase()]:r=>!!i[r]}const Is="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Ls=Sn(Is);function na(e){return!!e||e===""}function En(e){if(pe(e)){const t={};for(let i=0;i<e.length;i++){const n=e[i],r=je(n)?Bs(n):En(n);if(r)for(const o in r)t[o]=r[o]}return t}else{if(je(e))return e;if(He(e))return e}}const Ms=/;(?![^(]*\))/g,Os=/:(.+)/;function Bs(e){const t={};return e.split(Ms).forEach(i=>{if(i){const n=i.split(Os);n.length>1&&(t[n[0].trim()]=n[1].trim())}}),t}function Cn(e){let t="";if(je(e))t=e;else if(pe(e))for(let i=0;i<e.length;i++){const n=Cn(e[i]);n&&(t+=n+" ")}else if(He(e))for(const i in e)e[i]&&(t+=i+" ");return t.trim()}const Se={},er=[],it=()=>{},Ds=()=>!1,Ns=/^on[^a-z]/,_i=e=>Ns.test(e),Pn=e=>e.startsWith("onUpdate:"),Ue=Object.assign,Rn=(e,t)=>{const i=e.indexOf(t);i>-1&&e.splice(i,1)},js=Object.prototype.hasOwnProperty,ye=(e,t)=>js.call(e,t),pe=Array.isArray,_r=e=>ki(e)==="[object Map]",Fs=e=>ki(e)==="[object Set]",ve=e=>typeof e=="function",je=e=>typeof e=="string",In=e=>typeof e=="symbol",He=e=>e!==null&&typeof e=="object",oa=e=>He(e)&&ve(e.then)&&ve(e.catch),zs=Object.prototype.toString,ki=e=>zs.call(e),Us=e=>ki(e).slice(8,-1),Hs=e=>ki(e)==="[object Object]",Ln=e=>je(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,ti=Sn(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Ti=e=>{const t=Object.create(null);return i=>t[i]||(t[i]=e(i))},qs=/-(\w)/g,ir=Ti(e=>e.replace(qs,(t,i)=>i?i.toUpperCase():"")),Ws=/\B([A-Z])/g,sr=Ti(e=>e.replace(Ws,"-$1").toLowerCase()),aa=Ti(e=>e.charAt(0).toUpperCase()+e.slice(1)),Di=Ti(e=>e?`on${aa(e)}`:""),Lr=(e,t)=>!Object.is(e,t),Ni=(e,t)=>{for(let i=0;i<e.length;i++)e[i](t)},li=(e,t,i)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:i})},Vs=e=>{const t=parseFloat(e);return isNaN(t)?e:t};let Zn;const Ks=()=>Zn||(Zn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let ft;class $s{constructor(t=!1){this.active=!0,this.effects=[],this.cleanups=[],!t&&ft&&(this.parent=ft,this.index=(ft.scopes||(ft.scopes=[])).push(this)-1)}run(t){if(this.active){const i=ft;try{return ft=this,t()}finally{ft=i}}}on(){ft=this}off(){ft=this.parent}stop(t){if(this.active){let i,n;for(i=0,n=this.effects.length;i<n;i++)this.effects[i].stop();for(i=0,n=this.cleanups.length;i<n;i++)this.cleanups[i]();if(this.scopes)for(i=0,n=this.scopes.length;i<n;i++)this.scopes[i].stop(!0);if(this.parent&&!t){const r=this.parent.scopes.pop();r&&r!==this&&(this.parent.scopes[this.index]=r,r.index=this.index)}this.active=!1}}}function Ys(e,t=ft){t&&t.active&&t.effects.push(e)}const Mn=e=>{const t=new Set(e);return t.w=0,t.n=0,t},sa=e=>(e.w&It)>0,la=e=>(e.n&It)>0,Xs=({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=It},Qs=e=>{const{deps:t}=e;if(t.length){let i=0;for(let n=0;n<t.length;n++){const r=t[n];sa(r)&&!la(r)?r.delete(e):t[i++]=r,r.w&=~It,r.n&=~It}t.length=i}},Zi=new WeakMap;let wr=0,It=1;const en=30;let tt;const Ut=Symbol(""),tn=Symbol("");class On{constructor(t,i=null,n){this.fn=t,this.scheduler=i,this.active=!0,this.deps=[],this.parent=void 0,Ys(this,n)}run(){if(!this.active)return this.fn();let t=tt,i=Pt;for(;t;){if(t===this)return;t=t.parent}try{return this.parent=tt,tt=this,Pt=!0,It=1<<++wr,wr<=en?Xs(this):eo(this),this.fn()}finally{wr<=en&&Qs(this),It=1<<--wr,tt=this.parent,Pt=i,this.parent=void 0,this.deferStop&&this.stop()}}stop(){tt===this?this.deferStop=!0:this.active&&(eo(this),this.onStop&&this.onStop(),this.active=!1)}}function eo(e){const{deps:t}=e;if(t.length){for(let i=0;i<t.length;i++)t[i].delete(e);t.length=0}}let Pt=!0;const ca=[];function lr(){ca.push(Pt),Pt=!1}function cr(){const e=ca.pop();Pt=e===void 0?!0:e}function Xe(e,t,i){if(Pt&&tt){let n=Zi.get(e);n||Zi.set(e,n=new Map);let r=n.get(i);r||n.set(i,r=Mn()),ua(r)}}function ua(e,t){let i=!1;wr<=en?la(e)||(e.n|=It,i=!sa(e)):i=!e.has(tt),i&&(e.add(tt),tt.deps.push(e))}function xt(e,t,i,n,r,o){const a=Zi.get(e);if(!a)return;let l=[];if(t==="clear")l=[...a.values()];else if(i==="length"&&pe(e))a.forEach((u,s)=>{(s==="length"||s>=n)&&l.push(u)});else switch(i!==void 0&&l.push(a.get(i)),t){case"add":pe(e)?Ln(i)&&l.push(a.get("length")):(l.push(a.get(Ut)),_r(e)&&l.push(a.get(tn)));break;case"delete":pe(e)||(l.push(a.get(Ut)),_r(e)&&l.push(a.get(tn)));break;case"set":_r(e)&&l.push(a.get(Ut));break}if(l.length===1)l[0]&&rn(l[0]);else{const u=[];for(const s of l)s&&u.push(...s);rn(Mn(u))}}function rn(e,t){const i=pe(e)?e:[...e];for(const n of i)n.computed&&to(n);for(const n of i)n.computed||to(n)}function to(e,t){(e!==tt||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}const Gs=Sn("__proto__,__v_isRef,__isVue"),ha=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(In)),Js=Bn(),Zs=Bn(!1,!0),el=Bn(!0),ro=tl();function tl(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...i){const n=we(this);for(let o=0,a=this.length;o<a;o++)Xe(n,"get",o+"");const r=n[t](...i);return r===-1||r===!1?n[t](...i.map(we)):r}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...i){lr();const n=we(this)[t].apply(this,i);return cr(),n}}),e}function Bn(e=!1,t=!1){return function(n,r,o){if(r==="__v_isReactive")return!e;if(r==="__v_isReadonly")return e;if(r==="__v_isShallow")return t;if(r==="__v_raw"&&o===(e?t?gl:ya:t?pa:va).get(n))return n;const a=pe(n);if(!e&&a&&ye(ro,r))return Reflect.get(ro,r,o);const l=Reflect.get(n,r,o);return(In(r)?ha.has(r):Gs(r))||(e||Xe(n,"get",r),t)?l:De(l)?a&&Ln(r)?l:l.value:He(l)?e?ga(l):Mr(l):l}}const rl=fa(),il=fa(!0);function fa(e=!1){return function(i,n,r,o){let a=i[n];if(Or(a)&&De(a)&&!De(r))return!1;if(!e&&!Or(r)&&(nn(r)||(r=we(r),a=we(a)),!pe(i)&&De(a)&&!De(r)))return a.value=r,!0;const l=pe(i)&&Ln(n)?Number(n)<i.length:ye(i,n),u=Reflect.set(i,n,r,o);return i===we(o)&&(l?Lr(r,a)&&xt(i,"set",n,r):xt(i,"add",n,r)),u}}function nl(e,t){const i=ye(e,t);e[t];const n=Reflect.deleteProperty(e,t);return n&&i&&xt(e,"delete",t,void 0),n}function ol(e,t){const i=Reflect.has(e,t);return(!In(t)||!ha.has(t))&&Xe(e,"has",t),i}function al(e){return Xe(e,"iterate",pe(e)?"length":Ut),Reflect.ownKeys(e)}const da={get:Js,set:rl,deleteProperty:nl,has:ol,ownKeys:al},sl={get:el,set(e,t){return!0},deleteProperty(e,t){return!0}},ll=Ue({},da,{get:Zs,set:il}),Dn=e=>e,Ai=e=>Reflect.getPrototypeOf(e);function qr(e,t,i=!1,n=!1){e=e.__v_raw;const r=we(e),o=we(t);i||(t!==o&&Xe(r,"get",t),Xe(r,"get",o));const{has:a}=Ai(r),l=n?Dn:i?Fn:Br;if(a.call(r,t))return l(e.get(t));if(a.call(r,o))return l(e.get(o));e!==r&&e.get(t)}function Wr(e,t=!1){const i=this.__v_raw,n=we(i),r=we(e);return t||(e!==r&&Xe(n,"has",e),Xe(n,"has",r)),e===r?i.has(e):i.has(e)||i.has(r)}function Vr(e,t=!1){return e=e.__v_raw,!t&&Xe(we(e),"iterate",Ut),Reflect.get(e,"size",e)}function io(e){e=we(e);const t=we(this);return Ai(t).has.call(t,e)||(t.add(e),xt(t,"add",e,e)),this}function no(e,t){t=we(t);const i=we(this),{has:n,get:r}=Ai(i);let o=n.call(i,e);o||(e=we(e),o=n.call(i,e));const a=r.call(i,e);return i.set(e,t),o?Lr(t,a)&&xt(i,"set",e,t):xt(i,"add",e,t),this}function oo(e){const t=we(this),{has:i,get:n}=Ai(t);let r=i.call(t,e);r||(e=we(e),r=i.call(t,e)),n&&n.call(t,e);const o=t.delete(e);return r&&xt(t,"delete",e,void 0),o}function ao(){const e=we(this),t=e.size!==0,i=e.clear();return t&&xt(e,"clear",void 0,void 0),i}function Kr(e,t){return function(n,r){const o=this,a=o.__v_raw,l=we(a),u=t?Dn:e?Fn:Br;return!e&&Xe(l,"iterate",Ut),a.forEach((s,c)=>n.call(r,u(s),u(c),o))}}function $r(e,t,i){return function(...n){const r=this.__v_raw,o=we(r),a=_r(o),l=e==="entries"||e===Symbol.iterator&&a,u=e==="keys"&&a,s=r[e](...n),c=i?Dn:t?Fn:Br;return!t&&Xe(o,"iterate",u?tn:Ut),{next(){const{value:h,done:f}=s.next();return f?{value:h,done:f}:{value:l?[c(h[0]),c(h[1])]:c(h),done:f}},[Symbol.iterator](){return this}}}}function Tt(e){return function(...t){return e==="delete"?!1:this}}function cl(){const e={get(o){return qr(this,o)},get size(){return Vr(this)},has:Wr,add:io,set:no,delete:oo,clear:ao,forEach:Kr(!1,!1)},t={get(o){return qr(this,o,!1,!0)},get size(){return Vr(this)},has:Wr,add:io,set:no,delete:oo,clear:ao,forEach:Kr(!1,!0)},i={get(o){return qr(this,o,!0)},get size(){return Vr(this,!0)},has(o){return Wr.call(this,o,!0)},add:Tt("add"),set:Tt("set"),delete:Tt("delete"),clear:Tt("clear"),forEach:Kr(!0,!1)},n={get(o){return qr(this,o,!0,!0)},get size(){return Vr(this,!0)},has(o){return Wr.call(this,o,!0)},add:Tt("add"),set:Tt("set"),delete:Tt("delete"),clear:Tt("clear"),forEach:Kr(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(o=>{e[o]=$r(o,!1,!1),i[o]=$r(o,!0,!1),t[o]=$r(o,!1,!0),n[o]=$r(o,!0,!0)}),[e,i,t,n]}const[ul,hl,fl,dl]=cl();function Nn(e,t){const i=t?e?dl:fl:e?hl:ul;return(n,r,o)=>r==="__v_isReactive"?!e:r==="__v_isReadonly"?e:r==="__v_raw"?n:Reflect.get(ye(i,r)&&r in n?i:n,r,o)}const vl={get:Nn(!1,!1)},pl={get:Nn(!1,!0)},yl={get:Nn(!0,!1)},va=new WeakMap,pa=new WeakMap,ya=new WeakMap,gl=new WeakMap;function ml(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function wl(e){return e.__v_skip||!Object.isExtensible(e)?0:ml(Us(e))}function Mr(e){return Or(e)?e:jn(e,!1,da,vl,va)}function bl(e){return jn(e,!1,ll,pl,pa)}function ga(e){return jn(e,!0,sl,yl,ya)}function jn(e,t,i,n,r){if(!He(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const o=r.get(e);if(o)return o;const a=wl(e);if(a===0)return e;const l=new Proxy(e,a===2?n:i);return r.set(e,l),l}function tr(e){return Or(e)?tr(e.__v_raw):!!(e&&e.__v_isReactive)}function Or(e){return!!(e&&e.__v_isReadonly)}function nn(e){return!!(e&&e.__v_isShallow)}function ma(e){return tr(e)||Or(e)}function we(e){const t=e&&e.__v_raw;return t?we(t):e}function wa(e){return li(e,"__v_skip",!0),e}const Br=e=>He(e)?Mr(e):e,Fn=e=>He(e)?ga(e):e;function ba(e){Pt&&tt&&(e=we(e),ua(e.dep||(e.dep=Mn())))}function xa(e,t){e=we(e),e.dep&&rn(e.dep)}function De(e){return!!(e&&e.__v_isRef===!0)}function _a(e){return xl(e,!1)}function xl(e,t){return De(e)?e:new _l(e,t)}class _l{constructor(t,i){this.__v_isShallow=i,this.dep=void 0,this.__v_isRef=!0,this._rawValue=i?t:we(t),this._value=i?t:Br(t)}get value(){return ba(this),this._value}set value(t){t=this.__v_isShallow?t:we(t),Lr(t,this._rawValue)&&(this._rawValue=t,this._value=this.__v_isShallow?t:Br(t),xa(this))}}function ka(e){return De(e)?e.value:e}const kl={get:(e,t,i)=>ka(Reflect.get(e,t,i)),set:(e,t,i,n)=>{const r=e[t];return De(r)&&!De(i)?(r.value=i,!0):Reflect.set(e,t,i,n)}};function Ta(e){return tr(e)?e:new Proxy(e,kl)}class Tl{constructor(t,i,n,r){this._setter=i,this.dep=void 0,this.__v_isRef=!0,this._dirty=!0,this.effect=new On(t,()=>{this._dirty||(this._dirty=!0,xa(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!r,this.__v_isReadonly=n}get value(){const t=we(this);return ba(t),(t._dirty||!t._cacheable)&&(t._dirty=!1,t._value=t.effect.run()),t._value}set value(t){this._setter(t)}}function Al(e,t,i=!1){let n,r;const o=ve(e);return o?(n=e,r=it):(n=e.get,r=e.set),new Tl(n,r,o||!r,i)}function Rt(e,t,i,n){let r;try{r=n?e(...n):e()}catch(o){Si(o,t,i)}return r}function nt(e,t,i,n){if(ve(e)){const o=Rt(e,t,i,n);return o&&oa(o)&&o.catch(a=>{Si(a,t,i)}),o}const r=[];for(let o=0;o<e.length;o++)r.push(nt(e[o],t,i,n));return r}function Si(e,t,i,n=!0){const r=t?t.vnode:null;if(t){let o=t.parent;const a=t.proxy,l=i;for(;o;){const s=o.ec;if(s){for(let c=0;c<s.length;c++)if(s[c](e,a,l)===!1)return}o=o.parent}const u=t.appContext.config.errorHandler;if(u){Rt(u,null,10,[e,a,l]);return}}Sl(e,i,r,n)}function Sl(e,t,i,n=!0){console.error(e)}let ci=!1,on=!1;const $e=[];let mt=0;const kr=[];let br=null,Yt=0;const Tr=[];let Et=null,Xt=0;const Aa=Promise.resolve();let zn=null,an=null;function El(e){const t=zn||Aa;return e?t.then(this?e.bind(this):e):t}function Cl(e){let t=mt+1,i=$e.length;for(;t<i;){const n=t+i>>>1;Dr($e[n])<e?t=n+1:i=n}return t}function Sa(e){(!$e.length||!$e.includes(e,ci&&e.allowRecurse?mt+1:mt))&&e!==an&&(e.id==null?$e.push(e):$e.splice(Cl(e.id),0,e),Ea())}function Ea(){!ci&&!on&&(on=!0,zn=Aa.then(Ra))}function Pl(e){const t=$e.indexOf(e);t>mt&&$e.splice(t,1)}function Ca(e,t,i,n){pe(e)?i.push(...e):(!t||!t.includes(e,e.allowRecurse?n+1:n))&&i.push(e),Ea()}function Rl(e){Ca(e,br,kr,Yt)}function Il(e){Ca(e,Et,Tr,Xt)}function Ei(e,t=null){if(kr.length){for(an=t,br=[...new Set(kr)],kr.length=0,Yt=0;Yt<br.length;Yt++)br[Yt]();br=null,Yt=0,an=null,Ei(e,t)}}function Pa(e){if(Ei(),Tr.length){const t=[...new Set(Tr)];if(Tr.length=0,Et){Et.push(...t);return}for(Et=t,Et.sort((i,n)=>Dr(i)-Dr(n)),Xt=0;Xt<Et.length;Xt++)Et[Xt]();Et=null,Xt=0}}const Dr=e=>e.id==null?1/0:e.id;function Ra(e){on=!1,ci=!0,Ei(e),$e.sort((i,n)=>Dr(i)-Dr(n));const t=it;try{for(mt=0;mt<$e.length;mt++){const i=$e[mt];i&&i.active!==!1&&Rt(i,null,14)}}finally{mt=0,$e.length=0,Pa(),ci=!1,zn=null,($e.length||kr.length||Tr.length)&&Ra(e)}}function Ll(e,t,...i){if(e.isUnmounted)return;const n=e.vnode.props||Se;let r=i;const o=t.startsWith("update:"),a=o&&t.slice(7);if(a&&a in n){const c=`${a==="modelValue"?"model":a}Modifiers`,{number:h,trim:f}=n[c]||Se;f&&(r=i.map(d=>d.trim())),h&&(r=i.map(Vs))}let l,u=n[l=Di(t)]||n[l=Di(ir(t))];!u&&o&&(u=n[l=Di(sr(t))]),u&&nt(u,e,6,r);const s=n[l+"Once"];if(s){if(!e.emitted)e.emitted={};else if(e.emitted[l])return;e.emitted[l]=!0,nt(s,e,6,r)}}function Ia(e,t,i=!1){const n=t.emitsCache,r=n.get(e);if(r!==void 0)return r;const o=e.emits;let a={},l=!1;if(!ve(e)){const u=s=>{const c=Ia(s,t,!0);c&&(l=!0,Ue(a,c))};!i&&t.mixins.length&&t.mixins.forEach(u),e.extends&&u(e.extends),e.mixins&&e.mixins.forEach(u)}return!o&&!l?(n.set(e,null),null):(pe(o)?o.forEach(u=>a[u]=null):Ue(a,o),n.set(e,a),a)}function Ci(e,t){return!e||!_i(t)?!1:(t=t.slice(2).replace(/Once$/,""),ye(e,t[0].toLowerCase()+t.slice(1))||ye(e,sr(t))||ye(e,t))}let pt=null,La=null;function ui(e){const t=pt;return pt=e,La=e&&e.type.__scopeId||null,t}function Ma(e,t=pt,i){if(!t||e._n)return e;const n=(...r)=>{n._d&&yo(-1);const o=ui(t),a=e(...r);return ui(o),n._d&&yo(1),a};return n._n=!0,n._c=!0,n._d=!0,n}function ji(e){const{type:t,vnode:i,proxy:n,withProxy:r,props:o,propsOptions:[a],slots:l,attrs:u,emit:s,render:c,renderCache:h,data:f,setupState:d,ctx:v,inheritAttrs:g}=e;let p,b;const x=ui(e);try{if(i.shapeFlag&4){const _=r||n;p=vt(c.call(_,_,h,o,d,f,v)),b=u}else{const _=t;p=vt(_.length>1?_(o,{attrs:u,slots:l,emit:s}):_(o,null)),b=t.props?u:Ml(u)}}catch(_){Ar.length=0,Si(_,e,1),p=me(Nr)}let m=p;if(b&&g!==!1){const _=Object.keys(b),{shapeFlag:P}=m;_.length&&P&7&&(a&&_.some(Pn)&&(b=Ol(b,a)),m=nr(m,b))}return i.dirs&&(m=nr(m),m.dirs=m.dirs?m.dirs.concat(i.dirs):i.dirs),i.transition&&(m.transition=i.transition),p=m,ui(x),p}const Ml=e=>{let t;for(const i in e)(i==="class"||i==="style"||_i(i))&&((t||(t={}))[i]=e[i]);return t},Ol=(e,t)=>{const i={};for(const n in e)(!Pn(n)||!(n.slice(9)in t))&&(i[n]=e[n]);return i};function Bl(e,t,i){const{props:n,children:r,component:o}=e,{props:a,children:l,patchFlag:u}=t,s=o.emitsOptions;if(t.dirs||t.transition)return!0;if(i&&u>=0){if(u&1024)return!0;if(u&16)return n?so(n,a,s):!!a;if(u&8){const c=t.dynamicProps;for(let h=0;h<c.length;h++){const f=c[h];if(a[f]!==n[f]&&!Ci(s,f))return!0}}}else return(r||l)&&(!l||!l.$stable)?!0:n===a?!1:n?a?so(n,a,s):!0:!!a;return!1}function so(e,t,i){const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!0;for(let r=0;r<n.length;r++){const o=n[r];if(t[o]!==e[o]&&!Ci(i,o))return!0}return!1}function Dl({vnode:e,parent:t},i){for(;t&&t.subTree===e;)(e=t.vnode).el=i,t=t.parent}const Nl=e=>e.__isSuspense;function jl(e,t){t&&t.pendingBranch?pe(e)?t.effects.push(...e):t.effects.push(e):Il(e)}function Fl(e,t){if(Be){let i=Be.provides;const n=Be.parent&&Be.parent.provides;n===i&&(i=Be.provides=Object.create(n)),i[e]=t}}function Fi(e,t,i=!1){const n=Be||pt;if(n){const r=n.parent==null?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides;if(r&&e in r)return r[e];if(arguments.length>1)return i&&ve(t)?t.call(n.proxy):t}}const lo={};function zi(e,t,i){return Oa(e,t,i)}function Oa(e,t,{immediate:i,deep:n,flush:r,onTrack:o,onTrigger:a}=Se){const l=Be;let u,s=!1,c=!1;if(De(e)?(u=()=>e.value,s=nn(e)):tr(e)?(u=()=>e,n=!0):pe(e)?(c=!0,s=e.some(b=>tr(b)||nn(b)),u=()=>e.map(b=>{if(De(b))return b.value;if(tr(b))return jt(b);if(ve(b))return Rt(b,l,2)})):ve(e)?t?u=()=>Rt(e,l,2):u=()=>{if(!(l&&l.isUnmounted))return h&&h(),nt(e,l,3,[f])}:u=it,t&&n){const b=u;u=()=>jt(b())}let h,f=b=>{h=p.onStop=()=>{Rt(b,l,4)}};if(Fr)return f=it,t?i&&nt(t,l,3,[u(),c?[]:void 0,f]):u(),it;let d=c?[]:lo;const v=()=>{if(!!p.active)if(t){const b=p.run();(n||s||(c?b.some((x,m)=>Lr(x,d[m])):Lr(b,d)))&&(h&&h(),nt(t,l,3,[b,d===lo?void 0:d,f]),d=b)}else p.run()};v.allowRecurse=!!t;let g;r==="sync"?g=v:r==="post"?g=()=>We(v,l&&l.suspense):g=()=>Rl(v);const p=new On(u,g);return t?i?v():d=p.run():r==="post"?We(p.run.bind(p),l&&l.suspense):p.run(),()=>{p.stop(),l&&l.scope&&Rn(l.scope.effects,p)}}function zl(e,t,i){const n=this.proxy,r=je(e)?e.includes(".")?Ba(n,e):()=>n[e]:e.bind(n,n);let o;ve(t)?o=t:(o=t.handler,i=t);const a=Be;or(this);const l=Oa(r,o.bind(n),i);return a?or(a):Ht(),l}function Ba(e,t){const i=t.split(".");return()=>{let n=e;for(let r=0;r<i.length&&n;r++)n=n[i[r]];return n}}function jt(e,t){if(!He(e)||e.__v_skip||(t=t||new Set,t.has(e)))return e;if(t.add(e),De(e))jt(e.value,t);else if(pe(e))for(let i=0;i<e.length;i++)jt(e[i],t);else if(Fs(e)||_r(e))e.forEach(i=>{jt(i,t)});else if(Hs(e))for(const i in e)jt(e[i],t);return e}function ur(e){return ve(e)?{setup:e,name:e.name}:e}const ri=e=>!!e.type.__asyncLoader,Da=e=>e.type.__isKeepAlive;function Ul(e,t){Na(e,"a",t)}function Hl(e,t){Na(e,"da",t)}function Na(e,t,i=Be){const n=e.__wdc||(e.__wdc=()=>{let r=i;for(;r;){if(r.isDeactivated)return;r=r.parent}return e()});if(Pi(t,n,i),i){let r=i.parent;for(;r&&r.parent;)Da(r.parent.vnode)&&ql(n,t,i,r),r=r.parent}}function ql(e,t,i,n){const r=Pi(t,e,n,!0);Un(()=>{Rn(n[t],r)},i)}function Pi(e,t,i=Be,n=!1){if(i){const r=i[e]||(i[e]=[]),o=t.__weh||(t.__weh=(...a)=>{if(i.isUnmounted)return;lr(),or(i);const l=nt(t,i,e,a);return Ht(),cr(),l});return n?r.unshift(o):r.push(o),o}}const kt=e=>(t,i=Be)=>(!Fr||e==="sp")&&Pi(e,t,i),Wl=kt("bm"),ja=kt("m"),Vl=kt("bu"),Kl=kt("u"),$l=kt("bum"),Un=kt("um"),Yl=kt("sp"),Xl=kt("rtg"),Ql=kt("rtc");function Gl(e,t=Be){Pi("ec",e,t)}function Jl(e,t){const i=pt;if(i===null)return e;const n=Ii(i)||i.proxy,r=e.dirs||(e.dirs=[]);for(let o=0;o<t.length;o++){let[a,l,u,s=Se]=t[o];ve(a)&&(a={mounted:a,updated:a}),a.deep&&jt(l),r.push({dir:a,instance:n,value:l,oldValue:void 0,arg:u,modifiers:s})}return e}function Lt(e,t,i,n){const r=e.dirs,o=t&&t.dirs;for(let a=0;a<r.length;a++){const l=r[a];o&&(l.oldValue=o[a].value);let u=l.dir[n];u&&(lr(),nt(u,i,8,[e.el,l,e,t]),cr())}}const Zl=Symbol(),sn=e=>e?Qa(e)?Ii(e)||e.proxy:sn(e.parent):null,hi=Ue(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>sn(e.parent),$root:e=>sn(e.root),$emit:e=>e.emit,$options:e=>za(e),$forceUpdate:e=>e.f||(e.f=()=>Sa(e.update)),$nextTick:e=>e.n||(e.n=El.bind(e.proxy)),$watch:e=>zl.bind(e)}),ec={get({_:e},t){const{ctx:i,setupState:n,data:r,props:o,accessCache:a,type:l,appContext:u}=e;let s;if(t[0]!=="$"){const d=a[t];if(d!==void 0)switch(d){case 1:return n[t];case 2:return r[t];case 4:return i[t];case 3:return o[t]}else{if(n!==Se&&ye(n,t))return a[t]=1,n[t];if(r!==Se&&ye(r,t))return a[t]=2,r[t];if((s=e.propsOptions[0])&&ye(s,t))return a[t]=3,o[t];if(i!==Se&&ye(i,t))return a[t]=4,i[t];ln&&(a[t]=0)}}const c=hi[t];let h,f;if(c)return t==="$attrs"&&Xe(e,"get",t),c(e);if((h=l.__cssModules)&&(h=h[t]))return h;if(i!==Se&&ye(i,t))return a[t]=4,i[t];if(f=u.config.globalProperties,ye(f,t))return f[t]},set({_:e},t,i){const{data:n,setupState:r,ctx:o}=e;return r!==Se&&ye(r,t)?(r[t]=i,!0):n!==Se&&ye(n,t)?(n[t]=i,!0):ye(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(o[t]=i,!0)},has({_:{data:e,setupState:t,accessCache:i,ctx:n,appContext:r,propsOptions:o}},a){let l;return!!i[a]||e!==Se&&ye(e,a)||t!==Se&&ye(t,a)||(l=o[0])&&ye(l,a)||ye(n,a)||ye(hi,a)||ye(r.config.globalProperties,a)},defineProperty(e,t,i){return i.get!=null?e._.accessCache[t]=0:ye(i,"value")&&this.set(e,t,i.value,null),Reflect.defineProperty(e,t,i)}};let ln=!0;function tc(e){const t=za(e),i=e.proxy,n=e.ctx;ln=!1,t.beforeCreate&&co(t.beforeCreate,e,"bc");const{data:r,computed:o,methods:a,watch:l,provide:u,inject:s,created:c,beforeMount:h,mounted:f,beforeUpdate:d,updated:v,activated:g,deactivated:p,beforeDestroy:b,beforeUnmount:x,destroyed:m,unmounted:_,render:P,renderTracked:R,renderTriggered:L,errorCaptured:I,serverPrefetch:V,expose:Q,inheritAttrs:T,components:k,directives:M,filters:C}=t;if(s&&rc(s,n,null,e.appContext.config.unwrapInjectedRef),a)for(const W in a){const F=a[W];ve(F)&&(n[W]=F.bind(i))}if(r){const W=r.call(i,i);He(W)&&(e.data=Mr(W))}if(ln=!0,o)for(const W in o){const F=o[W],D=ve(F)?F.bind(i,i):ve(F.get)?F.get.bind(i,i):it,z=!ve(F)&&ve(F.set)?F.set.bind(i):it,U=vi({get:D,set:z});Object.defineProperty(n,W,{enumerable:!0,configurable:!0,get:()=>U.value,set:N=>U.value=N})}if(l)for(const W in l)Fa(l[W],n,i,W);if(u){const W=ve(u)?u.call(i):u;Reflect.ownKeys(W).forEach(F=>{Fl(F,W[F])})}c&&co(c,e,"c");function H(W,F){pe(F)?F.forEach(D=>W(D.bind(i))):F&&W(F.bind(i))}if(H(Wl,h),H(ja,f),H(Vl,d),H(Kl,v),H(Ul,g),H(Hl,p),H(Gl,I),H(Ql,R),H(Xl,L),H($l,x),H(Un,_),H(Yl,V),pe(Q))if(Q.length){const W=e.exposed||(e.exposed={});Q.forEach(F=>{Object.defineProperty(W,F,{get:()=>i[F],set:D=>i[F]=D})})}else e.exposed||(e.exposed={});P&&e.render===it&&(e.render=P),T!=null&&(e.inheritAttrs=T),k&&(e.components=k),M&&(e.directives=M)}function rc(e,t,i=it,n=!1){pe(e)&&(e=cn(e));for(const r in e){const o=e[r];let a;He(o)?"default"in o?a=Fi(o.from||r,o.default,!0):a=Fi(o.from||r):a=Fi(o),De(a)&&n?Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:()=>a.value,set:l=>a.value=l}):t[r]=a}}function co(e,t,i){nt(pe(e)?e.map(n=>n.bind(t.proxy)):e.bind(t.proxy),t,i)}function Fa(e,t,i,n){const r=n.includes(".")?Ba(i,n):()=>i[n];if(je(e)){const o=t[e];ve(o)&&zi(r,o)}else if(ve(e))zi(r,e.bind(i));else if(He(e))if(pe(e))e.forEach(o=>Fa(o,t,i,n));else{const o=ve(e.handler)?e.handler.bind(i):t[e.handler];ve(o)&&zi(r,o,e)}}function za(e){const t=e.type,{mixins:i,extends:n}=t,{mixins:r,optionsCache:o,config:{optionMergeStrategies:a}}=e.appContext,l=o.get(t);let u;return l?u=l:!r.length&&!i&&!n?u=t:(u={},r.length&&r.forEach(s=>fi(u,s,a,!0)),fi(u,t,a)),o.set(t,u),u}function fi(e,t,i,n=!1){const{mixins:r,extends:o}=t;o&&fi(e,o,i,!0),r&&r.forEach(a=>fi(e,a,i,!0));for(const a in t)if(!(n&&a==="expose")){const l=ic[a]||i&&i[a];e[a]=l?l(e[a],t[a]):t[a]}return e}const ic={data:uo,props:Bt,emits:Bt,methods:Bt,computed:Bt,beforeCreate:Fe,created:Fe,beforeMount:Fe,mounted:Fe,beforeUpdate:Fe,updated:Fe,beforeDestroy:Fe,beforeUnmount:Fe,destroyed:Fe,unmounted:Fe,activated:Fe,deactivated:Fe,errorCaptured:Fe,serverPrefetch:Fe,components:Bt,directives:Bt,watch:oc,provide:uo,inject:nc};function uo(e,t){return t?e?function(){return Ue(ve(e)?e.call(this,this):e,ve(t)?t.call(this,this):t)}:t:e}function nc(e,t){return Bt(cn(e),cn(t))}function cn(e){if(pe(e)){const t={};for(let i=0;i<e.length;i++)t[e[i]]=e[i];return t}return e}function Fe(e,t){return e?[...new Set([].concat(e,t))]:t}function Bt(e,t){return e?Ue(Ue(Object.create(null),e),t):t}function oc(e,t){if(!e)return t;if(!t)return e;const i=Ue(Object.create(null),e);for(const n in t)i[n]=Fe(e[n],t[n]);return i}function ac(e,t,i,n=!1){const r={},o={};li(o,Ri,1),e.propsDefaults=Object.create(null),Ua(e,t,r,o);for(const a in e.propsOptions[0])a in r||(r[a]=void 0);i?e.props=n?r:bl(r):e.type.props?e.props=r:e.props=o,e.attrs=o}function sc(e,t,i,n){const{props:r,attrs:o,vnode:{patchFlag:a}}=e,l=we(r),[u]=e.propsOptions;let s=!1;if((n||a>0)&&!(a&16)){if(a&8){const c=e.vnode.dynamicProps;for(let h=0;h<c.length;h++){let f=c[h];if(Ci(e.emitsOptions,f))continue;const d=t[f];if(u)if(ye(o,f))d!==o[f]&&(o[f]=d,s=!0);else{const v=ir(f);r[v]=un(u,l,v,d,e,!1)}else d!==o[f]&&(o[f]=d,s=!0)}}}else{Ua(e,t,r,o)&&(s=!0);let c;for(const h in l)(!t||!ye(t,h)&&((c=sr(h))===h||!ye(t,c)))&&(u?i&&(i[h]!==void 0||i[c]!==void 0)&&(r[h]=un(u,l,h,void 0,e,!0)):delete r[h]);if(o!==l)for(const h in o)(!t||!ye(t,h)&&!0)&&(delete o[h],s=!0)}s&&xt(e,"set","$attrs")}function Ua(e,t,i,n){const[r,o]=e.propsOptions;let a=!1,l;if(t)for(let u in t){if(ti(u))continue;const s=t[u];let c;r&&ye(r,c=ir(u))?!o||!o.includes(c)?i[c]=s:(l||(l={}))[c]=s:Ci(e.emitsOptions,u)||(!(u in n)||s!==n[u])&&(n[u]=s,a=!0)}if(o){const u=we(i),s=l||Se;for(let c=0;c<o.length;c++){const h=o[c];i[h]=un(r,u,h,s[h],e,!ye(s,h))}}return a}function un(e,t,i,n,r,o){const a=e[i];if(a!=null){const l=ye(a,"default");if(l&&n===void 0){const u=a.default;if(a.type!==Function&&ve(u)){const{propsDefaults:s}=r;i in s?n=s[i]:(or(r),n=s[i]=u.call(null,t),Ht())}else n=u}a[0]&&(o&&!l?n=!1:a[1]&&(n===""||n===sr(i))&&(n=!0))}return n}function Ha(e,t,i=!1){const n=t.propsCache,r=n.get(e);if(r)return r;const o=e.props,a={},l=[];let u=!1;if(!ve(e)){const c=h=>{u=!0;const[f,d]=Ha(h,t,!0);Ue(a,f),d&&l.push(...d)};!i&&t.mixins.length&&t.mixins.forEach(c),e.extends&&c(e.extends),e.mixins&&e.mixins.forEach(c)}if(!o&&!u)return n.set(e,er),er;if(pe(o))for(let c=0;c<o.length;c++){const h=ir(o[c]);ho(h)&&(a[h]=Se)}else if(o)for(const c in o){const h=ir(c);if(ho(h)){const f=o[c],d=a[h]=pe(f)||ve(f)?{type:f}:f;if(d){const v=po(Boolean,d.type),g=po(String,d.type);d[0]=v>-1,d[1]=g<0||v<g,(v>-1||ye(d,"default"))&&l.push(h)}}}const s=[a,l];return n.set(e,s),s}function ho(e){return e[0]!=="$"}function fo(e){const t=e&&e.toString().match(/^\s*function (\w+)/);return t?t[1]:e===null?"null":""}function vo(e,t){return fo(e)===fo(t)}function po(e,t){return pe(t)?t.findIndex(i=>vo(i,e)):ve(t)&&vo(t,e)?0:-1}const qa=e=>e[0]==="_"||e==="$stable",Hn=e=>pe(e)?e.map(vt):[vt(e)],lc=(e,t,i)=>{if(t._n)return t;const n=Ma((...r)=>Hn(t(...r)),i);return n._c=!1,n},Wa=(e,t,i)=>{const n=e._ctx;for(const r in e){if(qa(r))continue;const o=e[r];if(ve(o))t[r]=lc(r,o,n);else if(o!=null){const a=Hn(o);t[r]=()=>a}}},Va=(e,t)=>{const i=Hn(t);e.slots.default=()=>i},cc=(e,t)=>{if(e.vnode.shapeFlag&32){const i=t._;i?(e.slots=we(t),li(t,"_",i)):Wa(t,e.slots={})}else e.slots={},t&&Va(e,t);li(e.slots,Ri,1)},uc=(e,t,i)=>{const{vnode:n,slots:r}=e;let o=!0,a=Se;if(n.shapeFlag&32){const l=t._;l?i&&l===1?o=!1:(Ue(r,t),!i&&l===1&&delete r._):(o=!t.$stable,Wa(t,r)),a=t}else t&&(Va(e,t),a={default:1});if(o)for(const l in r)!qa(l)&&!(l in a)&&delete r[l]};function Ka(){return{app:null,config:{isNativeTag:Ds,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let hc=0;function fc(e,t){return function(n,r=null){ve(n)||(n=Object.assign({},n)),r!=null&&!He(r)&&(r=null);const o=Ka(),a=new Set;let l=!1;const u=o.app={_uid:hc++,_component:n,_props:r,_container:null,_context:o,_instance:null,version:Mc,get config(){return o.config},set config(s){},use(s,...c){return a.has(s)||(s&&ve(s.install)?(a.add(s),s.install(u,...c)):ve(s)&&(a.add(s),s(u,...c))),u},mixin(s){return o.mixins.includes(s)||o.mixins.push(s),u},component(s,c){return c?(o.components[s]=c,u):o.components[s]},directive(s,c){return c?(o.directives[s]=c,u):o.directives[s]},mount(s,c,h){if(!l){const f=me(n,r);return f.appContext=o,c&&t?t(f,s):e(f,s,h),l=!0,u._container=s,s.__vue_app__=u,Ii(f.component)||f.component.proxy}},unmount(){l&&(e(null,u._container),delete u._container.__vue_app__)},provide(s,c){return o.provides[s]=c,u}};return u}}function hn(e,t,i,n,r=!1){if(pe(e)){e.forEach((f,d)=>hn(f,t&&(pe(t)?t[d]:t),i,n,r));return}if(ri(n)&&!r)return;const o=n.shapeFlag&4?Ii(n.component)||n.component.proxy:n.el,a=r?null:o,{i:l,r:u}=e,s=t&&t.r,c=l.refs===Se?l.refs={}:l.refs,h=l.setupState;if(s!=null&&s!==u&&(je(s)?(c[s]=null,ye(h,s)&&(h[s]=null)):De(s)&&(s.value=null)),ve(u))Rt(u,l,12,[a,c]);else{const f=je(u),d=De(u);if(f||d){const v=()=>{if(e.f){const g=f?c[u]:u.value;r?pe(g)&&Rn(g,o):pe(g)?g.includes(o)||g.push(o):f?(c[u]=[o],ye(h,u)&&(h[u]=c[u])):(u.value=[o],e.k&&(c[e.k]=u.value))}else f?(c[u]=a,ye(h,u)&&(h[u]=a)):d&&(u.value=a,e.k&&(c[e.k]=a))};a?(v.id=-1,We(v,i)):v()}}}const We=jl;function dc(e){return vc(e)}function vc(e,t){const i=Ks();i.__VUE__=!0;const{insert:n,remove:r,patchProp:o,createElement:a,createText:l,createComment:u,setText:s,setElementText:c,parentNode:h,nextSibling:f,setScopeId:d=it,cloneNode:v,insertStaticContent:g}=e,p=(S,E,j,Y=null,K=null,G=null,ee=!1,ie=null,ne=!!E.dynamicChildren)=>{if(S===E)return;S&&!fr(S,E)&&(Y=te(S),q(S,K,G,!0),S=null),E.patchFlag===-2&&(ne=!1,E.dynamicChildren=null);const{type:re,ref:ae,shapeFlag:oe}=E;switch(re){case qn:b(S,E,j,Y);break;case Nr:x(S,E,j,Y);break;case Ui:S==null&&m(E,j,Y,ee);break;case dt:M(S,E,j,Y,K,G,ee,ie,ne);break;default:oe&1?R(S,E,j,Y,K,G,ee,ie,ne):oe&6?C(S,E,j,Y,K,G,ee,ie,ne):(oe&64||oe&128)&&re.process(S,E,j,Y,K,G,ee,ie,ne,w)}ae!=null&&K&&hn(ae,S&&S.ref,G,E||S,!E)},b=(S,E,j,Y)=>{if(S==null)n(E.el=l(E.children),j,Y);else{const K=E.el=S.el;E.children!==S.children&&s(K,E.children)}},x=(S,E,j,Y)=>{S==null?n(E.el=u(E.children||""),j,Y):E.el=S.el},m=(S,E,j,Y)=>{[S.el,S.anchor]=g(S.children,E,j,Y,S.el,S.anchor)},_=({el:S,anchor:E},j,Y)=>{let K;for(;S&&S!==E;)K=f(S),n(S,j,Y),S=K;n(E,j,Y)},P=({el:S,anchor:E})=>{let j;for(;S&&S!==E;)j=f(S),r(S),S=j;r(E)},R=(S,E,j,Y,K,G,ee,ie,ne)=>{ee=ee||E.type==="svg",S==null?L(E,j,Y,K,G,ee,ie,ne):Q(S,E,K,G,ee,ie,ne)},L=(S,E,j,Y,K,G,ee,ie)=>{let ne,re;const{type:ae,props:oe,shapeFlag:le,transition:ue,patchFlag:ge,dirs:xe}=S;if(S.el&&v!==void 0&&ge===-1)ne=S.el=v(S.el);else{if(ne=S.el=a(S.type,G,oe&&oe.is,oe),le&8?c(ne,S.children):le&16&&V(S.children,ne,null,Y,K,G&&ae!=="foreignObject",ee,ie),xe&&Lt(S,null,Y,"created"),oe){for(const Ee in oe)Ee!=="value"&&!ti(Ee)&&o(ne,Ee,null,oe[Ee],G,S.children,Y,K,J);"value"in oe&&o(ne,"value",null,oe.value),(re=oe.onVnodeBeforeMount)&&at(re,Y,S)}I(ne,S,S.scopeId,ee,Y)}xe&&Lt(S,null,Y,"beforeMount");const _e=(!K||K&&!K.pendingBranch)&&ue&&!ue.persisted;_e&&ue.beforeEnter(ne),n(ne,E,j),((re=oe&&oe.onVnodeMounted)||_e||xe)&&We(()=>{re&&at(re,Y,S),_e&&ue.enter(ne),xe&&Lt(S,null,Y,"mounted")},K)},I=(S,E,j,Y,K)=>{if(j&&d(S,j),Y)for(let G=0;G<Y.length;G++)d(S,Y[G]);if(K){let G=K.subTree;if(E===G){const ee=K.vnode;I(S,ee,ee.scopeId,ee.slotScopeIds,K.parent)}}},V=(S,E,j,Y,K,G,ee,ie,ne=0)=>{for(let re=ne;re<S.length;re++){const ae=S[re]=ie?Ct(S[re]):vt(S[re]);p(null,ae,E,j,Y,K,G,ee,ie)}},Q=(S,E,j,Y,K,G,ee)=>{const ie=E.el=S.el;let{patchFlag:ne,dynamicChildren:re,dirs:ae}=E;ne|=S.patchFlag&16;const oe=S.props||Se,le=E.props||Se;let ue;j&&Mt(j,!1),(ue=le.onVnodeBeforeUpdate)&&at(ue,j,E,S),ae&&Lt(E,S,j,"beforeUpdate"),j&&Mt(j,!0);const ge=K&&E.type!=="foreignObject";if(re?T(S.dynamicChildren,re,ie,j,Y,ge,G):ee||D(S,E,ie,null,j,Y,ge,G,!1),ne>0){if(ne&16)k(ie,E,oe,le,j,Y,K);else if(ne&2&&oe.class!==le.class&&o(ie,"class",null,le.class,K),ne&4&&o(ie,"style",oe.style,le.style,K),ne&8){const xe=E.dynamicProps;for(let _e=0;_e<xe.length;_e++){const Ee=xe[_e],Ze=oe[Ee],Vt=le[Ee];(Vt!==Ze||Ee==="value")&&o(ie,Ee,Ze,Vt,K,S.children,j,Y,J)}}ne&1&&S.children!==E.children&&c(ie,E.children)}else!ee&&re==null&&k(ie,E,oe,le,j,Y,K);((ue=le.onVnodeUpdated)||ae)&&We(()=>{ue&&at(ue,j,E,S),ae&&Lt(E,S,j,"updated")},Y)},T=(S,E,j,Y,K,G,ee)=>{for(let ie=0;ie<E.length;ie++){const ne=S[ie],re=E[ie],ae=ne.el&&(ne.type===dt||!fr(ne,re)||ne.shapeFlag&70)?h(ne.el):j;p(ne,re,ae,null,Y,K,G,ee,!0)}},k=(S,E,j,Y,K,G,ee)=>{if(j!==Y){for(const ie in Y){if(ti(ie))continue;const ne=Y[ie],re=j[ie];ne!==re&&ie!=="value"&&o(S,ie,re,ne,ee,E.children,K,G,J)}if(j!==Se)for(const ie in j)!ti(ie)&&!(ie in Y)&&o(S,ie,j[ie],null,ee,E.children,K,G,J);"value"in Y&&o(S,"value",j.value,Y.value)}},M=(S,E,j,Y,K,G,ee,ie,ne)=>{const re=E.el=S?S.el:l(""),ae=E.anchor=S?S.anchor:l("");let{patchFlag:oe,dynamicChildren:le,slotScopeIds:ue}=E;ue&&(ie=ie?ie.concat(ue):ue),S==null?(n(re,j,Y),n(ae,j,Y),V(E.children,j,ae,K,G,ee,ie,ne)):oe>0&&oe&64&&le&&S.dynamicChildren?(T(S.dynamicChildren,le,j,K,G,ee,ie),(E.key!=null||K&&E===K.subTree)&&$a(S,E,!0)):D(S,E,j,ae,K,G,ee,ie,ne)},C=(S,E,j,Y,K,G,ee,ie,ne)=>{E.slotScopeIds=ie,S==null?E.shapeFlag&512?K.ctx.activate(E,j,Y,ee,ne):B(E,j,Y,K,G,ee,ne):H(S,E,ne)},B=(S,E,j,Y,K,G,ee)=>{const ie=S.component=Ec(S,Y,K);if(Da(S)&&(ie.ctx.renderer=w),Cc(ie),ie.asyncDep){if(K&&K.registerDep(ie,W),!S.el){const ne=ie.subTree=me(Nr);x(null,ne,E,j)}return}W(ie,S,E,j,K,G,ee)},H=(S,E,j)=>{const Y=E.component=S.component;if(Bl(S,E,j))if(Y.asyncDep&&!Y.asyncResolved){F(Y,E,j);return}else Y.next=E,Pl(Y.update),Y.update();else E.el=S.el,Y.vnode=E},W=(S,E,j,Y,K,G,ee)=>{const ie=()=>{if(S.isMounted){let{next:ae,bu:oe,u:le,parent:ue,vnode:ge}=S,xe=ae,_e;Mt(S,!1),ae?(ae.el=ge.el,F(S,ae,ee)):ae=ge,oe&&Ni(oe),(_e=ae.props&&ae.props.onVnodeBeforeUpdate)&&at(_e,ue,ae,ge),Mt(S,!0);const Ee=ji(S),Ze=S.subTree;S.subTree=Ee,p(Ze,Ee,h(Ze.el),te(Ze),S,K,G),ae.el=Ee.el,xe===null&&Dl(S,Ee.el),le&&We(le,K),(_e=ae.props&&ae.props.onVnodeUpdated)&&We(()=>at(_e,ue,ae,ge),K)}else{let ae;const{el:oe,props:le}=E,{bm:ue,m:ge,parent:xe}=S,_e=ri(E);if(Mt(S,!1),ue&&Ni(ue),!_e&&(ae=le&&le.onVnodeBeforeMount)&&at(ae,xe,E),Mt(S,!0),oe&&O){const Ee=()=>{S.subTree=ji(S),O(oe,S.subTree,S,K,null)};_e?E.type.__asyncLoader().then(()=>!S.isUnmounted&&Ee()):Ee()}else{const Ee=S.subTree=ji(S);p(null,Ee,j,Y,S,K,G),E.el=Ee.el}if(ge&&We(ge,K),!_e&&(ae=le&&le.onVnodeMounted)){const Ee=E;We(()=>at(ae,xe,Ee),K)}(E.shapeFlag&256||xe&&ri(xe.vnode)&&xe.vnode.shapeFlag&256)&&S.a&&We(S.a,K),S.isMounted=!0,E=j=Y=null}},ne=S.effect=new On(ie,()=>Sa(re),S.scope),re=S.update=()=>ne.run();re.id=S.uid,Mt(S,!0),re()},F=(S,E,j)=>{E.component=S;const Y=S.vnode.props;S.vnode=E,S.next=null,sc(S,E.props,Y,j),uc(S,E.children,j),lr(),Ei(void 0,S.update),cr()},D=(S,E,j,Y,K,G,ee,ie,ne=!1)=>{const re=S&&S.children,ae=S?S.shapeFlag:0,oe=E.children,{patchFlag:le,shapeFlag:ue}=E;if(le>0){if(le&128){U(re,oe,j,Y,K,G,ee,ie,ne);return}else if(le&256){z(re,oe,j,Y,K,G,ee,ie,ne);return}}ue&8?(ae&16&&J(re,K,G),oe!==re&&c(j,oe)):ae&16?ue&16?U(re,oe,j,Y,K,G,ee,ie,ne):J(re,K,G,!0):(ae&8&&c(j,""),ue&16&&V(oe,j,Y,K,G,ee,ie,ne))},z=(S,E,j,Y,K,G,ee,ie,ne)=>{S=S||er,E=E||er;const re=S.length,ae=E.length,oe=Math.min(re,ae);let le;for(le=0;le<oe;le++){const ue=E[le]=ne?Ct(E[le]):vt(E[le]);p(S[le],ue,j,null,K,G,ee,ie,ne)}re>ae?J(S,K,G,!0,!1,oe):V(E,j,Y,K,G,ee,ie,ne,oe)},U=(S,E,j,Y,K,G,ee,ie,ne)=>{let re=0;const ae=E.length;let oe=S.length-1,le=ae-1;for(;re<=oe&&re<=le;){const ue=S[re],ge=E[re]=ne?Ct(E[re]):vt(E[re]);if(fr(ue,ge))p(ue,ge,j,null,K,G,ee,ie,ne);else break;re++}for(;re<=oe&&re<=le;){const ue=S[oe],ge=E[le]=ne?Ct(E[le]):vt(E[le]);if(fr(ue,ge))p(ue,ge,j,null,K,G,ee,ie,ne);else break;oe--,le--}if(re>oe){if(re<=le){const ue=le+1,ge=ue<ae?E[ue].el:Y;for(;re<=le;)p(null,E[re]=ne?Ct(E[re]):vt(E[re]),j,ge,K,G,ee,ie,ne),re++}}else if(re>le)for(;re<=oe;)q(S[re],K,G,!0),re++;else{const ue=re,ge=re,xe=new Map;for(re=ge;re<=le;re++){const Ve=E[re]=ne?Ct(E[re]):vt(E[re]);Ve.key!=null&&xe.set(Ve.key,re)}let _e,Ee=0;const Ze=le-ge+1;let Vt=!1,Qn=0;const hr=new Array(Ze);for(re=0;re<Ze;re++)hr[re]=0;for(re=ue;re<=oe;re++){const Ve=S[re];if(Ee>=Ze){q(Ve,K,G,!0);continue}let ot;if(Ve.key!=null)ot=xe.get(Ve.key);else for(_e=ge;_e<=le;_e++)if(hr[_e-ge]===0&&fr(Ve,E[_e])){ot=_e;break}ot===void 0?q(Ve,K,G,!0):(hr[ot-ge]=re+1,ot>=Qn?Qn=ot:Vt=!0,p(Ve,E[ot],j,null,K,G,ee,ie,ne),Ee++)}const Gn=Vt?pc(hr):er;for(_e=Gn.length-1,re=Ze-1;re>=0;re--){const Ve=ge+re,ot=E[Ve],Jn=Ve+1<ae?E[Ve+1].el:Y;hr[re]===0?p(null,ot,j,Jn,K,G,ee,ie,ne):Vt&&(_e<0||re!==Gn[_e]?N(ot,j,Jn,2):_e--)}}},N=(S,E,j,Y,K=null)=>{const{el:G,type:ee,transition:ie,children:ne,shapeFlag:re}=S;if(re&6){N(S.component.subTree,E,j,Y);return}if(re&128){S.suspense.move(E,j,Y);return}if(re&64){ee.move(S,E,j,w);return}if(ee===dt){n(G,E,j);for(let oe=0;oe<ne.length;oe++)N(ne[oe],E,j,Y);n(S.anchor,E,j);return}if(ee===Ui){_(S,E,j);return}if(Y!==2&&re&1&&ie)if(Y===0)ie.beforeEnter(G),n(G,E,j),We(()=>ie.enter(G),K);else{const{leave:oe,delayLeave:le,afterLeave:ue}=ie,ge=()=>n(G,E,j),xe=()=>{oe(G,()=>{ge(),ue&&ue()})};le?le(G,ge,xe):xe()}else n(G,E,j)},q=(S,E,j,Y=!1,K=!1)=>{const{type:G,props:ee,ref:ie,children:ne,dynamicChildren:re,shapeFlag:ae,patchFlag:oe,dirs:le}=S;if(ie!=null&&hn(ie,null,j,S,!0),ae&256){E.ctx.deactivate(S);return}const ue=ae&1&&le,ge=!ri(S);let xe;if(ge&&(xe=ee&&ee.onVnodeBeforeUnmount)&&at(xe,E,S),ae&6)Z(S.component,j,Y);else{if(ae&128){S.suspense.unmount(j,Y);return}ue&&Lt(S,null,E,"beforeUnmount"),ae&64?S.type.remove(S,E,j,K,w,Y):re&&(G!==dt||oe>0&&oe&64)?J(re,E,j,!1,!0):(G===dt&&oe&384||!K&&ae&16)&&J(ne,E,j),Y&&X(S)}(ge&&(xe=ee&&ee.onVnodeUnmounted)||ue)&&We(()=>{xe&&at(xe,E,S),ue&&Lt(S,null,E,"unmounted")},j)},X=S=>{const{type:E,el:j,anchor:Y,transition:K}=S;if(E===dt){$(j,Y);return}if(E===Ui){P(S);return}const G=()=>{r(j),K&&!K.persisted&&K.afterLeave&&K.afterLeave()};if(S.shapeFlag&1&&K&&!K.persisted){const{leave:ee,delayLeave:ie}=K,ne=()=>ee(j,G);ie?ie(S.el,G,ne):ne()}else G()},$=(S,E)=>{let j;for(;S!==E;)j=f(S),r(S),S=j;r(E)},Z=(S,E,j)=>{const{bum:Y,scope:K,update:G,subTree:ee,um:ie}=S;Y&&Ni(Y),K.stop(),G&&(G.active=!1,q(ee,S,E,j)),ie&&We(ie,E),We(()=>{S.isUnmounted=!0},E),E&&E.pendingBranch&&!E.isUnmounted&&S.asyncDep&&!S.asyncResolved&&S.suspenseId===E.pendingId&&(E.deps--,E.deps===0&&E.resolve())},J=(S,E,j,Y=!1,K=!1,G=0)=>{for(let ee=G;ee<S.length;ee++)q(S[ee],E,j,Y,K)},te=S=>S.shapeFlag&6?te(S.component.subTree):S.shapeFlag&128?S.suspense.next():f(S.anchor||S.el),y=(S,E,j)=>{S==null?E._vnode&&q(E._vnode,null,null,!0):p(E._vnode||null,S,E,null,null,null,j),Pa(),E._vnode=S},w={p,um:q,m:N,r:X,mt:B,mc:V,pc:D,pbc:T,n:te,o:e};let A,O;return t&&([A,O]=t(w)),{render:y,hydrate:A,createApp:fc(y,A)}}function Mt({effect:e,update:t},i){e.allowRecurse=t.allowRecurse=i}function $a(e,t,i=!1){const n=e.children,r=t.children;if(pe(n)&&pe(r))for(let o=0;o<n.length;o++){const a=n[o];let l=r[o];l.shapeFlag&1&&!l.dynamicChildren&&((l.patchFlag<=0||l.patchFlag===32)&&(l=r[o]=Ct(r[o]),l.el=a.el),i||$a(a,l))}}function pc(e){const t=e.slice(),i=[0];let n,r,o,a,l;const u=e.length;for(n=0;n<u;n++){const s=e[n];if(s!==0){if(r=i[i.length-1],e[r]<s){t[n]=r,i.push(n);continue}for(o=0,a=i.length-1;o<a;)l=o+a>>1,e[i[l]]<s?o=l+1:a=l;s<e[i[o]]&&(o>0&&(t[n]=i[o-1]),i[o]=n)}}for(o=i.length,a=i[o-1];o-- >0;)i[o]=a,a=t[a];return i}const yc=e=>e.__isTeleport,dt=Symbol(void 0),qn=Symbol(void 0),Nr=Symbol(void 0),Ui=Symbol(void 0),Ar=[];let rt=null;function gc(e=!1){Ar.push(rt=e?null:[])}function mc(){Ar.pop(),rt=Ar[Ar.length-1]||null}let jr=1;function yo(e){jr+=e}function wc(e){return e.dynamicChildren=jr>0?rt||er:null,mc(),jr>0&&rt&&rt.push(e),e}function bc(e,t,i,n,r){return wc(me(e,t,i,n,r,!0))}function xc(e){return e?e.__v_isVNode===!0:!1}function fr(e,t){return e.type===t.type&&e.key===t.key}const Ri="__vInternal",Ya=({key:e})=>e!=null?e:null,ii=({ref:e,ref_key:t,ref_for:i})=>e!=null?je(e)||De(e)||ve(e)?{i:pt,r:e,k:t,f:!!i}:e:null;function Xa(e,t=null,i=null,n=0,r=null,o=e===dt?0:1,a=!1,l=!1){const u={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&Ya(t),ref:t&&ii(t),scopeId:La,slotScopeIds:null,children:i,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:o,patchFlag:n,dynamicProps:r,dynamicChildren:null,appContext:null};return l?(Wn(u,i),o&128&&e.normalize(u)):i&&(u.shapeFlag|=je(i)?8:16),jr>0&&!a&&rt&&(u.patchFlag>0||o&6)&&u.patchFlag!==32&&rt.push(u),u}const me=_c;function _c(e,t=null,i=null,n=0,r=null,o=!1){if((!e||e===Zl)&&(e=Nr),xc(e)){const l=nr(e,t,!0);return i&&Wn(l,i),jr>0&&!o&&rt&&(l.shapeFlag&6?rt[rt.indexOf(e)]=l:rt.push(l)),l.patchFlag|=-2,l}if(Lc(e)&&(e=e.__vccOpts),t){t=kc(t);let{class:l,style:u}=t;l&&!je(l)&&(t.class=Cn(l)),He(u)&&(ma(u)&&!pe(u)&&(u=Ue({},u)),t.style=En(u))}const a=je(e)?1:Nl(e)?128:yc(e)?64:He(e)?4:ve(e)?2:0;return Xa(e,t,i,n,r,a,o,!0)}function kc(e){return e?ma(e)||Ri in e?Ue({},e):e:null}function nr(e,t,i=!1){const{props:n,ref:r,patchFlag:o,children:a}=e,l=t?Tc(n||{},t):n;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:l,key:l&&Ya(l),ref:t&&t.ref?i&&r?pe(r)?r.concat(ii(t)):[r,ii(t)]:ii(t):r,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:a,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==dt?o===-1?16:o|16:o,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&nr(e.ssContent),ssFallback:e.ssFallback&&nr(e.ssFallback),el:e.el,anchor:e.anchor}}function di(e=" ",t=0){return me(qn,null,e,t)}function vt(e){return e==null||typeof e=="boolean"?me(Nr):pe(e)?me(dt,null,e.slice()):typeof e=="object"?Ct(e):me(qn,null,String(e))}function Ct(e){return e.el===null||e.memo?e:nr(e)}function Wn(e,t){let i=0;const{shapeFlag:n}=e;if(t==null)t=null;else if(pe(t))i=16;else if(typeof t=="object")if(n&65){const r=t.default;r&&(r._c&&(r._d=!1),Wn(e,r()),r._c&&(r._d=!0));return}else{i=32;const r=t._;!r&&!(Ri in t)?t._ctx=pt:r===3&&pt&&(pt.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else ve(t)?(t={default:t,_ctx:pt},i=32):(t=String(t),n&64?(i=16,t=[di(t)]):i=8);e.children=t,e.shapeFlag|=i}function Tc(...e){const t={};for(let i=0;i<e.length;i++){const n=e[i];for(const r in n)if(r==="class")t.class!==n.class&&(t.class=Cn([t.class,n.class]));else if(r==="style")t.style=En([t.style,n.style]);else if(_i(r)){const o=t[r],a=n[r];a&&o!==a&&!(pe(o)&&o.includes(a))&&(t[r]=o?[].concat(o,a):a)}else r!==""&&(t[r]=n[r])}return t}function at(e,t,i,n=null){nt(e,t,7,[i,n])}const Ac=Ka();let Sc=0;function Ec(e,t,i){const n=e.type,r=(t?t.appContext:e.appContext)||Ac,o={uid:Sc++,vnode:e,type:n,parent:t,appContext:r,root:null,next:null,subTree:null,effect:null,update:null,scope:new $s(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(r.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Ha(n,r),emitsOptions:Ia(n,r),emit:null,emitted:null,propsDefaults:Se,inheritAttrs:n.inheritAttrs,ctx:Se,data:Se,props:Se,attrs:Se,slots:Se,refs:Se,setupState:Se,setupContext:null,suspense:i,suspenseId:i?i.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return o.ctx={_:o},o.root=t?t.root:o,o.emit=Ll.bind(null,o),e.ce&&e.ce(o),o}let Be=null;const or=e=>{Be=e,e.scope.on()},Ht=()=>{Be&&Be.scope.off(),Be=null};function Qa(e){return e.vnode.shapeFlag&4}let Fr=!1;function Cc(e,t=!1){Fr=t;const{props:i,children:n}=e.vnode,r=Qa(e);ac(e,i,r,t),cc(e,n);const o=r?Pc(e,t):void 0;return Fr=!1,o}function Pc(e,t){const i=e.type;e.accessCache=Object.create(null),e.proxy=wa(new Proxy(e.ctx,ec));const{setup:n}=i;if(n){const r=e.setupContext=n.length>1?Ic(e):null;or(e),lr();const o=Rt(n,e,0,[e.props,r]);if(cr(),Ht(),oa(o)){if(o.then(Ht,Ht),t)return o.then(a=>{go(e,a,t)}).catch(a=>{Si(a,e,0)});e.asyncDep=o}else go(e,o,t)}else Ga(e,t)}function go(e,t,i){ve(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:He(t)&&(e.setupState=Ta(t)),Ga(e,i)}let mo;function Ga(e,t,i){const n=e.type;if(!e.render){if(!t&&mo&&!n.render){const r=n.template;if(r){const{isCustomElement:o,compilerOptions:a}=e.appContext.config,{delimiters:l,compilerOptions:u}=n,s=Ue(Ue({isCustomElement:o,delimiters:l},a),u);n.render=mo(r,s)}}e.render=n.render||it}or(e),lr(),tc(e),cr(),Ht()}function Rc(e){return new Proxy(e.attrs,{get(t,i){return Xe(e,"get","$attrs"),t[i]}})}function Ic(e){const t=n=>{e.exposed=n||{}};let i;return{get attrs(){return i||(i=Rc(e))},slots:e.slots,emit:e.emit,expose:t}}function Ii(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(Ta(wa(e.exposed)),{get(t,i){if(i in t)return t[i];if(i in hi)return hi[i](e)}}))}function Lc(e){return ve(e)&&"__vccOpts"in e}const vi=(e,t)=>Al(e,t,Fr),Mc="3.2.37",Oc="http://www.w3.org/2000/svg",Dt=typeof document<"u"?document:null,wo=Dt&&Dt.createElement("template"),Bc={insert:(e,t,i)=>{t.insertBefore(e,i||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,i,n)=>{const r=t?Dt.createElementNS(Oc,e):Dt.createElement(e,i?{is:i}:void 0);return e==="select"&&n&&n.multiple!=null&&r.setAttribute("multiple",n.multiple),r},createText:e=>Dt.createTextNode(e),createComment:e=>Dt.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Dt.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},cloneNode(e){const t=e.cloneNode(!0);return"_value"in e&&(t._value=e._value),t},insertStaticContent(e,t,i,n,r,o){const a=i?i.previousSibling:t.lastChild;if(r&&(r===o||r.nextSibling))for(;t.insertBefore(r.cloneNode(!0),i),!(r===o||!(r=r.nextSibling)););else{wo.innerHTML=n?`<svg>${e}</svg>`:e;const l=wo.content;if(n){const u=l.firstChild;for(;u.firstChild;)l.appendChild(u.firstChild);l.removeChild(u)}t.insertBefore(l,i)}return[a?a.nextSibling:t.firstChild,i?i.previousSibling:t.lastChild]}};function Dc(e,t,i){const n=e._vtc;n&&(t=(t?[t,...n]:[...n]).join(" ")),t==null?e.removeAttribute("class"):i?e.setAttribute("class",t):e.className=t}function Nc(e,t,i){const n=e.style,r=je(i);if(i&&!r){for(const o in i)fn(n,o,i[o]);if(t&&!je(t))for(const o in t)i[o]==null&&fn(n,o,"")}else{const o=n.display;r?t!==i&&(n.cssText=i):t&&e.removeAttribute("style"),"_vod"in e&&(n.display=o)}}const bo=/\s*!important$/;function fn(e,t,i){if(pe(i))i.forEach(n=>fn(e,t,n));else if(i==null&&(i=""),t.startsWith("--"))e.setProperty(t,i);else{const n=jc(e,t);bo.test(i)?e.setProperty(sr(n),i.replace(bo,""),"important"):e[n]=i}}const xo=["Webkit","Moz","ms"],Hi={};function jc(e,t){const i=Hi[t];if(i)return i;let n=ir(t);if(n!=="filter"&&n in e)return Hi[t]=n;n=aa(n);for(let r=0;r<xo.length;r++){const o=xo[r]+n;if(o in e)return Hi[t]=o}return t}const _o="http://www.w3.org/1999/xlink";function Fc(e,t,i,n,r){if(n&&t.startsWith("xlink:"))i==null?e.removeAttributeNS(_o,t.slice(6,t.length)):e.setAttributeNS(_o,t,i);else{const o=Ls(t);i==null||o&&!na(i)?e.removeAttribute(t):e.setAttribute(t,o?"":i)}}function zc(e,t,i,n,r,o,a){if(t==="innerHTML"||t==="textContent"){n&&a(n,r,o),e[t]=i==null?"":i;return}if(t==="value"&&e.tagName!=="PROGRESS"&&!e.tagName.includes("-")){e._value=i;const u=i==null?"":i;(e.value!==u||e.tagName==="OPTION")&&(e.value=u),i==null&&e.removeAttribute(t);return}let l=!1;if(i===""||i==null){const u=typeof e[t];u==="boolean"?i=na(i):i==null&&u==="string"?(i="",l=!0):u==="number"&&(i=0,l=!0)}try{e[t]=i}catch{}l&&e.removeAttribute(t)}const[Ja,Uc]=(()=>{let e=Date.now,t=!1;if(typeof window<"u"){Date.now()>document.createEvent("Event").timeStamp&&(e=performance.now.bind(performance));const i=navigator.userAgent.match(/firefox\/(\d+)/i);t=!!(i&&Number(i[1])<=53)}return[e,t]})();let dn=0;const Hc=Promise.resolve(),qc=()=>{dn=0},Wc=()=>dn||(Hc.then(qc),dn=Ja());function Vc(e,t,i,n){e.addEventListener(t,i,n)}function Kc(e,t,i,n){e.removeEventListener(t,i,n)}function $c(e,t,i,n,r=null){const o=e._vei||(e._vei={}),a=o[t];if(n&&a)a.value=n;else{const[l,u]=Yc(t);if(n){const s=o[t]=Xc(n,r);Vc(e,l,s,u)}else a&&(Kc(e,l,a,u),o[t]=void 0)}}const ko=/(?:Once|Passive|Capture)$/;function Yc(e){let t;if(ko.test(e)){t={};let i;for(;i=e.match(ko);)e=e.slice(0,e.length-i[0].length),t[i[0].toLowerCase()]=!0}return[sr(e.slice(2)),t]}function Xc(e,t){const i=n=>{const r=n.timeStamp||Ja();(Uc||r>=i.attached-1)&&nt(Qc(n,i.value),t,5,[n])};return i.value=e,i.attached=Wc(),i}function Qc(e,t){if(pe(t)){const i=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{i.call(e),e._stopped=!0},t.map(n=>r=>!r._stopped&&n&&n(r))}else return t}const To=/^on[a-z]/,Gc=(e,t,i,n,r=!1,o,a,l,u)=>{t==="class"?Dc(e,n,r):t==="style"?Nc(e,i,n):_i(t)?Pn(t)||$c(e,t,i,n,a):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):Jc(e,t,n,r))?zc(e,t,n,o,a,l,u):(t==="true-value"?e._trueValue=n:t==="false-value"&&(e._falseValue=n),Fc(e,t,n,r))};function Jc(e,t,i,n){return n?!!(t==="innerHTML"||t==="textContent"||t in e&&To.test(t)&&ve(i)):t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA"||To.test(t)&&je(i)?!1:t in e}const Zc={beforeMount(e,{value:t},{transition:i}){e._vod=e.style.display==="none"?"":e.style.display,i&&t?i.beforeEnter(e):dr(e,t)},mounted(e,{value:t},{transition:i}){i&&t&&i.enter(e)},updated(e,{value:t,oldValue:i},{transition:n}){!t!=!i&&(n?t?(n.beforeEnter(e),dr(e,!0),n.enter(e)):n.leave(e,()=>{dr(e,!1)}):dr(e,t))},beforeUnmount(e,{value:t}){dr(e,t)}};function dr(e,t){e.style.display=t?e._vod:"none"}const eu=Ue({patchProp:Gc},Bc);let Ao;function tu(){return Ao||(Ao=dc(eu))}const ru=(...e)=>{const t=tu().createApp(...e),{mount:i}=t;return t.mount=n=>{const r=iu(n);if(!r)return;const o=t._component;!ve(o)&&!o.render&&!o.template&&(o.template=r.innerHTML),r.innerHTML="";const a=i(r,!1,r instanceof SVGElement);return r instanceof Element&&(r.removeAttribute("v-cloak"),r.setAttribute("data-v-app","")),a},t};function iu(e){return je(e)?document.querySelector(e):e}function Vn(e,t){var i=t||new Path2D,n=e.calculative.borderRadius||0,r=n,o=e.calculative.worldRect,a=o.x,l=o.y,u=o.width,s=o.height,c=o.ex,h=o.ey;n<1&&(n=u*n,r=s*r);var f=n<r?n:r;if(u<2*f&&(f=u/2),s<2*f&&(f=s/2),i.moveTo(a+f,l),i.arcTo(c,l,c,h,f),i.arcTo(c,h,a,h,f),i.arcTo(a,h,a,l,f),i.arcTo(a,l,c,l,f),i instanceof Path2D)return i}var nu=Vn;function ou(e,t){var i=t||new Path2D,n=e.calculative.worldRect,r=n.x,o=n.y,a=n.width,l=n.height;if(i.ellipse(r+a/2,o+l/2,a/2,l/2,0,0,Math.PI*2),i instanceof Path2D)return i}var Pe;(function(e){e[e.Node=0]="Node",e[e.Line=1]="Line"})(Pe||(Pe={}));var Ce;(function(e){e[e.None=0]="None",e[e.DisableEdit=1]="DisableEdit",e[e.DisableMove=2]="DisableMove",e[e.Disable=10]="Disable"})(Ce||(Ce={}));var So;(function(e){e[e.Default=0]="Default",e[e.In=1]="In",e[e.Out=2]="Out"})(So||(So={}));var Sr;(function(e){e[e.None=0]="None",e[e.Linear=1]="Linear",e[e.Radial=2]="Radial"})(Sr||(Sr={}));var au=["text","textWidth","textHeight","textLeft","textTop","fontFamily","fontSize","lineHeight","fontStyle","fontWeight","textAlign","textBaseline","whiteSpace","ellipsis","keepDecimal"],su=["x","y","width","height"],lu=["paddingTop","paddingRight","paddingBottom","paddingLeft","flipX","flipY","visible","showChild"],cu=["iconLeft","iconTop","iconRotate"],pi;(function(e){e[e.Normal=0]="Normal",e[e.Beads=1]="Beads",e[e.Dot=2]="Dot"})(pi||(pi={}));var uu=["gif","iframe","video","echarts","highcharts","lightningCharts"],hu=new Set(["borderRadius","rotate","paddingLeft","paddingRight","paddingTop","paddingBottom","progress","progressColor","verticalProgress","flipX","flipY","input","lineDash","lineCap","lineJoin","strokeType","lineGradientFromColor","lineGradientToColor","lineGradientAngle","color","hoverColor","activeColor","lineWidth","bkType","gradientFromColor","gradientToColor","gradientAngle","gradientRadius","hoverBackground","activeBackground","globalAlpha","anchorColor","anchorRadius","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","textHasShadow","fontFamily","fontSize","textColor","hoverTextColor","activeTextColor","textBackground","fontStyle","fontWeight","textAlign","textBaseline","lineHeight","whiteSpace","textWidth","textHeight","textLeft","textTop","ellipsis","hiddenText","keepDecimal"]);function fu(e){e.onAdd=void 0,e.onValue=void 0,e.onBeforeValue=void 0,e.onDestroy=void 0,e.onMove=void 0,e.onResize=void 0,e.onRotate=void 0,e.onClick=void 0,e.onMouseEnter=void 0,e.onMouseLeave=void 0,e.onMouseDown=void 0,e.onMouseMove=void 0,e.onMouseUp=void 0,e.onShowInput=void 0,e.onInput=void 0,e.onChangeId=void 0,e.onBinds=void 0}var ce;(function(e){e[e.None=0]="None",e[e.LineAnchor=1]="LineAnchor",e[e.NodeAnchor=2]="NodeAnchor",e[e.Line=3]="Line",e[e.Node=4]="Node",e[e.Resize=5]="Resize",e[e.Rotate=6]="Rotate",e[e.LineAnchorPrev=7]="LineAnchorPrev",e[e.LineAnchorNext=8]="LineAnchorNext"})(ce||(ce={}));var Te;(function(e){e[e.None=0]="None",e[e.Translate=1]="Translate",e[e.Select=2]="Select",e[e.Resize=3]="Resize",e[e.AddAnchor=4]="AddAnchor"})(Te||(Te={}));var gt;(function(e){e[e.None=0]="None",e[e.Down=1]="Down",e[e.Translate=2]="Translate"})(gt||(gt={}));var fe;(function(e){e[e.None=-1]="None",e[e.Up=0]="Up",e[e.Right=1]="Right",e[e.Bottom=2]="Bottom",e[e.Left=3]="Left"})(fe||(fe={}));var Eo=["nw-resize","ne-resize","se-resize","sw-resize"],Co=["n-resize","e-resize","s-resize","w-resize"],du=["curve","polyline","line"],qt;(function(e){e[e.Mirror=0]="Mirror",e[e.Bilateral=1]="Bilateral",e[e.Free=2]="Free"})(qt||(qt={}));var Po;(function(e){e[e.Default=0]="Default",e[e.In=1]="In",e[e.Out=2]="Out"})(Po||(Po={}));function Re(e,t,i){if(!(!t||t%360===0)){var n=t*Math.PI/180,r=(e.x-i.x)*Math.cos(n)-(e.y-i.y)*Math.sin(n)+i.x,o=(e.x-i.x)*Math.sin(n)+(e.y-i.y)*Math.cos(n)+i.y;e.x=r,e.y=o,e.prev&&Re(e.prev,t,i),e.next&&Re(e.next,t,i)}}function Qt(e,t,i){return i===void 0&&(i=5),e.x>t.x-i&&e.x<t.x+i&&e.y>t.y-i&&e.y<t.y+i}function Kn(e,t,i){e.x=i.x-(i.x-e.x)*t,e.y=i.y-(i.y-e.y)*t}function Ge(e,t){if(e.x===t.x)return e.y<=t.y?0:180;if(e.y===t.y)return e.x<t.x?270:90;var i=e.x-t.x,n=e.y-t.y,r=Math.atan(Math.abs(i/n))/(2*Math.PI)*360;return i>0&&n>0?r=180-r:i<0&&n>0?r+=180:i<0&&n<0&&(r=360-r),r}function Li(e,t){var i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)}function vu(e,t){var i=fe.None;if(!t)return i;var n=e.x-t.x,r=e.y-t.y;return Math.abs(n)>Math.abs(r)?n>0?i=fe.Right:i=fe.Left:r>0?i=fe.Bottom:i=fe.Up,i}function Er(e,t,i){!e||(e.x+=t,e.y+=i,e.next&&(e.next.x+=t,e.next.y+=i),e.prev&&(e.prev.x+=t,e.prev.y+=i))}function Ro(e,t){return e.anchorId===t.anchorId&&e.connectTo===t.connectTo}const pu="@topology/core",yu="1.1.30",gu="@topology/core: Powerful, Beautiful, Simple, Open - Web-Based 2D At Its Best .",mu="index.js",wu="index.d.ts",bu={copy:"shx cp package.build.json ../../dist/core/package.json",build:"tsc && npm run copy"},xu=["topology","diagram","2D","canvas"],_u="alsmile123@qq.com",ku="MIT",Tu={type:"git",url:"git+https://github.com/le5le-com/topology.js.git"},Au={url:"https://github.com/le5le-com/topology.js/issues"},Su="https://github.com/le5le-com/topology.js#readme",Eu={"@types/marked":"^4.0.3","@types/offscreencanvas":"latest"},Cu={mitt:"^2.1.0",mqtt:"^4.2.6"},Pu={access:"public"},Ru="78f2a53ca1839c89b56e2e498d17ba4eb987ad14",Za={name:pu,version:yu,description:gu,main:mu,types:wu,scripts:bu,keywords:xu,author:_u,license:ku,repository:Tu,bugs:Au,homepage:Su,devDependencies:Eu,dependencies:Cu,publishConfig:Pu,gitHead:Ru};var he={version:Za.version,path2dDraws:{},canvasDraws:{},anchors:{},htmlElements:{}};function Iu(e){Object.assign(he.path2dDraws,e)}function Lu(e){Object.assign(he.canvasDraws,e)}function Mu(e){Object.assign(he.anchors,e)}function Ou(e){return{all:e=e||new Map,on:function(t,i){var n=e.get(t);n&&n.push(i)||e.set(t,[i])},off:function(t,i){var n=e.get(t);n&&n.splice(n.indexOf(i)>>>0,1)},emit:function(t,i){(e.get(t)||[]).slice().map(function(n){n(i)}),(e.get("*")||[]).slice().map(function(n){n(t,i)})}}}var Ft;(function(e){e[e.None=-1]="None",e[e.Document=0]="Document",e[e.Canvas=1]="Canvas"})(Ft||(Ft={}));var Bu={fontFamily:'"Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial',fontSize:12,lineHeight:1.5,textAlign:"center",textBaseline:"middle",color:"#222222",activeColor:"#278df8",hoverColor:"rgba(39,141,248,0.50)",anchorColor:"#278DF8",hoverAnchorColor:"#FF4101",anchorRadius:4,anchorBackground:"#fff",dockColor:"rgba(39,141,248,0.50)",dockPenColor:"#1890FF",dragColor:"#1890ff",rotateCursor:"rotate.cur",hoverCursor:"pointer",minScale:.1,maxScale:10,keydown:Ft.Document,gridSize:20,gridColor:"#e2e2e2",ruleColor:"#888888",drawingLineName:"curve",interval:30,animateInterval:30,autoPolyline:!0,autoAnchor:!0,animateColor:"#ff4d4f",ruleLineColor:"#FF4101",defaultAnchors:[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1},{x:0,y:.5}],measureTextWidth:!0},vn=globalThis&&globalThis.__assign||function(){return vn=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},vn.apply(this,arguments)},de;(function(e){e[e.Add=0]="Add",e[e.Update=1]="Update",e[e.Delete=2]="Delete"})(de||(de={}));var Du=function(){return{data:{x:0,y:0,scale:1,pens:[],origin:{x:0,y:0},center:{x:0,y:0},paths:{}},histories:[],pens:{},path2dMap:new WeakMap,active:[],animates:new Set,options:vn({},Bu),emitter:Ou()}},Nu=function(e){return e===void 0&&(e="default"),he[e]||(he[e]=Du(),he[e].id=e),he[e]},ju=function(e){e.data={x:0,y:0,scale:1,pens:[],origin:{x:0,y:0},center:{x:0,y:0},paths:{}},e.pens={},e.histories=[],e.historyIndex=null,e.path2dMap=new WeakMap,e.active=[],e.hover=void 0,e.lastHover=void 0,e.animates.clear()},Io=globalThis&&globalThis.__values||function(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Fu=globalThis&&globalThis.__read||function(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var n=i.call(e),r,o=[],a;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(a)throw a.error}}return o},zu=globalThis&&globalThis.__spreadArray||function(e,t,i){if(i||arguments.length===2)for(var n=0,r=t.length,o;n<r;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};function xr(e){var t=e.calculative,i=t.paddingTop,n=t.paddingBottom,r=t.paddingLeft,o=t.paddingRight,a=t.worldRect,l=t.canvas,u=e.calculative,s=u.textLeft,c=u.textTop,h=u.textWidth,f=u.textHeight,d=r,v=i;s&&Math.abs(s)<1&&(s*=a.width),c&&Math.abs(c)<1&&(c*=a.height);var g=a.width-r-o-(s||0),p=a.height-i-n-(c||0);h&&h<1&&(h*=a.width),f&&f<1&&(f*=a.height),d+=(s||0)+a.x,v+=(c||0)+a.y;var b=e.textAlign||l.store.options.textAlign,x=e.textBaseline||l.store.options.textBaseline;switch(b){case"center":d+=(g-(h||g))/2;break;case"right":d+=g-(h||g);break}switch(x){case"middle":v+=(p-(f||p))/2;break;case"bottom":v+=p-(f||p);break}var m={x:d,y:v,width:h||g,height:f||p};Ne(m),e.calculative.worldTextRect=m,Mi(e),e.calculative.textDrawRect=void 0}function es(e,t){var i=t.calculative.fontSize*t.calculative.lineHeight,n=t.calculative.textLines.length*i,r=Uu(e,t),o=t.calculative.worldTextRect,a=o.x+(o.width-r)/2,l=o.y+(o.height-n)/2,u=t.calculative.canvas.store.options,s=t.textAlign||u.textAlign;switch(s){case"left":a=o.x;break;case"right":a=o.x+o.width-r;break}var c=t.textBaseline||u.textBaseline;switch(c){case"top":l=o.y;break;case"bottom":l=o.ey-n;break}t.calculative.textDrawRect={x:a,y:l,width:r,height:n},Ne(t.calculative.textDrawRect)}function Mi(e,t){var i,n,r,o;if(t===void 0&&(t=e.calculative.text),t==null){e.calculative.textLines=[];return}t=t.toString();var a=[],l=e.calculative.fontSize*e.calculative.lineHeight,u=e.calculative.worldTextRect.height,s=Math.floor(u/l),c=s>1?s:1;switch(e.whiteSpace){case"nowrap":if(e.ellipsis!==!1){var h=Lo(t.split(""),e);a.push(h[0]),h.length>1&&qi(a)}else a.push(t);break;case"pre-line":a=t.split(/[\n]/g),e.ellipsis!==!1&&a.length>c&&(a=a.slice(0,c),qi(a));break;case"break-all":default:var f=t.split(/[\n]/g),d=0;try{e:for(var v=Io(f),g=v.next();!g.done;g=v.next()){var p=g.value,b=e.whiteSpace==="break-all"?p.split(""):ts(p),x=Lo(b,e);if(x.length===0&&(x=[""]),e.ellipsis!=!1)try{for(var m=(r=void 0,Io(x)),_=m.next();!_.done;_=m.next()){var P=_.value;if(d++,d>c){qi(a);break e}else a.push(P)}}catch(L){r={error:L}}finally{try{_&&!_.done&&(o=m.return)&&o.call(m)}finally{if(r)throw r.error}}else a.push.apply(a,zu([],Fu(x),!1))}}catch(L){i={error:L}}finally{try{g&&!g.done&&(n=v.return)&&n.call(v)}finally{if(i)throw i.error}}break}var R=e.calculative.keepDecimal;return R!=null&&a.forEach(function(L,I){var V=Number(L);isNaN(V)||(a[I]=V.toFixed(R))}),e.calculative.textLines=a,a}function ts(e){e===void 0&&(e="");for(var t=[],i="",n=0;n<e.length;++n){var r=e.charCodeAt(n);r<33||r>126?(i&&(t.push(i),i=""),t.push(e[n])):i+=e[n]}return i&&t.push(i),t}function Lo(e,t){var i=t.calculative.canvas,n=i.offscreen.getContext("2d"),r=t.calculative,o=r.fontStyle,a=r.fontWeight,l=r.fontSize,u=r.fontFamily,s=r.lineHeight;n.save();for(var c=[],h=e[0]||"",f=1;f<e.length;++f){var d=e[f]||"",v=h+d,g=0;if(i.store.options.measureTextWidth)n.font=Bi({fontStyle:o,fontWeight:a,fontFamily:u||i.store.options.fontFamily,fontSize:l,lineHeight:s}),g=n.measureText(v).width;else{var p=v.match(/[^\x00-\xff]/g)||"",b=p.length*l,x=v.match(/\s/g)||"",m=x.length*l*.3,_=(v.length-p.length-x.length)*l*.6;g=b+m+_}var P=t.calculative.worldTextRect.width;g<=P?h+=d:(h.length&&c.push(h),h=d)}return h.length&&c.push(h),n.restore(),c}function Uu(e,t){var i=0;return t.calculative.textLineWidths=[],t.calculative.textLines.forEach(function(n){var r=e.measureText(n).width;t.calculative.textLineWidths.push(r),i<r&&(i=r)}),i}function qi(e){e[e.length-1]=e[e.length-1].slice(0,-3)+"..."}function se(e,t){if(t===void 0&&(t=!1),Array.isArray(e)){var i=[];return e.forEach(function(o){i.push(se(o,t))}),i}else if(typeof e=="object"){if(e===null)return null;if(e.constructor===RegExp)return e;var n={};for(var r in e)["canvas","lastFrame"].includes(r)||e[r]instanceof HTMLImageElement||e[r]instanceof HTMLMediaElement||r==="calculative"&&!t||(n[r]=se(e[r],t));return n}return e}var Qe={};function Hu(e,t,i){if(!!Qe[t.fromArrow]){var n=Oe(t),r=n.x,o=n.y,a={x:r,y:o};if(a.step=(t.fromArrowSize||10)*i.data.scale,n.next)a.rotate=Ge(n.next,n)+90;else{var l=t.calculative.worldAnchors[1];if(!l)return;l.prev?a.rotate=Ge(l.prev,n)+90:a.rotate=Ge(l,n)+90}e.save(),e.beginPath();var u=t.fromArrowColor||t.calculative.color;u&&(e.strokeStyle=u),Qe[t.fromArrow](e,t,i,a),e.restore()}}function qu(e,t,i){if(!(!Qe[t.toArrow]||t.calculative.worldAnchors.length<2)){e.save();var n=Ae(t),r=n.x,o=n.y,a={x:r,y:o};if(a.step=(t.toArrowSize||10)*i.data.scale,n.prev)a.rotate=Ge(n.prev,n)+90;else{var l=t.calculative.worldAnchors[t.calculative.worldAnchors.length-2];l.next?a.rotate=Ge(l.next,n)+90:a.rotate=Ge(l,n)+90}e.beginPath();var u=t.toArrowColor||t.calculative.color;u&&(e.strokeStyle=u),Qe[t.toArrow](e,t,i,a),e.restore()}}Qe.triangleSolid=function(e,t,i,n){e.save(),e.translate(n.x,n.y),e.rotate(n.rotate*Math.PI/180),e.translate(-n.x,-n.y);var r=n.x-n.step;e.moveTo(r,n.y-n.step/4),e.lineTo(n.x,n.y),e.lineTo(r,n.y+n.step/4),e.closePath(),e.stroke(),e.fillStyle=e.strokeStyle,e.fill(),e.restore()};Qe.triangle=function(e,t,i,n){e.save(),e.lineWidth<2&&(e.lineWidth=2),e.translate(n.x,n.y),e.rotate(n.rotate*Math.PI/180),e.translate(-n.x,-n.y);var r=n.x-n.step;e.moveTo(r,n.y-n.step/4),e.lineTo(n.x,n.y),e.lineTo(r,n.y+n.step/4),e.closePath(),e.stroke(),e.fillStyle=i.data.background||"#ffffff",e.fill(),e.restore()};Qe.circleSolid=function(e,t,i,n){e.save(),e.translate(n.x,n.y),e.rotate(n.rotate*Math.PI/180),e.translate(-n.x,-n.y);var r=n.step/2;e.arc(n.x-r,n.y,r,0,2*Math.PI),e.stroke(),e.fillStyle=e.strokeStyle,e.fill(),e.restore()};Qe.circle=function(e,t,i,n){e.save(),e.translate(n.x,n.y),e.rotate(n.rotate*Math.PI/180),e.translate(-n.x,-n.y);var r=n.step/2;e.arc(n.x-r,n.y,r,0,2*Math.PI),e.stroke(),e.fillStyle=i.data.background||"#ffffff",e.fill(),e.restore()};Qe.diamondSolid=function(e,t,i,n){e.save(),e.translate(n.x,n.y),e.rotate(n.rotate*Math.PI/180),e.translate(-n.x,-n.y);var r=n.x-n.step,o=n.step/2;e.moveTo(r,n.y),e.lineTo(r+o,n.y-o/2),e.lineTo(n.x,n.y),e.lineTo(r+o,n.y+o/2),e.closePath(),e.stroke(),e.fillStyle=e.strokeStyle,e.fill(),e.restore()};Qe.diamond=function(e,t,i,n){e.save(),e.translate(n.x,n.y),e.rotate(n.rotate*Math.PI/180),e.translate(-n.x,-n.y);var r=n.x-n.step,o=n.step/2;e.moveTo(r,n.y),e.lineTo(r+o,n.y-o/2),e.lineTo(n.x,n.y),e.lineTo(r+o,n.y+o/2),e.closePath(),e.stroke(),e.fillStyle=i.data.background||"#ffffff",e.fill(),e.restore()};Qe.line=function(e,t,i,n){e.save(),e.translate(n.x,n.y),e.rotate(n.rotate*Math.PI/180),e.translate(-n.x,-n.y);var r=n.x-n.step;e.moveTo(r,n.y-n.step/3),e.lineTo(n.x,n.y),e.lineTo(r,n.y+n.step/3),e.stroke(),e.restore()};Qe.lineUp=function(e,t,i,n){e.save(),e.translate(n.x,n.y),e.rotate(n.rotate*Math.PI/180),e.translate(-n.x,-n.y);var r=n.x-n.step;e.moveTo(r,n.y-n.step/3),e.lineTo(n.x,n.y),e.stroke(),e.restore()};Qe.lineDown=function(e,t,i,n){e.save(),e.translate(n.x,n.y),e.rotate(n.rotate*Math.PI/180),e.translate(-n.x,-n.y);var r=n.x-n.step;e.moveTo(r,n.y+n.step/3),e.lineTo(n.x,n.y),e.stroke(),e.restore()};var Wu=globalThis&&globalThis.__read||function(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var n=i.call(e),r,o=[],a;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(a)throw a.error}}return o};function Vu(e){var t=parseInt,i=Math.round,n=e.length,r={};if(n>9){var o=Wu(e=e.split(","),4),a=o[0],l=o[1],u=o[2],s=o[3];if(n=e.length,n<3||n>4)return null;r.r=t(a[3]=="a"?a.slice(5):a.slice(4)),r.g=t(l),r.b=t(u),r.a=s?parseFloat(s):-1}else{if(n==8||n==6||n<4)return null;n<6&&(e="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+(n>4?e[4]+e[4]:"")),e=t(e.slice(1),16),n==9||n==5?(r.r=e>>24&255,r.g=e>>16&255,r.b=e>>8&255,r.a=i((e&255)/.255)/1e3):(r.r=e>>16,r.g=e>>8&255,r.b=e&255,r.a=-1)}return r}function $n(e,t){var i=Vu(e)||{r:0,g:0,b:0};return i.a<0?"rgba("+i.r+","+i.g+","+i.b+","+t+")":"rgba("+i.r+","+i.g+","+i.b+","+(t+i.a)+")"}var Cr=globalThis&&globalThis.__read||function(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var n=i.call(e),r,o=[],a;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(a)throw a.error}}return o},Ku=globalThis&&globalThis.__values||function(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function Mo(e,t){if(isNaN(e)){console.warn("realValue not number");return}if(typeof t!="string"){console.warn("collection must be string");return}var i=Cr([t[0],t[t.length-1]],2),n=i[0],r=i[1];if(!["[","("].includes(n)){console.warn('collection must start with "[" or "("');return}if(!["]",")"].includes(r)){console.warn('collection must end with "]" or ")"');return}var o=t.substring(1,t.length-1).split(",");if(o.length!==2){console.warn("collection must have 2 numbers");return}var a=Cr([+o[0],+o[1]],2),l=a[0],u=a[1];if(l>=u){console.warn("startNum must less than endNum");return}var s=e>l||n==="["&&e===l;if(!s)return!1;var c=e<u||r==="]"&&e===u;return c}function Oo(e,t){var i,n;if(isNaN(e)){console.warn("realValue not number");return}if(typeof t!="string"){console.warn("collection must be string");return}var r=Cr([t[0],t[t.length-1]],2),o=r[0],a=r[1];if(o!=="["||a!=="]"){console.warn('collection must start with "[" and end with "]"');return}var l=t.substring(1,t.length-1).split(",");try{for(var u=Ku(l),s=u.next();!s.done;s=u.next()){var c=s.value;if(c.includes("..")){var h=Cr(c.split(".."),2),f=h[0],d=h[1],v=Cr([+f,+d],2),g=v[0],p=v[1];if(g>=p){console.warn("startNum must less than endNum");return}if(e>=g&&e<=p)return!0}else{var b=+c;if(e===b)return!0}}}catch(x){i={error:x}}finally{try{s&&!s.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}return!1}function be(){return((1+Math.random())*4294967296|0).toString(16).substring(1)}function Bo(){return/Android|webOS|iPad|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)}var Yn=function(e){var t=0,i=0,n=0,r=0;if(typeof e=="number")t=i=n=r=e;else if(typeof e=="string"){var o=parseInt(e,10);t=i=n=r=o}else Array.isArray(e)&&(t=e[0],n=Wi(e[1])?e[0]:e[1],r=Wi(e[2])?e[0]:e[2],i=Wi(e[3])?n:e[3]);return[t,n,r,i]};function Wi(e){return e==null}var rs=globalThis&&globalThis.__awaiter||function(e,t,i,n){function r(o){return o instanceof i?o:new i(function(a){a(o)})}return new(i||(i=Promise))(function(o,a){function l(c){try{s(n.next(c))}catch(h){a(h)}}function u(c){try{s(n.throw(c))}catch(h){a(h)}}function s(c){c.done?o(c.value):r(c.value).then(l,u)}s((n=n.apply(e,t||[])).next())})},is=globalThis&&globalThis.__generator||function(e,t){var i={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(c){return u([s,c])}}function u(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=s[0]&2?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[s[0]&2,o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!(o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){i=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(s[0]===6&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(c){s=[6,c],r=0}finally{n=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};function $u(e){return rs(this,void 0,void 0,function(){return is(this,function(t){return[2,new Promise(function(i,n){var r=new FileReader;r.onload=function(o){i(o.target.result)},r.onerror=function(o){n(o)},r.readAsDataURL(e)})]})})}function Yu(e,t,i,n){return rs(this,void 0,void 0,function(){var r,o,a;return is(this,function(l){switch(l.label){case 0:if(r=new FormData,r.append("file",e),i)for(o in i)i.hasOwnProperty(o)&&r.append(o,i[o]);return[4,fetch(t,{method:"POST",headers:n,body:r})];case 1:return a=l.sent(),[4,a.json()];case 2:return[2,l.sent().url]}})})}var pn=globalThis&&globalThis.__assign||function(){return pn=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},pn.apply(this,arguments)},Xu=globalThis&&globalThis.__read||function(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var n=i.call(e),r,o=[],a;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(a)throw a.error}}return o},Qu=globalThis&&globalThis.__spreadArray||function(e,t,i){if(i||arguments.length===2)for(var n=0,r=t.length,o;n<r;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},zr=globalThis&&globalThis.__values||function(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function Zt(e,t){if(!(!e||!e.parentId||!e.calculative)){var i=e.calculative.canvas.store,n=i.pens[e.parentId];return t&&Zt(n,t)||n}}function yi(e,t){if(!e||!e.children)return[];var i=[];return e.children.forEach(function(n){var r=t.pens[n];r&&(i.push(r),i.push.apply(i,Qu([],Xu(yi(r,t)),!1)))}),i}function Gu(e,t){var i=t.calculative,n=i.worldRect,r=i.gradientFromColor,o=i.gradientToColor,a=i.gradientAngle;return ns(e,n,r,o,a)}function Ju(e,t){var i=t.calculative,n=i.worldRect,r=i.gradientFromColor,o=i.gradientToColor,a=i.gradientRadius;if(!(!r||!o)){var l=n.width,u=n.height,s=n.center,c=s.x,h=s.y,f=l;f<u&&(f=u),f*=.5;var d=e.createRadialGradient(c,h,f*(a||0),c,h,f);return d.addColorStop(0,r),d.addColorStop(1,o),d}}function Zu(e,t){var i=t.calculative,n=i.worldRect,r=i.lineGradientFromColor,o=i.lineGradientToColor,a=i.lineGradientAngle;return ns(e,n,r,o,a)}function ns(e,t,i,n,r){if(!(!i||!n)){var o=t.x,a=t.y,l=t.center,u=t.ex,s=t.ey,c={x:o,y:l.y},h={x:u,y:l.y};r%90===0&&r%180?(c.x=l.x,h.x=l.x,r%270?(c.y=a,h.y=s):(c.y=s,h.y=a)):r&&(Re(c,r,t.center),Re(h,r,t.center));var f=e.createLinearGradient(c.x,c.y,h.x,h.y);return f.addColorStop(0,i),f.addColorStop(1,n),f}}function eh(e){var t=e.calculative,i=t.worldIconRect,n=t.iconWidth,r=t.iconHeight,o=t.imgNaturalWidth,a=t.imgNaturalHeight,l=i.x,u=i.y,s=i.width,c=i.height;if(n&&(s=n),r&&(c=r),o&&a&&e.imageRatio){var h=i.width/o,f=i.height/a,d=Math.min(h,f),v=o/a;n?c=n/v:r?s=r*v:(s=d*o,c=d*a)}switch(l+=(i.width-s)/2,u+=(i.height-c)/2,e.iconAlign){case"top":u=i.y;break;case"bottom":u=i.ey-c;break;case"left":l=i.x;break;case"right":l=i.ex-s;break;case"left-top":l=i.x,u=i.y;break;case"right-top":l=i.ex-s,u=i.y;break;case"left-bottom":l=i.x,u=i.ey-c;break;case"right-bottom":l=i.ex-s,u=i.ey-c;break}return{x:l,y:u,width:s,height:c}}function yn(e,t){var i=eh(t),n=i.x,r=i.y,o=i.width,a=i.height,l=t.calculative,u=l.worldIconRect,s=l.iconRotate,c=l.img;if(s){var h=u.center,f=h.x,d=h.y;e.translate(f,d),e.rotate(s*Math.PI/180),e.translate(-f,-d)}e.drawImage(c,n,r,o,a)}function Oi(e,t){var i=e.calculative,n=i.textColor,r=i.color,o=t.data,a=t.options;return n||r||o.color||a.textColor||a.color}function os(e,t){var i=t.calculative,n=i.fontStyle,r=i.fontWeight,o=i.fontSize,a=i.fontFamily,l=i.lineHeight,u=i.text,s=i.hiddenText,c=i.canvas,h=i.textHasShadow,f=i.textBackground;if(!(u==null||s)){var d=c.store;e.save(),h||(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0);var v=void 0;t.calculative.hover?v=t.hoverTextColor||t.hoverColor||d.options.hoverColor:t.calculative.active&&(v=t.activeTextColor||t.activeColor||d.options.activeColor),e.fillStyle=v||Oi(t,d),e.font=Bi({fontStyle:n,fontWeight:r,fontFamily:a||d.options.fontFamily,fontSize:o,lineHeight:l}),!t.calculative.textDrawRect&&es(e,t);var g=t.calculative.textDrawRect,p=g.x,b=g.y,x=g.width,m=g.height;f&&(e.save(),e.fillStyle=f,e.fillRect(p,b,x,m),e.restore());var _=.55,P=t.textAlign||d.options.textAlign,R=o*l;t.calculative.textLines.forEach(function(L,I){var V=t.calculative.textLineWidths[I],Q=0;P==="center"?Q=(x-V)/2:P==="right"&&(Q=x-V),e.fillText(L,p+Q,b+(I+_)*R)}),e.restore()}}function as(e,t,i){var n,r;if(i!=null){var o=t.calculative,a=o.fontStyle,l=o.fontWeight,u=o.fontSize,s=o.fontFamily,c=o.lineHeight,h=o.canvas,f=h.store;e.save();var d=void 0;t.calculative.hover?d=t.hoverTextColor||t.hoverColor||f.options.hoverColor:t.calculative.active&&(d=t.activeTextColor||t.activeColor||f.options.activeColor),e.fillStyle=d||Oi(t,f),e.font=Bi({fontStyle:a,fontWeight:l,fontFamily:s||f.options.fontFamily,fontSize:u,lineHeight:c});var v=e.measureText(i).width,g,p;try{for(var b=zr(t.calculative.worldAnchors),x=b.next();!x.done;x=b.next()){var m=x.value;if(!p){p=m;continue}var _=Li(p,m),P=Math.floor(_/v);g="";for(var R=0;R<P;R++)g+=i;var L=Ge(p,m)-270;if(e.save(),L%360!==0){var I=p.x,V=p.y;e.translate(I,V);var Q=L*Math.PI/180;e.rotate(Q),e.translate(-I,-V)}e.fillText(g,p.x,p.y+c/2),e.restore(),p=m}}catch(T){n={error:T}}finally{try{x&&!x.done&&(r=b.return)&&r.call(b)}finally{if(n)throw n.error}}e.restore()}}function ss(e,t){var i=t.calculative.canvas.store;e.save(),e.shadowColor="",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.textAlign="center",e.textBaseline="middle";var n=t.calculative.worldIconRect,r=n.x+n.width/2,o=n.y+n.height/2;switch(t.iconAlign){case"top":o=n.y,e.textBaseline="top";break;case"bottom":o=n.ey,e.textBaseline="bottom";break;case"left":r=n.x,e.textAlign="left";break;case"right":r=n.ex,e.textAlign="right";break;case"left-top":r=n.x,o=n.y,e.textAlign="left",e.textBaseline="top";break;case"right-top":r=n.ex,o=n.y,e.textAlign="right",e.textBaseline="top";break;case"left-bottom":r=n.x,o=n.ey,e.textAlign="left",e.textBaseline="bottom";break;case"right-bottom":r=n.ex,o=n.ey,e.textAlign="right",e.textBaseline="bottom";break}var a=t.calculative.iconWeight,l=void 0,u=t.calculative.iconFamily;t.calculative.iconSize>0?l=t.calculative.iconSize:n.width>n.height?l=n.height:l=n.width,e.font=Bi({fontSize:l,fontWeight:a,fontFamily:u}),e.fillStyle=t.calculative.iconColor||Oi(t,i),t.calculative.iconRotate&&(e.translate(n.center.x,n.center.y),e.rotate(t.calculative.iconRotate*Math.PI/180),e.translate(-n.center.x,-n.center.y)),e.beginPath(),e.fillText(t.calculative.icon,r,o),e.restore()}function Bi(e){var t=e===void 0?{}:e,i=t.fontStyle,n=i===void 0?"normal":i,r=t.textDecoration,o=r===void 0?"normal":r,a=t.fontWeight,l=a===void 0?"normal":a,u=t.fontSize,s=u===void 0?12:u,c=t.fontFamily,h=c===void 0?"Arial":c,f=t.lineHeight,d=f===void 0?1:f;return n+" "+o+" "+l+" "+s+"px/"+d+" "+h}function gn(e,t){var i=t.calculative.worldRect||{},n=i.x,r=i.ex,o=i.y,a=i.ey;t.calculative.flipX&&(e.translate(n+r+.5,.5),e.scale(-1,1)),t.calculative.flipY&&(e.translate(.5,o+a+.5),e.scale(1,-1))}function gi(e,t){var i=t.calculative.worldRect.center,n=i.x,r=i.y;e.translate(n,r);var o=t.calculative.rotate*Math.PI/180;(t.calculative.flipX||t.calculative.flipY)&&(o*=-1),e.rotate(o),e.translate(-n,-r)}function vr(e,t){var i,n;e.save(),e.translate(.5,.5),e.beginPath(),gn(e,t),t.calculative.rotate&&t.name!=="line"&&gi(e,t),t.calculative.lineWidth>1&&(e.lineWidth=t.calculative.lineWidth);var r=t.calculative.canvas.store;fh(e,r,t);var o,a=!0;if(t.calculative.hover)e.strokeStyle=t.hoverColor||r.options.hoverColor,o=t.hoverBackground||r.options.hoverBackground,e.fillStyle=o,o&&(a=!1);else if(t.calculative.active)e.strokeStyle=t.activeColor||r.options.activeColor,o=t.activeBackground||r.options.activeBackground,e.fillStyle=o,o&&(a=!1);else if(t.calculative.isDock)t.type===Pe.Line?e.strokeStyle=r.options.dockPenColor:(o=$n(r.options.dockPenColor,.2),e.fillStyle=o,o&&(a=!1));else{var l=t.calculative.strokeImg;if(t.calculative.strokeImage&&l)e.strokeStyle=e.createPattern(l,"repeat"),o=!0;else{var u=void 0;t.calculative.strokeType===Sr.Linear?u=Zu(e,t):u=t.calculative.color,e.strokeStyle=u}}if(a){var s=t.calculative.backgroundImg;if(t.calculative.backgroundImage&&s)e.fillStyle=e.createPattern(s,"repeat"),o=!0;else{var c=void 0;t.calculative.bkType===Sr.Linear?c=Gu(e,t):t.calculative.bkType===Sr.Radial?c=Ju(e,t):c=t.calculative.background||r.data.penBackground,e.fillStyle=c,o=!!c}}if(ls(e,t),cs(e,t),wi(e,t),t.calculative.lineDash&&e.setLineDash(t.calculative.lineDash),t.calculative.lineDashOffset&&(e.lineDashOffset=t.calculative.lineDashOffset),t.calculative.shadowColor&&(e.shadowColor=t.calculative.shadowColor,e.shadowOffsetX=t.calculative.shadowOffsetX,e.shadowOffsetY=t.calculative.shadowOffsetY,e.shadowBlur=t.calculative.shadowBlur),hs(!0,e,t,r,o),ys(e,t),!(t.image&&t.calculative.img)&&t.calculative.icon&&ss(e,t),os(e,t),t.type===Pe.Line&&t.fillTexts)try{for(var h=zr(t.fillTexts),f=h.next();!f.done;f=h.next()){var d=f.value;as(e,t,d)}}catch(v){i={error:v}}finally{try{f&&!f.done&&(n=h.return)&&n.call(h)}finally{if(i)throw i.error}}e.restore()}function ls(e,t){var i=t.lineCap;i?e.lineCap=i:t.type&&(e.lineCap="round")}function cs(e,t){var i=t.lineJoin;i?e.lineJoin=i:t.type&&(e.lineJoin="round")}function us(e,t,i){var n,r,o,a;e.save(),i&&e.translate(-i.x,-i.y),(a=(o=e).setAttrs)===null||a===void 0||a.call(o,t),e.beginPath(),t.calculative.flipX&&(i?e.translate(t.calculative.worldRect.x+t.calculative.worldRect.ex-i.x,-i.y):e.translate(t.calculative.worldRect.x+t.calculative.worldRect.ex,0),e.scale(-1,1)),t.calculative.flipY&&(i?e.translate(-i.x,t.calculative.worldRect.y+t.calculative.worldRect.ey-i.x):e.translate(0,t.calculative.worldRect.y+t.calculative.worldRect.ey),e.scale(1,-1)),t.calculative.rotate&&t.name!=="line"&&gi(e,t),t.calculative.lineWidth>1&&(e.lineWidth=t.calculative.lineWidth);var l=t.calculative.canvas.store,u;if(t.calculative.hover?(e.strokeStyle=t.hoverColor||l.options.hoverColor,e.fillStyle=t.hoverBackground||l.options.hoverBackground,u=t.hoverBackground||l.options.hoverBackground):t.calculative.active?(e.strokeStyle=t.activeColor||l.options.activeColor,e.fillStyle=t.activeBackground||l.options.activeBackground,u=t.activeBackground||l.options.activeBackground):(t.strokeImage?t.calculative.strokeImg&&(e.strokeStyle=e.createPattern(t.calculative.strokeImg,"repeat"),u=!0):e.strokeStyle=t.calculative.color||fs(l),t.backgroundImage?t.calculative.backgroundImg&&(e.fillStyle=e.createPattern(t.calculative.backgroundImg,"repeat"),u=!0):(e.fillStyle=t.background,u=!!t.background)),ls(e,t),cs(e,t),wi(e,t),t.calculative.lineDash&&e.setLineDash(t.calculative.lineDash),t.calculative.lineDashOffset&&(e.lineDashOffset=t.calculative.lineDashOffset),t.calculative.shadowColor&&(e.shadowColor=t.calculative.shadowColor,e.shadowOffsetX=t.calculative.shadowOffsetX,e.shadowOffsetY=t.calculative.shadowOffsetY,e.shadowBlur=t.calculative.shadowBlur),hs(!1,e,t,l,u),ys(e,t),t.calculative.img?(e.save(),e.shadowColor="",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,yn(e,t),e.restore()):t.calculative.icon&&ss(e,t),os(e,t),t.type===Pe.Line&&t.fillTexts)try{for(var s=zr(t.fillTexts),c=s.next();!c.done;c=s.next()){var h=c.value;as(e,t,h)}}catch(f){n={error:f}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}e.restore()}function hs(e,t,i,n,r){e===void 0&&(e=!0);var o=e?n.path2dMap.get(i):he.path2dDraws[i.name];if(o){if(i.type===Pe.Line&&i.borderWidth){t.save(),t.beginPath();var a=i.calculative.lineWidth+i.calculative.borderWidth;t.lineWidth=a,t.strokeStyle=i.borderColor,o instanceof Path2D?(r&&t.fill(o),a&&t.stroke(o)):(o(i,t),r&&t.fill(),a&&t.stroke()),t.restore()}o instanceof Path2D?r&&t.fill(o):(t.save(),o(i,t),r&&t.fill(),t.restore());var l=i.calculative.progress;if(l!=null){t.save();var u=i.calculative.worldRect,s=u.x,c=u.y,h=u.width,f=u.height,d=u.ey,v=i.verticalProgress?t.createLinearGradient(s,d,s,c+f*(1-l)):t.createLinearGradient(s,c,s+h*l,c),g=i.calculative.progressColor||i.calculative.color||n.options.activeColor;v.addColorStop(0,g),v.addColorStop(1,g),v.addColorStop(1,"transparent"),t.fillStyle=v,o instanceof Path2D?t.fill(o):(o(i,t),t.fill()),t.restore()}i.calculative.lineWidth&&(o instanceof Path2D?t.stroke(o):(o(i,t),t.stroke())),i.type&&(i.calculative.animatePos&&(t.save(),th(t,i,n),o instanceof Path2D?t.stroke(o):(o(i,t),t.stroke()),t.restore()),i.fromArrow&&Hu(t,i,n),i.toArrow&&qu(t,i,n),i.calculative.active&&!i.calculative.pencil&&rh(t,i))}}function th(e,t,i){e.strokeStyle=t.animateColor||i.options.animateColor;var n=0;switch(t.lineAnimateType){case pi.Beads:t.animateReverse?e.lineDashOffset=t.calculative.animatePos:e.lineDashOffset=t.length-t.calculative.animatePos,n=t.calculative.lineWidth||5,n<5&&(n=5),e.setLineDash(t.animateLineDash||[n,n*2]);break;case pi.Dot:t.animateReverse?e.lineDashOffset=t.calculative.animatePos:e.lineDashOffset=t.length-t.calculative.animatePos,n=t.calculative.animateDotSize||t.calculative.lineWidth*2||6,n<6&&(n=6),e.lineWidth=n,e.setLineDash([.1,t.length]);break;default:t.animateReverse?e.setLineDash([0,t.length-t.calculative.animatePos+1,t.calculative.animatePos]):e.setLineDash([t.calculative.animatePos,t.length-t.calculative.animatePos]);break}}function fs(e){var t=e.data,i=e.options;return t.color||i.color}function rh(e,t){var i=t.calculative.canvas.store;e.save(),e.lineWidth=1,e.fillStyle=t.activeColor||i.options.activeColor,t.calculative.worldAnchors.forEach(function(n){!n.hidden&&!n.isTemp&&ih(e,n,t)}),e.restore()}function ih(e,t,i){if(!!t){var n=i.calculative.activeAnchor===t,r=3;i.calculative.lineWidth>3&&(r=i.calculative.lineWidth),n?(t.prev&&(e.save(),e.strokeStyle="#4dffff",e.beginPath(),e.moveTo(t.prev.x,t.prev.y),e.lineTo(t.x,t.y),e.stroke(),e.restore(),e.save(),e.fillStyle="#ffffff",e.beginPath(),e.arc(t.prev.x,t.prev.y,r,0,Math.PI*2),e.fill(),e.stroke(),e.restore()),t.next&&(e.save(),e.strokeStyle="#4dffff",e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.next.x,t.next.y),e.stroke(),e.restore(),e.save(),e.fillStyle="#ffffff",e.beginPath(),e.arc(t.next.x,t.next.y,r,0,Math.PI*2),e.fill(),e.stroke(),e.restore(),e.beginPath(),e.arc(t.x,t.y,r,0,Math.PI*2),e.fill(),e.stroke()),e.beginPath(),e.arc(t.x,t.y,r,0,Math.PI*2),e.fill(),e.stroke()):(e.save(),e.fillStyle="#ffffff",e.beginPath(),e.arc(t.x,t.y,r,0,Math.PI*2),e.fill(),e.stroke(),e.restore())}}function ds(e){var t=e.calculative.canvas.store,i={x:e.x,y:e.y};if(!e.parentId)i.width=e.width,i.height=e.height,i.rotate=e.rotate,Ne(i),Ie(i);else{var n=t.pens[e.parentId],r=n.calculative.worldRect;r||(r=ds(n)),i.x=r.x+r.width*e.x,i.y=r.y+r.height*e.y,i.width=r.width*e.width,i.height=r.height*e.height,n.flipX&&(i.x=r.width-(i.x-r.x+i.width)+r.x),n.flipY&&(i.y=r.height-(i.y-r.y+i.height)+r.y),Ne(i),i.rotate=r.rotate+e.rotate,Ie(i)}return e.calculative.worldRect=i,vs(e,i),i}function vs(e,t){!e.paddingTop&&(e.calculative.paddingTop=0),!e.paddingBottom&&(e.calculative.paddingBottom=0),!e.paddingLeft&&(e.calculative.paddingLeft=0),!e.paddingRight&&(e.calculative.paddingRight=0),e.calculative.paddingTop<1&&(e.calculative.paddingTop*=t.height),e.calculative.paddingBottom<1&&(e.calculative.paddingBottom*=t.height),e.calculative.paddingLeft<1&&(e.calculative.paddingLeft*=t.width),e.calculative.paddingRight<1&&(e.calculative.paddingRight*=t.width)}function Vi(e){var t=e.calculative.worldRect;if(!e.parentId){Object.assign(e,t);return}var i=e.calculative.canvas.store,n=i.pens[e.parentId].calculative.worldRect;Object.assign(e,ai(t,n))}function mi(e){var t=e.calculative.canvas.store,i=[];if(e.anchors&&e.anchors.forEach(function(u){i.push(nh(e,u))}),!i.length&&!e.type&&e.name!=="combine"){var n=e.calculative.worldRect,r=n.x,o=n.y,a=n.width,l=n.height;i=t.options.defaultAnchors.map(function(u,s){return{id:""+s,penId:e.id,x:r+a*u.x,y:o+l*u.y}})}e.calculative.rotate&&i.forEach(function(u){Re(u,e.calculative.rotate,e.calculative.worldRect.center)}),(!e.type||e.anchors)&&(e.calculative.worldAnchors=i),e.calculative.activeAnchor&&i.length&&(e.calculative.activeAnchor=i.find(function(u){u.id,e.calculative.activeAnchor.id}))}function nh(e,t){var i=pn({},t),n=e.calculative.worldRect,r=n.x,o=n.y,a=n.width,l=n.height;return i.x=r+a*t.x,i.y=o+l*t.y,t.prev&&(i.prev={penId:e.id,connectTo:t.prev.connectTo,x:r+a*t.prev.x,y:o+l*t.prev.y}),t.next&&(i.next={penId:e.id,connectTo:t.next.connectTo,x:r+a*t.next.x,y:o+l*t.next.y}),i}function Do(e,t){var i=t.calculative,n=i.paddingTop,r=i.paddingBottom,o=i.paddingLeft,a=i.paddingRight,l=o,u=n,s=t.calculative.worldRect.width-o-a,c=t.calculative.worldRect.height-n-r,h=t.calculative.iconLeft,f=t.calculative.iconTop;h&&Math.abs(h)<1&&(h=t.calculative.worldRect.width*h),f&&Math.abs(f)<1&&(f=t.calculative.worldRect.height*f),l+=h||0,u+=f||0,s-=h||0,c-=f||0;var d=t.calculative.iconRotate||0;if(t.parentId){var v=e[t.parentId].calculative;v&&(d+=v.rotate,d%=360)}l=t.calculative.worldRect.x+l,u=t.calculative.worldRect.y+u,t.calculative.worldIconRect={x:l,y:u,width:s,height:c,rotate:d},Ne(t.calculative.worldIconRect),Ie(t.calculative.worldIconRect)}function Ki(e,t,i){bi(e.calculative.worldRect,t,i),e.calculative.initRect&&bi(e.calculative.initRect,t,i),e.calculative.x&&Kn(e.calculative,t,i),e.type&&mi(e)}function oh(e,t){e.anchors||(e.anchors=[]),e.calculative.worldAnchors||(e.calculative.worldAnchors=[]);var i={id:t.id,penId:e.id,x:t.x,y:t.y};if(e.calculative.worldAnchors.push(i),e.calculative.worldRect){e.rotate%360&&Re(t,-e.rotate,e.calculative.worldRect.center);var n={id:t.id,penId:e.id,x:(t.x-e.calculative.worldRect.x)/e.calculative.worldRect.width,y:(t.y-e.calculative.worldRect.y)/e.calculative.worldRect.height};e.anchors.push(n)}return i}function ah(e,t,i){e.anchors||(e.anchors=[]),e.calculative.worldAnchors||(e.calculative.worldAnchors=[]);var n=rf(e,t,i);return e.calculative.worldAnchors.splice(i+1,0,n),e.anchors.splice(i+1,0,si(n,e.calculative.worldRect)),e.calculative.activeAnchor=n,n}function sh(e,t){if(!(!e||!e.calculative.worldAnchors)){var i=e.calculative.worldAnchors.findIndex(function(n){return n.id===t.id});i>-1&&e.calculative.worldAnchors.splice(i,1),i=e.anchors.findIndex(function(n){return n.id===t.id}),i>-1&&e.anchors.splice(i,1)}}function ar(e,t){return!t||!t.calculative||!t.calculative.worldRect.center?fe.None:vu(e,t.calculative.worldRect.center)}function Yr(e,t){var i=1/0,n;return e.calculative.worldAnchors.forEach(function(r){var o=Li(t,r);i>o&&(i=o,n=r)}),n}function lh(e,t,i){e.x+=t,e.y+=i,e.anchors&&e.anchors.forEach(function(n){Er(n,t,i)}),e.calculative.worldAnchors&&e.calculative.worldAnchors.forEach(function(n){Er(n,t,i)})}function Xn(e){if(e&&e.calculative&&e.calculative.worldAnchors.length){var t=Ae(e);if(!e.anchors||!e.anchors.length)for(;e.calculative.worldAnchors.length&&t!==e.calculative.activeAnchor;)e.calculative.worldAnchors.pop(),t=Ae(e);else t===e.calculative.activeAnchor?e.calculative.worldAnchors=[e.calculative.worldAnchors[0]]:e.calculative.worldAnchors[0]===e.calculative.activeAnchor&&(e.calculative.worldAnchors=[e.calculative.worldAnchors[e.calculative.worldAnchors.length-1]])}}function yt(e,t,i,n){if(!(!e||!t||!i||!n)&&!(n.connectTo===e.id&&n.anchorId===t.id)){if(n.connectTo){var r=e.calculative.canvas.store.pens[n.connectTo];Pr(r,Gt(r,n.anchorId),i,n)}e.connectedLines||(e.connectedLines=[]);var o=e.connectedLines.findIndex(function(a){return a.lineId===i.id&&a.lineAnchor===n.id&&a.anchor===t.id});return o<0&&e.connectedLines.push({lineId:i.id,lineAnchor:n.id,anchor:t.id}),n.connectTo=e.id,n.anchorId=t.id,e.type&&yt(i,n,e,t),!0}}function Pr(e,t,i,n){if(!(!e||!t||!i||!n)&&!(!e.connectedLines||!e.connectedLines.length))return e.connectedLines.forEach(function(r,o,a){(r.lineId===i.id||r.lineId===i.id)&&r.lineAnchor===n.id&&r.anchor===t.id&&a.splice(o,1)}),n.connectTo=void 0,n.anchorId=void 0,e.type&&t.connectTo===i.id&&t.anchorId===n.id&&Pr(i,n,e,t),!0}function Gt(e,t){var i;if(!(!e||!t))return(i=e.calculative.worldAnchors)===null||i===void 0?void 0:i.find(function(n){return n.id===t})}function Oe(e){if(!(!e||!e.calculative.worldAnchors))return e.calculative.worldAnchors[0]}function Ae(e){if(!(!e||!e.calculative.worldAnchors))return e.calculative.worldAnchors[e.calculative.worldAnchors.length-1]}function ch(e,t){var i,n,r,o;if(e.calculative.start===0||!e.frames||!e.frames.length)return e.calculative.start=void 0,0;if(!e.calculative.duration){e.calculative.duration=0;try{for(var a=zr(e.frames),l=a.next();!l.done;l=a.next()){var u=l.value;e.calculative.duration+=u.duration;for(var s in u)s!=="duration"&&!e[s]&&s==="scale"&&(e[s]=1)}}catch(_){i={error:_}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}}if(e.animateCycle||(e.animateCycle=1/0),e.calculative.start){var c=0,h=Math.ceil((t-e.calculative.start)/e.calculative.duration);if(h>e.animateCycle)return e.calculative.start=void 0,No(e,1),0;var f=(t-e.calculative.start)%e.calculative.duration,d=0;try{for(var v=zr(e.frames),g=v.next();!g.done;g=v.next()){var p=g.value;if(d+=p.duration,f>d)++c;else break}}catch(_){r={error:_}}finally{try{g&&!g.done&&(o=v.return)&&o.call(v)}finally{if(r)throw r.error}}if(!e.frames[c])return!0;e.calculative.frameDuration=e.frames[c].duration,e.calculative.frameStart=e.calculative.start+e.calculative.duration*(h-1),e.calculative.frameEnd=e.calculative.frameStart+e.calculative.frameDuration;var b=c!==e.calculative.frameIndex,x=h>e.calculative.cycleIndex;if(b&&(e.calculative.frameIndex=c),x&&(e.calculative.cycleIndex=h),b||x){e.calculative.x=e.calculative.initRect.x,e.calculative.y=e.calculative.initRect.y,e.calculative.rotate=e.calculative.initRect.rotate||0,e.lastFrame={};var p=e.frames[c-1];for(var s in p)e.lastFrame[s]=p[s];c>0?Object.assign(e.lastFrame,{rotate:e.frames[c-1].rotate||0,x:e.frames[c-1].x||0,y:e.frames[c-1].y||0,scale:e.frames[c-1].scale||1}):Object.assign(e.lastFrame,{rotate:0,x:0,y:0,scale:1})}}else{e.calculative.start=t,e.calculative.frameIndex=0,e.calculative.frameStart=e.calculative.start,e.calculative.frameDuration=e.frames[0].duration,e.calculative.frameEnd=e.calculative.frameStart+e.calculative.frameDuration,e.calculative.cycleIndex=1,e.lastFrame={};for(var s in e)(typeof e[s]!="object"||s==="lineDash")&&(e.lastFrame[s]=e[s]);e.lastFrame.rotate=0,e.lastFrame.x=0,e.lastFrame.y=0,e.lastFrame.scale=1,e.calculative.x=e.calculative.worldRect.x,e.calculative.y=e.calculative.worldRect.y,e.calculative.initRect=se(e.calculative.worldRect),e.calculative.initRect.rotate=e.calculative.rotate||0}var m=(t-e.calculative.frameStart)/e.calculative.frameDuration%1;return No(e,m),!0}function No(e,t){if(!(t<0)){t>1&&(t=1);var i=e.frames[e.calculative.frameIndex];for(var n in i)if(n!=="duration"){if(n==="scale"){e.calculative.worldRect=se(e.calculative.initRect),bi(e.calculative.worldRect,e.lastFrame.scale,e.calculative.worldRect.center);var r=e.lastFrame.scale+(i[n]-e.lastFrame.scale)*t;bi(e.calculative.worldRect,r/e.lastFrame.scale,e.calculative.worldRect.center),e.calculative.dirty=!0}else if(n==="x"){var o=Yi(e,n,e.calculative.frameIndex);e.calculative.worldRect.x=e.calculative.initRect.x+o,e.calculative.worldRect.ex=e.calculative.initRect.ex+o,zt(e.calculative.worldRect,i[n]*t*e.calculative.canvas.store.data.scale,0),e.calculative.dirty=!0}else if(n==="y"){var o=Yi(e,n,e.calculative.frameIndex);e.calculative.worldRect.y=e.calculative.initRect.y+o,e.calculative.worldRect.ey=e.calculative.initRect.ey+o,zt(e.calculative.worldRect,0,i[n]*t*e.calculative.canvas.store.data.scale),e.calculative.dirty=!0}else if(n==="rotate"){e.lastFrame[n]>=360&&(e.lastFrame[n]%=360);var o=Yi(e,n,e.calculative.frameIndex);e.calculative.rotate=(e.calculative.initRect.rotate+o+i[n]*t)%360,e.calculative.dirty=!0}else if(uh(i[n],n,e)){e.lastFrame[n]==null&&(n==="globalAlpha"?e.lastFrame[n]=1:e.lastFrame[n]=0);var a=e.lastFrame[n]+(i[n]-e.lastFrame[n])*t;e.calculative[n]=Math.round(a*100)/100}else e.calculative[n]=i[n];n==="text"&&Mi(e)}}}function uh(e,t,i){var n=["strokeType","bkType","showChild"];return typeof e=="number"&&i.linear!==!1&&!n.includes(t)}function hh(e,t){if(e.calculative.start===0)return e.calculative.start=void 0,0;if(e.animateCycle||(e.animateCycle=1/0),e.animateSpan||(e.animateSpan=1),e.calculative.animatePos+=e.animateSpan*(e.calculative.canvas.store.data.scale||1),!e.calculative.start)e.calculative.start=Date.now(),e.calculative.animatePos=e.animateSpan*(e.calculative.canvas.store.data.scale||1),e.calculative.cycleIndex=1;else if(e.calculative.animatePos>e.length){if(++e.calculative.cycleIndex,e.calculative.cycleIndex>e.animateCycle)return e.calculative.start=void 0,0;e.calculative.animatePos=e.animateSpan}return!0}function Jt(e,t){if(t===void 0&&(t=!0),!!e.children){var i=e.calculative.canvas.store;e.children.forEach(function(n){var r=i.pens[n];r&&(r.calculative.active=t,Jt(r,t))})}}function ni(e,t){if(t===void 0&&(t=!0),!!e){var i=e.calculative.canvas.store;e.calculative.hover=t,e.children&&e.children.forEach(function(n){var r,o;((r=i.pens[n])===null||r===void 0?void 0:r.hoverColor)==null&&((o=i.pens[n])===null||o===void 0?void 0:o.hoverBackground)==null&&ni(i.pens[n],t)})}}function _t(e,t){if(!!t){var i=e.calculative.canvas.store,n=e.calculative.worldRect;t.style.position="absolute",t.style.outline="none",t.style.left=n.x+i.data.x+"px",t.style.top=n.y+i.data.y+"px",t.style.width=n.width+"px",t.style.height=n.height+"px",t.style.display=e.calculative.inView!=!1?"inline":"none",!e.calculative.rotate&&(e.calculative.rotate=0),t.style.transform="rotate("+e.calculative.rotate+"deg)",e.locked===Ce.DisableEdit||e.locked===Ce.DisableMove||i.data.locked?(t.style.userSelect="initial",t.style.pointerEvents="initial"):(t.style.userSelect="none",t.style.pointerEvents="none")}}function $i(e){return e.every(function(t){return t.locked})}function jo(e){return e.every(function(t){return t.disableRotate})}function Fo(e){return e.every(function(t){return t.disableSize})}function Yi(e,t,i){if(!e.frames||!t)return 0;for(var n=0,r=0;r<i;r++)e.frames[r]&&(n+=e.frames[r][t]||0);return n}function ps(e,t){for(var i,n=e;n.parentId;){var r=n;n=t.pens[n.parentId];var o=(i=n==null?void 0:n.calculative)===null||i===void 0?void 0:i.showChild;if(o!=null){var a=n.children[o];if(a!==r.id)return!1}}return!0}function Rr(e,t){var i,n;t===void 0&&(t=!1);var r=e.calculative.canvas,o=r.store,a=r.canvasRect;if(t&&((i=e.children)===null||i===void 0||i.forEach(function(v){var g=o.pens[v];g&&Rr(g,!0)})),e.calculative.inView=!0,!ps(e,o)||e.visible==!1||e.calculative.visible==!1)e.calculative.inView=!1;else{var l=e.calculative.worldRect,u=l.x,s=l.y,c=l.width,h=l.height,f=l.rotate,d={x:u+o.data.x,y:s+o.data.y,width:c,height:h,rotate:f};Ne(d),bn(d,a)||(e.calculative.inView=!1)}(n=e.onMove)===null||n===void 0||n.call(e,e)}function fh(e,t,i){if(t.fillWorldTextRect){e.save(),e.fillStyle="#c3deb7";var n=i.calculative.worldTextRect,r=n.x,o=n.y,a=n.width,l=n.height;e.fillRect(r,o,a,l),e.restore()}}function wi(e,t){var i=t.calculative.globalAlpha;i<1&&(e.globalAlpha=i)}function ys(e,t){var i=he.canvasDraws[t.name];i&&(e.save(),i(e,t),e.restore())}var Ir=globalThis&&globalThis.__values||function(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},mn=globalThis&&globalThis.__read||function(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var n=i.call(e),r,o=[],a;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(a)throw a.error}}return o},oi=globalThis&&globalThis.__spreadArray||function(e,t,i){if(i||arguments.length===2)for(var n=0,r=t.length,o;n<r;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};function dh(e,t,i,n){var r=[];return i.length===1?(r=se(gs(i[0])),r.forEach(function(o){o.x+=n.x,o.y+=n.y})):(Ie(t),r=oi([t.center],mn(bt(t)),!1)),ms(e,r,t,!0)}function gs(e){if(e.type){if(e.type===Pe.Line)return e.calculative.worldAnchors}else{var t=bt(e.calculative.worldRect);return Ie(e.calculative.worldRect),oi(oi(oi([],mn(t),!1),mn(e.calculative.worldAnchors),!1),[e.calculative.worldRect.center],!1)}}function vh(e,t,i,n){var r=bt(t);return ms(e,r,t)}function ms(e,t,i,n){var r,o,a,l,u,s;n===void 0&&(n=!1);var c,h,f=1/0,d=1/0,v=8,g=bh(i,v),p=e.data.pens.filter(function(B){var H=B.calculative,W=H.inView,F=H.worldRect,D=H.active;return!(W===!1||!n&&D||wh(g,F)||B.type&&e.active.some(function(z){return ws(e,z,B)}))});try{for(var b=Ir(p),x=b.next();!x.done;x=b.next()){var m=x.value,_=gs(m);try{for(var P=(a=void 0,Ir(_)),R=P.next();!R.done;R=P.next()){var L=R.value;try{for(var I=(u=void 0,Ir(t)),V=I.next();!V.done;V=I.next()){var Q=V.value,T=L.x-Q.x,k=L.y-Q.y,M=Math.abs(T),C=Math.abs(k);M<v&&M<f&&(c={x:Math.round(L.x)+.5,y:Math.round(L.y)+.5,step:T,prev:{x:Math.round(Q.x)+.5,y:Math.round(Q.y)+.5},penId:m.id},f=M),C<v&&C<d&&(h={x:Math.round(L.x)+.5,y:Math.round(L.y)+.5,step:k,prev:{x:Math.round(Q.x)+.5,y:Math.round(Q.y)+.5},penId:m.id},d=C)}}catch(B){u={error:B}}finally{try{V&&!V.done&&(s=I.return)&&s.call(I)}finally{if(u)throw u.error}}}}catch(B){a={error:B}}finally{try{R&&!R.done&&(l=P.return)&&l.call(P)}finally{if(a)throw a.error}}}}catch(B){r={error:B}}finally{try{x&&!x.done&&(o=b.return)&&o.call(b)}finally{if(r)throw r.error}}return{xDock:c,yDock:h}}function ws(e,t,i){var n,r,o,a;if(!i.type)return!1;if(Array.isArray(t==null?void 0:t.connectedLines))try{for(var l=Ir(t==null?void 0:t.connectedLines),u=l.next();!u.done;u=l.next()){var s=u.value;if(s.lineId===i.id)return!0}}catch(v){n={error:v}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}if(Array.isArray(t==null?void 0:t.children))try{for(var c=Ir(t.children),h=c.next();!h.done;h=c.next()){var f=h.value,d=e.pens[f];if(ws(e,d,i))return!0}}catch(v){o={error:v}}finally{try{h&&!h.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}return!1}function wn(e,t){return e.toFixed(12)==t}var ph=globalThis&&globalThis.__values||function(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function zo(e){var t,i;if(e.id=be(),Array.isArray(e.anchors))try{for(var n=ph(e.anchors),r=n.next();!r.done;r=n.next()){var o=r.value;e.type&&(o.id=be()),o.penId=e.id,o.prev&&(e.type&&(o.prev.id=be()),o.prev.penId=e.id),o.next&&(e.type&&(o.next.id=be()),o.next.penId=e.id)}}catch(a){t={error:a}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}}var bs=globalThis&&globalThis.__values||function(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},yh=globalThis&&globalThis.__read||function(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var n=i.call(e),r,o=[],a;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(a)throw a.error}}return o},gh=globalThis&&globalThis.__spreadArray||function(e,t,i){if(i||arguments.length===2)for(var n=0,r=t.length,o;n<r;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};function Xi(e,t){if(!!t){if(t.ex==null&&Ne(t),!t.rotate||t.width<20||t.height<20||t.rotate%360===0)return e.x>t.x&&e.x<t.ex&&e.y>t.y&&e.y<t.ey;t.center||Ie(t);var i=[{x:t.x,y:t.y},{x:t.ex,y:t.y},{x:t.ex,y:t.ey},{x:t.x,y:t.ey}];return i.forEach(function(n){Re(n,t.rotate,t.center)}),mh(e,i)}}function Wt(e,t,i){i===void 0&&(i=0);var n=t.x,r=t.y,o=t.ex,a=t.ey;return e.x>=n-i&&e.x<=o+i&&e.y>=r-i&&e.y<=a+i}function Ie(e){e.center||(e.center={}),e.center.x=e.x+e.width/2,e.center.y=e.y+e.height/2}function Ne(e){e.ex=e.x+e.width,e.ey=e.y+e.height}function mh(e,t){var i,n;if(t.length<3)return!1;var r=!1,o=t[t.length-1];try{for(var a=bs(t),l=a.next();!l.done;l=a.next()){var u=l.value;o.y>e.y!=u.y>e.y&&u.x+(e.y-u.y)*(o.x-u.x)/(o.y-u.y)>e.x&&(r=!r),o=u}}catch(s){i={error:s}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return r}function wt(e){var t=[];e.forEach(function(n){if(!n.isRuleLine){var r=n.calculative.worldRect;if(r){var o=bt(r);t.push.apply(t,gh([],yh(o),!1))}}});var i=Hr(t);return Ie(i),i}function bt(e){var t=[{x:e.x,y:e.y},{x:e.ex,y:e.y},{x:e.ex,y:e.ey},{x:e.x,y:e.ey}];return e.rotate&&(e.center||Ie(e),t.forEach(function(i){Re(i,e.rotate,e.center)})),t}function Hr(e){var t=1/0,i=1/0,n=-1/0,r=-1/0;return e.forEach(function(o){!isFinite(o.x)||!isFinite(o.y)||(t=Math.min(t,o.x),i=Math.min(i,o.y),n=Math.max(n,o.x),r=Math.max(r,o.y))}),isFinite(t)||console.error("getRectOfPoints \u975E\u6CD5\u7684 points",e),{x:t,y:i,ex:n,ey:r,width:n-t,height:r-i}}function bn(e,t,i){return e.rotate&&(e=Hr(bt(e))),i?e.x>t.x&&e.ex<t.ex&&e.y>t.y&&e.ey<t.ey:!(e.x>t.ex||e.ex<t.x||e.ey<t.y||e.y>t.ey)}function wh(e,t){return(t.x>e.ex||t.ex<e.x)&&(t.y>e.ey||t.ey<e.y)}function bh(e,t){var i=Yn(t),n={x:e.x-i[3],y:e.y-i[0],width:e.width+i[1]+i[3],height:e.height+i[0]+i[2]};return Ne(n),n}function zt(e,t,i){e.x+=t,e.y+=i,e.ex+=t,e.ey+=i,e.center&&(e.center.x+=t,e.center.y+=i)}function xh(e,t){var i=(e.to.y-e.from.y)/(e.to.x-e.from.x),n=(t.to.y-t.from.y)/(t.to.x-t.from.x);return xn({k:i,point:e.from},{k:n,point:t.from})}function xn(e,t){if(wn(e.k,0))return{x:t.point.x,y:e.point.y};if(wn(t.k,0))return{x:e.point.x,y:t.point.y};var i=e.point.y-e.k*e.point.x,n=t.point.y-t.k*t.point.x,r=(n-i)/(e.k-t.k),o=e.k*r+i;return{x:r,y:o}}function _h(e,t){var i,n,r=xh({from:e[0],to:e[2]},{from:e[1],to:e[3]});try{for(var o=bs(e),a=o.next();!a.done;a=o.next()){var l=a.value;Re(l,-t,r)}}catch(u){i={error:u}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return Hr(e)}function Uo(e,t,i,n){if(e.rotate&&e.rotate%360){var r=bt(e),o=(r[0].y-r[1].y)/(r[0].x-r[1].x),a=(r[1].y-r[2].y)/(r[1].x-r[2].x);if(n<4){r[n].x+=t,r[n].y+=i;var l=r[(n+2)%4];r[(n+1)%4]=xn({k:n%2?a:o,point:r[n]},{k:n%2?o:a,point:l}),r[(n+4-1)%4]=xn({k:n%2?o:a,point:r[n]},{k:n%2?a:o,point:l})}else{var u=[4,6].includes(n)?a:o;wn(u,0)?(r[n%4].x+=t,r[(n+1)%4].x+=t):(r[n%4].y+=i,r[n%4].x+=i/u,r[(n+1)%4].y+=i,r[(n+1)%4].x+=i/u)}if(Math.pow(r[0].x-r[1].x,2)+Math.pow(r[0].y-r[1].y,2)<25||Math.pow(r[1].x-r[2].x,2)+Math.pow(r[1].y-r[2].y,2)<25)return;var s=_h(r,e.rotate);Ie(s),Object.assign(e,s);return}switch(n){case 0:if(e.width-t<5||e.height-i<5)break;e.x+=t,e.y+=i,e.width-=t,e.height-=i;break;case 1:if(e.width+t<5||e.height-i<5)break;e.ex+=t,e.y+=i,e.width+=t,e.height-=i;break;case 2:if(e.width+t<5||e.height+i<5)break;e.ex+=t,e.ey+=i,e.width+=t,e.height+=i;break;case 3:if(e.width-t<5||e.height+i<5)break;e.x+=t,e.ey+=i,e.width-=t,e.height+=i;break;case 4:if(e.height-i<5)break;e.y+=i,e.height-=i;break;case 5:if(e.width+t<5)break;e.ex+=t,e.width+=t;break;case 6:if(e.height+i<5)break;e.ey+=i,e.height+=i;break;case 7:if(e.width-t<5)break;e.x+=t,e.width-=t;break}}function bi(e,t,i){!e||(e.width*=t,e.height*=t,Kn(e,t,i),Ne(e),Ie(e))}function ai(e,t){var i={x:(e.x-t.x)/t.width,y:(e.y-t.y)/t.height,width:e.width/t.width,height:e.height/t.height};return Ne(i),i}function si(e,t){var i=t.x,n=t.y,r=t.width,o=t.height,a=e.id,l=e.penId,u=e.connectTo,s=e.anchorId,c=e.prevNextType,h=e.hidden,f={id:a,penId:l,connectTo:u,x:r?(e.x-i)/r:0,y:o?(e.y-n)/o:0,anchorId:s,prevNextType:c,hidden:h};return e.prev&&(f.prev={penId:l,connectTo:u,x:r?(e.prev.x-i)/r:0,y:o?(e.prev.y-n)/o:0}),e.next&&(f.next={penId:l,connectTo:u,x:r?(e.next.x-i)/r:0,y:o?(e.next.y-n)/o:0}),f}var kh=globalThis&&globalThis.__read||function(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var n=i.call(e),r,o=[],a;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(a)throw a.error}}return o},Th=globalThis&&globalThis.__spreadArray||function(e,t,i){if(i||arguments.length===2)for(var n=0,r=t.length,o;n<r;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},Ah=globalThis&&globalThis.__values||function(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Sh=/^[\t\n\f\r ]*([MLHVZCSQTAmlhvzcsqta])[\t\n\f\r ]*/,Ho=/^[01]/,ke=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,Eh=/^(([\t\n\f\r ]+,?[\t\n\f\r ]*)|(,[\t\n\f\r ]*))/,Ch={M:[ke,ke],L:[ke,ke],H:[ke],V:[ke],Z:[],C:[ke,ke,ke,ke,ke,ke],S:[ke,ke,ke,ke],Q:[ke,ke,ke,ke],T:[ke,ke],A:[ke,ke,ke,Ho,Ho,ke,ke]};function Ph(e){for(var t=0,i=[];t<e.length;){var n=e.slice(t).match(Sh);if(n!==null){var r=n[1];t+=n[0].length;var o=Mh(r,e,t);t=o.cursor,i.push.apply(i,Th([],kh(o.commands),!1))}else throw new Error("malformed path (first error at "+t+")")}return{commands:i}}function qo(e){var t=1/0,i=1/0,n=-1/0,r=-1/0;return Bh(e),e.commands.forEach(function(o){o.worldPoints.forEach(function(a,l){l%2===0?(a<t&&(t=a),a>n&&(n=a)):(a<i&&(i=a),a>r&&(r=a))})}),--t,--i,{x:t,y:i,ex:n,ey:r,width:n-t+1,height:r-i+1}}function Rh(e,t,i){i==null&&(i=t),e.commands.forEach(function(n,r){if(!(n.relative&&r))switch(n.key){case"A":case"a":n.values[5]+=t,n.values[6]+=i;break;case"V":case"v":n.values[0]+=i;break;default:n.values.forEach(function(o,a){n.values[a]=o+(a%2===0?t:i)});break}})}function Ih(e,t,i){i==null&&(i=t),e.commands.forEach(function(n){switch(n.key){case"A":case"a":var r=n.values[0],o=n.values[1],a=Math.PI*n.values[2]/180,l=Math.cos(a),u=Math.sin(a),s=o*o*i*i*l*l+r*r*i*i*u*u,c=2*t*i*l*u*(o*o-r*r),h=r*r*t*t*l*l+o*o*t*t*u*u,f=-(r*r*o*o*t*t*i*i),d=c*c-4*s*h,v=Math.sqrt((s-h)*(s-h)+c*c);n.values[2]=c!==0?Math.atan((h-s-v)/c)*180/Math.PI:s<h?0:90,n.values[0]=-Math.sqrt(2*d*f*(s+h+v))/d,n.values[1]=-Math.sqrt(2*d*f*(s+h-v))/d,n.values[5]*=t,n.values[6]*=i,n.values[4]=t*i>=0?n.values[4]:1-n.values[4];break;case"V":case"v":n.values[0]*=i;break;default:n.values.forEach(function(g,p){n.values[p]=g*(p%2===0?t:i)});break}})}function Lh(e){var t="";return e.commands.forEach(function(i){t+=i.key+" ",i.values.forEach(function(n){t+=n+" "})}),t}function Mh(e,t,i){for(var n,r,o=Ch[e.toUpperCase()],a=[];i<=t.length;){var l={key:e,values:[]};try{for(var u=(n=void 0,Ah(o)),s=u.next();!s.done;s=u.next()){var c=s.value,h=t.slice(i).match(c);if(h!==null){l.values.push(+h[0]),i+=h[0].length;var f=t.slice(i).match(Eh);f!==null&&(i+=f[0].length)}else{if(l.values.length===0)return{cursor:i,commands:a};throw new Error("malformed path (first error at "+i+")")}}}catch(d){n={error:d}}finally{try{s&&!s.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}if(l.relative=l.key.toUpperCase()!==l.key,a.push(l),o.length===0)return{cursor:i,commands:a};e==="m"&&(e="l"),e==="M"&&(e="L")}throw new Error("malformed path (first error at "+i+")")}function Oh(e,t){for(var i=[],n=e.relative&&t?{x:t.worldPoints[t.worldPoints.length-2],y:t.worldPoints[t.worldPoints.length-1]}:{x:0,y:0},r=0;r<e.values.length-1;r+=2)i.push(n.x+e.values[r]),i.push(n.y+e.values[r+1]);e.worldPoints=i}function Bh(e){var t,i=0,n=0;e.commands.forEach(function(r){switch(r.key){case"Z":case"z":r.worldPoints=[i,n];break;case"H":r.worldPoints=[r.values[0],t.worldPoints[t.worldPoints.length-1]];break;case"h":r.worldPoints=[r.values[0]+t.worldPoints[t.worldPoints.length-2],t.worldPoints[t.worldPoints.length-1]];break;case"V":r.worldPoints=[t.worldPoints[t.worldPoints.length-2],r.values[0]];break;case"v":r.worldPoints=[t.worldPoints[t.worldPoints.length-2],r.values[0]+t.worldPoints[t.worldPoints.length-1]];break;case"A":r.worldPoints=[t.worldPoints[t.worldPoints.length-2],r.values[0]+t.worldPoints[t.worldPoints.length-1]];break;default:Oh(r,t);break}(r.key==="M"||r.key==="m"||r.key==="Z"||r.key==="z")&&(i=r.worldPoints[r.worldPoints.length-2],n=r.worldPoints[r.worldPoints.length-1]),t=r})}function Dh(e,t){var i,n,r=e.calculative.canvas.store,o=r.data.paths[e.pathId];if(!o)return new Path2D;var a=Ph(o);e.calculative.svgRect=qo(a),Ie(e.calculative.svgRect),(e.calculative.svgRect.width!==e.calculative.worldRect.width||e.calculative.svgRect.height!==e.calculative.worldRect.height)&&Ih(a,e.calculative.worldRect.width/e.calculative.svgRect.width,e.calculative.worldRect.height/e.calculative.svgRect.height);var l=qo(a);Ie(l),Rh(a,e.calculative.worldRect.x-l.x,e.calculative.worldRect.y-l.y);var u=Lh(a);if(t){(n=(i=t).svgPath)===null||n===void 0||n.call(i,u);return}var s=new Path2D(u);return s}function Nh(e,t){var i=t||new Path2D,n=e.calculative.worldRect,r=n.x,o=n.y,a=n.width,l=n.height;if(i.moveTo(r+a/2,o),i.lineTo(r+a,o+l/2),i.lineTo(r+a/2,o+l),i.lineTo(r,o+l/2),i.lineTo(r+a/2,o),i.closePath(),i instanceof Path2D)return i}function jh(e,t){var i=t||new Path2D,n=e.calculative.worldRect,r=n.x,o=n.y,a=n.width,l=n.height;if(i.moveTo(r+a/2,o),i.lineTo(r+a,o+l),i.lineTo(r,o+l),i.lineTo(r+a/2,o),i.closePath(),i instanceof Path2D)return i}function Fh(e){var t=[{x:.5,y:0},{x:.75,y:.5},{x:.5,y:1},{x:.25,y:.5}];e.anchors=t.map(function(i,n){var r=i.x,o=i.y;return{id:""+n,penId:e.id,x:r,y:o}})}function zh(e,t){var i=t||new Path2D,n=e.calculative.worldRect,r=n.x,o=n.y,a=n.width,l=n.height;if(i.moveTo(r+a/2,o),i.lineTo(r+a,o+l*2/5),i.lineTo(r+a*4/5,o+l),i.lineTo(r+a/5,o+l),i.lineTo(r,o+l*2/5),i.closePath(),i instanceof Path2D)return i}function Uh(e){var t=[{x:.5,y:0},{x:1,y:.4},{x:.8,y:1},{x:.2,y:1},{x:0,y:.4}];e.anchors=t.map(function(i,n){var r=i.x,o=i.y;return{id:""+n,penId:e.id,x:r,y:o}})}var Hh=globalThis&&globalThis.__read||function(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var n=i.call(e),r,o=[],a;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(a)throw a.error}}return o},qh=globalThis&&globalThis.__spreadArray||function(e,t,i){if(i||arguments.length===2)for(var n=0,r=t.length,o;n<r;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};function Wh(e,t){e.onResize||(e.onResize=Vh);var i=t||new Path2D,n=e.calculative.worldRect,r=n.width,o=n.height,a=n.center,l=r>o?o:r,u=a.x,s=a.y,c=s-l/2,h=s-l/4,f=-(h-s)*Math.sin(Math.PI/180*324)+u,d=(h-s)*Math.cos(Math.PI/180*324)+s;i.moveTo(f,d);for(var v=0;v<5;++v)i.lineTo(-(c-s)*Math.sin(Math.PI/180*72*v)+u,(c-s)*Math.cos(Math.PI/180*72*v)+s),i.lineTo((f-u)*Math.cos(Math.PI/180*72*(v+1))-(d-s)*Math.sin(Math.PI/180*72*(v+1))+u,(f-u)*Math.sin(Math.PI/180*72*(v+1))+(d-s)*Math.cos(Math.PI/180*72*(v+1))+s);if(i.closePath(),i instanceof Path2D)return i}function xs(e){for(var t=e.width,i=e.height,n=t>i?i:t,r=[],o=0;o<5;++o)r.push({flag:1,id:String(o),penId:e.id,x:.5+n/2*Math.sin(Math.PI/180*72*o)/t,y:-n/2*Math.cos(Math.PI/180*72*o)/i+.5});e.anchors=r}function Vh(e){var t,i=e.anchors.filter(function(n){return n.flag!==1});xs(e),e.anchors=(t=e.anchors).concat.apply(t,qh([],Hh(i),!1))}function Kh(e,t){var i=t||new Path2D,n=e.calculative.worldRect,r=n.x,o=n.y,a=n.width,l=n.height;if(i.moveTo(r+a/4,o),i.lineTo(r+a*3/4,o),i.lineTo(r+a,o+l/2),i.lineTo(r+a*3/4,o+l),i.lineTo(r+a*1/4,o+l),i.lineTo(r,o+l/2),i.lineTo(r+a/4,o),i.closePath(),i instanceof Path2D)return i}function $h(e,t){var i=t||new Path2D,n=e.calculative.worldRect,r=n.x,o=n.y,a=n.width,l=n.height;if(i.moveTo(r,o+l/2),i.lineTo(r+l/2,o),i.lineTo(r+l/2,o+l/3),i.lineTo(r+a,o+l/3),i.lineTo(r+a,o+l*2/3),i.lineTo(r+l/2,o+l*2/3),i.lineTo(r+l/2,o+l*2/3),i.lineTo(r+l/2,o+l),i.closePath(),i instanceof Path2D)return i}function Yh(e,t){var i=t||new Path2D,n=e.calculative.worldRect,r=n.x,o=n.y,a=n.width,l=n.height;if(i.moveTo(r,o+l/3),i.lineTo(r+(a-l/2),o+l/3),i.lineTo(r+(a-l/2),o),i.lineTo(r+a,o+l/2),i.lineTo(r+(a-l/2),o+l),i.lineTo(r+(a-l/2),o+l*2/3),i.lineTo(r,o+l*2/3),i.closePath(),i instanceof Path2D)return i}function Xh(e,t){var i=t||new Path2D,n=e.calculative.worldRect,r=n.x,o=n.y,a=n.width,l=n.height;if(i.moveTo(r,o+l/2),i.lineTo(r+l/2,o),i.lineTo(r+l/2,o+l/3),i.lineTo(r+(a-l/2),o+l/3),i.lineTo(r+(a-l/2),o),i.lineTo(r+a,o+l/2),i.lineTo(r+(a-l/2),o+l),i.lineTo(r+(a-l/2),o+l*2/3),i.lineTo(r+l/2,o+l*2/3),i.lineTo(r+l/2,o+l),i.closePath(),i instanceof Path2D)return i}function Qh(e,t){var i=t||new Path2D,n=e.calculative.worldRect,r=n.x,o=n.y,a=n.width,l=n.height,u=n.ey;if(i.moveTo(r,o),i.lineTo(r+a,o),i.lineTo(r+a,o+l*3/4),i.lineTo(r+a*8/16,o+l*3/4),i.lineTo(r+a/4,u),i.lineTo(r+a*5/16,o+l*3/4),i.lineTo(r,o+l*3/4),i.closePath(),i instanceof Path2D)return i}function Gh(e,t){var i=t||new Path2D,n=e.calculative.worldRect,r=n.x,o=n.y,a=n.width,l=n.height;if(i.moveTo(r+a/5,o+l*13/16),i.bezierCurveTo(r-a/15,o+l*13/16,r-a/15,o+l*7/16,r+a/5,o+l*7/16),i.bezierCurveTo(r+a/5,o,r+a*4/5,o,r+a*4/5,o+l*7/16),i.bezierCurveTo(r+a*16/15,o+l*7/16,r+a*16/15,o+l*13/16,r+a*4/5,o+l*13/16),i.closePath(),i instanceof Path2D)return i}function Jh(e,t){var i=t||new Path2D,n=e.calculative.worldRect,r=n.x,o=n.y,a=n.width,l=n.ex,u=n.ey,s=a/6;if(i.moveTo(r,o),i.lineTo(l-s,o),i.lineTo(l,o+s),i.lineTo(l,u),i.lineTo(r,u),i.closePath(),i.moveTo(l-s,o),i.lineTo(l-s,o+s),i.lineTo(l,o+s),i.closePath(),i instanceof Path2D)return i}function Zh(e,t){var i=t.calculative.worldRect,n=i.x,r=i.y,o=i.width,a=i.ex,l=i.ey,u=o*.25,s=t.z;s>1?u=s:s>0&&(u=o*s);var c={x:n,y:r+u},h={x:a-u,y:r+u},f={x:a-u,y:l},d={x:n,y:l};Qi(e,[c,h,f,d],t.backgroundFront||t.background,t.color),Qi(e,[c,{x:n+u,y:r},{x:a,y:r},h],t.backgroundUp||t.background,t.color),Qi(e,[h,{x:a,y:r},{x:a,y:l-u},f],t.backgroundRight||t.background,t.color)}function Qi(e,t,i,n){i===void 0&&(i=""),n===void 0&&(n=""),e.save(),i&&(e.fillStyle=i),n&&(e.strokeStyle=n),e.beginPath();for(var r=0;r<t.length;++r)r?e.lineTo(t[r].x,t[r].y):e.moveTo(t[r].x,t[r].y);e.closePath(),i&&e.fill(),e.stroke(),e.restore()}function ef(e,t){var i=t||new Path2D,n=e.calculative.worldRect,r=n.x,o=n.y,a=n.width,l=n.ex,u=n.ey,s=a/4,c=r+a/2;if(i.arc(c,o+s,s,0,Math.PI*2),i.moveTo(r,o+s*3),i.lineTo(l,o+s*3),i.moveTo(c,o+s*2),i.lineTo(c,o+s*4),i.moveTo(c,o+s*4),i.lineTo(r,u),i.moveTo(c,o+s*4),i.lineTo(l,u),i.closePath(),i instanceof Path2D)return i}var _n=globalThis&&globalThis.__assign||function(){return _n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},_n.apply(this,arguments)};function tf(e,t,i){if(t.calculative.worldAnchors||(t.calculative.worldAnchors=[]),i)t.calculative.activeAnchor&&(t.calculative.activeAnchor.next={penId:t.id,x:i.x,y:i.y},Li(t.calculative.activeAnchor.next,t.calculative.activeAnchor)<5?t.calculative.activeAnchor.next=void 0:(t.calculative.activeAnchor.prev=_n({},t.calculative.activeAnchor.next),Re(t.calculative.activeAnchor.prev,180,t.calculative.activeAnchor)));else{var n=t.calculative.worldAnchors[0];if(!n.next){var r=ar(n,e.pens[n.connectTo]);Wo(n,r,50),n.prev=void 0}var o=t.calculative.worldAnchors[t.calculative.worldAnchors.length-1];if(o&&o!==n&&!o.prev){var a=ar(o,e.pens[o.connectTo]);Wo(o,a,-50),o.next=void 0}}}function Wo(e,t,i){switch(t){case fe.Up:e.prev={penId:e.penId,x:e.x,y:e.y+i},e.next={penId:e.penId,x:e.x,y:e.y-i};break;case fe.Right:e.prev={penId:e.penId,x:e.x-i,y:e.y},e.next={penId:e.penId,x:e.x+i,y:e.y};break;case fe.Bottom:e.prev={penId:e.penId,x:e.x,y:e.y-i},e.next={penId:e.penId,x:e.x,y:e.y+i};break;case fe.Left:e.prev={penId:e.penId,x:e.x+i,y:e.y},e.next={penId:e.penId,x:e.x-i,y:e.y};break}}function kn(e,t,i,n){var r=1-e,o=r*r*t.x+2*r*e*i.x+e*e*n.x,a=r*r*t.y+2*r*e*i.y+e*e*n.y;return{x:o,y:a,step:e}}function _s(e,t,i,n,r){var o=t.x,a=t.y,l=r.x,u=r.y,s=i.x,c=i.y,h=n.x,f=n.y,d=1-e,v=o*d*d*d+3*s*e*d*d+3*h*e*e*d+l*e*e*e,g=a*d*d*d+3*c*e*d*d+3*f*e*e*d+u*e*e*e;return{x:v,y:g,step:e}}function At(e,t,i){return{x:e.x+i*(t.x-e.x),y:e.y+i*(t.y-e.y)}}function rf(e,t,i){var n=e.calculative.worldAnchors[i],r=e.calculative.worldAnchors[i+1],o=t.step,a;if(n.next&&r.prev){var l=n,u=n.next,s=r.prev,c=r,h=At(l,u,o),f=At(u,s,o),d=At(s,c,o),v=At(h,f,o),g=At(f,d,o);a=At(v,g,o),v.penId=e.id,a.prev=v,g.penId=e.id,a.next=g,n.next.x=h.x,n.next.y=h.y,r.prev.x=d.x,r.prev.y=d.y}else if(n.next||r.prev){var l=n,u=n.next||r.prev,s=r,c=At(l,u,o),h=At(u,s,o);a=t,c.penId=e.id,h.penId=e.id,a.prev=c,a.next=h,n.next=void 0,r.prev=void 0}else a=t;return a.penId=e.id,a.id=be(),a.prevNextType=qt.Bilateral,a}function nf(e,t,i){if(t.calculative.worldAnchors||(t.calculative.worldAnchors=[]),!(t.calculative.worldAnchors.length<2)){var n=t.calculative.activeAnchor,r=i||Ae(t);if(!(!n||!r)){var o=20,a=e.pens[n.connectTo],l=ar(n,a);switch(l===fe.None&&(r.x>n.x?l=fe.Right:l=fe.Left),n.next={id:be(),penId:t.id,x:n.x,y:n.y,prevNextType:2},r.prev={id:be(),penId:t.id,x:r.x,y:r.y,prevNextType:2},l){case fe.Up:n.next.y-=o,r.prev.y=n.y;break;case fe.Bottom:n.next.y+=o,r.prev.y=n.y;break;case fe.Left:n.next.x-=o,r.prev.x=n.x;break;default:n.next.x+=o,r.prev.x=n.x;break}}}}var Vo=globalThis&&globalThis.__read||function(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var n=i.call(e),r,o=[],a;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(a)throw a.error}}return o},Ko=globalThis&&globalThis.__spreadArray||function(e,t,i){if(i||arguments.length===2)for(var n=0,r=t.length,o;n<r;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},ks=globalThis&&globalThis.__values||function(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function of(e,t){var i=t||new Path2D,n=e.calculative.worldAnchors;if(n.length>1){var r;n.forEach(function(o){r?$o(i,r,o):o.start=!0,r=o}),e.close&&$o(i,r,n[0])}if(i instanceof Path2D)return i}function af(e,t,i){if(t.calculative.worldAnchors||(t.calculative.worldAnchors=[]),!(t.calculative.worldAnchors.length<2)){var n=t.calculative.activeAnchor,r=Ae(t);!n||!r||!r.id||n===r||(n.next=void 0,Xn(t),r.prev=void 0,t.calculative.worldAnchors.push(r))}}function $o(e,t,i){!i||i.isTemp||(t.start&&e.moveTo(t.x,t.y),t.next?i.prev?e.bezierCurveTo(t.next.x,t.next.y,i.prev.x,i.prev.y,i.x,i.y):e.quadraticCurveTo(t.next.x,t.next.y,i.x,i.y):i.prev?e.quadraticCurveTo(i.prev.x,i.prev.y,i.x,i.y):e.lineTo(i.x,i.y))}function Yo(e){return Tn(e),Hr(sf(e))}function sf(e){var t=[],i;return e.calculative.worldAnchors.forEach(function(n){t.push(n),i&&t.push.apply(t,Ko([],Vo(Xo(i,n,e)),!1)),i=n}),e.close&&e.calculative.worldAnchors.length>1&&t.push.apply(t,Ko([],Vo(Xo(i,e.calculative.worldAnchors[0],e)),!1)),t}function xi(e){return e!=null&&e.lineWidth?e.lineWidth/2+4:4}function Xo(e,t,i){var n=[];if(!t)return n;var r=.02;if(e.lineLength){var o=xi(i);r=o/e.lineLength}if(e.next)if(t.prev)for(var a=r;a<1;a+=r)n.push(_s(a,e,e.next,t.prev,t));else for(var a=r;a<1;a+=r)n.push(kn(a,e,e.next,t));else if(t.prev)for(var a=r;a<1;a+=r)n.push(kn(a,e,t.prev,t));else n.push({x:t.x,y:t.y});return n.length>1&&(e.curvePoints=n),n}function lf(e,t){var i,n,r=xi(t),o=0,a,l;try{for(var u=ks(t.calculative.worldAnchors),s=u.next();!s.done;s=u.next()){var c=s.value;if(a){if(l=Qo(e,a,c,r),l)return{i:o,point:l};++o}a=c}}catch(h){i={error:h}}finally{try{s&&!s.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}if(t.close&&t.calculative.worldAnchors.length>1&&(l=Qo(e,a,t.calculative.worldAnchors[0],r)))return{i:o,point:l}}function Qo(e,t,i,n){var r,o;if(n===void 0&&(n=4),!t.next&&!i.prev){var a=t.x,l=t.y,u=i.x,s=i.y,c=Math.min(a,u),h=Math.max(a,u),f=Math.min(l,s),d=Math.max(l,s);return e.x>=c-n&&e.x<=h+n&&e.y>=f-n&&e.y<=d+n?cf(e,t,i,n):void 0}else if(t.curvePoints)try{for(var v=ks(t.curvePoints),g=v.next();!g.done;g=v.next()){var p=g.value;if(Qt(e,p,n))return p}}catch(b){r={error:b}}finally{try{g&&!g.done&&(o=v.return)&&o.call(v)}finally{if(r)throw r.error}}}function cf(e,t,i,n){if(n===void 0&&(n=4),t.x===i.x){var r=Math.abs(e.x-t.x);if(r<=n)return{x:t.x,y:e.y}}else{var o=(t.y-i.y)/(t.x-i.x),a=t.y-o*t.x,r=Math.abs((o*e.x+a-e.y)/Math.sqrt(o*o+1));if(r<=n){var l=e.x+o*e.y,u=(l-o*a)/(o*o+1);return{x:u,y:o*u+a}}}}function Go(e,t,i,n){if(!t&&!i)return Math.sqrt(Math.pow(Math.abs(e.x-n.x),2)+Math.pow(Math.abs(e.y-n.y),2))||0;var r=document.createElementNS("http://www.w3.org/2000/svg","path");return t&&i?r.setAttribute("d","M"+e.x+" "+e.y+" C"+t.x+" "+t.y+" "+i.x+" "+i.y+" "+n.x+" "+n.y):t?r.setAttribute("d","M"+e.x+" "+e.y+" Q"+t.x+" "+t.y+" "+n.x+" "+n.y):r.setAttribute("d","M"+e.x+" "+e.y+" Q"+i.x+" "+i.y+" "+n.x+" "+n.y),r.getTotalLength()||0}function Tn(e){if(e.calculative.worldAnchors.length<2)return 0;var t=0,i;if(e.calculative.worldAnchors.forEach(function(r){i&&(i.lineLength=Go(i,i.next,r.prev,r),t+=i.lineLength),i=r}),e.close){var n=Oe(e);i.lineLength=Go(i,i.next,n.prev,n),t+=i.lineLength}return e.length=t,t}function uf(e,t){for(var i=e.calculative.worldAnchors,n=0;n<i.length-1;n++){var r=i[n],o=i[n+1];if(!r.next&&!o.prev){if(Ts(r,o,t))return!0}else if(hf(r,o,t))return!0}return!1}function Ts(e,t,i){if(Wt(e,i)||Wt(t,i))return!0;var n=e.x,r=e.y,o=t.x,a=t.y,l=i.x,u=i.y,s=i.ex,c=i.ey,h=r-a,f=o-n,d=n*a-o*r;if(h*l+f*u+d>=0&&h*s+f*c+d<=0||h*l+f*u+d<=0&&h*s+f*c+d>=0||h*l+f*c+d>=0&&h*s+f*u+d<=0||h*l+f*c+d<=0&&h*s+f*u+d>=0){if(l>s){var v=l;l=s,s=v}if(u<c){var g=u;u=c,c=g}return!(n<l&&o<l||n>s&&o>s||r>u&&a>u||r<c&&a<c)}else return!1}function hf(e,t,i){var n=.02;if(!e.next&&!t.prev)return Ts(e,t,i);if(e.next&&t.prev)for(var r=n;r<1;r+=n){var o=_s(r,e,e.next,t.prev,t);if(Wt(o,i))return!0}else if(e.next||t.prev)for(var r=n;r<1;r+=n){var o=kn(r,e,e.next||t.prev,t);if(Wt(o,i))return!0}return!1}var pr=globalThis&&globalThis.__read||function(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var n=i.call(e),r,o=[],a;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(a)throw a.error}}return o},yr=globalThis&&globalThis.__spreadArray||function(e,t,i){if(i||arguments.length===2)for(var n=0,r=t.length,o;n<r;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},Je=30;function ff(e,t,i){var n;if(t.calculative.worldAnchors||(t.calculative.worldAnchors=[]),!(t.calculative.worldAnchors.length<2)){var r=Oe(t),o=Ae(t);if(!(!r||!o)){var a;((n=t.anchors)===null||n===void 0?void 0:n.length)&&r===t.calculative.activeAnchor?(a=!0,r=o,o=Oe(t)):(!t.anchors||!t.anchors.length)&&r!==t.calculative.activeAnchor&&(r=t.calculative.activeAnchor),r.next=void 0,o.prev=void 0,Xn(t);var l=[],u=e.pens[r.connectTo],s=e.pens[o.connectTo],c=ar(r,u),h=ar(o,s),f=Jo(r,c,Je);f&&(r=f,l.push(f)),f=Jo(o,h,Je);var d=o;switch(f&&(o=f),c){case fe.Up:l.push.apply(l,yr([],pr(df(r,o,h)),!1));break;case fe.Right:l.push.apply(l,yr([],pr(vf(r,o,h)),!1));break;case fe.Bottom:l.push.apply(l,yr([],pr(pf(r,o,h)),!1));break;case fe.Left:l.push.apply(l,yr([],pr(yf(r,o,h)),!1));break;default:l.push.apply(l,yr([],pr(gf(t,r,o)),!1));break}l.forEach(function(v){v.id=be(),v.penId=t.id,t.calculative.worldAnchors.push(v)}),t.calculative.worldAnchors.push(o),f&&t.calculative.worldAnchors.push(d),a&&t.calculative.worldAnchors.reverse()}}}function Jo(e,t,i){var n={x:e.x,y:e.y,id:be()};switch(t){case fe.Up:n.y-=i;break;case fe.Right:n.x+=i;break;case fe.Bottom:n.y+=i;break;case fe.Left:n.x-=i;break;default:return}return n}function df(e,t,i){if(e.x===t.x||e.y===t.y)return[];var n=[],r,o;switch(i){case fe.Up:e.y<t.y?(r=t.x,o=e.y):(r=e.x,o=t.y),n.push({x:r,y:o});break;case fe.Bottom:if(r=t.x,o=e.y,t.y>e.y)r=e.x+(t.x-e.x)/2,n.push({x:r,y:e.y},{x:r,y:t.y});else{var a=(e.y+t.y)/2;n.push({x:e.x,y:a},{x:t.x,y:a})}break;case fe.Right:r=t.x,o=e.y,t.x<e.x&&t.y<e.y&&(r=e.x,o=t.y),n.push({x:r,y:o});break;case fe.Left:r=t.x,o=e.y,t.x>e.x&&t.y<e.y&&(r=e.x,o=t.y),n.push({x:r,y:o});break;default:if(t.y>e.y-Je)r=e.x+(t.x-e.x)/2,n.push({x:r,y:e.y},{x:r,y:t.y});else{var a=(e.y+t.y+Je)/2;n.push({x:e.x,y:a},{x:t.x,y:a})}break}return n}function vf(e,t,i){if(e.x===t.x||e.y===t.y)return[];var n=[],r,o;switch(i){case fe.Up:r=e.x,o=t.y,t.x>e.x&&t.y>e.y&&(r=t.x,o=e.y),n.push({x:r,y:o});break;case fe.Bottom:r=e.x,o=t.y,t.x>e.x&&t.y<e.y&&(r=t.x,o=e.y),n.push({x:r,y:o});break;case fe.Left:if(r=t.x,o=e.y,t.x<e.x)o=e.y+(t.y-e.y)/2,n.push({x:e.x,y:o},{x:t.x,y:o});else{var a=(e.x+t.x)/2;n.push({x:a,y:o},{x:a,y:t.y})}break;case fe.Right:t.x<e.x?n.push({x:e.x,y:t.y}):n.push({x:t.x,y:e.y});break;default:if(r=t.x,o=t.y,t.x<e.x+Je)n.push({x:e.x,y:o});else{var a=(e.x+t.x-Je)/2;n.push({x:a,y:e.y},{x:a,y:o})}break}return n}function pf(e,t,i){if(e.x===t.x||e.y===t.y)return[];var n=[],r,o;switch(i){case fe.Up:if(r=e.x,o=t.y,t.y<e.y)r=e.x+(t.x-e.x)/2,n.push({x:r,y:e.y},{x:r,y:t.y});else{var a=(e.y+t.y)/2;n.push({x:r,y:a},{x:t.x,y:a})}break;case fe.Right:r=t.x,o=e.y,t.x<e.x&&t.y>e.y&&(r=e.x,o=t.y),n.push({x:r,y:o});break;case fe.Bottom:e.y>t.y?(r=t.x,o=e.y):(r=e.x,o=t.y),n.push({x:r,y:o});break;case fe.Left:r=t.x,o=e.y,t.x>e.x&&t.y>e.y&&(r=e.x,o=t.y),n.push({x:r,y:o});break;default:if(r=e.x,t.y<e.y+Je)r=e.x+(t.x-e.x)/2,n.push({x:r,y:e.y},{x:r,y:t.y});else{var a=(e.y+t.y-Je)/2;n.push({x:r,y:a},{x:t.x,y:a})}break}return n}function yf(e,t,i){if(e.x===t.x||e.y===t.y)return[];var n=[],r,o;switch(i){case fe.Up:r=e.x,o=t.y,t.x<e.x&&t.y>e.y&&(r=t.x,o=e.y),n.push({x:r,y:o});break;case fe.Bottom:r=e.x,o=t.y,t.x<e.x&&t.y<e.y&&(r=t.x,o=e.y),n.push({x:r,y:o});break;case fe.Right:if(r=e.x,o=t.y,t.x>e.x)r=t.x,o=e.y+(t.y-e.y)/2,n.push({x:e.x,y:o},{x:t.x,y:o});else{var a=(e.x+t.x)/2;n.push({x:a,y:e.y},{x:a,y:t.y})}break;case fe.Left:t.x>e.x?n.push({x:e.x,y:t.y}):n.push({x:t.x,y:e.y});break;default:if(r=e.x,o=t.y,t.x<e.x-Je){var a=(e.x+t.x+Je)/2;n.push({x:a,y:e.y},{x:a,y:o})}else n.push({x:e.x,y:o});break}return n}function gf(e,t,i){var n=[];return e.calculative.drawlineH==null&&(e.calculative.drawlineH=Math.abs(i.x-t.x)>Math.abs(i.y-t.y)),e.calculative.worldAnchors.length&&(i.isTemp=void 0,e.calculative.drawlineH?(n.push({x:i.x,y:t.y}),Math.abs(i.y-t.y)<Je&&(i.isTemp=!0)):(n.push({x:t.x,y:i.y}),Math.abs(i.x-t.x)<Je&&(i.isTemp=!0))),n}var Nt=globalThis&&globalThis.__assign||function(){return Nt=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},Nt.apply(this,arguments)},Zo=globalThis&&globalThis.__read||function(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var n=i.call(e),r,o=[],a;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(a)throw a.error}}return o},ea=globalThis&&globalThis.__spreadArray||function(e,t,i){if(i||arguments.length===2)for(var n=0,r=t.length,o;n<r;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};function An(e,t,i,n){var r=[],o,a,l,u,s,c,h,f,d,v,g,p,b,x;d=e[i],v=e[n],l=d.x,u=d.y,h=v.x-l,f=v.y-u,x=h*h+f*f,o=t;for(var m=i+1;m<n;m++)g=e[m],h!==0||f!==0?(p=((g.x-l)*h+(g.y-u)*f)/x,p>1?(s=g.x-v.x,c=g.y-v.y):p>0?(s=g.x-(l+h*p),c=g.y-(u+f*p)):(s=g.x-l,c=g.y-u)):(s=g.x-l,c=g.y-u),b=s*s+c*c,b>o&&(a=m,o=b);return o>t&&(a-i>1&&r.push.apply(r,ea([],Zo(An(e,t,i,a)),!1)),r.push({id:e[a].id,penId:e[a].penId,x:e[a].x,y:e[a].y}),n-a>1&&r.push.apply(r,ea([],Zo(An(e,t,a,n)),!1))),r}function mf(e,t,i){if(t===void 0&&(t=.8),i===void 0&&(i=!1),e.length<3)return e;var n,r,o,a,l,u,s,c,h,f,d,v,g,p,b,x=function(P,R,L,I){return a=Math.sqrt(P*P+R*R),a>0?(v=P/a,p=R/a):(v=1,p=0),l=Math.sqrt(L*L+I*I),l>0?(g=L/l,b=I/l):(g=1,b=0),Math.acos(v*g+p*b)};f=[],d=e.length,n=e[0],e[d-1],f.push(Nt({},e[0]));for(var m=0;m<d-1;m++){if(r=e[m],o=e[m+1],h=Math.abs(x(r.x-n.x,r.y-n.y,o.x-r.x,o.y-r.y)),a)if(h<t*3.14)if(i&&(a=Math.min(a,l),l=a),u=(v+g)/2,s=(p+b)/2,c=Math.sqrt(u*u+s*s),c===0)f.push(Nt({},r));else{u/=c,s/=c;var _=Nt({},r);_.prevNextType=qt.Bilateral,_.prev={penId:_.penId,x:r.x-u*a*.25,y:r.y-s*a*.25},_.next={penId:_.penId,x:r.x+u*l*.25,y:r.y+s*l*.25},f.push(_)}else f.push(Nt({},r));n=r}return f.push(Nt({},e[e.length-1])),f}var ze={};function wf(e){var t;if(e.onDestroy||(e.onDestroy=bf,e.onMove=Xr,e.onResize=Xr,e.onRotate=Xr,e.onValue=Xr,e.onChangeId=xf),ze[e.id])ze[e.id].getAttribute("src")!==e.iframe&&(ze[e.id].src=e.iframe,e.calculative.iframe=e.iframe);else{var i=document.createElement("iframe");i.scrolling="no",i.frameBorder="0",i.src=e.iframe,ze[e.id]=i,e.calculative.iframe=e.iframe,(t=e.calculative.canvas.externalElements)===null||t===void 0||t.appendChild(i),_t(e,i)}return e.calculative.dirty&&_t(e,ze[e.id]),new Path2D}function bf(e){ze[e.id].remove(),ze[e.id]=void 0}function Xr(e){!ze[e.id]||(_t(e,ze[e.id]),ze[e.id].getAttribute("src")!==e.iframe&&(ze[e.id].src=e.iframe))}function xf(e,t,i){!ze[t]||(ze[i]=ze[t],delete ze[t])}var Ye={};function _f(e){var t;if(e.onDestroy||(e.onDestroy=kf,e.onMove=Gi,e.onResize=Gi,e.onRotate=Gi,e.onClick=Tf,e.onValue=Sf,e.onChangeId=Af),Ye[e.id])e.video&&e.calculative.media&&e.video!==e.calculative.video?(console.warn("video \u66F4\u6539, \u6B64\u5904\u662F\u5426\u6267\u884C\uFF1F"),e.calculative.media.src=e.video,e.autoPlay&&(e.calculative.media.muted=!0,e.calculative.media.autoplay=!0),e.calculative.media.loop=e.playLoop,e.calculative.video=e.video):e.audio&&e.calculative.media&&e.audio!==e.calculative.audio&&(e.calculative.media.src=e.audio,e.autoPlay&&(e.calculative.media.muted=!0,e.calculative.media.autoplay=!0),e.calculative.media.loop=e.playLoop,e.calculative.audio=e.audio);else{var i=document.createElement("div"),n=document.createElement("div");n.style.position="absolute",n.style.outline="none",n.style.left="0",n.style.bottom="0",n.style.width="0",n.style.height="2px",n.style.background="#52c41a",n.style.zIndex="1",i.appendChild(n);var r;e.video?(r=document.createElement("video"),r.src=e.video):e.audio&&(r=document.createElement("audio"),r.src=e.audio),r.loop=e.playLoop,r.ontimeupdate=function(){As(n,r,e.calculative.worldRect.width)},r.onended=function(){e.calculative.onended&&e.calculative.onended(e)},e.calculative.media=r,r.style.position="absolute",r.style.outline="none",r.style.left="0",r.style.top="0",r.style.width="100%",r.style.height="100%",i.appendChild(r),Ye[e.id]=i,(t=e.calculative.canvas.externalElements)===null||t===void 0||t.appendChild(i),_t(e,i),e.autoPlay&&(r.autoplay=!0,r.muted=!0)}return e.calculative.dirty&&_t(e,Ye[e.id]),new Path2D}function kf(e){Ye[e.id].remove(),Ye[e.id]=void 0}function Gi(e){_t(e,Ye[e.id]);var t=Ye[e.id].children[0],i=Ye[e.id].children[1];As(t,i,e.calculative.worldRect.width)}function Tf(e){e.calculative.media&&(e.calculative.media.muted=!1,e.calculative.media.paused?e.calculative.media.play():e.calculative.media.pause())}function As(e,t,i){e.style.width=t.currentTime/t.duration*i+"px"}function Af(e,t,i){!Ye[t]||(Ye[i]=Ye[t],delete Ye[t])}function Sf(e){var t=Ye[e.id];if(!!t){_t(e,t);var i=e.calculative.media.getAttribute("src");e.video?i!==e.video&&(e.calculative.media.src=e.video):e.audio&&i!==e.audio&&(e.calculative.media.src=e.audio),e.autoPlay&&(e.calculative.media.muted=!0,e.calculative.media.autoplay=!0),e.calculative.media.loop=e.playLoop}}var Me={};function Ef(e){e.onDestroy||(e.onDestroy=Cf,e.onMove=ta,e.onResize=Pf,e.onRotate=ta,e.onValue=Rf,e.onChangeId=If);var t=new Path2D;if(!!e.image){if(!Me[e.id]){var i=new Image;i.crossOrigin="anonymous",i.src=e.image,Me[e.id]=i,i.onload=function(){var n;e.calculative.img=i,e.calculative.imgNaturalWidth=i.naturalWidth||e.iconWidth,e.calculative.imgNaturalHeight=i.naturalHeight||e.iconHeight,(n=e.calculative.canvas.externalElements)===null||n===void 0||n.appendChild(i),Ur(e,i)}}return e.calculative.dirty&&Me[e.id]&&Ur(e,Me[e.id]),t}}function Cf(e){Me[e.id].remove(),Me[e.id]=void 0}function ta(e){!Me[e.id]||Ur(e,Me[e.id])}function Pf(e){!Me[e.id]||Ur(e,Me[e.id])}function Rf(e){!Me[e.id]||(Ur(e,Me[e.id]),Me[e.id].getAttribute("src")!==e.image&&(Me[e.id].src=e.image))}function If(e,t,i){!Me[t]||(Me[i]=Me[t],delete Me[t])}function Ur(e,t){t.style.objectFit=e.imageRatio?"contain":"fill",_t(e,t)}var Lf=globalThis&&globalThis.__read||function(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var n=i.call(e),r,o=[],a;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(a)throw a.error}}return o},Mf=globalThis&&globalThis.__spreadArray||function(e,t,i){if(i||arguments.length===2)for(var n=0,r=t.length,o;n<r;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};function Of(e,t){return e.onResize||(e.onResize=Ss,e.onValue=Bf),Vn(e,t)}function Ss(e){var t,i=e.anchors.filter(function(n){return n.flag!==1});Es(e),e.anchors=(t=e.anchors).concat.apply(t,Mf([],Lf(i),!1))}function Bf(e){Ss(e),mi(e)}function Es(e){for(var t=[],i=e.x,n=e.y,r=e.width,o=e.height,a=Df(e),l=5,u=0;u<l;u++)if(u!==2){var s=i+r*(u+1)/(l+1),c=n;s<i+a?c=Gr(i+a,c+a,s,a,-1):s>i+r-a&&(c=Gr(i+r-a,c+a,s,a,-1)),t.push({id:String(t.length),flag:1,penId:e.id,x:(s-i)/r,y:(c-n)/o})}for(var h=3,u=0;u<h;u++){var c=n+o*(u+1)/(h+1),s=i+r;c<n+a?s=Qr(s-a,n+a,c,a):c>n+o-a&&(s=Qr(s-a,n+o-a,c,a)),t.push({id:String(t.length),flag:1,penId:e.id,x:(s-i)/r,y:(c-n)/o})}for(var f=5,u=0;u<f;u++)if(u!==2){var s=i+r*(u+1)/(f+1),c=n+o;s<i+a?c=Gr(i+a,c-a,s,a):s>i+r-a&&(c=Gr(i+r-a,c-a,s,a)),t.push({id:String(t.length),flag:1,penId:e.id,x:(s-i)/r,y:(c-n)/o})}for(var d=3,u=0;u<d;u++){var c=n+o*(u+1)/(d+1),s=i;c<n+a?s=Qr(s+a,n+a,c,a,-1):c>n+o-a&&(s=Qr(s+a,n+o-a,c,a,-1)),t.push({id:String(t.length),flag:1,penId:e.id,x:(s-i)/r,y:(c-n)/o})}e.anchors=t}function Df(e){var t=e.calculative.borderRadius||0,i=e.calculative.borderRadius||0,n=e.width,r=e.height;e.calculative.borderRadius<1&&(t=n*e.calculative.borderRadius,i=r*e.calculative.borderRadius);var o=t<i?t:i;return n<2*o&&(o=n/2),r<2*o&&(o=r/2),o}function Qr(e,t,i,n,r){return r===void 0&&(r=1),r*Math.sqrt(Math.pow(n,2)-Math.pow(i-t,2))+e}function Gr(e,t,i,n,r){return r===void 0&&(r=1),r*Math.sqrt(Math.pow(n,2)-Math.pow(i-e,2))+t}function Nf(e,t){var i=t||new Path2D,n=e.calculative.worldRect,r=n.x,o=n.y,a=n.width,l=n.height;if(i.moveTo(r,o+l),i.lineTo(r+a,o+l),i.closePath(),i instanceof Path2D)return i}function jf(e){var t=[{x:0,y:1},{x:1,y:1}];e.anchors=t.map(function(i,n){var r=i.x,o=i.y;return{id:n+"",x:r,y:o,penId:e.id}})}function Ff(){return{rectangle:Vn,square:nu,circle:ou,svgPath:Dh,diamond:Nh,triangle:jh,pentagon:zh,pentagram:Wh,hexagon:Kh,leftArrow:$h,rightArrow:Yh,twowayArrow:Xh,message:Qh,cloud:Gh,file:Jh,people:ef,line:of,iframe:wf,video:_f,gif:Ef,mindNode:Of,mindLine:Nf}}function zf(){return{triangle:Fh,pentagon:Uh,pentagram:xs,mindNode:Es,mindLine:jf}}function rr(){try{var e=new OffscreenCanvas(0,0),t=e.getContext("2d");return t&&t.arc?e:document.createElement("canvas")}catch{return document.createElement("canvas")}}var Uf=function(){function e(t,i){var n=this;this.parentElement=t,this.store=i,this.box=document.createElement("div"),this.text=document.createElement("div"),this.arrowUp=document.createElement("div"),this.arrowDown=document.createElement("div"),this.box.className="topology-tooltip",this.text.className="text",this.arrowUp.className="arrow",this.arrowDown.className="arrow down",this.box.appendChild(this.text),this.box.appendChild(this.arrowUp),this.box.appendChild(this.arrowDown),t.appendChild(this.box),this.box.onmouseleave=function(){n.hide(),n.store.lastHover=void 0};for(var r,o=0;o<document.styleSheets.length;o++)document.styleSheets[o].title==="le5le.com/tooltip"&&(r=document.styleSheets[o]);if(!r){var a=document.createElement("style");a.type="text/css",a.title="le5le.com/tooltip",document.head.appendChild(a),a=document.createElement("style"),a.type="text/css",document.head.appendChild(a),r=a.sheet,r.insertRule(".topology-tooltip{position:absolute;padding:8px 0;z-index:10;left: -9999px;top: -9999px;}"),r.insertRule(".topology-tooltip .text{max-width:320px;min-height:30px;max-height:400px;outline:none;padding:8px 16px;border-radius:4px;background:#777777;color:#ffffff;line-height:1.8;overflow-y:auto;}"),r.insertRule(".topology-tooltip .arrow{position:absolute;border:6px solid transparent;background:transparent;top:-4px;left:50%;transform:translateX(-50%)}"),r.insertRule(".topology-tooltip .arrow.down{top:initial;bottom: 1.5px;}")}}return e.getTitle=function(t){if(t.titleFnJs&&!t.titleFn)try{t.titleFn=new Function("pen",t.titleFnJs)}catch(i){console.log("titleFnJs",i)}return t.titleFn?t.titleFn(t):String(t.title)},e.prototype.setText=function(t){var i=this.box.getBoundingClientRect(),n;window?n=window.marked:global&&(n=global.marked);var r=e.getTitle(t);if(n){this.text.innerHTML=n(r);for(var o=this.text.getElementsByTagName("A"),a=0;a<o.length;++a)o[a].setAttribute("target","_blank")}else this.text.innerHTML=r;return i},e.prototype.updateText=function(t){var i;if(((i=this.currentPen)===null||i===void 0?void 0:i.id)===t.id&&!e.titleEmpty(t)){var n=this.setText(t),r=this.box.getBoundingClientRect();this.changePositionByText(n,r)}},e.prototype.changePositionByText=function(t,i){this.x-=(i.width-t.width)/2,this.y-=i.height-t.height,this.box.style.left=this.x+"px",this.box.style.top=this.y+"px"},e.titleEmpty=function(t){return!t.title&&!t.titleFn&&!t.titleFnJs},e.prototype.show=function(t,i){if(this.currentPen=t,!e.titleEmpty(t)){this.setText(t);var n=this.box.getBoundingClientRect(),r=t.calculative.worldRect,o=i.x-n.width/2,a=i.y-n.height;t.type||(o=t.calculative.canvas.store.data.x+r.x-(n.width-r.width)/2,a=t.calculative.canvas.store.data.y+r.ey-n.height-r.height),a>0?(this.arrowUp.style.borderBottomColor="transparent",this.arrowDown.style.borderTopColor="#777777"):(a+=n.height+r.height+5,this.arrowUp.style.borderBottomColor="#777777",this.arrowDown.style.borderTopColor="transparent"),this.x=o,this.y=a,this.box.style.left=this.x+"px",this.box.style.top=this.y+"px"}},e.prototype.hide=function(){this.currentPen=null,this.x=-9999,this.box.style.left="-9999px"},e.prototype.translate=function(t,i){this.x<-1e3||(this.x+=t,this.y+=i,this.box.style.left=this.x+"px",this.box.style.top=this.y+"px")},e.prototype.destroy=function(){this.box.onmouseleave=null},e}(),Hf=function(){function e(t){var i=this;this.parent=t,this.onMouseDownH=function(a){a.preventDefault(),a.stopPropagation(),i.isDownH=a.x,i.x=i.parent.store.data.x||0,i.lastScrollX=i.scrollX},this.onMouseDownV=function(a){a.preventDefault(),a.stopPropagation(),i.isDownV=a.y,i.y=i.parent.store.data.y||0,i.lastScrollY=i.scrollY},this.onMouseMove=function(a){if(i.isDownH){var l=a.x-i.isDownH;i.scrollX=i.lastScrollX+l,i.h.style.left=i.scrollX+"px",i.parent.store.data.x=i.x-l*i.rect.width/i.parent.parentElement.clientWidth}if(i.isDownV){var u=a.y-i.isDownV;i.scrollY=i.lastScrollY+u,i.v.style.top=i.scrollY+"px",i.parent.store.data.y=i.y-u*i.rect.height/i.parent.parentElement.clientHeight}(i.isDownH||i.isDownV)&&(i.parent.onMovePens(),i.parent.canvasImage.init(),i.parent.canvasImageBottom.init(),i.parent.render())},this.onMouseUp=function(a){!i.isDownH&&!i.isDownV||(i.isDownH=void 0,i.isDownV=void 0,i.scrollX<20?(i.scrollX=20,i.h.style.left=i.scrollX+"px"):i.scrollX>i.parent.parentElement.clientWidth-i.hSize-20&&(i.scrollX=i.parent.parentElement.clientWidth-i.hSize-20,i.h.style.left=i.scrollX+"px"),i.scrollY<20?(i.scrollY=20,i.v.style.top=i.scrollY+"px"):i.scrollY>i.parent.parentElement.clientHeight-i.vSize-20&&(i.scrollY=i.parent.parentElement.clientHeight-i.vSize-20,i.v.style.top=i.scrollY+"px"),i.resize())},this.h=document.createElement("div"),this.v=document.createElement("div"),this.parent.externalElements.appendChild(this.h),this.parent.externalElements.appendChild(this.v),this.h.className="topology-scroll h",this.h.onmousedown=this.onMouseDownH,this.v.className="topology-scroll v",this.v.onmousedown=this.onMouseDownV,document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp);for(var n,r=0;r<document.styleSheets.length;r++)document.styleSheets[r].title==="le5le/scroll"&&(n=document.styleSheets[r]);if(!n){var o=document.createElement("style");o.type="text/css",o.title="le5le.com/scroll",document.head.appendChild(o),o=document.createElement("style"),o.type="text/css",document.head.appendChild(o),n=o.sheet,n.insertRule(".topology-scroll{position:absolute;width:8px;height:200px;background:#dddddd;border-radius:10px;z-index:20;cursor:default;}"),n.insertRule(".topology-scroll:hover{background:#cccccc;cursor:pointer}"),n.insertRule(".topology-scroll.v{right:0;top:calc(50% - 100px);}"),n.insertRule(".topology-scroll.h{bottom:2px;left:calc(50% - 100px);width:200px;height:8px;}")}this.init()}return e.prototype.init=function(){this.isShow=!0,this.resize(),this.initPos()},e.prototype.initPos=function(){this.scrollX=(this.parent.parentElement.clientWidth-this.hSize)/2,this.scrollY=(this.parent.parentElement.clientHeight-this.vSize)/2,this.h.style.left=this.scrollX+"px",this.v.style.top=this.scrollY+"px"},e.prototype.resize=function(){this.rect=wt(this.parent.store.data.pens),this.rect.width<1400&&(this.rect.width=1400),this.rect.height<900&&(this.rect.height=900),this.parent.store.data.x>0?this.rect.width+=this.parent.store.data.x+(this.rect.x>0?0:this.rect.x):this.rect.width-=this.parent.store.data.x+(this.rect.x>0?0:this.rect.x),this.parent.store.data.y>0?this.rect.height+=this.parent.store.data.y+(this.rect.y>0?0:this.rect.y):this.rect.height-=this.parent.store.data.y+(this.rect.y>0?0:this.rect.y),this.rect.width<1400&&(this.rect.width=1400),this.rect.height<900&&(this.rect.height=900),this.hSize=1e3*this.parent.parentElement.clientWidth/this.rect.width/3,this.vSize=1e3*this.parent.parentElement.clientHeight/this.rect.height/3,this.h.style.width=this.hSize+"px",this.v.style.height=this.vSize+"px"},e.prototype.show=function(){this.isShow=!0,this.h.style.display="block",this.v.style.display="block",document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)},e.prototype.hide=function(){this.isShow=!1,this.h.style.display="none",this.v.style.display="none",this.destroy()},e.prototype.translate=function(t,i){t&&(this.scrollX-=t*this.parent.parentElement.clientWidth/this.rect.width,this.h.style.left=this.scrollX+"px"),i&&(this.scrollY-=i*this.parent.parentElement.clientHeight/this.rect.height,this.v.style.top=this.scrollY+"px")},e.prototype.wheel=function(t){var i=10;t&&(i=-10),this.scrollY+=i,this.v.style.top=this.scrollY+"px",this.parent.store.data.y-=i*this.rect.height/this.parent.parentElement.clientHeight,this.parent.onMovePens(),this.parent.render()},e.prototype.destroy=function(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)},e}(),Jr=globalThis&&globalThis.__values||function(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ra=function(){function e(t,i,n){this.parentElement=t,this.store=i,this.isBottom=n,this.canvas=document.createElement("canvas"),this.otherOffsreen=rr(),this.offscreen=rr(),this.animateOffsScreen=rr(),t.appendChild(this.canvas),this.canvas.style.backgroundRepeat="no-repeat",this.canvas.style.backgroundSize="100% 100%",this.canvas.style.position="absolute",this.canvas.style.top="0",this.canvas.style.left="0"}return e.prototype.resize=function(t,i){this.canvas.style.width=t+"px",this.canvas.style.height=i+"px",t=t*this.store.dpiRatio|0,i=i*this.store.dpiRatio|0,this.canvas.width=t,this.canvas.height=i,this.otherOffsreen.width=t,this.otherOffsreen.height=i,this.offscreen.width=t,this.offscreen.height=i,this.animateOffsScreen.width=t,this.animateOffsScreen.height=i,this.otherOffsreen.getContext("2d").scale(this.store.dpiRatio,this.store.dpiRatio),this.otherOffsreen.getContext("2d").textBaseline="middle",this.offscreen.getContext("2d").scale(this.store.dpiRatio,this.store.dpiRatio),this.offscreen.getContext("2d").textBaseline="middle",this.animateOffsScreen.getContext("2d").scale(this.store.dpiRatio,this.store.dpiRatio),this.animateOffsScreen.getContext("2d").textBaseline="middle",this.init()},e.prototype.init=function(){var t,i;this.offscreen.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.animateOffsScreen.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height);try{for(var n=Jr(this.store.data.pens),r=n.next();!r.done;r=n.next()){var o=r.value;this.hasImage(o)&&(o.calculative.imageDrawed=!1)}}catch(a){t={error:a}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}this.store.dirtyBackground=!0,this.store.dirtyTop=!0},e.prototype.clear=function(){this.otherOffsreen.getContext("2d").clearRect(0,0,this.otherOffsreen.width,this.otherOffsreen.height),this.offscreen.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.animateOffsScreen.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height)},e.prototype.hasImage=function(t){return t.calculative.hasImage=t.calculative&&t.calculative.inView&&!t.isBottom==!this.isBottom&&t.image&&t.calculative.img&&t.name!=="gif",t.calculative.hasImage},e.prototype.render=function(){var t,i,n,r,o,a,l=!1,u=!1;try{for(var s=Jr(this.store.data.pens),c=s.next();!c.done;c=s.next()){var h=c.value;this.hasImage(h)&&(this.store.animates.has(h)?u=!0:h.calculative.imageDrawed||(l=!0))}}catch(P){t={error:P}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}var f=this.store.dirtyBackground;if(f&&this.isBottom){var d=this.otherOffsreen.getContext("2d");d.clearRect(0,0,this.canvas.width,this.canvas.height);var v=this.store.data.background||this.store.options.background;v&&(d.save(),d.fillStyle=v,d.fillRect(0,0,this.canvas.width,this.canvas.height),d.restore()),this.renderGrid(d)}var g=this.store.dirtyTop;if(g&&!this.isBottom){var d=this.otherOffsreen.getContext("2d");d.clearRect(0,0,this.canvas.width,this.canvas.height),this.renderRule(d)}if(l){var d=this.offscreen.getContext("2d");d.save(),d.translate(this.store.data.x,this.store.data.y);try{for(var p=Jr(this.store.data.pens),b=p.next();!b.done;b=p.next()){var h=b.value;!h.calculative.hasImage||h.calculative.imageDrawed||this.store.animates.has(h)||(h.calculative.imageDrawed=!0,d.save(),gn(d,h),h.calculative.rotate&&gi(d,h),wi(d,h),yn(d,h),d.restore())}}catch(R){n={error:R}}finally{try{b&&!b.done&&(r=p.return)&&r.call(p)}finally{if(n)throw n.error}}d.restore()}if(u){var d=this.animateOffsScreen.getContext("2d");d.save(),d.clearRect(0,0,this.canvas.width,this.canvas.height),d.translate(this.store.data.x,this.store.data.y);try{for(var x=Jr(this.store.animates),m=x.next();!m.done;m=x.next()){var h=m.value;!h.calculative.hasImage||(h.calculative.imageDrawed=!0,d.save(),gn(d,h),h.calculative.rotate&&gi(d,h),wi(d,h),yn(d,h),d.restore())}}catch(R){o={error:R}}finally{try{m&&!m.done&&(a=x.return)&&a.call(x)}finally{if(o)throw o.error}}d.restore()}if(l||u||f&&this.isBottom||g&&!this.isBottom){var _=this.canvas.getContext("2d");_.clearRect(0,0,this.canvas.width,this.canvas.height),this.isBottom&&(_.drawImage(this.otherOffsreen,0,0,this.canvas.width,this.canvas.height),this.store.dirtyBackground=!1),_.drawImage(this.offscreen,0,0,this.canvas.width,this.canvas.height),_.drawImage(this.animateOffsScreen,0,0,this.canvas.width,this.canvas.height),this.isBottom||(_.drawImage(this.otherOffsreen,0,0,this.canvas.width,this.canvas.height),this.store.dirtyTop=!1)}},e.prototype.renderGrid=function(t){var i=this.store,n=i.data,r=i.options,o=n.grid,a=n.gridRotate,l=n.gridColor,u=n.gridSize,s=n.scale;if(!!(o!=null?o:r.grid)){t.save();var c=this.canvas,h=c.width,f=c.height;a&&(t.translate(h/2,f/2),t.rotate(a*Math.PI/180),t.translate(-h/2,-f/2)),t.lineWidth=1,t.strokeStyle=l||r.gridColor,t.beginPath();for(var d=(u||r.gridSize)*s,v=Math.max(h,f),g=Math.ceil(v/d),p=-d*g;p<v*2;p+=d)t.moveTo(p,-v),t.lineTo(p,v*2);for(var p=-d*g;p<v*2;p+=d)t.moveTo(-v,p),t.lineTo(v*2,p);t.stroke(),t.restore()}},e.prototype.renderRule=function(t){var i=this.store,n=i.data,r=i.options,o=n.rule,a=n.ruleColor,l=n.scale,u=n.origin;if(!!(o!=null?o:r.rule)){var s=l*10;t.save();var c=a||r.ruleColor;t.strokeStyle=$n(c,.7);var h=u.x+n.x,f=u.y+n.y,d=this.canvas,v=d.width,g=d.height;t.beginPath(),t.lineWidth=12,t.lineDashOffset=-h%s,t.setLineDash([1,s-1]),t.moveTo(0,0),t.lineTo(v,0),t.stroke(),t.beginPath(),t.lineDashOffset=-f%s,t.moveTo(0,0),t.lineTo(0,g),t.stroke(),t.strokeStyle=c,t.beginPath(),t.lineWidth=24,t.lineDashOffset=-h%(s*10),t.setLineDash([1,s*10-1]),t.moveTo(0,0),t.lineTo(v,0),t.stroke(),t.beginPath(),t.lineDashOffset=-f%(s*10),t.moveTo(0,0),t.lineTo(0,g),t.stroke(),t.beginPath(),t.fillStyle=t.strokeStyle;var p=0-Math.floor(h/s/10)*100;h<0&&(p-=100);for(var b=h%(s*10);b<v;b+=10*s,p+=100)s<3&&p%500||t.fillText(p.toString(),b+4,16);p=0-Math.floor(f/s/10)*100,f<0&&(p-=100);for(var b=f%(s*10);b<g;b+=10*s,p+=100)s<3&&p%500||(t.save(),t.beginPath(),t.translate(16,b-4),t.rotate(270*Math.PI/180),t.fillText(p.toString(),0,0),t.restore());t.restore()}},e}(),qf=function(){function e(t,i,n){this.parentCanvas=t,this.parentElement=i,this.store=n,this.canvas=document.createElement("canvas"),this.magnifierScreen=rr(),this.offscreen=rr(),this.magnifierSize=300,i.appendChild(this.canvas),this.canvas.style.backgroundRepeat="no-repeat",this.canvas.style.backgroundSize="100% 100%",this.canvas.style.position="absolute",this.canvas.style.top="0",this.canvas.style.left="0"}return e.prototype.resize=function(t,i){this.canvas.style.width=t+"px",this.canvas.style.height=i+"px",t=t*this.store.dpiRatio|0,i=i*this.store.dpiRatio|0,this.canvas.width=t,this.canvas.height=i,this.offscreen.width=t,this.offscreen.height=i,this.offscreen.getContext("2d").scale(this.store.dpiRatio,this.store.dpiRatio),this.offscreen.getContext("2d").textBaseline="middle",this.magnifierScreen.width=this.magnifierSize+5,this.magnifierScreen.height=this.magnifierSize+5},e.prototype.renderMagnifier=function(){var t=this;if(!!this.magnifier){var i=this.magnifierSize/2,n=this.magnifierSize+5,r=this.magnifierScreen.getContext("2d");r.clearRect(0,0,n,n),r.lineWidth=5,r.save(),r.translate(2.5,2.5),r.save(),r.arc(i,i,i,0,Math.PI*2,!1),r.clip(),r.fillStyle=this.store.data.background||this.store.options.background||"#f4f4f4",r.fillRect(0,0,n,n),r.translate(-i,-i),r.scale(2,2);var o={x:(this.parentCanvas.mousePos.x+this.store.data.x)*this.store.dpiRatio,y:(this.parentCanvas.mousePos.y+this.store.data.y)*this.store.dpiRatio},a=[this.parentCanvas.canvasImageBottom.offscreen,this.parentCanvas.canvasImageBottom.animateOffsScreen,this.parentCanvas.offscreen,this.parentCanvas.canvasImage.offscreen,this.parentCanvas.canvasImage.animateOffsScreen];a.forEach(function(s){r.drawImage(s,o.x-i,o.y-i,t.magnifierSize,t.magnifierSize,0,0,t.magnifierSize,t.magnifierSize)}),r.restore(),r.beginPath();var l=r.createRadialGradient(i,i,i-5,i,i,i);l.addColorStop(0,"rgba(0,0,0,0.2)"),l.addColorStop(.8,"rgb(200,200,200)"),l.addColorStop(.9,"rgb(200,200,200)"),l.addColorStop(1,"rgba(200,200,200,0.9)"),r.strokeStyle=l,r.arc(i,i,i,0,Math.PI*2,!1),r.stroke(),r.restore();var u=this.offscreen.getContext("2d");u.drawImage(this.magnifierScreen,0,0,this.magnifierSize+5,this.magnifierSize+5,(o.x-i-2.5)/this.store.dpiRatio,(o.y-i-2.5)/this.store.dpiRatio,(this.magnifierSize+5)/this.store.dpiRatio,(this.magnifierSize+5)/this.store.dpiRatio)}},e.prototype.render=function(){this.offscreen.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.renderMagnifier();var t=this.canvas.getContext("2d");t.clearRect(0,0,this.canvas.width,this.canvas.height),t.drawImage(this.offscreen,0,0,this.canvas.width,this.canvas.height)},e}();function Cs(e){if(e.data.locked)throw new Error("canvas is locked")}var qe=globalThis&&globalThis.__assign||function(){return qe=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},qe.apply(this,arguments)},st=globalThis&&globalThis.__awaiter||function(e,t,i,n){function r(o){return o instanceof i?o:new i(function(a){a(o)})}return new(i||(i=Promise))(function(o,a){function l(c){try{s(n.next(c))}catch(h){a(h)}}function u(c){try{s(n.throw(c))}catch(h){a(h)}}function s(c){c.done?o(c.value):r(c.value).then(l,u)}s((n=n.apply(e,t||[])).next())})},lt=globalThis&&globalThis.__generator||function(e,t){var i={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(c){return u([s,c])}}function u(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=s[0]&2?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[s[0]&2,o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!(o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){i=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(s[0]===6&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(c){s=[6,c],r=0}finally{n=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},ct=globalThis&&globalThis.__read||function(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var n=i.call(e),r,o=[],a;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(a)throw a.error}}return o},ut=globalThis&&globalThis.__spreadArray||function(e,t,i){if(i||arguments.length===2)for(var n=0,r=t.length,o;n<r;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},Le=globalThis&&globalThis.__values||function(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ot="-moving",ia=function(){function e(t,i,n){var r=this;this.parent=t,this.parentElement=i,this.store=n,this.canvas=document.createElement("canvas"),this.offscreen=rr(),this.externalElements=document.createElement("div"),this.lastRotate=0,this.hoverType=ce.None,this.resizeIndex=0,this.lastOffsetX=0,this.lastOffsetY=0,this.drawLineFns=ut([],ct(du),!1),this.dirtyLines=new Set,this.lastMouseTime=0,this.hoverTimer=0,this.dirty=!1,this.lastRender=0,this.touchStart=0,this.lastAnimateRender=0,this.animateRendering=!1,this.pointSize=8,this.pasteOffset=10,this.inputParent=document.createElement("div"),this.input=document.createElement("textarea"),this.inputRight=document.createElement("div"),this.dropdown=document.createElement("ul"),this.mousePos={x:0,y:0},this.alreadyCopy=!1,this.stopPropagation=function(o){o.stopPropagation()},this.curve=tf,this.polyline=ff,this.mind=nf,this.line=af,this.onwheel=function(o){if(o.preventDefault(),o.stopPropagation(),r.store.options.scroll&&!o.ctrlKey&&!o.metaKey&&r.scroll){r.scroll.wheel(o.deltaY<0);return}if(!r.store.options.disableScale&&r.store.data.locked!==Ce.Disable){var a=!(!o.deltaX&&o.deltaY),l=performance.now();if(!(l-r.touchStart<50)){r.touchStart=l;var u=o.offsetX,s=o.offsetY;a?r.translate(o.deltaX,o.deltaY):o.deltaY<0?r.scale(r.store.data.scale+.1,{x:u,y:s}):r.scale(r.store.data.scale-.1,{x:u,y:s}),r.externalElements.focus()}}},this.onkeydown=function(o){var a,l,u;if(!(r.store.data.locked>=Ce.DisableMove||o.target.tagName==="INPUT"||o.target.tagName==="TEXTAREA")){var s=10,c=10;switch(o.key){case" ":r.hotkeyType=Te.Translate;break;case"Control":r.drawingLine?r.drawingLine.calculative.drawlineH=!r.drawingLine.calculative.drawlineH:r.hotkeyType||(r.dirty=!0,r.hotkeyType=Te.Select);break;case"Meta":break;case"Shift":if(r.drawingLine){var h=Ae(r.drawingLine);h!==r.drawingLine.calculative.activeAnchor?(Xn(r.drawingLine),r.drawingLine.calculative.worldAnchors.push(h)):r.drawingLine.calculative.worldAnchors.push({x:h.x,y:h.y});var f=r.drawLineFns.indexOf(r.drawingLineName);r.drawingLineName=r.drawLineFns[(f+1)%r.drawLineFns.length],r.drawline(),r.dirty=!0}else r.store.active.length===1&&r.store.active[0].type&&r.store.activeAnchor?r.toggleAnchorHand():r.hotkeyType||(r.dirty=!0,r.hotkeyType=Te.Resize);break;case"Alt":break;case"a":case"A":o.ctrlKey||o.metaKey?(r.active(r.store.data.pens.filter(function(d){return!d.parentId})),o.preventDefault()):r.toggleAnchorMode();break;case"Delete":case"Backspace":!r.store.data.locked&&r.delete();break;case"ArrowLeft":if(r.movingAnchor){r.translateAnchor(-1,0);break}s=-10,o.shiftKey&&(s=-5),(o.ctrlKey||o.metaKey)&&(s=-1),r.translatePens(r.store.active,s,0);break;case"ArrowUp":if(r.movingAnchor){r.translateAnchor(0,-1);break}c=-10,o.shiftKey&&(c=-5),(o.ctrlKey||o.metaKey)&&(c=-1),r.translatePens(r.store.active,0,c);break;case"ArrowRight":if(r.movingAnchor){r.translateAnchor(1,0);break}o.shiftKey&&(s=5),(o.ctrlKey||o.metaKey)&&(s=1),r.translatePens(r.store.active,s,0);break;case"ArrowDown":if(r.movingAnchor){r.translateAnchor(0,1);break}o.shiftKey&&(c=5),(o.ctrlKey||o.metaKey)&&(c=1),r.translatePens(r.store.active,0,c);break;case"x":case"X":(o.ctrlKey||o.metaKey)&&r.cut();break;case"c":case"C":(o.ctrlKey||o.metaKey)&&r.copy();break;case"d":case"D":!((a=r.store.active[0])===null||a===void 0)&&a.locked||r.removeAnchorHand();break;case"h":case"H":!((l=r.store.active[0])===null||l===void 0)&&l.locked||r.addAnchorHand();break;case"m":case"M":r.toggleMagnifier();break;case"g":case"G":r.hoverType===ce.NodeAnchor&&(r.movingAnchor=r.store.hoverAnchor,r.externalElements.style.cursor="move");break;case"s":case"S":!r.store.data.locked&&r.hoverType===ce.LineAnchor&&r.store.hover===r.store.active[0]&&r.splitLine(r.store.active[0],r.store.hoverAnchor);break;case"v":case"V":o.ctrlKey||o.metaKey?r.paste():r.drawingLineName?(r.finishDrawline(),r.drawingLineName=""):r.drawingLineName=r.store.options.drawingLineName;break;case"b":case"B":r.drawingPencil();break;case"y":case"Y":(o.ctrlKey||o.metaKey)&&r.redo();break;case"z":case"Z":o.ctrlKey||o.metaKey?r.undo():o.shiftKey&&r.redo();break;case"Enter":r.drawingLineName&&(r.finishDrawline(!0),r.store.active[0].anchors[0].connectTo?r.drawingLineName="":r.drawingLineName=r.store.options.drawingLineName),r.store.active&&(r.store.active.forEach(function(d){d.type&&(d.close=!d.close,r.store.path2dMap.set(d,he.path2dDraws.line(d)),Tn(d))}),r.render());break;case"Escape":r.drawingLineName&&r.finishDrawline(),r.drawingLineName=void 0,r.stopPencil(),r.movingPens&&(r.getAllByPens(r.movingPens).forEach(function(d){r.store.pens[d.id]=void 0}),r.movingPens=void 0,r.mouseDown=void 0,r.clearDock(),(u=r.store.active)===null||u===void 0||u.forEach(function(d){r.updateLines(d)}),r.calcActiveRect(),r.dirty=!0),r.hotkeyType=Te.None,r.movingAnchor=void 0,r.magnifierCanvas.magnifier&&(r.magnifierCanvas.magnifier=!1,r.dirty=!0);break}r.render(!1)}},this.onkeyup=function(o){switch(o.key){case"Alt":r.drawingLine&&(r.store.options.autoAnchor=!r.store.options.autoAnchor);break}r.hotkeyType&&r.render(),r.hotkeyType<Te.AddAnchor&&(r.hotkeyType=Te.None)},this.ondrop=function(o){return st(r,void 0,void 0,function(){var a,l,u,s,c;return lt(this,function(h){switch(h.label){case 0:if(this.store.data.locked)return console.warn("canvas is locked, can not drop"),[2];h.label=1;case 1:return h.trys.push([1,4,,5]),o.preventDefault(),o.stopPropagation(),a=o.dataTransfer.getData("Topology")||o.dataTransfer.getData("Text"),l=null,a?[3,3]:(u=o.dataTransfer.files,u.length&&u[0].type.match("image.*")?(s=u[0].type==="image/gif",[4,this.fileToPen(u[0],s)]):[3,3]);case 2:l=h.sent(),h.label=3;case 3:return!l&&(l=JSON.parse(a)),l=Array.isArray(l)?l:[l],c={x:o.offsetX,y:o.offsetY},this.calibrateMouse(c),this.dropPens(l,c),[3,5];case 4:return h.sent(),[3,5];case 5:return[2]}})})},this.ontouchstart=function(o){r.store.data.locked!==Ce.Disable&&(r.touchStartTimer&&clearTimeout(r.touchStartTimer),r.touchStartTimer=setTimeout(function(){r.touchStart=performance.now();var a=o.touches[0].pageX-r.clientRect.x,l=o.touches[0].pageY-r.clientRect.y,u={x:a,y:l};if(r.calibrateMouse(u),r.getHover(u),r.onMouseDown({x:a,y:l,clientX:o.touches[0].clientX,clientY:o.touches[0].clientY,pageX:o.touches[0].pageX,pageY:o.touches[0].pageY,ctrlKey:o.ctrlKey||o.metaKey,shiftKey:o.shiftKey,altKey:o.altKey,buttons:1}),o.touches.length===2){r.initTouchDis=Math.hypot(o.touches[0].pageX-o.touches[1].pageX,o.touches[0].pageY-o.touches[1].pageY),r.initScale=r.store.data.scale,r.startTouches=o.touches,r.touchCenter={x:o.touches[0].pageX+(o.touches[1].pageX-o.touches[0].pageX)/2-r.clientRect.x,y:o.touches[0].pageY+(o.touches[1].pageY-o.touches[0].pageY)/2-r.clientRect.y};return}else o.touches.length===3&&(r.store.emitter.emit("contextmenu",{e:{x:a,y:l,clientX:o.touches[0].clientX,clientY:o.touches[0].clientY,pageX:o.touches[0].pageX,pageY:o.touches[0].pageY},clientRect:r.clientRect}),o.preventDefault(),o.stopPropagation());r.touchStartTimer=void 0},50))},this.ontouchmove=function(o){if(r.store.data.locked!==Ce.Disable){o.stopPropagation(),o.preventDefault();var a=performance.now();if(!(a-r.touchStart<50)){r.touchStart=a;var l=o.touches,u=l.length,s=o.touches[0].pageX-r.clientRect.x,c=o.touches[0].pageY-r.clientRect.y;if(u===1)r.onMouseMove({x:s,y:c,clientX:o.changedTouches[0].clientX,clientY:o.changedTouches[0].clientY,pageX:o.changedTouches[0].pageX,pageY:o.changedTouches[0].pageY,ctrlKey:o.ctrlKey||o.metaKey,shiftKey:o.shiftKey,altKey:o.altKey,buttons:1});else if(u===2){if(!r.touchMoving&&!r.touchScaling){var h=r.startTouches[0].pageX-l[0].pageX,f=r.startTouches[1].pageX-l[1].pageX,d=r.startTouches[0].pageY-l[0].pageY,v=r.startTouches[1].pageY-l[1].pageY;(h>=0&&f<0||h<=0&&f>0)&&(d>=0&&v<0||d<=0&&v>0)?r.touchScaling=!0:r.touchMoving=!0}if(r.touchScaling){if(r.store.options.disableScale)return;var g=Math.hypot(l[0].pageX-l[1].pageX,l[0].pageY-l[1].pageY)/r.initTouchDis;r.scale(r.initScale*g,se(r.touchCenter))}if(r.touchMoving){if(r.store.data.locked>=Ce.DisableMove||r.store.options.disableScale)return;if(r.lastOffsetX){var g=r.store.data.scale;r.translate((s-r.lastOffsetX)/g,(c-r.lastOffsetY)/g)}r.lastOffsetX=s,r.lastOffsetY=c}}}}},this.ontouchend=function(o){if(r.store.data.locked!==Ce.Disable){r.touchCenter=void 0,r.touchScaling=void 0,r.touchMoving=void 0,r.startTouches=void 0,r.lastOffsetX=0,r.lastOffsetY=0;var a=o.changedTouches[0].pageX-r.clientRect.x,l=o.changedTouches[0].pageY-r.clientRect.y;r.onMouseUp({x:a,y:l,clientX:o.changedTouches[0].clientX,clientY:o.changedTouches[0].clientY,pageX:o.changedTouches[0].pageX,pageY:o.changedTouches[0].pageY,ctrlKey:o.ctrlKey||o.metaKey,shiftKey:o.shiftKey,altKey:o.altKey,buttons:1}),r.render()}},this.onGesturestart=function(o){o.preventDefault()},this.onMouseDown=function(o){var a;if(o.buttons===2&&!r.drawingLine&&(r.mouseRight=gt.Down),r.hideInput(),r.store.data.locked===Ce.Disable||o.buttons!==1&&o.buttons!==2){r.hoverType=ce.None;return}if(!r.magnifierCanvas.magnifier){if(r.calibrateMouse(o),r.mousePos.x=o.x,r.mousePos.y=o.y,r.mouseDown=o,r.lastMouseTime=performance.now(),r.hotkeyType===Te.AddAnchor){r.setAnchor(o);return}if(!(r.hotkeyType===Te.Translate||r.mouseRight===gt.Down)){if(r.drawingLine){if(r.store.hoverAnchor){var l=Ae(r.drawingLine);l.x=r.store.hoverAnchor.x,l.y=r.store.hoverAnchor.y,yt(r.store.hover,r.store.hoverAnchor,r.drawingLine,l),r.drawline(),r.finishDrawline(!0);return}if(o.buttons===2||r.drawingLineName==="mind"&&((a=r.drawingLine)===null||a===void 0?void 0:a.calculative.worldAnchors.length)>1){r.finishDrawline(!0),r.store.active[0].anchors[0].connectTo?r.drawingLineName="":r.drawingLineName=r.store.options.drawingLineName;return}if(r.store.options.autoAnchor&&r.hoverType===ce.Node){var u=Ae(r.drawingLine),s=Yr(r.store.hover,o);u.x=s.x,u.y=s.y,r.drawingLine.autoTo=!0,yt(r.store.hover,s,r.drawingLine,u),r.drawline(),r.finishDrawline(!0);return}var c=Ae(r.drawingLine);c.isTemp?(r.drawingLine.calculative.activeAnchor=r.drawingLine.calculative.worldAnchors[r.drawingLine.calculative.worldAnchors.length-2],c.isTemp=void 0):(r.drawingLine.calculative.activeAnchor=c,r.drawingLine.calculative.worldAnchors.push({x:c.x,y:c.y,penId:c.penId})),r.drawingLineName==="polyline"&&(r.drawingLine.autoPolyline=!1),r.drawingLine.calculative.drawlineH=void 0,r.drawingLineName!=="polyline"&&r.drawline()}if(r.drawingLineName){if(r.hoverType===ce.Node)if(r.store.options.autoAnchor){r.inactive(!0);var s=Yr(r.store.hover,o);r.store.hoverAnchor=s;var h={id:be(),x:s.x,y:s.y};r.drawingLine=r.createDrawingLine(h),r.drawingLine.autoFrom=!0,yt(r.store.hover,s,r.drawingLine,h)}else r.inactive(),r.hoverType=ce.None;else if(!r.drawingLine&&r.drawingLineName!=="curve"){r.inactive(!0);var h={id:be(),x:o.x,y:o.y};r.drawingLine=r.createDrawingLine(h),r.drawingLine.calculative.activeAnchor=h}}else if(r.pencil){r.inactive(!0);var f=be(),h={x:o.x,y:o.y,id:be(),penId:f};r.pencilLine=r.getInitPencilLine(h)}else{switch(r.hoverType){case ce.None:r.store.data.rule&&!r.store.options.disableRuleLine&&r.addRuleLine(o),r.inactive();break;case ce.Node:case ce.Line:if(r.store.hover){var d=Zt(r.store.hover,!0)||r.store.hover;o.ctrlKey&&!o.shiftKey?(d.calculative.active?r.willInactivePen=d:(d.calculative.active=!0,Jt(d),r.store.active.push(d),r.store.emitter.emit("active",r.store.active)),r.dirty=!0):o.ctrlKey&&o.shiftKey&&r.store.hover.parentId?r.active([r.store.hover]):d.calculative.active||r.active([d]),r.calcActiveRect()}break;case ce.LineAnchor:r.store.activeAnchor=r.store.hoverAnchor,r.store.hover.calculative.activeAnchor=r.store.hoverAnchor,r.active([r.store.hover]);break;case ce.LineAnchorPrev:case ce.LineAnchorNext:r.store.activeAnchor&&(r.prevAnchor=qe({},r.store.activeAnchor.prev),r.nextAnchor=qe({},r.store.activeAnchor.next));break;case ce.Resize:r.activeInitPos=[],r.store.active.forEach(function(v){r.activeInitPos.push({x:(v.calculative.worldRect.x-r.activeRect.x)/r.activeRect.width,y:(v.calculative.worldRect.y-r.activeRect.y)/r.activeRect.height})});break}r.store.emitter.emit("mousedown",{x:o.x,y:o.y,pen:r.store.hover})}r.render()}}},this.onMouseMove=function(o){var a,l;if(r.store.data.locked===Ce.Disable){r.hoverType=ce.None;return}if(r.mouseDown&&!r.mouseDown.restore&&o.buttons!==1&&o.buttons!==2){r.onMouseUp(o);return}if(r.lastMouseTime){var u=performance.now();if(u-r.lastMouseTime<50){r.lastMouseTime=0;return}r.lastMouseTime=0}if(r.calibrateMouse(o),r.mousePos.x=o.x,r.mousePos.y=o.y,r.magnifierCanvas.magnifier){r.render();return}if(r.mouseDown){if(r.mouseRight===gt.Down&&(r.mouseRight=gt.Translate),r.store.data.locked===Ce.DisableEdit||r.hotkeyType===Te.Translate||r.mouseRight===gt.Translate){var s=r.store.data.scale;r.translate((o.x-r.mouseDown.x)/s,(o.y-r.mouseDown.y)/s);return}if(r.store.data.locked)return;if(!r.drawingLine&&!r.pencil){if(!r.drawingLineName&&!r.movingAnchor){if(r.hoverType===ce.NodeAnchor){r.drawingLineName=r.store.options.drawingLineName;var c={id:be(),x:r.store.hoverAnchor.x,y:r.store.hoverAnchor.y};r.drawingLine=r.createDrawingLine(c),r.drawingLine.calculative.activeAnchor=c,yt(r.store.hover,r.store.hoverAnchor,r.drawingLine,c),r.drawline();return}}else if(r.drawingLineName&&r.hoverType===ce.None){var c={id:be(),x:o.x,y:o.y};r.drawingLine=r.createDrawingLine(c),r.drawingLine.calculative.activeAnchor=c,r.drawline();return}if(o.buttons===1&&!r.hoverType&&!r.hotkeyType){r.dragRect={x:Math.min(r.mouseDown.x,o.x),y:Math.min(r.mouseDown.y,o.y),ex:Math.max(r.mouseDown.x,o.x),ey:Math.max(r.mouseDown.y,o.y),width:Math.abs(o.x-r.mouseDown.x),height:Math.abs(o.y-r.mouseDown.y)},r.render();return}if(r.movingAnchor){var h=o.x-r.movingAnchor.x,f=o.y-r.movingAnchor.y;r.translateAnchor(h,f),r.render();return}else if(!(!((a=r.store.active[0])===null||a===void 0)&&a.locked)){if(r.hoverType===ce.LineAnchor){r.getAnchorDock(o),r.moveLineAnchor(o);return}if(r.hoverType===ce.LineAnchorPrev){r.moveLineAnchorPrev(o);return}if(r.hoverType===ce.LineAnchorNext){r.moveLineAnchorNext(o);return}}if(r.hoverType===ce.Rotate){r.rotatePens({x:o.x,y:o.y});return}if(r.hoverType===ce.Resize){r.resizePens(o);return}if(r.hoverType===ce.Node||r.hoverType===ce.Line){var h=o.x-r.mouseDown.x,f=o.y-r.mouseDown.y,d=20;if(o.ctrlKey&&!o.shiftKey&&!r.alreadyCopy&&(Math.abs(h)>=d||Math.abs(f)>=d)&&(r.alreadyCopy=!0,r.willInactivePen=void 0),r.store.active.length===1){var v=r.store.active[0];v.locked<Ce.DisableMove&&((l=v==null?void 0:v.onMouseMove)===null||l===void 0||l.call(v,v,r.mousePos))}r.movePens(o);return}}else if(r.pencil){var c=qe({},o);c.id=be(),c.penId=r.pencilLine.id,r.pencilLine.calculative.worldAnchors.push(c),r.store.path2dMap.set(r.pencilLine,he.path2dDraws[r.pencilLine.name](r.pencilLine)),r.dirty=!0}}if(r.drawingLine){var c=qe({},o);if(c.id=be(),c.penId=r.drawingLine.id,r.mouseDown&&r.drawingLineName==="curve"&&!r.drawingLine.calculative.worldAnchors[0].connectTo)r.drawline(c);else{var g=void 0;r.drawingLine.calculative.worldAnchors.length>1&&(g=Ae(r.drawingLine)),g?(g.prev=void 0,g.next=void 0,g.id||(g.id=be()),g.x=c.x,g.y=c.y,g.connectTo=void 0):(g=qe({},c),r.drawingLine.calculative.worldAnchors.push(g)),(r.hoverType===ce.NodeAnchor||r.hoverType===ce.LineAnchor)&&(g.x=r.store.hoverAnchor.x,g.y=r.store.hoverAnchor.y,g.connectTo=r.store.hoverAnchor.penId),r.drawingLineName==="line"&&(o.ctrlKey?g.y=r.drawingLine.calculative.worldAnchors[r.drawingLine.calculative.worldAnchors.length-2].y:o.altKey&&(g.x=r.drawingLine.calculative.worldAnchors[r.drawingLine.calculative.worldAnchors.length-2].x)),r.drawline()}}window&&window.debug&&console.time("hover");var p=performance.now();p-r.hoverTimer>50&&(r.hoverTimer=p,r.getHover(o)),window&&window.debug&&console.timeEnd("hover"),r.hotkeyType===Te.AddAnchor&&(r.dirty=!0),r.render(!1)},this.onMouseUp=function(o){var a,l;if(r.store.data.locked===Ce.Disable){r.hoverType=ce.None;return}if(!!r.mouseDown){if(r.mouseRight===gt.Down&&r.store.emitter.emit("contextmenu",{e:o,clientRect:r.clientRect}),r.mouseRight=gt.None,r.calibrateMouse(o),r.mousePos.x=o.x,r.mousePos.y=o.y,r.pencil&&r.finishPencil(),r.drawingLine){if(r.store.hoverAnchor){var u=Ae(r.drawingLine);u.x=r.store.hoverAnchor.x,u.y=r.store.hoverAnchor.y,yt(r.store.hover,r.store.hoverAnchor,r.drawingLine,u),r.drawline(),r.finishDrawline(!0);return}if(r.store.options.autoAnchor&&r.hoverType===ce.Node){var u=Ae(r.drawingLine),s=Yr(r.store.hover,o);u.x=s.x,u.y=s.y,r.drawingLine.autoTo=!0,yt(r.store.hover,s,r.drawingLine,u),r.drawline(),r.finishDrawline(!0);return}}if(r.hoverType===ce.LineAnchor&&r.store.hover&&r.store.active[0]&&r.store.active[0]!==r.store.hover){var c=r.store.active[0],h=Oe(c),u=Ae(c);if(r.store.hoverAnchor){var f=r.store.hover,d=Oe(f)===r.store.hoverAnchor,v=Ae(f)===r.store.hoverAnchor,g=h===r.store.activeAnchor,p=u===r.store.activeAnchor;if((o.ctrlKey||o.altKey)&&f.type===Pe.Line&&(d||v)&&(g||p)){var b=f.calculative.worldAnchors.map(function(_){return qe(qe({},_),{penId:c.id})});d?b.shift():v&&b.pop(),(d&&g||v&&p)&&b.reverse(),g?(a=c.calculative.worldAnchors).unshift.apply(a,ut([],ct(b),!1)):p&&(l=c.calculative.worldAnchors).push.apply(l,ut([],ct(b),!1)),r.delete([f]),r.render()}else r.store.activeAnchor.x=r.store.hoverAnchor.x,r.store.activeAnchor.y=r.store.hoverAnchor.y,yt(r.store.hover,r.store.hoverAnchor,c,r.store.activeAnchor);r[c.lineName]&&r[c.lineName](r.store,c),r.store.path2dMap.set(c,he.path2dDraws.line(c)),r.initLineRect(c)}else h===r.store.activeAnchor&&c.autoFrom?r.calcAutoAnchor(c,h,r.store.hover):u===r.store.activeAnchor&&c.autoTo&&r.calcAutoAnchor(c,u,r.store.hover)}if(r.addCaches&&(r.store.data.locked||r.dropPens(r.addCaches,o),r.addCaches=void 0),r.hoverType===ce.Rotate&&(r.getSizeCPs(),r.store.active.forEach(function(m){m.rotate=m.calculative.rotate})),r.dirtyLines.forEach(function(m){m.type&&r.initLineRect(m)}),r.dirtyLines.clear(),r.dragRect){var x=r.store.data.pens.filter(function(m){if(m.visible===!1||m.locked===Ce.Disable||m.parentId)return!1;if(bn(m.calculative.worldRect,r.dragRect,r.store.options.dragAllIn))return m.type===Pe.Line&&!r.store.options.dragAllIn?uf(m,r.dragRect):!0});r.active(x)}o.button!==2&&(Li(r.mouseDown,o)<2&&(r.store.hover&&r.store.hover.input&&r.showInput(r.store.hover),r.store.emitter.emit("click",{x:o.x,y:o.y,pen:r.store.hover})),r.store.emitter.emit("mouseup",{x:o.x,y:o.y,pen:r.store.hover})),r.willInactivePen&&(r.willInactivePen.calculative.active=void 0,Jt(r.willInactivePen,!1),r.store.active.splice(r.store.active.findIndex(function(m){return m===r.willInactivePen}),1),r.calcActiveRect(),r.willInactivePen=void 0,r.store.emitter.emit("inactive",[r.willInactivePen]),r.render()),r.movingPens&&(r.alreadyCopy?r.copyMovedPens():r.movedActivePens(),r.getAllByPens(r.movingPens).forEach(function(m){r.store.pens[m.id]=void 0}),r.movingPens=void 0),r.mouseDown=void 0,r.lastOffsetX=0,r.lastOffsetY=0,r.clearDock(),r.dragRect=void 0,r.initActiveRect=void 0}},this.clearDock=function(){var o,a,l,u,s=(a=(o=r.dock)===null||o===void 0?void 0:o.xDock)===null||a===void 0?void 0:a.penId,c=(u=(l=r.dock)===null||l===void 0?void 0:l.yDock)===null||u===void 0?void 0:u.penId,h=r.store.pens[s];h&&(h.calculative.isDock=!1);var f=r.store.pens[c];f&&(f.calculative.isDock=!1),r.dock=void 0},this.onResize=function(){r.timer&&clearTimeout(r.timer),r.timer=setTimeout(function(){r.resize(),r.timer=void 0},100)},this.onScroll=function(){r.timer&&clearTimeout(r.timer),r.timer=setTimeout(function(){r.clientRect=r.canvas.getBoundingClientRect(),r.timer=void 0},100)},this.calibrateMouse=function(o){return o.x-=r.store.data.x,o.y-=r.store.data.y,o},this.getHover=function(o){var a,l;if(!r.dragRect){var u=ce.None;r.store.hover=void 0,r.store.hoverAnchor=void 0,r.store.pointAt=void 0,r.store.pointAtIndex=void 0;var s=r.store.active.length===1&&r.store.active[0].type;if(!r.drawingLineName&&r.activeRect&&!s&&!r.store.data.locked){var c=$i(r.store.active),h=jo(r.store.active)||r.store.options.disableRotate,f=Fo(r.store.active)||r.store.options.disableSize;if(!c&&!h){var d={x:r.activeRect.center.x,y:r.activeRect.y-30};r.activeRect.rotate&&Re(d,r.activeRect.rotate,r.activeRect.center),!r.hotkeyType&&Qt(o,d,r.pointSize)&&(u=ce.Rotate,r.externalElements.style.cursor='url("'+r.store.options.rotateCursor+'"), auto')}if(!c&&!f)for(var v=0;v<8;v++){var g=v<4,p=r.hotkeyType===Te.Resize||g&&!r.hotkeyType;if(p&&Qt(o,r.sizeCPs[v],r.pointSize)){var b=g?Eo:Co,x=0;Math.abs(r.activeRect.rotate%90-45)<25?(b=g?Co:Eo,x=Math.round((r.activeRect.rotate-45)/90)+(g?0:1)):x=Math.round(r.activeRect.rotate/90),u=ce.Resize,r.resizeIndex=v,r.externalElements.style.cursor=b[(v+x)%4];break}}}u===ce.None&&(u=r.inPens(o,r.store.data.pens)),!u&&!s&&Xi(o,r.activeRect)&&(u=ce.Node,r.externalElements.style.cursor="move"),r.hoverType=u,u===ce.None&&(r.drawingLineName||r.pencil?r.externalElements.style.cursor="crosshair":r.mouseDown||(r.externalElements.style.cursor="default"),r.store.hover=void 0),r.store.lastHover!==r.store.hover&&(r.dirty=!0,r.store.lastHover&&(r.store.lastHover.calculative.hover=!1,ni(Zt(r.store.lastHover,!0)||r.store.lastHover,!1),r.store.emitter.emit("leave",r.store.lastHover),r.tooltip.hide()),r.store.hover&&(r.store.hover.calculative.hover=!0,ni(Zt(r.store.hover,!0)||r.store.hover),r.store.emitter.emit("enter",r.store.hover),r.tooltip.show(r.store.hover,o)),r.store.lastHover=r.store.hover),(l=(a=r.store.hover)===null||a===void 0?void 0:a.onMouseMove)===null||l===void 0||l.call(a,r.store.hover,r.mousePos)}},this.inPens=function(o,a){var l=ce.None,u=function(h){var f,d,v=a[h];if(v.visible==!1||v.calculative.inView==!1||v.locked===Ce.Disable)return"continue";var g=xi(v);if(!v.calculative.active&&!Wt(o,v.calculative.worldRect,g)&&!Xi(o,v.calculative.worldRect))return"continue";if(!r.store.data.locked&&r.hotkeyType!==Te.Resize&&v.calculative.worldAnchors)try{for(var p=(f=void 0,Le(v.calculative.worldAnchors)),b=p.next();!b.done;b=p.next()){var x=b.value;if(l=r.inAnchor(o,v,x),l)return"break-outer"}}catch(R){f={error:R}}finally{try{b&&!b.done&&(d=p.return)&&d.call(p)}finally{if(f)throw f.error}}if(v.type){var m=lf(o,v);if(m)return!r.store.data.locked&&!v.locked?r.hotkeyType===Te.AddAnchor?r.externalElements.style.cursor="pointer":r.externalElements.style.cursor="move":r.externalElements.style.cursor=r.store.options.hoverCursor,r.store.hover=v,r.store.pointAt=m.point,r.store.pointAtIndex=m.i,l=ce.Line,"break"}else{if(v.children){var _=[];if(v.children.forEach(function(R){_.push(r.store.pens[R])}),l=r.inPens(o,_),l)return"break"}var P=!1;if(v.name==="line"?P=Wt(o,v.calculative.worldRect,v.lineWidth):P=Xi(o,v.calculative.worldRect),P)return!r.store.data.locked&&!v.locked?r.hotkeyType===Te.AddAnchor?r.externalElements.style.cursor="pointer":r.externalElements.style.cursor="move":r.externalElements.style.cursor=r.store.options.hoverCursor,r.store.hover=v,l=ce.Node,r.store.pointAt=o,"break"}};e:for(var s=a.length-1;s>=0;--s){var c=u(s);if(c==="break")break;switch(c){case"break-outer":break e}}return l},this.getAnchorDock=function(o){var a,l;r.store.hover=void 0;e:for(var u=r.store.data.pens.length-1;u>=0;--u){var s=r.store.data.pens[u];if(!(s.visible==!1||s.locked===Ce.Disable||s===r.store.active[0])){var c=xi(s);if(!!Wt(o,s.calculative.worldRect,c)&&(r.store.hover=s,r.hotkeyType!==Te.Resize&&s.calculative.worldAnchors))try{for(var h=(a=void 0,Le(s.calculative.worldAnchors)),f=h.next();!f.done;f=h.next()){var d=f.value;if(r.inAnchor(o,s,d))break e}}catch(v){a={error:v}}finally{try{f&&!f.done&&(l=h.return)&&l.call(h)}finally{if(a)throw a.error}}}}},this.render=function(o){var a;if(o==null||o===!0?(a=performance.now(),r.dirty=!0):o>1?a=o:a=performance.now(),!!r.dirty){if(a-r.lastRender<r.store.options.interval){r.renderTimer&&cancelAnimationFrame(r.renderTimer),r.renderTimer=requestAnimationFrame(r.render);return}r.renderTimer=void 0,r.lastRender=a;var l=r.offscreen.getContext("2d");l.clearRect(0,0,r.offscreen.width,r.offscreen.height),l.save(),l.translate(r.store.data.x,r.store.data.y),window&&window.debugRender&&console.time("renderPens"),r.renderPens(),window&&window.debugRender&&console.timeEnd("renderPens"),r.renderBorder(),r.renderHoverPoint(),l.restore(),r.magnifierCanvas.render();var u=r.canvas.getContext("2d");u.clearRect(0,0,r.canvas.width,r.canvas.height),u.drawImage(r.offscreen,0,0,r.width,r.height),r.canvasImageBottom.render(),r.canvasImage.render(),r.dirty=!1}},this.renderPens=function(){var o,a,l=r.offscreen.getContext("2d");l.strokeStyle=fs(r.store);try{for(var u=Le(r.store.data.pens),s=u.next();!s.done;s=u.next()){var c=s.value;isFinite(c.x)||console.warn(c,"\u753B\u7B14\u7684 x \u4E0D\u5408\u6CD5"),c.calculative.inView&&vr(l,c)}}catch(h){o={error:h}}finally{try{s&&!s.done&&(a=u.return)&&a.call(u)}finally{if(o)throw o.error}}r.drawingLine&&vr(l,r.drawingLine),r.pencilLine&&vr(l,r.pencilLine),r.movingPens&&r.movingPens.forEach(function(h){r.renderPenContainChild(l,h)})},this.renderPenContainChild=function(o,a){var l;a.calculative.inView&&vr(o,a),(l=a.children)===null||l===void 0||l.forEach(function(u){var s=r.store.pens[u];s&&r.renderPenContainChild(o,s)})},this.renderBorder=function(){if(!r.store.data.locked&&r.activeRect&&!(r.store.active.length===1&&r.store.active[0].type)&&!r.movingPens){var o=r.offscreen.getContext("2d");if(o.save(),o.translate(.5,.5),r.activeRect.rotate&&(o.translate(r.activeRect.center.x,r.activeRect.center.y),o.rotate(r.activeRect.rotate*Math.PI/180),o.translate(-r.activeRect.center.x,-r.activeRect.center.y)),o.strokeStyle=r.store.options.activeColor,o.globalAlpha=.3,o.beginPath(),o.strokeRect(r.activeRect.x,r.activeRect.y,r.activeRect.width,r.activeRect.height),o.globalAlpha=1,$i(r.store.active)||jo(r.store.active)||r.store.options.disableRotate){o.restore();return}o.beginPath(),o.moveTo(r.activeRect.center.x,r.activeRect.y),o.lineTo(r.activeRect.center.x,r.activeRect.y-30),o.stroke(),o.beginPath(),o.strokeStyle=r.store.options.activeColor,o.fillStyle="#ffffff",o.arc(r.activeRect.center.x,r.activeRect.y-30,5,0,Math.PI*2),o.fill(),o.stroke(),o.restore()}},this.renderHoverPoint=function(){if(!r.store.data.locked){var o=r.offscreen.getContext("2d");if(o.save(),o.translate(.5,.5),!r.store.options.disableAnchor&&r.store.hover&&!r.store.hover.disableAnchor&&(r.hotkeyType!==Te.Resize||r.store.active.length!==1||r.store.active[0]!==r.store.hover)){var a=ut([],ct(r.store.hover.calculative.worldAnchors),!1);r.store.pointAt&&r.hotkeyType===Te.AddAnchor&&a.push(r.store.pointAt),a&&(o.strokeStyle=r.store.hover.anchorColor||r.store.options.anchorColor,o.fillStyle=r.store.hover.anchorBackground||r.store.options.anchorBackground,a.forEach(function(l){if(l===r.store.hoverAnchor){o.save();var u=r.store.hover.hoverAnchorColor||r.store.options.hoverAnchorColor;o.strokeStyle=u,o.fillStyle=u}o.beginPath();var s=l.radius||r.store.hover.anchorRadius||r.store.options.anchorRadius;r.store.hover.type&&(s=3,r.store.hover.calculative.lineWidth>3&&(s=r.store.hover.calculative.lineWidth)),o.arc(l.x,l.y,s,0,Math.PI*2),r.store.hover.type&&r.store.hoverAnchor===l?(o.save(),o.strokeStyle=r.store.hover.activeColor||r.store.options.activeColor,o.fillStyle=o.strokeStyle):(l.color||l.background)&&(o.save(),o.strokeStyle=l.color,o.fillStyle=l.background),o.fill(),o.stroke(),l===r.store.hoverAnchor&&o.restore(),(r.store.hover.type&&r.store.hoverAnchor===l||l.color||l.background)&&o.restore()}))}r.hotkeyType!==Te.AddAnchor&&!r.movingPens&&r.activeRect&&!(r.store.active.length===1&&r.store.active[0].type)&&!$i(r.store.active)&&!Fo(r.store.active)&&!r.store.options.disableSize&&(o.strokeStyle=r.store.options.activeColor,o.fillStyle="#ffffff",r.sizeCPs.forEach(function(l,u){r.activeRect.rotate&&(o.save(),o.translate(l.x,l.y),o.rotate(r.activeRect.rotate*Math.PI/180),o.translate(-l.x,-l.y)),(u<4||r.hotkeyType===Te.Resize)&&(o.beginPath(),o.fillRect(l.x-4.5,l.y-4.5,8,8),o.strokeRect(l.x-5.5,l.y-5.5,10,10)),r.activeRect.rotate&&o.restore()})),!r.store.data.locked&&r.dragRect&&(o.save(),o.fillStyle=$n(r.store.options.dragColor,.2),o.strokeStyle=r.store.options.dragColor,o.beginPath(),o.strokeRect(r.dragRect.x,r.dragRect.y,r.dragRect.width,r.dragRect.height),o.fillRect(r.dragRect.x,r.dragRect.y,r.dragRect.width,r.dragRect.height),o.restore()),r.dock&&(o.strokeStyle=r.store.options.dockColor,r.dock.xDock&&(o.beginPath(),o.moveTo(r.dock.xDock.x,r.dock.xDock.y),o.lineTo(r.dock.xDock.x,r.dock.xDock.prev.y),o.stroke()),r.dock.yDock&&(o.beginPath(),o.moveTo(r.dock.yDock.x,r.dock.yDock.y),o.lineTo(r.dock.yDock.prev.x,r.dock.yDock.y),o.stroke())),o.restore()}},this.ondblclick=function(o){r.store.hover&&!r.store.data.locked&&!r.store.options.disableInput&&(r.store.hover.onShowInput?r.store.hover.onShowInput(r.store.hover,o):r.showInput(r.store.hover)),r.store.emitter.emit("dblclick",{x:o.x,y:o.y,pen:r.store.hover})},this.showInput=function(o,a,l){if(l===void 0&&(l="transparent"),!(!r.store.hover||r.store.hover.locked||r.store.hover.externElement||r.store.hover.disableInput)){if(r.input.dataset.penId===o.id){r.input.focus();return}var u=a||o.calculative.worldTextRect;r.input.value=o.calculative.tempText||o.text||"",r.input.style.fontSize=o.calculative.fontSize+"px",r.input.style.color=Oi(o,r.store),r.inputParent.style.left=u.x+r.store.data.x+5+"px",r.inputParent.style.top=u.y+r.store.data.y+5+"px",r.inputParent.style.width=u.width-10+"px",r.inputParent.style.height=u.height-10+"px",r.inputParent.style.zIndex="1000",r.inputParent.style.background=l,o.rotate%360?r.inputParent.style.transform="rotate("+o.rotate+"deg)":r.inputParent.style.transform=null,r.inputParent.style.display="flex",r.input.dataset.penId=o.id,r.input.readOnly=o.disableInput,o.dropdownList&&r.dropdown.style.display!=="block"?(r.store.data.locked||(r.inputRight.style.display="none"),r.setDropdownList()):r.inputRight.style.display="none",r.input.focus(),o.calculative.text=void 0,r.render()}},this.hideInput=function(){if(r.inputParent.style.display==="flex"){r.inputParent.style.display="none";var o=r.store.pens[r.input.dataset.penId];if(!o)return;if(o.calculative.text=o.text,o.onInput)o.onInput(o,r.input.value);else if(o.text!==r.input.value){var a=[se(o,!0)];o.text=r.input.value,o.calculative.text=o.text,r.input.dataset.penId=void 0,xr(o),r.dirty=!0,r.pushHistory({type:de.Update,pens:[se(o,!0)],initPens:a}),r.store.emitter.emit("valueUpdate",o)}}r.input.dataset.penId=void 0,r.dropdown.style.display="none"},this.setDropdownList=function(o){var a,l;if(r.clearDropdownList(),!!r.store.data.locked){r.dropdown.style.display="block",r.inputRight.style.display="block",setTimeout(function(){r.inputRight.style.transform="rotate(315deg)"});var u=r.store.pens[r.input.dataset.penId];if(!u||!u.dropdownList){r.dropdown.style.display="none",r.inputRight.style.display="none",r.inputRight.style.transform="rotate(135deg)";return}if(!u.dropdownList.length){var s=document.createElement("div");s.innerText="None",s.style.padding="5px 12px",s.style.color="#ddd",r.dropdown.appendChild(s);return}var c=r.input.value,h=0;try{for(var f=Le(u.dropdownList),d=f.next();!d.done;d=f.next()){var v=d.value,g=typeof v=="string"?v:v.text;o&&c?g.includes(c)&&r.dropdownAppendOption(g,h):r.dropdownAppendOption(g,h),++h}}catch(p){a={error:p}}finally{try{d&&!d.done&&(l=f.return)&&l.call(f)}finally{if(a)throw a.error}}if(!r.dropdown.hasChildNodes()){var s=document.createElement("div");s.innerText="None",s.style.padding="5px 12px",s.style.color="#ddd",r.dropdown.appendChild(s)}}},this.selectDropdown=function(o){var a=o.target,l=r.store.pens[r.input.dataset.penId];if(!(!a||!l||!l.dropdownList)){var u=+a.dataset.i,s=l.dropdownList[u];if(!!s){var c=[se(l,!0)];typeof s=="object"?(r.updateValue(l,qe({},s)),l.calculative.text=void 0,r.calcActiveRect()):l.text=s+"",r.input.value=l.text,r.hideInput(),r.pushHistory({type:de.Update,pens:[se(l,!0)],initPens:c}),r.render(),r.store.emitter.emit("valueUpdate",l)}}},this.canvasImageBottom=new ra(i,n,!0),i.appendChild(this.canvas),this.canvas.style.position="absolute",this.canvas.style.backgroundRepeat="no-repeat",this.canvas.style.backgroundSize="100% 100%",this.canvasImage=new ra(i,n),this.magnifierCanvas=new qf(this,i,n),this.externalElements.style.position="absolute",this.externalElements.style.left="0",this.externalElements.style.top="0",this.externalElements.style.outline="none",this.externalElements.style.background="transparent",i.style.position="relative",i.appendChild(this.externalElements),this.createInput(),this.tooltip=new Uf(i,n),this.store.options.scroll&&(this.scroll=new Hf(this)),this.store.dpiRatio=window?window.devicePixelRatio:1,this.store.dpiRatio<1?this.store.dpiRatio=1:this.store.dpiRatio>1&&this.store.dpiRatio<1.5&&(this.store.dpiRatio=1.5),this.clientRect=this.externalElements.getBoundingClientRect(),this.listen(),window&&window.addEventListener("resize",this.onResize),window&&window.addEventListener("scroll",this.onScroll)}return e.prototype.listen=function(){var t=this;switch(this.externalElements.addEventListener("gesturestart",this.onGesturestart),this.externalElements.ondragover=function(i){return i.preventDefault()},this.externalElements.ondrop=this.ondrop,this.externalElements.oncontextmenu=function(i){return i.preventDefault()},Bo()?(this.store.options.interval=50,this.externalElements.ontouchstart=this.ontouchstart,this.externalElements.ontouchmove=this.ontouchmove,this.externalElements.ontouchend=this.ontouchend):(this.externalElements.onmousedown=function(i){t.onMouseDown({x:i.offsetX,y:i.offsetY,clientX:i.clientX,clientY:i.clientY,pageX:i.pageX,pageY:i.pageY,ctrlKey:i.ctrlKey||i.metaKey,shiftKey:i.shiftKey,altKey:i.altKey,buttons:i.buttons})},this.externalElements.onmousemove=function(i){t.onMouseMove({x:i.offsetX,y:i.offsetY,clientX:i.clientX,clientY:i.clientY,pageX:i.pageX,pageY:i.pageY,ctrlKey:i.ctrlKey||i.metaKey,shiftKey:i.shiftKey,altKey:i.altKey,buttons:i.buttons})},this.externalElements.onmouseup=function(i){t.onMouseUp({x:i.offsetX,y:i.offsetY,clientX:i.clientX,clientY:i.clientY,pageX:i.pageX,pageY:i.pageY,ctrlKey:i.ctrlKey||i.metaKey,shiftKey:i.shiftKey,altKey:i.altKey,buttons:i.buttons,button:i.button})},this.externalElements.onmouseleave=function(i){i.toElement!==t.tooltip.box&&(t.tooltip.hide(),t.store.lastHover=void 0)}),this.externalElements.ondblclick=this.ondblclick,this.externalElements.tabIndex=0,this.externalElements.onblur=function(){t.mouseDown=void 0},this.externalElements.onwheel=this.onwheel,this.store.options.keydown){case Ft.Document:document.addEventListener("keydown",this.onkeydown),document.addEventListener("keyup",this.onkeyup);break;case Ft.Canvas:this.externalElements.addEventListener("keydown",this.onkeydown),this.externalElements.addEventListener("keyup",this.onkeyup);break}},e.prototype.splitLine=function(t,i){var n=t.calculative.worldAnchors,r=n.findIndex(function(c){return c===i});if(![-1,0,n.length-1].includes(r)){var o=se(t,!0),a=se(t,!0),l=be();a.id=l,a.calculative.canvas=this,a.calculative.active=!1,a.calculative.hover=!1;var u=se(n.slice(0,r+1)),s=se(n.slice(r)).map(function(c){return c.penId=l,c});t.calculative.worldAnchors=u,a.calculative.worldAnchors=s,this.initLineRect(t),this.initLineRect(a),this.store.data.pens.push(a),this.store.pens[l]=a,this.pushHistory({type:de.Add,pens:[se(a,!0)],step:2}),this.pushHistory({type:de.Update,initPens:[o],pens:[se(t,!0)],step:2})}},e.prototype.translateAnchor=function(t,i){var n=this;this.movingAnchor.x+=t,this.movingAnchor.y+=i;var r=this.movingAnchor.penId;if(r){var o=this.store.pens[r],a=o.calculative.worldRect;this.movingAnchor.x<a.x?this.movingAnchor.x=a.x:this.movingAnchor.x>a.ex&&(this.movingAnchor.x=a.ex),this.movingAnchor.y<a.y?this.movingAnchor.y=a.y:this.movingAnchor.y>a.ey&&(this.movingAnchor.y=a.ey);var l=si(this.movingAnchor,a),u=o.anchors.findIndex(function(s){return s.id===n.movingAnchor.id});o.anchors[u]=l,this.dirty=!0}},e.prototype.fileToPen=function(t,i){return st(this,void 0,void 0,function(){var n;return lt(this,function(r){switch(r.label){case 0:return n="",this.store.options.uploadFn?[4,this.store.options.uploadFn(t)]:[3,2];case 1:return n=r.sent(),[3,6];case 2:return this.store.options.uploadUrl?[4,Yu(t,this.store.options.uploadUrl,this.store.options.uploadParams,this.store.options.uploadHeaders)]:[3,4];case 3:return n=r.sent(),[3,6];case 4:return[4,$u(t)];case 5:n=r.sent(),r.label=6;case 6:return[2,new Promise(function(o,a){var l=new Image;l.onload=function(){he.htmlElements[n]=l,o({width:l.width,height:l.height,name:i?"gif":"image",image:n})},l.onerror=function(u){a(u)},l.src=n})]}})})},e.prototype.dropPens=function(t,i){return st(this,void 0,void 0,function(){var n,r,s,o,a,s,l,u,s,c,h,f,d,v,g;return lt(this,function(p){switch(p.label){case 0:try{for(n=Le(t),r=n.next();!r.done;r=n.next())s=r.value,!s.parentId&&this.randomCombineId(s,t)}catch(b){c={error:b}}finally{try{r&&!r.done&&(h=n.return)&&h.call(n)}finally{if(c)throw c.error}}try{for(o=Le(t),a=o.next();!a.done;a=o.next())s=a.value,s.id||(s.id=be()),!s.calculative&&(s.calculative={canvas:this}),this.store.pens[s.id]=s}catch(b){f={error:b}}finally{try{a&&!a.done&&(d=o.return)&&d.call(o)}finally{if(f)throw f.error}}try{for(l=Le(t),u=l.next();!u.done;u=l.next())s=u.value,s.parentId||(s.width*=this.store.data.scale,s.height*=this.store.data.scale,s.x=i.x-s.width/2,s.y=i.y-s.height/2)}catch(b){v={error:b}}finally{try{u&&!u.done&&(g=l.return)&&g.call(l)}finally{if(v)throw v.error}}return[4,this.addPens(t,!0)];case 1:return p.sent(),this.active(t.filter(function(b){return!b.parentId})),this.render(),this.externalElements.focus(),[2]}})})},e.prototype.randomCombineId=function(t,i,n){var r,o;zo(t),t.parentId=n;var a=[];if(Array.isArray(t.children)){var l=function(f){var d=i.find(function(v){return v.id===f});d&&a.push(u.randomCombineId(d,i,t.id).id)},u=this;try{for(var s=Le(t.children),c=s.next();!c.done;c=s.next()){var h=c.value;l(h)}}catch(f){r={error:f}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}}return t.children=a,t},e.prototype.addPens=function(t,i){return st(this,void 0,void 0,function(){var n,r,o,a,l,u,s;return lt(this,function(c){switch(c.label){case 0:return n=this.beforeAddPens,n?[4,this.beforeAddPens(t)]:[3,2];case 1:n=c.sent()!=!0,c.label=2;case 2:if(n)return[2,[]];r=[];try{for(o=Le(t),a=o.next();!a.done;a=o.next())l=a.value,!(this.beforeAddPen&&this.beforeAddPen(l)!=!0)&&(this.makePen(l),r.push(l))}catch(h){u={error:h}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(u)throw u.error}}return this.render(),this.store.emitter.emit("add",r),i&&this.pushHistory({type:de.Add,pens:se(r,!0)}),[2,r]}})})},e.prototype.getInitPencilLine=function(t){var i=this.store,n=i.data,r=i.options,o=n.scale,a=n.lineWidth||1;return{id:t.penId,name:"line",x:t.x,y:t.y,type:Pe.Line,calculative:{canvas:this,pencil:!0,active:!0,worldAnchors:[t],lineWidth:a*o},fromArrow:n.fromArrow||r.fromArrow,toArrow:n.toArrow||r.toArrow,lineWidth:a}},e.prototype.createDrawingLine=function(t){var i=this.store,n=i.data,r=i.options,o=n.scale,a=n.lineWidth||1;return t.penId=be(),{id:t.penId,name:"line",lineName:this.drawingLineName,x:t.x,y:t.y,type:Pe.Line,calculative:{canvas:this,active:!0,worldAnchors:[t],lineWidth:a*o},fromArrow:n.fromArrow||r.fromArrow,toArrow:n.toArrow||r.toArrow,lineWidth:a}},e.prototype.addRuleLine=function(t){var i=this.store.data,n=i.x,r=i.y,o=t.x+n,a=t.y+r,l=t.x,u=t.y,s=0,c=0,h=0,f=0;if(o<=a&&o<20)l=-n,s=this.width,h=1;else if(a<o&&a<20)u=-r,c=this.height,f=1;else return;this.addPen({isRuleLine:!0,locked:Ce.DisableMove,type:Pe.Line,name:"line",lineName:"line",x:l,y:u,width:s,height:c,color:this.store.options.ruleLineColor,anchors:[{x:0,y:0},{x:h,y:f}]})},e.prototype.movedActivePens=function(){var t=this,i=se(this.store.active,!0);this.store.active.forEach(function(n,r){var o,a=t.movingPens[r],l=a.x,u=a.y;Object.assign(n,{x:l,y:u}),(o=n.onMove)===null||o===void 0||o.call(n,n),t.dirtyPenRect(n),t.updateLines(n),t.dirtyLines.forEach(function(s){s.type&&t.initLineRect(s)}),t.dirtyLines.clear(),n.calculative.x=n.x,n.calculative.y=n.y,n.calculative.initRect&&(n.calculative.initRect.x=n.calculative.x,n.calculative.initRect.y=n.calculative.y,n.calculative.initRect.ex=n.calculative.x+n.calculative.width,n.calculative.initRect.ey=n.calculative.y+n.calculative.height)}),this.store.emitter.emit("active",this.store.active),this.initImageCanvas(this.store.active),this.pushHistory({type:de.Update,pens:se(this.store.active,!0),initPens:i})},e.prototype.copyMovedPens=function(){var t=this;this.copy(this.store.active.map(function(i,n){var r=t.movingPens[n],o=r.x,a=r.y;return qe(qe({},i),{x:o,y:a})})),this.pasteOffset=0,this.paste(),this.alreadyCopy=!1},e.prototype.initImageCanvas=function(t){var i=this;t.some(function(n){return i.hasImage(n,!1)})&&this.canvasImage.init(),t.some(function(n){return i.hasImage(n,!0)})&&this.canvasImageBottom.init()},e.prototype.hasImage=function(t,i){var n=this,r;return t.image&&t.name!=="gif"&&!t.isBottom==!i?!0:(r=t.children)===null||r===void 0?void 0:r.some(function(o){var a=n.store.pens[o];return a&&n.hasImage(a,i)})},e.prototype.inactive=function(t){!this.store.active.length||(this.store.active.forEach(function(i){i.calculative.active=void 0,i.calculative.activeAnchor=void 0,Jt(i,!1)}),!t&&this.store.emitter.emit("inactive",this.store.active),this.store.active=[],this.activeRect=void 0,this.sizeCPs=void 0,this.store.activeAnchor=void 0,this.dirty=!0)},e.prototype.active=function(t,i){var n,r,o;if(i===void 0&&(i=!0),this.store.active)try{for(var a=Le(this.store.active),l=a.next();!l.done;l=a.next()){var u=l.value;u.calculative.active=void 0,Jt(u,!1)}}catch(s){n={error:s}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}this.store.active=[],t.forEach(function(s){s.calculative.active=!0,Jt(s)}),(o=this.store.active).push.apply(o,ut([],ct(t),!1)),this.calcActiveRect(),this.dirty=!0,i&&this.store.emitter.emit("active",this.store.active)},e.prototype.getSizeCPs=function(){var t=this;this.sizeCPs=bt(this.activeRect);var i=[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1},{x:0,y:.5}],n=this.activeRect,r=n.x,o=n.y,a=n.width,l=n.height,u=n.rotate,s=n.center;i.forEach(function(c){var h={x:c.x*a+r,y:c.y*l+o};Re(h,u,s),t.sizeCPs.push(h)})},e.prototype.clearHover=function(){this.hoverType=ce.None,this.store.hover=null,this.store.hoverAnchor=null},e.prototype.inAnchor=function(t,i,n){if(this.store.hoverAnchor=void 0,this.movingAnchor=void 0,!n||this.store.options.disableAnchor||i.disableAnchor)return ce.None;if(Qt(t,n,this.pointSize))return n!==this.store.hoverAnchor&&(this.dirty=!0),this.store.hoverAnchor=n,this.store.hover=i,i.type?n.connectTo&&!i.calculative.active&&(this.store.hover=this.store.pens[n.connectTo],this.store.hover)?(this.store.hoverAnchor=this.store.hover.calculative.worldAnchors.find(function(r){return r.id===n.anchorId}),this.externalElements.style.cursor="crosshair",ce.NodeAnchor):(this.hotkeyType===Te.AddAnchor?this.externalElements.style.cursor="vertical-text":this.externalElements.style.cursor="pointer",ce.LineAnchor):(this.hotkeyType===Te.AddAnchor?this.externalElements.style.cursor="vertical-text":this.externalElements.style.cursor="crosshair",ce.NodeAnchor);if(!this.mouseDown&&i.type){if(i.calculative.active&&n.prev&&Qt(t,n.prev,this.pointSize))return this.store.hoverAnchor=n,this.store.hover=i,this.externalElements.style.cursor="pointer",ce.LineAnchorPrev;if(i.calculative.active&&n.next&&Qt(t,n.next,this.pointSize))return this.store.hoverAnchor=n,this.store.hover=i,this.externalElements.style.cursor="pointer",ce.LineAnchorNext}return ce.None},e.prototype.resize=function(t,i){t=t||this.parentElement.clientWidth,i=i||this.parentElement.clientHeight,this.width=t,this.height=i,this.canvasRect={x:0,y:0,width:t,height:i},Ne(this.canvasRect),this.canvas.style.width=t+"px",this.canvas.style.height=i+"px",this.externalElements.style.width=t+"px",this.externalElements.style.height=i+"px",this.canvasImage.resize(t,i),this.canvasImageBottom.resize(t,i),this.magnifierCanvas.resize(t,i),t=t*this.store.dpiRatio|0,i=i*this.store.dpiRatio|0,this.canvas.width=t,this.canvas.height=i,this.offscreen.width=t,this.offscreen.height=i,this.clientRect=this.externalElements.getBoundingClientRect(),this.canvas.getContext("2d").scale(this.store.dpiRatio,this.store.dpiRatio),this.offscreen.getContext("2d").scale(this.store.dpiRatio,this.store.dpiRatio),this.offscreen.getContext("2d").textBaseline="middle",this.render()},e.prototype.clearCanvas=function(){this.activeRect=void 0,this.sizeCPs=void 0,this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.offscreen.getContext("2d").clearRect(0,0,this.offscreen.width,this.offscreen.height),this.canvasImage.clear(),this.canvasImageBottom.clear()},e.prototype.addPen=function(t,i){return st(this,void 0,void 0,function(){var n;return lt(this,function(r){switch(r.label){case 0:return n=this.beforeAddPens,n?[4,this.beforeAddPens([t])]:[3,2];case 1:n=r.sent()!=!0,r.label=2;case 2:return n?[2]:this.beforeAddPen&&this.beforeAddPen(t)!=!0?[2]:(this.makePen(t),this.active([t]),this.render(),this.store.emitter.emit("add",[t]),i&&this.pushHistory({type:de.Add,pens:[t]}),[2,t])}})})},e.prototype.pushHistory=function(t){var i=this;if(!this.store.data.locked){var n=this.store.data,r=n.origin,o=n.scale;t.origin=se(r),t.scale=o,t.type!==de.Update&&t.pens&&t.pens.forEach(function(a){a.calculative.layer=i.store.data.pens.findIndex(function(l){return l.id===a.id})}),this.store.historyIndex<this.store.histories.length-1&&this.store.histories.splice(this.store.historyIndex+1,this.store.histories.length-this.store.historyIndex-1),this.store.histories.push(t),this.store.historyIndex=this.store.histories.length-1,this.store.emitter.emit("update",{previous:t.initPens,current:t.pens})}},e.prototype.undo=function(){if(!(this.store.data.locked||this.store.historyIndex==null||this.store.historyIndex<0)){var t=this.store.histories[this.store.historyIndex--];this.doEditAction(t,!0);for(var i=t.step;i>1;){var n=this.store.histories[this.store.historyIndex--];this.doEditAction(n,!0),i--}}},e.prototype.redo=function(){if(!(this.store.data.locked||this.store.historyIndex==null||this.store.historyIndex>this.store.histories.length-2)){var t=this.store.histories[++this.store.historyIndex];this.doEditAction(t,!1);for(var i=t.step;i>1;){var n=this.store.histories[++this.store.historyIndex];this.doEditAction(n,!1),i--}}},e.prototype.doEditAction=function(t,i){var n=this;switch(this.inactive(),this.store.hoverAnchor=void 0,this.store.hover=void 0,t.type){case de.Add:t.pens.forEach(function(o){var a,l=se(o,!0),u=n.store.data.pens.findIndex(function(s){return s.id===l.id});u>-1&&(n.store.data.pens.splice(u,1),n.store.pens[l.id]=void 0,l.calculative.canvas=n,n.store.animates.delete(l),(a=l.onDestroy)===null||a===void 0||a.call(l,l))}),t.type=de.Delete;break;case de.Update:var r=i?t.initPens:t.pens;r.forEach(function(o){var a=se(o,!0),l=n.store.data.pens.findIndex(function(c){return c.id===a.id});if(l>-1){a.calculative=n.store.data.pens[l].calculative,n.store.data.pens[l]=a,n.store.pens[a.id]=a;for(var u in a)(typeof a[u]!="object"||u==="lineDash")&&(a.calculative[u]=a[u]);a.calculative.image=void 0;var s=n.getPenRect(a,t.origin,t.scale);n.setPenRect(a,s,!1),n.updateLines(a,!0)}});break;case de.Delete:t.pens.forEach(function(o){var a=se(o,!0);n.store.data.pens.splice(a.calculative.layer,0,a),n.store.pens[a.id]=a,a.calculative.canvas=n}),t.pens.forEach(function(o){var a=n.store.pens[o.id],l=n.getPenRect(a,t.origin,t.scale);n.setPenRect(a,l,!1),a.calculative.image=void 0,a.calculative.backgroundImage=void 0,a.calculative.strokeImage=void 0,n.loadImage(a)}),t.type=de.Add;break}t.type===de.Update?this.initImageCanvas(ut(ut([],ct(t.pens),!1),ct(t.initPens),!1)):this.initImageCanvas(t.pens),this.render(),this.store.emitter.emit(i?"undo":"redo",t)},e.prototype.makePen=function(t){var i=this;if(t.id||(t.id=be()),this.store.data.pens.push(t),this.store.pens[t.id]=t,t.path){!t.pathId&&(t.pathId=be());var n=this.store.data.paths;!n[t.pathId]&&(n[t.pathId]=t.path),t.path=void 0}t.lineWidth==null&&(t.lineWidth=1);var r=this.store.options,o=r.fontSize,a=r.lineHeight;t.fontSize||(t.fontSize=o),t.lineHeight||(t.lineHeight=a),t.calculative={canvas:this},(t.video||t.audio)&&(t.calculative.onended=function(u){i.nextAnimate(u)});for(var l in t)(typeof t[l]!="object"||l==="lineDash")&&(t.calculative[l]=t[l]);t.calculative.image=void 0,t.calculative.backgroundImage=void 0,t.calculative.strokeImage=void 0,!t.anchors&&he.anchors[t.name]&&(t.anchors||(t.anchors=[]),he.anchors[t.name](t)),this.dirtyPenRect(t),t.type?this.initLineRect(t):t.anchors||(t.anchors=t.calculative.worldAnchors.map(function(u){return si(u,t.calculative.worldRect)})),!t.rotate&&(t.rotate=0),this.loadImage(t)},e.prototype.drawline=function(t){var i;!this.drawingLine||((i=this[this.drawingLineName])===null||i===void 0||i.call(this,this.store,this.drawingLine,t),this.store.path2dMap.set(this.drawingLine,he.path2dDraws.line(this.drawingLine)),this.dirty=!0)},e.prototype.initLineRect=function(t){var i=Yo(t);t.parentId||Object.assign(t,i);var n=this.store.options,r=n.fontSize,o=n.lineHeight;t.fontSize||(t.fontSize=r,t.calculative.fontSize=t.fontSize*this.store.data.scale),t.lineHeight||(t.lineHeight=o,t.calculative.lineHeight=t.lineHeight),Ie(i),t.calculative.worldRect=i,vs(t,i),xr(t),Rr(t),this.store.path2dMap.set(t,he.path2dDraws[t.name](t)),t.calculative.worldAnchors&&(t.anchors=t.calculative.worldAnchors.map(function(a){return si(a,t.calculative.worldRect)}))},e.prototype.drawingPencil=function(){Cs(this.store),this.pencil=!0,this.externalElements.style.cursor="crosshair"},e.prototype.stopPencil=function(){this.pencil=!1,this.pencilLine=void 0,this.externalElements.style.cursor="default"},e.prototype.finishDrawline=function(t){return st(this,void 0,void 0,function(){var i,n,r,o,a,l;return lt(this,function(u){switch(u.label){case 0:if(!this.drawingLine)return[2];if(i=Oe(this.drawingLine),n=Ae(this.drawingLine),n.isTemp&&(this.drawingLine.calculative.worldAnchors.pop(),n=Ae(this.drawingLine)),!t&&(!n.connectTo&&this.drawingLine.calculative.worldAnchors.pop(),Oe(this.drawingLine)===this.drawingLine.calculative.activeAnchor))return this.drawingLine=void 0,this.render(),[2];if(!i.connectTo||!n.connectTo){if(this.store.options.disableEmptyLine)return this.drawingLine=void 0,this.render(),[2]}else if(this.store.options.disableRepeatLine&&(r=this.store.data.pens.find(function(s){if(s.type){var c=Oe(s),h=Ae(s);return Ro(c,i)&&Ro(h,n)}}),r))return this.drawingLine=void 0,this.render(),[2];return o=Yo(this.drawingLine),Object.assign(this.drawingLine,o),this.drawingLine.calculative.worldRect=o,this.drawingLine.calculative.activeAnchor=Ae(this.drawingLine),this.store.activeAnchor=this.drawingLine.calculative.activeAnchor,l=!this.beforeAddPens,l?[3,2]:[4,this.beforeAddPens([this.drawingLine])];case 1:l=u.sent(),u.label=2;case 2:return a=l&&(!this.beforeAddPen||this.beforeAddPen(this.drawingLine)),a&&(this.initLineRect(this.drawingLine),this.store.data.pens.push(this.drawingLine),this.store.pens[this.drawingLine.id]=this.drawingLine,this.store.emitter.emit("add",[this.drawingLine]),this.active([this.drawingLine]),this.pushHistory({type:de.Add,pens:se([this.drawingLine],!0)})),this.store.path2dMap.set(this.drawingLine,he.path2dDraws[this.drawingLine.name](this.drawingLine)),this.drawingLine=void 0,this.drawingLineName=void 0,this.render(),[2]}})})},e.prototype.finishPencil=function(){return st(this,void 0,void 0,function(){var t,i,n,r;return lt(this,function(o){switch(o.label){case 0:return this.pencilLine?(t=An(this.pencilLine.calculative.worldAnchors,10,0,this.pencilLine.calculative.worldAnchors.length-1),i=Oe(this.pencilLine),t.unshift({id:i.id,penId:i.penId,x:i.x,y:i.y}),i=Ae(this.pencilLine),t.push({id:i.id,penId:i.penId,x:i.x,y:i.y}),this.pencilLine.calculative.worldAnchors=mf(t),this.pencilLine.calculative.worldAnchors.length>1?(this.pencilLine.calculative.pencil=!1,this.store.path2dMap.set(this.pencilLine,he.path2dDraws[this.pencilLine.name](this.pencilLine)),r=!this.beforeAddPens,r?[3,2]:[4,this.beforeAddPens([this.pencilLine])]):[3,3]):[3,4];case 1:r=o.sent(),o.label=2;case 2:n=r&&(!this.beforeAddPen||this.beforeAddPen(this.pencilLine)),n&&(this.initLineRect(this.pencilLine),this.store.data.pens.push(this.pencilLine),this.store.pens[this.pencilLine.id]=this.pencilLine,this.store.emitter.emit("add",[this.pencilLine]),this.active([this.pencilLine]),this.pushHistory({type:de.Add,pens:se([this.pencilLine],!0)})),o.label=3;case 3:this.pencilLine=void 0,this.render(),o.label=4;case 4:return[2]}})})},e.prototype.firefoxLoadSvg=function(t){var i=this,n=new Image,r=new XMLHttpRequest;r.open("GET",t.image,!0),r.onload=function(){var o=new DOMParser,a=o.parseFromString(r.responseText,"text/xml"),l=a.getElementsByTagName("svg")[0],u=t.calculative.worldRect,s=u.width,c=u.height;l.setAttribute("width",s+"px"),l.setAttribute("height",c+"px");var h=btoa(unescape(encodeURIComponent(new XMLSerializer().serializeToString(l)))),f="data:image/svg+xml;base64,"+h;n.src=f,n.onload=function(){t.calculative.img=n,t.calculative.imgNaturalWidth=n.naturalWidth||t.iconWidth,t.calculative.imgNaturalHeight=n.naturalHeight||t.iconHeight,he.htmlElements[t.image]=n,i.imageLoaded()}},r.send()},e.prototype.loadImage=function(t){var i=this;if(t.image!==t.calculative.image){if(t.calculative.img=void 0,t.image)if(he.htmlElements[t.image]){var n=he.htmlElements[t.image];t.calculative.img=n,t.calculative.imgNaturalWidth=n.naturalWidth||t.iconWidth,t.calculative.imgNaturalHeight=n.naturalHeight||t.iconHeight,this.imageLoaded()}else if(navigator.userAgent.includes("Firefox")&&t.image.endsWith(".svg"))this.firefoxLoadSvg(t);else{var r=new Image;r.crossOrigin="anonymous",r.src=t.image,r.onload=function(){t.calculative.img=r,t.calculative.imgNaturalWidth=r.naturalWidth||t.iconWidth,t.calculative.imgNaturalHeight=r.naturalHeight||t.iconHeight,he.htmlElements[t.image]=r,i.imageLoaded()}}t.calculative.image=t.image}if(t.backgroundImage!==t.calculative.backgroundImage){if(t.calculative.backgroundImg=void 0,t.backgroundImage)if(he.htmlElements[t.backgroundImage]){var n=he.htmlElements[t.backgroundImage];t.calculative.backgroundImg=n}else{var o=new Image;o.crossOrigin="anonymous",o.src=t.backgroundImage,o.onload=function(){t.calculative.backgroundImg=o,he.htmlElements[t.backgroundImage]=o,i.imageLoaded()}}t.calculative.backgroundImage=t.backgroundImage}if(t.strokeImage!==t.calculative.strokeImage){if(t.calculative.strokeImg=void 0,t.strokeImage)if(he.htmlElements[t.strokeImage]){var n=he.htmlElements[t.strokeImage];t.calculative.strokeImg=n}else{var a=new Image;a.crossOrigin="anonymous",a.src=t.strokeImage,a.onload=function(){t.calculative.strokeImg=a,he.htmlElements[t.strokeImage]=a,i.imageLoaded()}}t.calculative.strokeImage=t.strokeImage}},e.prototype.imageLoaded=function(){var t=this;this.imageTimer&&clearTimeout(this.imageTimer),this.imageTimer=setTimeout(function(){t.canvasImage.init(),t.canvasImageBottom.init(),t.render()},100)},e.prototype.setCalculativeByScale=function(t){var i=this.store.data.scale;t.calculative.lineWidth=t.lineWidth*i,t.calculative.fontSize=t.fontSize*i,t.fontSize<1&&(t.calculative.fontSize=t.fontSize*t.calculative.worldRect.height),t.calculative.iconSize=t.iconSize*i,t.calculative.iconWidth=t.iconWidth*i,t.calculative.iconHeight=t.iconHeight*i,t.calculative.iconLeft=t.iconLeft*i,t.calculative.iconTop=t.iconTop*i,t.calculative.textWidth=t.textWidth*i,t.calculative.textHeight=t.textHeight*i,t.calculative.textLeft=t.textLeft*i,t.calculative.textTop=t.textTop*i,t.type===Pe.Line&&t.borderWidth&&(t.calculative.borderWidth=t.borderWidth*i)},e.prototype.dirtyPenRect=function(t,i){var n=this,r=i===void 0?{}:i,o=r.worldRectIsReady,a=r.playingAnimate;o?Vi(t):ds(t),a||this.setCalculativeByScale(t),mi(t),Do(this.store.pens,t),xr(t),Rr(t),he.path2dDraws[t.name]&&this.store.path2dMap.set(t,he.path2dDraws[t.name](t)),t.calculative.dirty=!0,this.dirty=!0,t.children&&t.children.forEach(function(l){var u=n.store.pens[l];u&&n.dirtyPenRect(u,{worldRectIsReady:!1})}),t.type&&this.initLineRect(t)},e.prototype.translate=function(t,i){t===void 0&&(t=0),i===void 0&&(i=0),this.store.data.x+=t*this.store.data.scale,this.store.data.y+=i*this.store.data.scale,this.store.data.x=Math.round(this.store.data.x),this.store.data.y=Math.round(this.store.data.y),this.canvasImage.init(),this.canvasImageBottom.init(),this.render(),this.store.emitter.emit("translate",{x:this.store.data.x,y:this.store.data.y}),this.tooltip.translate(t,i),this.scroll&&this.scroll.isShow&&this.scroll.translate(t,i),this.onMovePens()},e.prototype.onMovePens=function(){var t,i,n,r=this.parent.map;r&&r.isShow&&r.setView();try{for(var o=Le(this.store.data.pens),a=o.next();!a.done;a=o.next()){var l=a.value;Rr(l),(n=l.onMove)===null||n===void 0||n.call(l,l),l.isRuleLine&&(l.width?l.height||(l.x=-this.store.data.x):l.y=-this.store.data.y,this.dirtyPenRect(l))}}catch(u){t={error:u}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}},e.prototype.scale=function(t,i){var n=this;i===void 0&&(i={x:0,y:0});var r=this.store.options,o=r.minScale,a=r.maxScale;if(!(t<o||t>a)){this.calibrateMouse(i);var l=t/this.store.data.scale;this.store.data.scale=t,this.store.data.center=i,Kn(this.store.data.origin,l,i),this.store.data.pens.forEach(function(s){if(!s.parentId){if(Ki(s,l,i),s.isRuleLine){var c=l>1?1:1/l/l,h=s.calculative.worldRect.center;s.width&&s.height||Ki(s,c,h)}n.dirtyPenRect(s,{worldRectIsReady:!0}),n.execPenResize(s)}}),this.calcActiveRect(),this.canvasImage.init(),this.canvasImageBottom.init();var u=this.parent.map;u&&u.isShow&&u.setView(),this.render(),this.store.emitter.emit("scale",this.store.data.scale)}},e.prototype.rotatePens=function(t){var i,n,r=this;this.initPens||(this.initPens=se(this.getAllByPens(this.store.active))),this.activeRect.rotate=Ge(t,this.activeRect.center),this.store.active.length===1&&(this.lastRotate=this.store.active[0].rotate||0);var o=this.activeRect.rotate-this.lastRotate;try{for(var a=Le(this.store.active),l=a.next();!l.done;l=a.next()){var u=l.value;if(u.parentId)return;this.rotatePen(u,o,this.activeRect),u.onRotate&&u.onRotate(u),this.updateLines(u)}}catch(s){i={error:s}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}this.lastRotate=this.activeRect.rotate,this.getSizeCPs(),this.initImageCanvas(this.store.active),this.render(),this.store.emitter.emit("rotatePens",this.store.active),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){r.timer=void 0,r.pushHistory({type:de.Update,pens:se(r.getAllByPens(r.store.active)),initPens:r.initPens}),r.initPens=void 0},200)},e.prototype.resizePens=function(t){var i=this;if(this.initPens||(this.initPens=se(this.store.active,!0)),!this.initActiveRect){this.initActiveRect=se(this.activeRect);return}var n={x:this.mouseDown.x,y:this.mouseDown.y},r={x:t.x,y:t.y},o=r.x-n.x,a=r.y-n.y,l=se(this.initActiveRect);if(Uo(l,o,a,this.resizeIndex),Ie(l),!this.store.options.disableDockLine){this.clearDock();var u=this.customeResizeDock||vh;this.dock=u(this.store,l,this.store.active,this.resizeIndex);var s=this.dock,c=s.xDock,h=s.yDock;if(c){o+=c.step;var f=this.store.pens[c.penId];f.calculative.isDock=!0}if(h){a+=h.step;var f=this.store.pens[h.penId];f.calculative.isDock=!0}}var d=this.activeRect.width,v=this.activeRect.height,g=o-this.lastOffsetX,p=a-this.lastOffsetY;if(this.lastOffsetX=o,this.lastOffsetY=a,t.ctrlKey){var b=[1,3].includes(this.resizeIndex)?-1:1;p=b*(g*v)/d}Uo(this.activeRect,g,p,this.resizeIndex),Ie(this.activeRect);var x=this.activeRect.width/d,m=this.activeRect.height/v;this.store.active.forEach(function(_,P){_.calculative.worldRect.x=i.activeInitPos[P].x*i.activeRect.width+i.activeRect.x,_.calculative.worldRect.y=i.activeInitPos[P].y*i.activeRect.height+i.activeRect.y,_.calculative.worldRect.width*=x,_.calculative.iconWidth&&(_.calculative.iconWidth*=x),_.calculative.worldRect.height*=m,_.calculative.iconHeight&&(_.calculative.iconHeight*=m),Ne(_.calculative.worldRect),Ie(_.calculative.worldRect),i.dirtyPenRect(_,{worldRectIsReady:!0}),i.execPenResize(_),i.updateLines(_)}),this.getSizeCPs(),this.initImageCanvas(this.store.active),this.render(),this.store.emitter.emit("resizePens",this.store.active),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){i.timer=void 0,i.pushHistory({type:de.Update,pens:se(i.store.active,!0),initPens:i.initPens}),i.initPens=void 0},200)},e.prototype.movePens=function(t){if(!(!this.activeRect||this.store.data.locked)){if(!this.initActiveRect){this.initActiveRect=se(this.activeRect);return}this.movingPens||(this.initMovingPens(),this.store.active.forEach(function(h){ni(h,!1)}),this.store.hover=void 0);var i=t.x-this.mouseDown.x,n=t.y-this.mouseDown.y;t.shiftKey&&!t.ctrlKey&&(i=0),t.altKey&&(n=0);var r=se(this.initActiveRect);zt(r,i,n);var o={x:r.x-this.activeRect.x,y:r.y-this.activeRect.y};if(!this.store.options.disableDockLine){this.clearDock();var a=this.customeMoveDock||dh;this.dock=a(this.store,r,this.movingPens,o);var l=this.dock,u=l.xDock,s=l.yDock;if(u){o.x+=u.step;var c=this.store.pens[u.penId];c.calculative.isDock=!0}if(s){o.y+=s.step;var c=this.store.pens[s.penId];c.calculative.isDock=!0}}this.translatePens(this.movingPens,o.x,o.y,!0)}},e.prototype.changeIdsByMoving=function(t,i){t.id+=Ot,t.parentId&&i.find(function(n){return n.id===t.parentId})&&(t.parentId+=Ot),t.children&&(t.children=t.children.map(function(n){return n+Ot})),t.connectedLines&&(t.connectedLines=t.connectedLines.map(function(n){return i.find(function(r){return r.id===n.lineId})&&(n.lineId+=Ot),n})),t.type&&t.calculative.worldAnchors&&(t.calculative.worldAnchors=t.calculative.worldAnchors.map(function(n){return n.connectTo&&i.find(function(r){return r.id===n.connectTo})&&(n.connectTo+=Ot),n}))},e.prototype.initMovingPens=function(){var t=this;this.movingPens=se(this.store.active,!0);var i=this.getAllByPens(this.movingPens),n=se(i,!0);i.forEach(function(r){t.changeIdsByMoving(r,n),t.store.pens[r.id]=r,r.calculative.canvas=t;var o={globalAlpha:.5};r.lineWidth===0&&(o.lineWidth=1),(uu.includes(r.name)||r.image)&&(o.name="rectangle",o.onDestroy=void 0),t.updateValue(r,o),r.calculative.image=void 0})},e.prototype.moveLineAnchor=function(t){var i=this,n,r,o;if(!(!this.activeRect||this.store.data.locked)){if(this.initPens||(this.initPens=se(this.store.active,!0)),!((n=this.store.activeAnchor)===null||n===void 0)&&n.connectTo){var a=this.store.pens[this.store.activeAnchor.connectTo];Pr(a,Gt(a,this.store.activeAnchor.anchorId),this.store.pens[this.store.activeAnchor.penId],this.store.activeAnchor)}var l=t.x-this.mouseDown.x,u=t.y-this.mouseDown.y,s=l-this.lastOffsetX,c=u-this.lastOffsetY;this.lastOffsetX=l,this.lastOffsetY=u,Er(this.store.activeAnchor,s,c);var h=this.store.active[0],f=Oe(h),d=Ae(h);h.autoPolyline!==!1&&this.store.activeAnchor!==f&&this.store.activeAnchor!==d&&(h.autoPolyline=!1),this.store.hover&&this.store.hoverAnchor&&this.store.hoverAnchor.penId!==this.store.activeAnchor.penId&&(s=this.store.hoverAnchor.x-this.store.activeAnchor.x,c=this.store.hoverAnchor.y-this.store.activeAnchor.y,Er(this.store.activeAnchor,s,c),this.store.activeAnchor.connectTo=this.store.hover.id,d.prev=void 0,h.lineName!=="polyline"&&((r=this[h.lineName])===null||r===void 0||r.call(this,this.store,h))),h.autoPolyline!==!1&&h.lineName==="polyline"&&((o=this[h.lineName])===null||o===void 0||o.call(this,this.store,h)),this.dirtyLines.add(h),this.store.path2dMap.set(h,he.path2dDraws[h.name](h)),this.render(),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){i.timer=void 0,i.pushHistory({type:de.Update,pens:se(i.store.active,!0),initPens:i.initPens}),i.initPens=void 0},500)}},e.prototype.moveLineAnchorPrev=function(t){var i=this;if(!(!this.activeRect||this.store.data.locked||!this.store.activeAnchor)){if(this.initPens||(this.initPens=se(this.store.active,!0)),this.store.activeAnchor.prev.x=t.x,this.store.activeAnchor.prev.y=t.y,this.store.activeAnchor.next){if(!this.store.activeAnchor.prevNextType)this.store.activeAnchor.next.x=t.x,this.store.activeAnchor.next.y=t.y,Re(this.store.activeAnchor.next,180,this.store.activeAnchor);else if(this.store.activeAnchor.prevNextType===qt.Bilateral){var n=Ge(t,this.store.activeAnchor),r=Ge(this.prevAnchor,this.store.activeAnchor);this.store.activeAnchor.next.x=this.nextAnchor.x,this.store.activeAnchor.next.y=this.nextAnchor.y,Re(this.store.activeAnchor.next,n-r,this.store.activeAnchor)}}var o=this.store.active[0];this.dirtyLines.add(o),this.store.path2dMap.set(o,he.path2dDraws[o.name](o)),this.render(),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){i.timer=void 0,i.pushHistory({type:de.Update,pens:se(i.store.active,!0),initPens:i.initPens}),i.initPens=void 0},200)}},e.prototype.moveLineAnchorNext=function(t){var i=this;if(!(!this.activeRect||this.store.data.locked)){if(this.initPens||(this.initPens=se(this.store.active,!0)),this.store.activeAnchor.next.x=t.x,this.store.activeAnchor.next.y=t.y,this.store.activeAnchor.prev){if(!this.store.activeAnchor.prevNextType)this.store.activeAnchor.prev.x=t.x,this.store.activeAnchor.prev.y=t.y,Re(this.store.activeAnchor.prev,180,this.store.activeAnchor);else if(this.store.activeAnchor.prevNextType===qt.Bilateral){var n=Ge(t,this.store.activeAnchor),r=Ge(this.nextAnchor,this.store.activeAnchor);this.store.activeAnchor.prev.x=this.prevAnchor.x,this.store.activeAnchor.prev.y=this.prevAnchor.y,Re(this.store.activeAnchor.prev,n-r,this.store.activeAnchor)}}var o=this.store.active[0];this.dirtyLines.add(o),this.store.path2dMap.set(o,he.path2dDraws[o.name](o)),this.render(),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){i.timer=void 0,i.pushHistory({type:de.Update,pens:se(i.store.active,!0),initPens:i.initPens}),i.initPens=void 0},200)}},e.prototype.setAnchor=function(t){var i;return st(this,void 0,void 0,function(){var n,r,o,a,l,l;return lt(this,function(u){switch(u.label){case 0:return n=[se(this.store.hover,!0)],r=this.store.hover,this.store.hoverAnchor?(o=this.beforeRemoveAnchor,o?[4,this.beforeRemoveAnchor(r,this.store.hoverAnchor)]:[3,2]):[3,3];case 1:o=!u.sent(),u.label=2;case 2:return o?[2]:(r.type===Pe.Line&&((i=r.calculative.worldAnchors)===null||i===void 0?void 0:i.length)<=2?this.delete([r]):(sh(r,this.store.hoverAnchor),r.type===Pe.Line&&this.initLineRect(r)),this.store.hoverAnchor=void 0,this.store.activeAnchor=void 0,this.externalElements.style.cursor="default",[3,6]);case 3:return r?(a=this.beforeAddAnchor,a?[4,this.beforeAddAnchor(r,this.store.pointAt)]:[3,5]):[3,6];case 4:a=!u.sent(),u.label=5;case 5:if(a)return[2];r.type===Pe.Line?(this.store.activeAnchor=ah(r,this.store.pointAt,this.store.pointAtIndex),this.initLineRect(r),l={x:t.x,y:t.y},this.getHover(l)):(l={id:be(),x:t.x,y:t.y},this.store.activeAnchor=oh(r,l)),u.label=6;case 6:return this.hotkeyType=Te.None,this.render(),this.pushHistory({type:de.Update,pens:[se(r,!0)],initPens:n}),[2]}})})},e.prototype.checkDisconnect=function(t,i){var n=this;if(t.id.indexOf(Ot)>0){var r=t.id;t=this.store.pens[r.replace(Ot,"")]}t.calculative.worldAnchors.forEach(function(o){if(o.connectTo&&!i.find(function(l){return l.id===o.connectTo})){var a=n.store.pens[o.connectTo];if(a.type)return;Pr(a,Gt(a,o.anchorId),t,o)}})},e.prototype.translatePens=function(t,i,n,r){var o=this;if(t===void 0&&(t=this.store.active),!(!t||!t.length)){var a=t.some(function(s){if(s.locked)return!0});if(!a){var l=!r&&se(t,!0);zt(this.activeRect,i,n);var u=this.getAllByPens(t);t.forEach(function(s){var c,h;s.locked>=Ce.DisableMove||(s.type===Pe.Line?(lh(s,i,n),o.checkDisconnect(s,u),o.store.path2dMap.set(s,he.path2dDraws[s.name](s)),r||(o.initLineRect(s),(c=s.connectedLines)===null||c===void 0||c.forEach(function(f){var d=o.store.pens[f.lineId];o.initLineRect(d)}))):(zt(s.calculative.worldRect,i,n),o.dirtyPenRect(s,{worldRectIsReady:!0}),s.calculative.x=s.x,s.calculative.y=s.y,s.calculative.initRect&&(s.calculative.initRect.x=s.calculative.x,s.calculative.initRect.y=s.calculative.y,s.calculative.initRect.ex=s.calculative.x+s.calculative.width,s.calculative.initRect.ey=s.calculative.y+s.calculative.height)),o.updateLines(s),(h=s.onMove)===null||h===void 0||h.call(s,s))}),this.getSizeCPs(),this.render(),this.tooltip.translate(i,n),this.store.emitter.emit("translatePens",t),r||(this.pushHistory({type:de.Update,pens:se(t,!0),initPens:l}),this.initImageCanvas(t))}}},e.prototype.calcAutoAnchor=function(t,i,n,r){var o=Oe(t),a=Ae(t),l=Yr(n,i===o?a:o);i.x=l.x,i.y=l.y,i.prev=void 0,i.next=void 0,r?r.anchor=l.id:yt(n,l,t,i),this[t.lineName]&&this[t.lineName](this.store,t),this.store.path2dMap.set(t,he.path2dDraws.line(t)),this.initLineRect(t)},e.prototype.restoreNodeAnimate=function(t){if(t.calculative.initRect){if(t.keepAnimateState)for(var i in t)t.calculative[i]!==void 0&&i!=="x"&&i!=="y"&&i!=="width"&&i!=="height"&&i!=="initRect"&&(typeof t[i]!="object"||i==="lineDash")&&(i==="fontSize"?t[i]=t.calculative[i]/t.calculative.canvas.store.data.scale:t[i]=t.calculative[i]);else{for(var i in t)i!=="x"&&i!=="y"&&i!=="width"&&i!=="height"&&i!=="initRect"&&(typeof t[i]!="object"||i==="lineDash")&&(t.calculative[i]=t[i]);t.calculative.worldRect=t.calculative.initRect}this.dirtyPenRect(t,{worldRectIsReady:!0}),t.calculative.text!==t.text&&(t.calculative.text=t.text,Mi(t)),t.calculative.initRect=void 0}},e.prototype.updateLines=function(t,i){var n=this,r;(r=t.children)===null||r===void 0||r.forEach(function(o){var a=n.store.pens[o];a&&n.updateLines(a,i)}),t.connectedLines&&t.connectedLines.forEach(function(o){var a,l=n.store.pens[o.lineId];if(!(!l||l.calculative.active)){var u=Gt(l,o.lineAnchor);if(!!u){if(l.autoFrom){var s=Oe(l);s.id===u.id&&n.calcAutoAnchor(l,s,t,o)}if(l.autoTo){var c=Ae(l);c.id===u.id&&n.calcAutoAnchor(l,c,t,o)}var h=Gt(t,o.anchor);if(!!h){if(Er(u,h.x-u.x,h.y-u.y),((a=l.autoPolyline)!==null&&a!==void 0?a:n.store.options.autoPolyline)&&l.lineName==="polyline"){var s=Oe(l),c=Ae(l),f=!1;s.id===u.id?(s=u,f=!0):c.id===u.id&&(c=u,f=!0),f&&(l.calculative.worldAnchors=[s,c],l.calculative.activeAnchor=s,n.polyline(n.store,l,c),n.initLineRect(l))}n.store.path2dMap.set(l,he.path2dDraws[l.name](l)),n.dirtyLines.add(l),i&&Tn(l)}}}})},e.prototype.calcActiveRect=function(){var t=this.store.active.filter(function(i){return(!i.locked||i.locked<Ce.DisableMove)&&i.visible!=!1});if(t.length)t.length===1?(this.activeRect=se(t[0].calculative.worldRect),this.activeRect.rotate=t[0].calculative.rotate||0,Ie(this.activeRect)):(this.activeRect=wt(t),this.activeRect.rotate=0);else{console.warn("active have no movable pens");return}this.lastRotate=0,this.getSizeCPs()},e.prototype.rotatePen=function(t,i,n){var r=this;t.type?(t.calculative.worldAnchors.forEach(function(o){Re(o,i,n.center)}),this.initLineRect(t),Vi(t)):(t.calculative.rotate?t.calculative.rotate+=i:t.calculative.rotate=i,Re(t.calculative.worldRect.center,i,n.center),t.parentId?(t.calculative.worldRect.x=t.calculative.worldRect.center.x-t.calculative.worldRect.width/2,t.calculative.worldRect.y=t.calculative.worldRect.center.y-t.calculative.worldRect.height/2,t.x=(t.calculative.worldRect.x-n.x)/n.width,t.y=(t.calculative.worldRect.y-n.y)/n.height):(t.x=t.calculative.worldRect.center.x-t.width/2,t.y=t.calculative.worldRect.center.y-t.height/2),t.rotate=t.calculative.rotate,this.dirtyPenRect(t),t.children&&t.children.forEach(function(o){var a=r.store.pens[o];r.rotatePen(a,i,t.calculative.worldRect)}))},e.prototype.nextAnimate=function(t){var i=this;if(!!t){this.store.emitter.emit("animateEnd",t);var n;t.nextAnimate&&(n=this.store.data.pens.filter(function(r){return r.id===t.nextAnimate||r.tags&&r.tags.indexOf(t.nextAnimate)>-1})),n&&(n.forEach(function(r){if(r.calculative.pause){var o=Date.now()-r.calculative.pause;r.calculative.pause=void 0,r.calculative.frameStart+=o,r.calculative.frameEnd+=o}else i.store.animates.add(r)}),this.animate())}},e.prototype.animate=function(){var t=this;this.animateRendering||requestAnimationFrame(function(){var i,n,r=Date.now();if(r-t.lastAnimateRender<t.store.options.animateInterval){t.store.animates.size>0&&t.animate();return}t.lastAnimateRender=r,t.animateRendering=!0;var o=[],a=!1;try{for(var l=Le(t.store.animates),u=l.next();!u.done;u=l.next()){var s=u.value;if(!s.calculative.pause){if(s.calculative.active&&!s.type&&!t.movingPens&&(a=!0),!s.type)ch(s,r)?s.calculative.dirty&&(Ie(s.calculative.worldRect),t.dirtyPenRect(s,{worldRectIsReady:!0,playingAnimate:!0})):(t.restoreNodeAnimate(s),o.push(s),t.nextAnimate(s)),t.updateLines(s,!0);else if(!hh(s,r)){if(s.keepAnimateState){for(var c in s)s.calculative[c]!==void 0&&(typeof s[c]!="object"||c==="lineDash")&&(s[c]=s.calculative[c]);Vi(s)}else for(var c in s)(typeof s[c]!="object"||c==="lineDash")&&(s.calculative[c]=s[c]);o.push(s),t.nextAnimate(s)}t.dirty=!0}}}catch(h){i={error:h}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(i)throw i.error}}a&&t.calcActiveRect(),o.forEach(function(h){t.store.animates.delete(h)}),t.render(!1),t.animateRendering=!1,t.animate()})},Object.defineProperty(e.prototype,"clipboardName",{get:function(){return"topology-clipboard"},enumerable:!1,configurable:!0}),e.prototype.copy=function(t){var i,n=this.store.data,r=n.origin,o=n.scale;this.store.clipboard={pens:this.getAllByPens(se(t||this.store.active,!0)),origin:se(r),scale:o},this.pasteOffset=10;var a=this.store.clipboard;localStorage.setItem(this.clipboardName,JSON.stringify({topology:!0,data:a})),(i=navigator.clipboard)===null||i===void 0||i.writeText(JSON.stringify({topology:!0,data:a}))},e.prototype.cut=function(t){this.copy(t),this.delete(t)},e.prototype.paste=function(){var t,i;return st(this,void 0,void 0,function(){var n,r,o,a,l,u,s,c,h;return lt(this,function(f){switch(f.label){case 0:return[4,(t=navigator.clipboard)===null||t===void 0?void 0:t.readText()];case 1:if(n=f.sent(),(i=navigator.clipboard)===null||i===void 0||i.writeText(""),n||(n=localStorage.getItem(this.clipboardName)),n){r=void 0;try{r=JSON.parse(n)}catch(d){return console.warn("\u526A\u5207\u677F\u6570\u636E\u4E0D\u662F json",d.message),[2]}if(!r||!r.topology||!r.data)return[2];this.store.clipboard=r.data}return o=this.beforeAddPens,o?[4,this.beforeAddPens(this.store.clipboard.pens)]:[3,3];case 2:o=f.sent()!=!0,f.label=3;case 3:if(o)return[2];this.store.clipboard=se(this.store.clipboard,!0),a=this.store.clipboard.pens.filter(function(d){return!d.parentId});try{for(l=Le(a),u=l.next();!u.done;u=l.next())s=u.value,this.pastePen(s,void 0,this.store.clipboard)}catch(d){c={error:d}}finally{try{u&&!u.done&&(h=l.return)&&h.call(l)}finally{if(c)throw c.error}}return this.active(a),this.pushHistory({type:de.Add,pens:this.store.clipboard.pens}),this.render(),this.store.emitter.emit("add",this.store.clipboard.pens),localStorage.removeItem(this.clipboardName),[2]}})})},e.prototype.getAllByPens=function(t){var i,n,r=[];try{for(var o=Le(t),a=o.next();!a.done;a=o.next()){var l=a.value;r.push.apply(r,ut([],ct(se(yi(l,this.store),!0)),!1))}}catch(u){i={error:u}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return r.concat(t)},e.prototype.pastePen=function(t,i,n){var r,o,a=t.id;if(zo(t),t.parentId=i,!i&&zt(t,this.pasteOffset,this.pasteOffset),t.type===Pe.Line?this.changeNodeConnectedLine(a,t,n.pens):this.changeLineAnchors(a,t,n.pens),!this.beforeAddPen||this.beforeAddPen(t)==!0){if(this.makePen(t),!t.parentId){var l=this.getPenRect(t,n.origin,n.scale);this.setPenRect(t,l,!1)}var u=[];if(Array.isArray(t.children)){var s=function(v){var g=n.pens.find(function(p){return p.id===v});g&&u.push(c.pastePen(g,t.id,n).id)},c=this;try{for(var h=Le(t.children),f=h.next();!f.done;f=h.next()){var d=f.value;s(d)}}catch(v){r={error:v}}finally{try{f&&!f.done&&(o=h.return)&&o.call(h)}finally{if(r)throw r.error}}}return t.children=u,t}return{}},e.prototype.changeLineAnchors=function(t,i,n){if(!!Array.isArray(i.connectedLines))for(var r=function(l){var u=i.connectedLines[l].lineId,s=n.find(function(f){return f.id===u});if(s){var c=s.anchors[0],h=s.anchors[s.anchors.length-1];c.connectTo===t&&(c.connectTo=i.id),h.connectTo===t&&(h.connectTo=i.id)}else i.connectedLines.splice(l,1),l--;o=l},o,a=0;a<i.connectedLines.length;a++)r(a),a=o},e.prototype.changeNodeConnectedLine=function(t,i,n){var r,o,a,l=i.anchors[0],u=i.anchors[i.anchors.length-1],s=[l,u],c=function(v){var g=v.connectTo;if(g){var p=n.find(function(b){return b.id===g});p?(a=p.connectedLines)===null||a===void 0||a.forEach(function(b){b.lineId===t&&(b.lineId=i.id,b.lineAnchor=v.id)}):(v.connectTo=void 0,v.prev&&(v.prev.connectTo=void 0),v.next&&(v.next.connectTo=void 0))}};try{for(var h=Le(s),f=h.next();!f.done;f=h.next()){var d=f.value;c(d)}}catch(v){r={error:v}}finally{try{f&&!f.done&&(o=h.return)&&o.call(h)}finally{if(r)throw r.error}}},e.prototype.delete=function(t,i){return t===void 0&&(t=this.store.active),i===void 0&&(i=!1),st(this,void 0,void 0,function(){var n;return lt(this,function(r){switch(r.label){case 0:return!t||!t.length?[2]:(n=this.beforeRemovePens,n?[4,this.beforeRemovePens(t)]:[3,2]);case 1:n=r.sent()!=!0,r.label=2;case 2:return n?[2]:(i||(t=t.filter(function(o){return!o.locked})),!t||!t.length?[2]:(this._del(t),this.initImageCanvas(t),this.inactive(),this.clearHover(),this.render(),this.pushHistory({type:de.Delete,pens:t}),this.store.emitter.emit("delete",t),[2]))}})})},e.prototype._del=function(t){var i=this;!t||t.forEach(function(n){if(n.parentId){var r=i.getLockedParent(n);if(r){console.warn("\u7236\u8282\u70B9\u9501\u5B9A");return}else{var o=i.store.pens[n.parentId],a=o.children.indexOf(n.id);o.children.splice(a,1),i.delForce(n)}}else{if(n.locked)return;i.delForce(n)}})},e.prototype.getLockedParent=function(t){if(!t.parentId)return!1;var i=Zt(t);if(i.locked)return i;this.getLockedParent(i)},e.prototype.delForce=function(t){var i=this,n;if(!!t){var r=this.store.data.pens.findIndex(function(o){return o.id===t.id});r>-1&&(this.delConnectedLines(this.store.data.pens[r]),this.store.data.pens.splice(r,1),this.store.pens[t.id]=void 0,delete this.store.pens[t.id]),this.store.animates.delete(t),t.children&&t.children.forEach(function(o){i.delForce(i.store.pens[o])}),(n=t.onDestroy)===null||n===void 0||n.call(t,t)}},e.prototype.delConnectedLines=function(t){var i=this,n;if(t.connectedLines)for(var r=function(l){var u=t.connectedLines[l],s=u.lineId,c=u.lineAnchor,h=o.store.pens[s];if(h){var f=h.anchors.find(function(d){return d.id===c});(f==null?void 0:f.connectTo)===t.id&&(f.connectTo=void 0,f.anchorId=void 0,f.prev&&(f.prev.connectTo=void 0),f.next&&(f.next.connectTo=void 0)),f=Gt(h,c),f&&(f.connectTo=void 0,f.anchorId=void 0,f.prev&&(f.prev.connectTo=void 0),f.next&&(f.next.connectTo=void 0))}},o=this,a=0;a<t.connectedLines.length;a++)r(a);!t.type||(n=t.calculative.worldAnchors)===null||n===void 0||n.forEach(function(l,u){var s;if(!!l.connectTo){var c=i.store.pens[l.connectTo];c&&((s=c.calculative.worldAnchors)===null||s===void 0||s.forEach(function(h){Pr(c,h,t,l)}))}})},e.prototype.createInput=function(){var t=this;this.inputParent.classList.add("topology-input"),this.inputRight.classList.add("right"),this.inputParent.appendChild(this.input),this.inputParent.appendChild(this.inputRight),this.inputParent.appendChild(this.dropdown),this.externalElements.appendChild(this.inputParent),this.inputParent.onmousedown=this.stopPropagation,this.input.onmousedown=this.stopPropagation,this.input.onmousedown=this.stopPropagation,this.inputRight.onmousedown=this.stopPropagation,this.dropdown.onmousedown=this.stopPropagation,this.inputRight.style.transform="rotate(135deg)";for(var i,n=0;n<document.styleSheets.length;n++)document.styleSheets[n].title==="le5le.com"&&(i=document.styleSheets[n]);if(!i){var r=document.createElement("style");r.title="le5le.com",document.head.appendChild(r),i=r.sheet,i.insertRule(".topology-input{display:none;position:absolute;outline:none;align-items: center;}"),i.insertRule(".topology-input textarea{resize:none;border:none;outline:none;background:transparent;flex-grow:1;height:100%;left:0;top:0}"),i.insertRule(".topology-input .right{width:10px;height:10px;flex-shrink:0;border-top: 1px solid;border-right: 1px solid;margin-right: 5px;transition: all .3s cubic-bezier(.645,.045,.355,1);}"),i.insertRule(".topology-input ul{position:absolute;top:100%;left:-5px;width:calc(100% + 10px);min-height:30px;border-radius: 2px;box-shadow: 0 2px 8px #00000026;list-style-type: none;background-color: #fff;padding: 4px 0;}"),i.insertRule(".topology-input ul li{padding: 5px 12px;line-height: 22px;white-space: nowrap;cursor: pointer;}"),i.insertRule(".topology-input ul li:hover{background: #eeeeee;}")}this.input.onclick=function(){var o=t.store.pens[t.input.dataset.penId];t.dropdown.style.display==="block"?(t.dropdown.style.display="none",t.inputRight.style.transform="rotate(135deg)"):(o==null?void 0:o.dropdownList)&&t.store.data.locked&&(t.dropdown.style.display="block",t.inputRight.style.transform="rotate(315deg)"),t.store.emitter.emit("clickInput",o)},this.input.onkeyup=function(o){t.setDropdownList(!0);var a=t.store.pens[t.input.dataset.penId];t.store.emitter.emit("input",{pen:a,text:o.key})}},e.prototype.clearDropdownList=function(){if(this.dropdown.hasChildNodes())for(var t=0;t<this.dropdown.childNodes.length;t++)this.dropdown.childNodes[t].remove(),--t},e.prototype.dropdownAppendOption=function(t,i){var n=document.createElement("li");n.onwheel=this.stopPropagation,n.innerText=t,n.onmousedown=this.stopPropagation,n.dataset.i=i+"",n.onclick=this.selectDropdown,this.dropdown.appendChild(n)},e.prototype.find=function(t){return this.store.data.pens.filter(function(i){return i.id==t||i.tags&&i.tags.indexOf(t)>-1})},e.prototype.findOne=function(t){return this.store.data.pens.find(function(i){return i.id==t||i.tags&&i.tags.indexOf(t)>-1})},e.prototype.changePenId=function(t,i){var n=this,r,o,a,l,u;if(t===i)throw new Error("oldId is same as newId");var s=this.store.pens[t];if(!s)throw new Error("old pen isn't exist");if(this.store.pens[i])throw new Error("new pen already exists");if(s.id=i,this.store.pens[i]=this.store.pens[t],(r=s.onChangeId)===null||r===void 0||r.call(s,s,t,i),delete this.store.pens[t],s.parentId){var c=this.store.pens[s.parentId],h=(o=c.children)===null||o===void 0?void 0:o.findIndex(function(f){return f===t});h!==-1&&((a=c.children)===null||a===void 0||a.splice(h,1,i))}(l=s.children)===null||l===void 0||l.forEach(function(f){var d=n.store.pens[f];d.parentId=i}),s.type===Pe.Line?this.changeNodeConnectedLine(t,s,this.store.data.pens):(this.changeLineAnchors(t,s,this.store.data.pens),(u=s.connectedLines)===null||u===void 0||u.forEach(function(f){var d=f.lineId,v=n.store.pens[d];mi(v)}))},e.prototype.updateValue=function(t,i){var n,r,o,a,l,u=this.getPenRect(t),s=t.name;Object.assign(t,i);var c=s!==t.name;i.newId&&this.changePenId(t.id,i.newId);var h=!1,f=!1,d=!1,v=!1,g=!1,p=!1,b=void 0,x=!1;for(var m in i)m==="rotate"&&(b=t.calculative.rotate||0),(typeof t[m]!="object"||m==="lineDash")&&(t.calculative[m]=i[m]),au.includes(m)&&(f=!0),["name","borderRadius"].includes(m)&&(h=!0),su.includes(m)&&(g=!0),lu.includes(m)&&(d=!0),cu.includes(m)&&(v=!0),m==="isBottom"&&(p=!0),m==="image"&&(x=!0);if(this.setCalculativeByScale(t),c&&((n=t.onDestroy)===null||n===void 0||n.call(t,t),fu(t)),g){var _={x:(r=i.x)!==null&&r!==void 0?r:u.x,y:(o=i.y)!==null&&o!==void 0?o:u.y,width:(a=i.width)!==null&&a!==void 0?a:u.width,height:(l=i.height)!==null&&l!==void 0?l:u.height};this.setPenRect(t,_,!1),this.updateLines(t,!0)}else d?this.dirtyPenRect(t):(f&&xr(t),v&&Do(this.store.pens,t),h&&he.path2dDraws[t.name]&&this.store.path2dMap.set(t,he.path2dDraws[t.name](t)));if(b!==void 0){var P=t.calculative.rotate;t.calculative.rotate=b,this.rotatePen(t,P-b,t.calculative.worldRect)}(i.image||i.backgroundImage||i.strokeImage)&&(t.calculative.image=void 0,t.calculative.backgroundImage=void 0,t.calculative.strokeImage=void 0,this.loadImage(t)),p?(this.canvasImage.init(),this.canvasImageBottom.init()):x?t.isBottom?this.canvasImageBottom.init():this.canvasImage.init():this.initImageCanvas([t])},e.prototype.execPenResize=function(t){var i=this,n,r;(n=t.onResize)===null||n===void 0||n.call(t,t),(r=t.children)===null||r===void 0||r.forEach(function(o){var a=i.store.pens[o];a&&i.execPenResize(a)})},e.prototype.setPenRect=function(t,i,n){if(n===void 0&&(n=!0),t.parentId)Object.assign(t,i);else{var r=this.store.data,o=r.origin,a=r.scale;t.x=o.x+i.x*a,t.y=o.y+i.y*a,t.width=i.width*a,t.height=i.height*a}this.dirtyPenRect(t),this.execPenResize(t),n&&this.render()},e.prototype.getPenRect=function(t,i,n){if(i===void 0&&(i=this.store.data.origin),n===void 0&&(n=this.store.data.scale),!!t)return t.parentId?{x:t.x,y:t.y,width:t.width,height:t.height}:{x:(t.x-i.x)/n,y:(t.y-i.y)/n,width:t.width/n,height:t.height/n}},e.prototype.toPng=function(t,i,n){var r,o;t===void 0&&(t=2),n===void 0&&(n=!1);var a=wt(this.store.data.pens);if(!isFinite(a.width))throw new Error("can not to png, because width is not finite");var l=se(a),u=this.store.data,s=n&&!u.background&&this.store.bkImg,c=!1,h=!1;if(s){if(a.x+=u.x,a.y+=u.y,Ne(a),bn(a,this.canvasRect,!0))Object.assign(a,this.canvasRect);else{var f=Hr(ut(ut([],ct(bt(a)),!1),ct(bt(this.canvasRect)),!1));Object.assign(a,f)}c=a.x===0,h=a.y===0}var d=Yn(t);a.x-=d[3],a.y-=d[0],a.width+=d[3]+d[1],a.height+=d[0]+d[2],Ne(a);var v=document.createElement("canvas");v.width=a.width,v.height=a.height;var g=v.getContext("2d");if(g.textBaseline="middle",s){var p=a.x<0?-a.x:0,b=a.y<0?-a.y:0;g.drawImage(this.store.bkImg,p,b,this.canvasRect.width,this.canvasRect.height)}var x=this.store.data.background||this.store.options.background;x&&(g.save(),g.fillStyle=x,g.fillRect(0,0,v.width,v.height),g.restore()),s?g.translate(c?u.x:-l.x,h?u.y:-l.y):g.translate(-a.x,-a.y);try{for(var m=Le(this.store.data.pens),_=m.next();!_.done;_=m.next()){var P=_.value;if(!(!ps(P,this.store)||P.visible==!1)){var R=P.calculative.active;P.calculative.active=!1,P.calculative.img?us(g,P):vr(g,P),P.calculative.active=R}}}catch(L){r={error:L}}finally{try{_&&!_.done&&(o=m.return)&&o.call(m)}finally{if(r)throw r.error}}if(i){v.toBlob(i);return}return v.toDataURL()},e.prototype.toggleAnchorMode=function(){var t;if(this.hotkeyType)this.hotkeyType===Te.AddAnchor&&(this.hotkeyType=Te.None,this.store.hoverAnchor?this.externalElements.style.cursor="vertical-text":this.store.hover&&(this.externalElements.style.cursor="move"));else{if(this.store.options.disableAnchor||((t=this.store.hover)===null||t===void 0?void 0:t.disableAnchor))return;this.hotkeyType=Te.AddAnchor,this.store.hover&&(this.externalElements.style.cursor="pointer")}this.dirty=!0},e.prototype.addAnchorHand=function(){if(this.store.activeAnchor&&this.store.active&&this.store.active.length===1&&this.store.active[0].type){var t=[se(this.store.active[0],!0)];this.store.activeAnchor.prev?this.store.activeAnchor.next||(this.store.activeAnchor.next=qe({},this.store.activeAnchor.prev),Re(this.store.activeAnchor.next,180,this.store.activeAnchor),this.initLineRect(this.store.active[0]),this.dirty=!0):(this.store.activeAnchor.next||(this.store.activeAnchor.next={penId:this.store.activeAnchor.penId,x:this.store.activeAnchor.x+50,y:this.store.activeAnchor.y}),this.store.activeAnchor.prev=qe({},this.store.activeAnchor.next),Re(this.store.activeAnchor.prev,180,this.store.activeAnchor),this.initLineRect(this.store.active[0]),this.dirty=!0),this.pushHistory({type:de.Update,pens:[se(this.store.active[0],!0)],initPens:t})}},e.prototype.removeAnchorHand=function(){if(this.store.activeAnchor&&this.store.active&&this.store.active.length===1&&this.store.active[0].type){var t=[se(this.store.active[0],!0)];this.hoverType===ce.LineAnchorPrev?(this.store.activeAnchor.prev=void 0,this.initLineRect(this.store.active[0]),this.dirty=!0):this.hoverType===ce.LineAnchorNext?(this.store.activeAnchor.next=void 0,this.initLineRect(this.store.active[0]),this.dirty=!0):(this.store.activeAnchor.prev=void 0,this.store.activeAnchor.next=void 0,this.initLineRect(this.store.active[0]),this.dirty=!0),this.pushHistory({type:de.Update,pens:[se(this.store.active[0])],initPens:t})}},e.prototype.toggleAnchorHand=function(){this.store.active.length===1&&this.store.active[0].type&&this.store.activeAnchor&&(this.store.activeAnchor.prevNextType||(this.store.activeAnchor.prevNextType=qt.Mirror),this.store.activeAnchor.prevNextType=(this.store.activeAnchor.prevNextType+1)%3)},e.prototype.gotoView=function(t,i){var n=wt(this.store.data.pens);if(!isFinite(n.width))throw new Error("can not move view, because width is not finite");this.store.data.x=this.canvas.clientWidth/2-t*n.width-n.x,this.store.data.y=this.canvas.clientHeight/2-i*n.height-n.y,this.onMovePens(),this.canvasImage.init(),this.canvasImageBottom.init(),this.render()},e.prototype.showMagnifier=function(){this.magnifierCanvas.magnifier=!0,this.externalElements.style.cursor="default",this.render()},e.prototype.hideMagnifier=function(){this.magnifierCanvas.magnifier=!1,this.externalElements.style.cursor="default",this.render()},e.prototype.toggleMagnifier=function(){this.magnifierCanvas.magnifier=!this.magnifierCanvas.magnifier,this.magnifierCanvas.magnifier&&(this.externalElements.style.cursor="default"),this.render()},e.prototype.destroy=function(){var t;switch(this.scroll&&this.scroll.destroy(),(t=this.tooltip)===null||t===void 0||t.destroy(),this.externalElements.removeEventListener("gesturestart",this.onGesturestart),this.externalElements.ondragover=function(i){return i.preventDefault()},this.externalElements.ondrop=void 0,Bo()?(this.externalElements.ontouchstart=void 0,this.externalElements.ontouchmove=void 0,this.externalElements.ontouchend=void 0):(this.externalElements.onmousedown=void 0,this.externalElements.onmousemove=void 0,this.externalElements.onmouseup=void 0,this.externalElements.onmouseleave=void 0),this.externalElements.ondblclick=void 0,this.store.options.keydown){case Ft.Document:document.removeEventListener("keydown",this.onkeydown),document.removeEventListener("keyup",this.onkeyup);break;case Ft.Canvas:this.externalElements.removeEventListener("keydown",this.onkeydown),this.externalElements.removeEventListener("keyup",this.onkeyup);break}window&&window.removeEventListener("resize",this.onResize),window&&window.removeEventListener("scroll",this.onScroll)},e}(),Ke;(function(e){e[e.Link=0]="Link",e[e.SetProps=1]="SetProps",e[e.StartAnimate=2]="StartAnimate",e[e.PauseAnimate=3]="PauseAnimate",e[e.StopAnimate=4]="StopAnimate",e[e.Function=5]="Function",e[e.WindowFn=6]="WindowFn",e[e.Emit=7]="Emit",e[e.StartVideo=8]="StartVideo",e[e.PauseVideo=9]="PauseVideo",e[e.StopVideo=10]="StopVideo"})(Ke||(Ke={}));var Wf=function(){function e(t){var i=this;this.parent=t,this.boxWidth=320,this.boxHeight=180,this.ratio=this.boxWidth/this.boxHeight,this.padding=5,this.onMouseDown=function(a){a.preventDefault(),a.stopPropagation(),i.isDown=!0},this.onMouseMove=function(a){if(a.preventDefault(),a.stopPropagation(),i.isDown)try{i.parent.gotoView(a.offsetX/i.box.clientWidth,a.offsetY/i.box.clientHeight)}catch(l){console.warn(l.message),i.isDown=!1}},this.onMouseUp=function(a){a.preventDefault(),a.stopPropagation();try{i.parent.gotoView(a.offsetX/i.box.clientWidth,a.offsetY/i.box.clientHeight)}catch(l){console.warn(l.message)}finally{i.isDown=!1}},this.box=document.createElement("div"),this.img=new Image,this.view=document.createElement("div"),this.box.appendChild(this.img),this.box.appendChild(this.view),this.parent.externalElements.appendChild(this.box),this.box.className="topology-map",this.box.onmousedown=this.onMouseDown,this.box.onmousemove=this.onMouseMove,this.box.onmouseup=this.onMouseUp;for(var n,r=0;r<document.styleSheets.length;r++)document.styleSheets[r].title==="le5le/map"&&(n=document.styleSheets[r]);if(!n){var o=document.createElement("style");o.type="text/css",o.title="le5le.com/map",document.head.appendChild(o),o=document.createElement("style"),o.type="text/css",document.head.appendChild(o),n=o.sheet,n.insertRule(".topology-map{display:flex;width:"+(this.boxWidth+2*this.padding)+"px;height:"+(this.boxHeight+2*this.padding)+"px;padding:"+this.padding+"px;background:#f4f4f4;border:1px solid #ffffff;box-shadow: 0px 0px 14px 0px rgba(0,10,38,0.30);border-radius:8px;position:absolute;z-index:20;right:0;bottom:0;justify-content:center;align-items:center;cursor:default;user-select:none;overflow: hidden;}"),n.insertRule(".topology-map img{max-width:100%;max-height:100%;pointer-events: none;}"),n.insertRule(".topology-map div{pointer-events: none;border:1px solid #1890ff;position:absolute}")}}return e.prototype.show=function(){this.box.style.display="flex";var t=this.parent.store.data;t.pens.length?(this.img.style.display="block",this.img.src=this.parent.toPng(),this.setView()):this.img.style.display="none",this.isShow=!0},e.prototype.hide=function(){this.box.style.display="none",this.isShow=!1},e.prototype.setView=function(){var t=this.parent.store.data;if(t.pens.length){var i=wt(t.pens);zt(i,t.x,t.y);var n=i.width/i.height;if(n>this.ratio){var r=i.width/this.ratio;i.y-=(r-i.height)/2,i.height=r,Ne(i)}else{var o=i.height*this.ratio;i.x-=(o-i.width)/2,i.width=o,Ne(i)}var a=this.parent.canvasRect,l=0,u=0;if(i.x<0)l=-i.x/i.width;else if(i.x+i.width>a.width){var s=0;a.width>i.width&&(s=a.width-i.width),l=(-i.x+s)/i.width}if(i.y<0)u=-i.y/i.height;else if(i.y+i.height>a.height){var s=0;a.height>i.height&&(s=a.height-i.height),u=(-i.y+s)/i.height}var c=a.width>i.width?1:a.width/i.width,h=a.height>i.height?1:a.height/i.height;this.view.style.left=this.padding+l*this.boxWidth+"px",this.view.style.width=c*this.boxWidth+"px",this.view.style.top=this.padding+u*this.boxHeight+"px",this.view.style.height=h*this.boxHeight+"px"}},e}(),ht=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zr(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ps={exports:{}};(function(e,t){(function(i){e.exports=i()})(function(){return function(){return function i(n,r,o){function a(s,c){if(!r[s]){if(!n[s]){var h=typeof Zr=="function"&&Zr;if(!c&&h)return h(s,!0);if(l)return l(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var d=r[s]={exports:{}};n[s][0].call(d.exports,function(v){return a(n[s][1][v]||v)},d,d.exports,i,n,r,o)}return r[s].exports}for(var l=typeof Zr=="function"&&Zr,u=0;u<o.length;u++)a(o[u]);return a}}()({1:[function(i,n,r){(function(o,a){(function(){const l=i("events").EventEmitter,u=i("./store"),s=i("./topic-alias-recv"),c=i("./topic-alias-send"),h=i("mqtt-packet"),f=i("./default-message-id-provider"),d=i("readable-stream").Writable,v=i("inherits"),g=i("reinterval"),p=i("rfdc/default"),b=i("./validations"),x=i("xtend"),m=i("debug")("mqttjs:client"),_=o?o.nextTick:function(C){setTimeout(C,0)},P=a.setImmediate||function(C){_(C)},R={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0,resubscribe:!0},L=["ECONNREFUSED","EADDRINUSE","ECONNRESET","ENOTFOUND"],I={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};function V(C,B){let H;B.properties&&(H=B.properties.topicAlias);let W=B.topic.toString();if(W.length===0){if(H===void 0)return new Error("Unregistered Topic Alias");if((W=C.topicAliasSend.getTopicByAlias(H))===void 0)return new Error("Unregistered Topic Alias");B.topic=W}H&&delete B.properties.topicAlias}function Q(C,B,H){m("sendPacket :: packet: %O",B),m("sendPacket :: emitting `packetsend`"),C.emit("packetsend",B),m("sendPacket :: writing to stream");const W=h.writeToStream(B,C.stream,C.options);m("sendPacket :: writeToStream result %s",W),!W&&H&&H!==k?(m("sendPacket :: handle events on `drain` once through callback."),C.stream.once("drain",H)):H&&(m("sendPacket :: invoking cb"),H())}function T(C,B,H,W){m("storeAndSend :: store packet with cmd %s to outgoingStore",B.cmd);let F,D=B;if(D.cmd==="publish"&&(D=p(B),F=V(C,D)))return H&&H(F);C.outgoingStore.put(D,function(z){if(z)return H&&H(z);W(),Q(C,B,H)})}function k(C){m("nop ::",C)}function M(C,B){let H;const W=this;if(!(this instanceof M))return new M(C,B);for(H in this.options=B||{},R)this.options[H]===void 0?this.options[H]=R[H]:this.options[H]=B[H];m("MqttClient :: options.protocol",B.protocol),m("MqttClient :: options.protocolVersion",B.protocolVersion),m("MqttClient :: options.username",B.username),m("MqttClient :: options.keepalive",B.keepalive),m("MqttClient :: options.reconnectPeriod",B.reconnectPeriod),m("MqttClient :: options.rejectUnauthorized",B.rejectUnauthorized),m("MqttClient :: options.topicAliasMaximum",B.topicAliasMaximum),this.options.clientId=typeof B.clientId=="string"?B.clientId:"mqttjs_"+Math.random().toString(16).substr(2,8),m("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=B.protocolVersion===5&&B.customHandleAcks?B.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=C,this.messageIdProvider=this.options.messageIdProvider===void 0?new f:this.options.messageIdProvider,this.outgoingStore=B.outgoingStore||new u,this.incomingStore=B.incomingStore||new u,this.queueQoSZero=B.queueQoSZero===void 0||B.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this._storeProcessingQueue=[],this.outgoing={},this._firstConnection=!0,B.topicAliasMaximum>0&&(B.topicAliasMaximum>65535?m("MqttClient :: options.topicAliasMaximum is out of range"):this.topicAliasRecv=new s(B.topicAliasMaximum)),this.on("connect",function(){const F=this.queue;m("connect :: sending queued packets"),function D(){const z=F.shift();m("deliver :: entry %o",z);let U=null;if(!z)return void W._resubscribe();U=z.packet,m("deliver :: call _sendPacket for %o",U);let N=!0;U.messageId&&U.messageId!==0&&(W.messageIdProvider.register(U.messageId)||(N=!1)),N?W._sendPacket(U,function(q){z.cb&&z.cb(q),D()}):(m("messageId: %d has already used. The message is skipped and removed.",U.messageId),D())}()}),this.on("close",function(){m("close :: connected set to `false`"),this.connected=!1,m("close :: clearing connackTimer"),clearTimeout(this.connackTimer),m("close :: clearing ping timer"),W.pingTimer!==null&&(W.pingTimer.clear(),W.pingTimer=null),this.topicAliasRecv&&this.topicAliasRecv.clear(),m("close :: calling _setupReconnect"),this._setupReconnect()}),l.call(this),m("MqttClient :: setting up stream"),this._setupStream()}v(M,l),M.prototype._setupStream=function(){const C=this,B=new d,H=h.parser(this.options);let W=null;const F=[];function D(){if(F.length)_(z);else{const N=W;W=null,N()}}function z(){m("work :: getting next packet in queue");const N=F.shift();if(N)m("work :: packet pulled from queue"),C._handlePacket(N,D);else{m("work :: no packets in queue");const q=W;W=null,m("work :: done flag is %s",!!q),q&&q()}}m("_setupStream :: calling method to clear reconnect"),this._clearReconnect(),m("_setupStream :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),H.on("packet",function(N){m("parser :: on packet push to packets array."),F.push(N)}),B._write=function(N,q,X){W=X,m("writable stream :: parsing buffer"),H.parse(N),z()},m("_setupStream :: pipe stream to writable stream"),this.stream.pipe(B),this.stream.on("error",function(N){m("streamErrorHandler :: error",N.message),L.includes(N.code)?(m("streamErrorHandler :: emitting error"),C.emit("error",N)):k(N)}),this.stream.on("close",function(){var N;m("(%s)stream :: on close",C.options.clientId),(N=C.outgoing)&&(m("flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(N).forEach(function(q){N[q].volatile&&typeof N[q].cb=="function"&&(N[q].cb(new Error("Connection closed")),delete N[q])})),m("stream: emit close to MqttClient"),C.emit("close")}),m("_setupStream: sending packet `connect`");const U=Object.create(this.options);if(U.cmd="connect",this.topicAliasRecv&&(U.properties||(U.properties={}),this.topicAliasRecv&&(U.properties.topicAliasMaximum=this.topicAliasRecv.max)),Q(this,U),H.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return C.end(()=>this.emit("error",new Error("Packet has no Authentication Method"))),this;this.options.properties.authenticationMethod&&this.options.authPacket&&typeof this.options.authPacket=="object"&&Q(this,x({cmd:"auth",reasonCode:0},this.options.authPacket))}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(function(){m("!!connectTimeout hit!! Calling _cleanUp with force `true`"),C._cleanUp(!0)},this.options.connectTimeout)},M.prototype._handlePacket=function(C,B){const H=this.options;if(H.protocolVersion===5&&H.properties&&H.properties.maximumPacketSize&&H.properties.maximumPacketSize<C.length)return this.emit("error",new Error("exceeding packets size "+C.cmd)),this.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),this;switch(m("_handlePacket :: emitting packetreceive"),this.emit("packetreceive",C),C.cmd){case"publish":this._handlePublish(C,B);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(C),B();break;case"pubrel":this._handlePubrel(C,B);break;case"connack":this._handleConnack(C),B();break;case"auth":this._handleAuth(C),B();break;case"pingresp":this._handlePingresp(C),B();break;case"disconnect":this._handleDisconnect(C),B()}},M.prototype._checkDisconnecting=function(C){return this.disconnecting&&(C&&C!==k?C(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting},M.prototype.publish=function(C,B,H,W){m("publish :: message `%s` to topic `%s`",B,C);const F=this.options;if(typeof H=="function"&&(W=H,H=null),H=x({qos:0,retain:!1,dup:!1},H),this._checkDisconnecting(W))return this;const D=this,z=function(){let U=0;if((H.qos===1||H.qos===2)&&(U=D._nextId())===null)return m("No messageId left"),!1;const N={cmd:"publish",topic:C,payload:B,qos:H.qos,retain:H.retain,messageId:U,dup:H.dup};switch(F.protocolVersion===5&&(N.properties=H.properties),m("publish :: qos",H.qos),H.qos){case 1:case 2:D.outgoing[N.messageId]={volatile:!1,cb:W||k},m("MqttClient:publish: packet cmd: %s",N.cmd),D._sendPacket(N,void 0,H.cbStorePut);break;default:m("MqttClient:publish: packet cmd: %s",N.cmd),D._sendPacket(N,W,H.cbStorePut)}return!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!z())&&this._storeProcessingQueue.push({invoke:z,cbStorePut:H.cbStorePut,callback:W}),this},M.prototype.subscribe=function(){const C=this,B=new Array(arguments.length);for(let $=0;$<arguments.length;$++)B[$]=arguments[$];const H=[];let W=B.shift();const F=W.resubscribe;let D=B.pop()||k,z=B.pop();const U=this.options.protocolVersion;delete W.resubscribe,typeof W=="string"&&(W=[W]),typeof D!="function"&&(z=D,D=k);const N=b.validateTopics(W);if(N!==null)return P(D,new Error("Invalid topic "+N)),this;if(this._checkDisconnecting(D))return m("subscribe: discconecting true"),this;const q={qos:0};if(U===5&&(q.nl=!1,q.rap=!1,q.rh=0),z=x(q,z),Array.isArray(W)?W.forEach(function($){if(m("subscribe: array topic %s",$),!Object.prototype.hasOwnProperty.call(C._resubscribeTopics,$)||C._resubscribeTopics[$].qos<z.qos||F){const Z={topic:$,qos:z.qos};U===5&&(Z.nl=z.nl,Z.rap=z.rap,Z.rh=z.rh,Z.properties=z.properties),m("subscribe: pushing topic `%s` and qos `%s` to subs list",Z.topic,Z.qos),H.push(Z)}}):Object.keys(W).forEach(function($){if(m("subscribe: object topic %s",$),!Object.prototype.hasOwnProperty.call(C._resubscribeTopics,$)||C._resubscribeTopics[$].qos<W[$].qos||F){const Z={topic:$,qos:W[$].qos};U===5&&(Z.nl=W[$].nl,Z.rap=W[$].rap,Z.rh=W[$].rh,Z.properties=z.properties),m("subscribe: pushing `%s` to subs list",Z),H.push(Z)}}),!H.length)return D(null,[]),this;const X=function(){const $=C._nextId();if($===null)return m("No messageId left"),!1;const Z={cmd:"subscribe",subscriptions:H,qos:1,retain:!1,dup:!1,messageId:$};if(z.properties&&(Z.properties=z.properties),C.options.resubscribe){m("subscribe :: resubscribe true");const J=[];H.forEach(function(te){if(C.options.reconnectPeriod>0){const y={qos:te.qos};U===5&&(y.nl=te.nl||!1,y.rap=te.rap||!1,y.rh=te.rh||0,y.properties=te.properties),C._resubscribeTopics[te.topic]=y,J.push(te.topic)}}),C.messageIdToTopic[Z.messageId]=J}return C.outgoing[Z.messageId]={volatile:!0,cb:function(J,te){if(!J){const y=te.granted;for(let w=0;w<y.length;w+=1)H[w].qos=y[w]}D(J,H)}},m("subscribe :: call _sendPacket"),C._sendPacket(Z),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!X())&&this._storeProcessingQueue.push({invoke:X,callback:D}),this},M.prototype.unsubscribe=function(){const C=this,B=new Array(arguments.length);for(let U=0;U<arguments.length;U++)B[U]=arguments[U];let H=B.shift(),W=B.pop()||k,F=B.pop();typeof H=="string"&&(H=[H]),typeof W!="function"&&(F=W,W=k);const D=b.validateTopics(H);if(D!==null)return P(W,new Error("Invalid topic "+D)),this;if(C._checkDisconnecting(W))return this;const z=function(){const U=C._nextId();if(U===null)return m("No messageId left"),!1;const N={cmd:"unsubscribe",qos:1,messageId:U};return typeof H=="string"?N.unsubscriptions=[H]:Array.isArray(H)&&(N.unsubscriptions=H),C.options.resubscribe&&N.unsubscriptions.forEach(function(q){delete C._resubscribeTopics[q]}),typeof F=="object"&&F.properties&&(N.properties=F.properties),C.outgoing[N.messageId]={volatile:!0,cb:W},m("unsubscribe: call _sendPacket"),C._sendPacket(N),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!z())&&this._storeProcessingQueue.push({invoke:z,callback:W}),this},M.prototype.end=function(C,B,H){const W=this;function F(){m("end :: (%s) :: finish :: calling _cleanUp with force %s",W.options.clientId,C),W._cleanUp(C,()=>{m("end :: finish :: calling process.nextTick on closeStores"),_(function(){m("end :: closeStores: closing incoming and outgoing stores"),W.disconnected=!0,W.incomingStore.close(function(D){W.outgoingStore.close(function(z){if(m("end :: closeStores: emitting end"),W.emit("end"),H){const U=D||z;m("end :: closeStores: invoking callback with args"),H(U)}})}),W._deferredReconnect&&W._deferredReconnect()}.bind(W))},B)}return m("end :: (%s)",this.options.clientId),C!=null&&typeof C=="boolean"||(H=B||k,B=C,C=!1,typeof B!="object"&&(H=B,B=null,typeof H!="function"&&(H=k))),typeof B!="object"&&(H=B,B=null),m("end :: cb? %s",!!H),H=H||k,this.disconnecting?(H(),this):(this._clearReconnect(),this.disconnecting=!0,!C&&Object.keys(this.outgoing).length>0?(m("end :: (%s) :: calling finish in 10ms once outgoing is empty",W.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,F,10))):(m("end :: (%s) :: immediately calling finish",W.options.clientId),F()),this)},M.prototype.removeOutgoingMessage=function(C){const B=this.outgoing[C]?this.outgoing[C].cb:null;return delete this.outgoing[C],this.outgoingStore.del({messageId:C},function(){B(new Error("Message removed"))}),this},M.prototype.reconnect=function(C){m("client reconnect");const B=this,H=function(){C?(B.options.incomingStore=C.incomingStore,B.options.outgoingStore=C.outgoingStore):(B.options.incomingStore=null,B.options.outgoingStore=null),B.incomingStore=B.options.incomingStore||new u,B.outgoingStore=B.options.outgoingStore||new u,B.disconnecting=!1,B.disconnected=!1,B._deferredReconnect=null,B._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=H:H(),this},M.prototype._reconnect=function(){m("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(()=>{this._setupStream()}),m("client already connected. disconnecting first.")):(m("_reconnect: calling _setupStream"),this._setupStream())},M.prototype._setupReconnect=function(){const C=this;!C.disconnecting&&!C.reconnectTimer&&C.options.reconnectPeriod>0?(this.reconnecting||(m("_setupReconnect :: emit `offline` state"),this.emit("offline"),m("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),m("_setupReconnect :: setting reconnectTimer for %d ms",C.options.reconnectPeriod),C.reconnectTimer=setInterval(function(){m("reconnectTimer :: reconnect triggered!"),C._reconnect()},C.options.reconnectPeriod)):m("_setupReconnect :: doing nothing...")},M.prototype._clearReconnect=function(){m("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)},M.prototype._cleanUp=function(C,B){const H=arguments[2];if(B&&(m("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",B)),m("_cleanUp :: forced? %s",C),C)this.options.reconnectPeriod===0&&this.options.clean&&(W=this.outgoing)&&(m("flush: queue exists? %b",!!W),Object.keys(W).forEach(function(F){typeof W[F].cb=="function"&&(W[F].cb(new Error("Connection closed")),delete W[F])})),m("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{const F=x({cmd:"disconnect"},H);m("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(F,P.bind(null,this.stream.end.bind(this.stream)))}var W;this.disconnecting||(m("_cleanUp :: client not disconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),this.pingTimer!==null&&(m("_cleanUp :: clearing pingTimer"),this.pingTimer.clear(),this.pingTimer=null),B&&!this.connected&&(m("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",B),B())},M.prototype._sendPacket=function(C,B,H){m("_sendPacket :: (%s) ::  start",this.options.clientId),H=H||k,B=B||k;const W=function(F,D){if(F.options.protocolVersion===5&&D.cmd==="publish"){let z;D.properties&&(z=D.properties.topicAlias);const U=D.topic.toString();if(F.topicAliasSend)if(z){if(U.length!==0&&(m("applyTopicAlias :: register topic: %s - alias: %d",U,z),!F.topicAliasSend.put(U,z)))return m("applyTopicAlias :: error out of range. topic: %s - alias: %d",U,z),new Error("Sending Topic Alias out of range")}else U.length!==0&&(F.options.autoAssignTopicAlias?(z=F.topicAliasSend.getAliasByTopic(U))?(D.topic="",D.properties={...D.properties,topicAlias:z},m("applyTopicAlias :: auto assign(use) topic: %s - alias: %d",U,z)):(z=F.topicAliasSend.getLruAlias(),F.topicAliasSend.put(U,z),D.properties={...D.properties,topicAlias:z},m("applyTopicAlias :: auto assign topic: %s - alias: %d",U,z)):F.options.autoUseTopicAlias&&(z=F.topicAliasSend.getAliasByTopic(U))&&(D.topic="",D.properties={...D.properties,topicAlias:z},m("applyTopicAlias :: auto use topic: %s - alias: %d",U,z)));else if(z)return m("applyTopicAlias :: error out of range. topic: %s - alias: %d",U,z),new Error("Sending Topic Alias out of range")}}(this,C);if(W)B(W);else{if(!this.connected)return C.cmd==="auth"?(this._shiftPingInterval(),void Q(this,C,B)):(m("_sendPacket :: client not connected. Storing packet offline."),void this._storePacket(C,B,H));switch(this._shiftPingInterval(),C.cmd){case"publish":break;case"pubrel":return void T(this,C,B,H);default:return void Q(this,C,B)}switch(C.qos){case 2:case 1:T(this,C,B,H);break;case 0:default:Q(this,C,B)}m("_sendPacket :: (%s) ::  end",this.options.clientId)}},M.prototype._storePacket=function(C,B,H){m("_storePacket :: packet: %o",C),m("_storePacket :: cb? %s",!!B),H=H||k;let W=C;if(W.cmd==="publish"){const F=V(this,W=p(C));if(F)return B&&B(F)}(W.qos||0)===0&&this.queueQoSZero||W.cmd!=="publish"?this.queue.push({packet:W,cb:B}):W.qos>0?(B=this.outgoing[W.messageId]?this.outgoing[W.messageId].cb:null,this.outgoingStore.put(W,function(F){if(F)return B&&B(F);H()})):B&&B(new Error("No connection to broker"))},M.prototype._setupPingTimer=function(){m("_setupPingTimer :: keepalive %d (seconds)",this.options.keepalive);const C=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=g(function(){C._checkPing()},1e3*this.options.keepalive))},M.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(1e3*this.options.keepalive)},M.prototype._checkPing=function(){m("_checkPing :: checking ping..."),this.pingResp?(m("_checkPing :: ping response received. Clearing flag and sending `pingreq`"),this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):(m("_checkPing :: calling _cleanUp with force true"),this._cleanUp(!0))},M.prototype._handlePingresp=function(){this.pingResp=!0},M.prototype._handleConnack=function(C){m("_handleConnack");const B=this.options,H=B.protocolVersion===5?C.reasonCode:C.returnCode;if(clearTimeout(this.connackTimer),delete this.topicAliasSend,C.properties){if(C.properties.topicAliasMaximum){if(C.properties.topicAliasMaximum>65535)return void this.emit("error",new Error("topicAliasMaximum from broker is out of range"));C.properties.topicAliasMaximum>0&&(this.topicAliasSend=new c(C.properties.topicAliasMaximum))}C.properties.serverKeepAlive&&B.keepalive&&(B.keepalive=C.properties.serverKeepAlive,this._shiftPingInterval()),C.properties.maximumPacketSize&&(B.properties||(B.properties={}),B.properties.maximumPacketSize=C.properties.maximumPacketSize)}if(H===0)this.reconnecting=!1,this._onConnect(C);else if(H>0){const W=new Error("Connection refused: "+I[H]);W.code=H,this.emit("error",W)}},M.prototype._handleAuth=function(C){const B=this.options.protocolVersion,H=B===5?C.reasonCode:C.returnCode;if(B!==5){const F=new Error("Protocol error: Auth packets are only supported in MQTT 5. Your version:"+B);return F.code=H,void this.emit("error",F)}const W=this;this.handleAuth(C,function(F,D){if(F)W.emit("error",F);else if(H===24)W.reconnecting=!1,W._sendPacket(D);else{const z=new Error("Connection refused: "+I[H]);F.code=H,W.emit("error",z)}})},M.prototype.handleAuth=function(C,B){B()},M.prototype._handlePublish=function(C,B){m("_handlePublish: packet %o",C),B=B!==void 0?B:k;let H=C.topic.toString();const W=C.payload,F=C.qos,D=C.messageId,z=this,U=this.options,N=[0,16,128,131,135,144,145,151,153];if(this.options.protocolVersion===5){let q;if(C.properties&&(q=C.properties.topicAlias),q!==void 0)if(H.length===0){if(!(q>0&&q<=65535))return m("_handlePublish :: topic alias out of range. alias: %d",q),void this.emit("error",new Error("Received Topic Alias is out of range"));{const X=this.topicAliasRecv.getTopicByAlias(q);if(!X)return m("_handlePublish :: unregistered topic alias. alias: %d",q),void this.emit("error",new Error("Received unregistered Topic Alias"));m("_handlePublish :: topic complemented by alias. topic: %s - alias: %d",H=X,q)}}else{if(!this.topicAliasRecv.put(H,q))return m("_handlePublish :: topic alias out of range. alias: %d",q),void this.emit("error",new Error("Received Topic Alias is out of range"));m("_handlePublish :: registered topic: %s - alias: %d",H,q)}}switch(m("_handlePublish: qos %d",F),F){case 2:U.customHandleAcks(H,W,C,function(q,X){return q instanceof Error||(X=q,q=null),q?z.emit("error",q):N.indexOf(X)===-1?z.emit("error",new Error("Wrong reason code for pubrec")):void(X?z._sendPacket({cmd:"pubrec",messageId:D,reasonCode:X},B):z.incomingStore.put(C,function(){z._sendPacket({cmd:"pubrec",messageId:D},B)}))});break;case 1:U.customHandleAcks(H,W,C,function(q,X){return q instanceof Error||(X=q,q=null),q?z.emit("error",q):N.indexOf(X)===-1?z.emit("error",new Error("Wrong reason code for puback")):(X||z.emit("message",H,W,C),void z.handleMessage(C,function($){if($)return B&&B($);z._sendPacket({cmd:"puback",messageId:D,reasonCode:X},B)}))});break;case 0:this.emit("message",H,W,C),this.handleMessage(C,B);break;default:m("_handlePublish: unknown QoS. Doing nothing.")}},M.prototype.handleMessage=function(C,B){B()},M.prototype._handleAck=function(C){const B=C.messageId,H=C.cmd;let W=null;const F=this.outgoing[B]?this.outgoing[B].cb:null,D=this;let z;if(F){switch(m("_handleAck :: packet type",H),H){case"pubcomp":case"puback":{const U=C.reasonCode;U&&U>0&&U!==16&&((z=new Error("Publish error: "+I[U])).code=U,F(z,C)),delete this.outgoing[B],this.outgoingStore.del(C,F),this.messageIdProvider.deallocate(B),this._invokeStoreProcessingQueue();break}case"pubrec":{W={cmd:"pubrel",qos:2,messageId:B};const U=C.reasonCode;U&&U>0&&U!==16?((z=new Error("Publish error: "+I[U])).code=U,F(z,C)):this._sendPacket(W);break}case"suback":delete this.outgoing[B],this.messageIdProvider.deallocate(B);for(let U=0;U<C.granted.length;U++)if((128&C.granted[U])!=0){const N=this.messageIdToTopic[B];N&&N.forEach(function(q){delete D._resubscribeTopics[q]})}this._invokeStoreProcessingQueue(),F(null,C);break;case"unsuback":delete this.outgoing[B],this.messageIdProvider.deallocate(B),this._invokeStoreProcessingQueue(),F(null);break;default:D.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&Object.keys(this.outgoing).length===0&&this.emit("outgoingEmpty")}else m("_handleAck :: Server sent an ack in error. Ignoring.")},M.prototype._handlePubrel=function(C,B){m("handling pubrel packet"),B=B!==void 0?B:k;const H=this,W={cmd:"pubcomp",messageId:C.messageId};H.incomingStore.get(C,function(F,D){F?H._sendPacket(W,B):(H.emit("message",D.topic,D.payload,D),H.handleMessage(D,function(z){if(z)return B(z);H.incomingStore.del(D,k),H._sendPacket(W,B)}))})},M.prototype._handleDisconnect=function(C){this.emit("disconnect",C)},M.prototype._nextId=function(){return this.messageIdProvider.allocate()},M.prototype.getLastMessageId=function(){return this.messageIdProvider.getLastAllocated()},M.prototype._resubscribe=function(){m("_resubscribe");const C=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||this.options.protocolVersion===5&&!this.connackPacket.sessionPresent)&&C.length>0)if(this.options.resubscribe)if(this.options.protocolVersion===5){m("_resubscribe: protocolVersion 5");for(let B=0;B<C.length;B++){const H={};H[C[B]]=this._resubscribeTopics[C[B]],H.resubscribe=!0,this.subscribe(H,{properties:H[C[B]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1},M.prototype._onConnect=function(C){if(this.disconnected)return void this.emit("connect",C);const B=this;this.connackPacket=C,this.messageIdProvider.clear(),this._setupPingTimer(),this.connected=!0,function H(){let W=B.outgoingStore.createStream();function F(){B._storeProcessing=!1,B._packetIdsDuringStoreProcessing={}}function D(){W.destroy(),W=null,B._flushStoreProcessingQueue(),F()}B.once("close",D),W.on("error",function(z){F(),B._flushStoreProcessingQueue(),B.removeListener("close",D),B.emit("error",z)}),W.on("end",function(){let z=!0;for(const U in B._packetIdsDuringStoreProcessing)if(!B._packetIdsDuringStoreProcessing[U]){z=!1;break}z?(F(),B.removeListener("close",D),B._invokeAllStoreProcessingQueue(),B.emit("connect",C)):H()}),function z(){if(!W)return;B._storeProcessing=!0;const U=W.read(1);let N;U?B._packetIdsDuringStoreProcessing[U.messageId]?z():B.disconnecting||B.reconnectTimer?W.destroy&&W.destroy():(N=B.outgoing[U.messageId]?B.outgoing[U.messageId].cb:null,B.outgoing[U.messageId]={volatile:!1,cb:function(q,X){N&&N(q,X),z()}},B._packetIdsDuringStoreProcessing[U.messageId]=!0,B.messageIdProvider.register(U.messageId)?B._sendPacket(U):m("messageId: %d has already used.",U.messageId)):W.once("readable",z)}()}()},M.prototype._invokeStoreProcessingQueue=function(){if(this._storeProcessingQueue.length>0){const C=this._storeProcessingQueue[0];if(C&&C.invoke())return this._storeProcessingQueue.shift(),!0}return!1},M.prototype._invokeAllStoreProcessingQueue=function(){for(;this._invokeStoreProcessingQueue(););},M.prototype._flushStoreProcessingQueue=function(){for(const C of this._storeProcessingQueue)C.cbStorePut&&C.cbStorePut(new Error("Connection closed")),C.callback&&C.callback(new Error("Connection closed"));this._storeProcessingQueue.splice(0)},n.exports=M}).call(this)}).call(this,i("_process"),typeof ht<"u"?ht:typeof self<"u"?self:typeof window<"u"?window:{})},{"./default-message-id-provider":7,"./store":8,"./topic-alias-recv":9,"./topic-alias-send":10,"./validations":11,_process:50,debug:18,events:22,inherits:24,"mqtt-packet":40,"readable-stream":69,reinterval:70,"rfdc/default":71,xtend:81}],2:[function(i,n,r){const{Buffer:o}=i("buffer"),a=i("readable-stream").Transform,l=i("duplexify");let u,s,c,h=!1;n.exports=function(f,d){if(d.hostname=d.hostname||d.host,!d.hostname)throw new Error("Could not determine host. Specify host manually.");const v=d.protocolId==="MQIsdp"&&d.protocolVersion===3?"mqttv3.1":"mqtt";(function(p){p.hostname||(p.hostname="localhost"),p.path||(p.path="/"),p.wsOptions||(p.wsOptions={})})(d);const g=function(p,b){const x=p.protocol==="alis"?"wss":"ws";let m=x+"://"+p.hostname+p.path;return p.port&&p.port!==80&&p.port!==443&&(m=x+"://"+p.hostname+":"+p.port+p.path),typeof p.transformWsUrl=="function"&&(m=p.transformWsUrl(m,p,b)),m}(d,f);return(u=d.my).connectSocket({url:g,protocols:v}),s=function(){const p=new a;return p._write=function(b,x,m){u.sendSocketMessage({data:b.buffer,success:function(){m()},fail:function(){m(new Error)}})},p._flush=function(b){u.closeSocket({success:function(){b()}})},p}(),c=l.obj(),h||(h=!0,u.onSocketOpen(function(){c.setReadable(s),c.setWritable(s),c.emit("connect")}),u.onSocketMessage(function(p){if(typeof p.data=="string"){const b=o.from(p.data,"base64");s.push(b)}else{const b=new FileReader;b.addEventListener("load",function(){let x=b.result;x=x instanceof ArrayBuffer?o.from(x):o.from(x,"utf8"),s.push(x)}),b.readAsArrayBuffer(p.data)}}),u.onSocketClose(function(){c.end(),c.destroy()}),u.onSocketError(function(p){c.destroy(p)})),c}},{buffer:17,duplexify:20,"readable-stream":69}],3:[function(i,n,r){const o=i("net"),a=i("debug")("mqttjs:tcp");n.exports=function(l,u){u.port=u.port||1883,u.hostname=u.hostname||u.host||"localhost";const s=u.port,c=u.hostname;return a("port %d and host %s",s,c),o.createConnection(s,c)}},{debug:18,net:16}],4:[function(i,n,r){const o=i("tls"),a=i("net"),l=i("debug")("mqttjs:tls");n.exports=function(u,s){s.port=s.port||8883,s.host=s.hostname||s.host||"localhost",a.isIP(s.host)===0&&(s.servername=s.host),s.rejectUnauthorized=s.rejectUnauthorized!==!1,delete s.path,l("port %d host %s rejectUnauthorized %b",s.port,s.host,s.rejectUnauthorized);const c=o.connect(s);function h(f){s.rejectUnauthorized&&u.emit("error",f),c.end()}return c.on("secureConnect",function(){s.rejectUnauthorized&&!c.authorized?c.emit("error",new Error("TLS not authorized")):c.removeListener("error",h)}),c.on("error",h),c}},{debug:18,net:16,tls:16}],5:[function(i,n,r){(function(o){(function(){const{Buffer:a}=i("buffer"),l=i("ws"),u=i("debug")("mqttjs:ws"),s=i("duplexify"),c=i("readable-stream").Transform,h=["rejectUnauthorized","ca","cert","key","pfx","passphrase"],f=o!==void 0&&o.title==="browser"||typeof __webpack_require__=="function";function d(g,p){let b=g.protocol+"://"+g.hostname+":"+g.port+g.path;return typeof g.transformWsUrl=="function"&&(b=g.transformWsUrl(b,g,p)),b}function v(g){const p=g;return g.hostname||(p.hostname="localhost"),g.port||(g.protocol==="wss"?p.port=443:p.port=80),g.path||(p.path="/"),g.wsOptions||(p.wsOptions={}),f||g.protocol!=="wss"||h.forEach(function(b){Object.prototype.hasOwnProperty.call(g,b)&&!Object.prototype.hasOwnProperty.call(g.wsOptions,b)&&(p.wsOptions[b]=g[b])}),p}n.exports=f?function(g,p){let b;u("browserStreamBuilder");const x=function(M){const C=v(M);if(C.hostname||(C.hostname=C.host),!C.hostname){if(typeof document>"u")throw new Error("Could not determine host. Specify host manually.");const B=new URL(document.URL);C.hostname=B.hostname,C.port||(C.port=B.port)}return C.objectMode===void 0&&(C.objectMode=!(C.binary===!0||C.binary===void 0)),C}(p).browserBufferSize||524288,m=p.browserBufferTimeout||1e3,_=!p.objectMode,P=function(M,C){const B=C.protocolId==="MQIsdp"&&C.protocolVersion===3?"mqttv3.1":"mqtt",H=d(C,M),W=new WebSocket(H,[B]);return W.binaryType="arraybuffer",W}(g,p),R=function(M,C,B){const H=new c({objectModeMode:M.objectMode});return H._write=C,H._flush=B,H}(p,function M(C,B,H){P.bufferedAmount>x&&setTimeout(M,m,C,B,H),_&&typeof C=="string"&&(C=a.from(C,"utf8"));try{P.send(C)}catch(W){return H(W)}H()},function(M){P.close(),M()});p.objectMode||(R._writev=k),R.on("close",()=>{P.close()});const L=P.addEventListener!==void 0;function I(){b.setReadable(R),b.setWritable(R),b.emit("connect")}function V(){b.end(),b.destroy()}function Q(M){b.destroy(M)}function T(M){let C=M.data;C=C instanceof ArrayBuffer?a.from(C):a.from(C,"utf8"),R.push(C)}function k(M,C){const B=new Array(M.length);for(let H=0;H<M.length;H++)typeof M[H].chunk=="string"?B[H]=a.from(M[H],"utf8"):B[H]=M[H].chunk;this._write(a.concat(B),"binary",C)}return P.readyState===P.OPEN?b=R:(b=b=s(void 0,void 0,p),p.objectMode||(b._writev=k),L?P.addEventListener("open",I):P.onopen=I),b.socket=P,L?(P.addEventListener("close",V),P.addEventListener("error",Q),P.addEventListener("message",T)):(P.onclose=V,P.onerror=Q,P.onmessage=T),b}:function(g,p){u("streamBuilder");const b=v(p),x=d(b,g),m=function(P,R,L){u("createWebSocket"),u("protocol: "+L.protocolId+" "+L.protocolVersion);const I=L.protocolId==="MQIsdp"&&L.protocolVersion===3?"mqttv3.1":"mqtt";return u("creating new Websocket for url: "+R+" and protocol: "+I),new l(R,[I],L.wsOptions)}(0,x,b),_=l.createWebSocketStream(m,b.wsOptions);return _.url=x,m.on("close",()=>{_.destroy()}),_}}).call(this)}).call(this,i("_process"))},{_process:50,buffer:17,debug:18,duplexify:20,"readable-stream":69,ws:80}],6:[function(i,n,r){const{Buffer:o}=i("buffer"),a=i("readable-stream").Transform,l=i("duplexify");let u,s,c;n.exports=function(h,f){if(f.hostname=f.hostname||f.host,!f.hostname)throw new Error("Could not determine host. Specify host manually.");const d=f.protocolId==="MQIsdp"&&f.protocolVersion===3?"mqttv3.1":"mqtt";(function(p){p.hostname||(p.hostname="localhost"),p.path||(p.path="/"),p.wsOptions||(p.wsOptions={})})(f);const v=function(p,b){const x=p.protocol==="wxs"?"wss":"ws";let m=x+"://"+p.hostname+p.path;return p.port&&p.port!==80&&p.port!==443&&(m=x+"://"+p.hostname+":"+p.port+p.path),typeof p.transformWsUrl=="function"&&(m=p.transformWsUrl(m,p,b)),m}(f,h);u=wx.connectSocket({url:v,protocols:[d]}),s=function(){const p=new a;return p._write=function(b,x,m){u.send({data:b.buffer,success:function(){m()},fail:function(_){m(new Error(_))}})},p._flush=function(b){u.close({success:function(){b()}})},p}(),(c=l.obj())._destroy=function(p,b){u.close({success:function(){b&&b(p)}})};const g=c.destroy;return c.destroy=function(){c.destroy=g;const p=this;setTimeout(function(){u.close({fail:function(){p._destroy(new Error)}})},0)}.bind(c),u.onOpen(function(){c.setReadable(s),c.setWritable(s),c.emit("connect")}),u.onMessage(function(p){let b=p.data;b=b instanceof ArrayBuffer?o.from(b):o.from(b,"utf8"),s.push(b)}),u.onClose(function(){c.end(),c.destroy()}),u.onError(function(p){c.destroy(new Error(p.errMsg))}),c}},{buffer:17,duplexify:20,"readable-stream":69}],7:[function(i,n,r){function o(){if(!(this instanceof o))return new o;this.nextId=Math.max(1,Math.floor(65535*Math.random()))}o.prototype.allocate=function(){const a=this.nextId++;return this.nextId===65536&&(this.nextId=1),a},o.prototype.getLastAllocated=function(){return this.nextId===1?65535:this.nextId-1},o.prototype.register=function(a){return!0},o.prototype.deallocate=function(a){},o.prototype.clear=function(){},n.exports=o},{}],8:[function(i,n,r){const o=i("xtend"),a=i("readable-stream").Readable,l={objectMode:!0},u={clean:!0};function s(c){if(!(this instanceof s))return new s(c);this.options=c||{},this.options=o(u,c),this._inflights=new Map}s.prototype.put=function(c,h){return this._inflights.set(c.messageId,c),h&&h(),this},s.prototype.createStream=function(){const c=new a(l),h=[];let f=!1,d=0;return this._inflights.forEach(function(v,g){h.push(v)}),c._read=function(){!f&&d<h.length?this.push(h[d++]):this.push(null)},c.destroy=function(){if(f)return;const v=this;f=!0,setTimeout(function(){v.emit("close")},0)},c},s.prototype.del=function(c,h){return(c=this._inflights.get(c.messageId))?(this._inflights.delete(c.messageId),h(null,c)):h&&h(new Error("missing packet")),this},s.prototype.get=function(c,h){return(c=this._inflights.get(c.messageId))?h(null,c):h&&h(new Error("missing packet")),this},s.prototype.close=function(c){this.options.clean&&(this._inflights=null),c&&c()},n.exports=s},{"readable-stream":69,xtend:81}],9:[function(i,n,r){function o(a){if(!(this instanceof o))return new o(a);this.aliasToTopic={},this.max=a}o.prototype.put=function(a,l){return!(l===0||l>this.max)&&(this.aliasToTopic[l]=a,this.length=Object.keys(this.aliasToTopic).length,!0)},o.prototype.getTopicByAlias=function(a){return this.aliasToTopic[a]},o.prototype.clear=function(){this.aliasToTopic={}},n.exports=o},{}],10:[function(i,n,r){const o=i("lru-cache"),a=i("number-allocator").NumberAllocator;function l(u){if(!(this instanceof l))return new l(u);u>0&&(this.aliasToTopic=new o({max:u}),this.topicToAlias={},this.numberAllocator=new a(1,u),this.max=u,this.length=0)}l.prototype.put=function(u,s){if(s===0||s>this.max)return!1;const c=this.aliasToTopic.get(s);return c&&delete this.topicToAlias[c],this.aliasToTopic.set(s,u),this.topicToAlias[u]=s,this.numberAllocator.use(s),this.length=this.aliasToTopic.length,!0},l.prototype.getTopicByAlias=function(u){return this.aliasToTopic.get(u)},l.prototype.getAliasByTopic=function(u){const s=this.topicToAlias[u];return s!==void 0&&this.aliasToTopic.get(s),s},l.prototype.clear=function(){this.aliasToTopic.reset(),this.topicToAlias={},this.numberAllocator.clear(),this.length=0},l.prototype.getLruAlias=function(){return this.numberAllocator.firstVacant()||this.aliasToTopic.keys()[this.aliasToTopic.length-1]},n.exports=l},{"lru-cache":37,"number-allocator":46}],11:[function(i,n,r){function o(a){const l=a.split("/");for(let u=0;u<l.length;u++)if(l[u]!=="+"){if(l[u]==="#")return u===l.length-1;if(l[u].indexOf("+")!==-1||l[u].indexOf("#")!==-1)return!1}return!0}n.exports={validateTopics:function(a){if(a.length===0)return"empty_topic_list";for(let l=0;l<a.length;l++)if(!o(a[l]))return a[l];return null}}},{}],12:[function(i,n,r){(function(o){(function(){const a=i("../client"),l=i("../store"),u=i("url"),s=i("xtend"),c=i("debug")("mqttjs"),h={};function f(d,v){if(c("connecting to an MQTT broker..."),typeof d!="object"||v||(v=d,d=null),v=v||{},d){const p=u.parse(d,!0);if(p.port!=null&&(p.port=Number(p.port)),(v=s(p,v)).protocol===null)throw new Error("Missing protocol");v.protocol=v.protocol.replace(/:$/,"")}if(function(p){let b;p.auth&&((b=p.auth.match(/^(.+):(.+)$/))?(p.username=b[1],p.password=b[2]):p.username=p.auth)}(v),v.query&&typeof v.query.clientId=="string"&&(v.clientId=v.query.clientId),v.cert&&v.key){if(!v.protocol)throw new Error("Missing secure protocol key");if(["mqtts","wss","wxs","alis"].indexOf(v.protocol)===-1)switch(v.protocol){case"mqtt":v.protocol="mqtts";break;case"ws":v.protocol="wss";break;case"wx":v.protocol="wxs";break;case"ali":v.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'+v.protocol+'"!')}}if(!h[v.protocol]){const p=["mqtts","wss"].indexOf(v.protocol)!==-1;v.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter(function(b,x){return(!p||x%2!=0)&&typeof h[b]=="function"})[0]}if(v.clean===!1&&!v.clientId)throw new Error("Missing clientId for unclean clients");v.protocol&&(v.defaultProtocol=v.protocol);const g=new a(function(p){return v.servers&&(p._reconnectCount&&p._reconnectCount!==v.servers.length||(p._reconnectCount=0),v.host=v.servers[p._reconnectCount].host,v.port=v.servers[p._reconnectCount].port,v.protocol=v.servers[p._reconnectCount].protocol?v.servers[p._reconnectCount].protocol:v.defaultProtocol,v.hostname=v.host,p._reconnectCount++),c("calling streambuilder for",v.protocol),h[v.protocol](p,v)},v);return g.on("error",function(){}),g}o!==void 0&&o.title!=="browser"||typeof __webpack_require__!="function"?(h.mqtt=i("./tcp"),h.tcp=i("./tcp"),h.ssl=i("./tls"),h.tls=i("./tls"),h.mqtts=i("./tls")):(h.wx=i("./wx"),h.wxs=i("./wx"),h.ali=i("./ali"),h.alis=i("./ali")),h.ws=i("./ws"),h.wss=i("./ws"),n.exports=f,n.exports.connect=f,n.exports.MqttClient=a,n.exports.Store=l}).call(this)}).call(this,i("_process"))},{"../client":1,"../store":8,"./ali":2,"./tcp":3,"./tls":4,"./ws":5,"./wx":6,_process:50,debug:18,url:76,xtend:81}],13:[function(i,n,r){r.byteLength=function(d){var v=h(d),g=v[0],p=v[1];return 3*(g+p)/4-p},r.toByteArray=function(d){var v,g,p=h(d),b=p[0],x=p[1],m=new l(function(R,L,I){return 3*(L+I)/4-I}(0,b,x)),_=0,P=x>0?b-4:b;for(g=0;g<P;g+=4)v=a[d.charCodeAt(g)]<<18|a[d.charCodeAt(g+1)]<<12|a[d.charCodeAt(g+2)]<<6|a[d.charCodeAt(g+3)],m[_++]=v>>16&255,m[_++]=v>>8&255,m[_++]=255&v;return x===2&&(v=a[d.charCodeAt(g)]<<2|a[d.charCodeAt(g+1)]>>4,m[_++]=255&v),x===1&&(v=a[d.charCodeAt(g)]<<10|a[d.charCodeAt(g+1)]<<4|a[d.charCodeAt(g+2)]>>2,m[_++]=v>>8&255,m[_++]=255&v),m},r.fromByteArray=function(d){for(var v,g=d.length,p=g%3,b=[],x=0,m=g-p;x<m;x+=16383)b.push(f(d,x,x+16383>m?m:x+16383));return p===1?(v=d[g-1],b.push(o[v>>2]+o[v<<4&63]+"==")):p===2&&(v=(d[g-2]<<8)+d[g-1],b.push(o[v>>10]+o[v>>4&63]+o[v<<2&63]+"=")),b.join("")};for(var o=[],a=[],l=typeof Uint8Array<"u"?Uint8Array:Array,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,c=u.length;s<c;++s)o[s]=u[s],a[u.charCodeAt(s)]=s;function h(d){var v=d.length;if(v%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var g=d.indexOf("=");return g===-1&&(g=v),[g,g===v?0:4-g%4]}function f(d,v,g){for(var p,b,x=[],m=v;m<g;m+=3)p=(d[m]<<16&16711680)+(d[m+1]<<8&65280)+(255&d[m+2]),x.push(o[(b=p)>>18&63]+o[b>>12&63]+o[b>>6&63]+o[63&b]);return x.join("")}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},{}],14:[function(i,n,r){const{Buffer:o}=i("buffer"),a=Symbol.for("BufferList");function l(u){if(!(this instanceof l))return new l(u);l._init.call(this,u)}l._init=function(u){Object.defineProperty(this,a,{value:!0}),this._bufs=[],this.length=0,u&&this.append(u)},l.prototype._new=function(u){return new l(u)},l.prototype._offset=function(u){if(u===0)return[0,0];let s=0;for(let c=0;c<this._bufs.length;c++){const h=s+this._bufs[c].length;if(u<h||c===this._bufs.length-1)return[c,u-s];s=h}},l.prototype._reverseOffset=function(u){const s=u[0];let c=u[1];for(let h=0;h<s;h++)c+=this._bufs[h].length;return c},l.prototype.get=function(u){if(u>this.length||u<0)return;const s=this._offset(u);return this._bufs[s[0]][s[1]]},l.prototype.slice=function(u,s){return typeof u=="number"&&u<0&&(u+=this.length),typeof s=="number"&&s<0&&(s+=this.length),this.copy(null,0,u,s)},l.prototype.copy=function(u,s,c,h){if((typeof c!="number"||c<0)&&(c=0),(typeof h!="number"||h>this.length)&&(h=this.length),c>=this.length||h<=0)return u||o.alloc(0);const f=!!u,d=this._offset(c),v=h-c;let g=v,p=f&&s||0,b=d[1];if(c===0&&h===this.length){if(!f)return this._bufs.length===1?this._bufs[0]:o.concat(this._bufs,this.length);for(let x=0;x<this._bufs.length;x++)this._bufs[x].copy(u,p),p+=this._bufs[x].length;return u}if(g<=this._bufs[d[0]].length-b)return f?this._bufs[d[0]].copy(u,s,b,b+g):this._bufs[d[0]].slice(b,b+g);f||(u=o.allocUnsafe(v));for(let x=d[0];x<this._bufs.length;x++){const m=this._bufs[x].length-b;if(!(g>m)){this._bufs[x].copy(u,p,b,b+g),p+=m;break}this._bufs[x].copy(u,p,b),p+=m,g-=m,b&&(b=0)}return u.length>p?u.slice(0,p):u},l.prototype.shallowSlice=function(u,s){if(u=u||0,s=typeof s!="number"?this.length:s,u<0&&(u+=this.length),s<0&&(s+=this.length),u===s)return this._new();const c=this._offset(u),h=this._offset(s),f=this._bufs.slice(c[0],h[0]+1);return h[1]===0?f.pop():f[f.length-1]=f[f.length-1].slice(0,h[1]),c[1]!==0&&(f[0]=f[0].slice(c[1])),this._new(f)},l.prototype.toString=function(u,s,c){return this.slice(s,c).toString(u)},l.prototype.consume=function(u){if(u=Math.trunc(u),Number.isNaN(u)||u<=0)return this;for(;this._bufs.length;){if(!(u>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(u),this.length-=u;break}u-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},l.prototype.duplicate=function(){const u=this._new();for(let s=0;s<this._bufs.length;s++)u.append(this._bufs[s]);return u},l.prototype.append=function(u){if(u==null)return this;if(u.buffer)this._appendBuffer(o.from(u.buffer,u.byteOffset,u.byteLength));else if(Array.isArray(u))for(let s=0;s<u.length;s++)this.append(u[s]);else if(this._isBufferList(u))for(let s=0;s<u._bufs.length;s++)this.append(u._bufs[s]);else typeof u=="number"&&(u=u.toString()),this._appendBuffer(o.from(u));return this},l.prototype._appendBuffer=function(u){this._bufs.push(u),this.length+=u.length},l.prototype.indexOf=function(u,s,c){if(c===void 0&&typeof s=="string"&&(c=s,s=void 0),typeof u=="function"||Array.isArray(u))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof u=="number"?u=o.from([u]):typeof u=="string"?u=o.from(u,c):this._isBufferList(u)?u=u.slice():Array.isArray(u.buffer)?u=o.from(u.buffer,u.byteOffset,u.byteLength):o.isBuffer(u)||(u=o.from(u)),s=Number(s||0),isNaN(s)&&(s=0),s<0&&(s=this.length+s),s<0&&(s=0),u.length===0)return s>this.length?this.length:s;const h=this._offset(s);let f=h[0],d=h[1];for(;f<this._bufs.length;f++){const v=this._bufs[f];for(;d<v.length;)if(v.length-d>=u.length){const g=v.indexOf(u,d);if(g!==-1)return this._reverseOffset([f,g]);d=v.length-u.length+1}else{const g=this._reverseOffset([f,d]);if(this._match(g,u))return g;d++}d=0}return-1},l.prototype._match=function(u,s){if(this.length-u<s.length)return!1;for(let c=0;c<s.length;c++)if(this.get(u+c)!==s[c])return!1;return!0},function(){const u={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(const s in u)(function(c){l.prototype[c]=u[c]===null?function(h,f){return this.slice(h,h+f)[c](0,f)}:function(h=0){return this.slice(h,h+u[c])[c](0)}})(s)}(),l.prototype._isBufferList=function(u){return u instanceof l||l.isBufferList(u)},l.isBufferList=function(u){return u!=null&&u[a]},n.exports=l},{buffer:17}],15:[function(i,n,r){const o=i("readable-stream").Duplex,a=i("inherits"),l=i("./BufferList");function u(s){if(!(this instanceof u))return new u(s);if(typeof s=="function"){this._callback=s;const c=function(h){this._callback&&(this._callback(h),this._callback=null)}.bind(this);this.on("pipe",function(h){h.on("error",c)}),this.on("unpipe",function(h){h.removeListener("error",c)}),s=null}l._init.call(this,s),o.call(this)}a(u,o),Object.assign(u.prototype,l.prototype),u.prototype._new=function(s){return new u(s)},u.prototype._write=function(s,c,h){this._appendBuffer(s),typeof h=="function"&&h()},u.prototype._read=function(s){if(!this.length)return this.push(null);s=Math.min(s,this.length),this.push(this.slice(0,s)),this.consume(s)},u.prototype.end=function(s){o.prototype.end.call(this,s),this._callback&&(this._callback(null,this.slice()),this._callback=null)},u.prototype._destroy=function(s,c){this._bufs.length=0,this.length=0,c(s)},u.prototype._isBufferList=function(s){return s instanceof u||s instanceof l||u.isBufferList(s)},u.isBufferList=l.isBufferList,n.exports=u,n.exports.BufferListStream=u,n.exports.BufferList=l},{"./BufferList":14,inherits:24,"readable-stream":69}],16:[function(i,n,r){},{}],17:[function(i,n,r){(function(o){(function(){var a=i("base64-js"),l=i("ieee754");r.Buffer=c,r.SlowBuffer=function(y){return+y!=y&&(y=0),c.alloc(+y)},r.INSPECT_MAX_BYTES=50;var u=2147483647;function s(y){if(y>u)throw new RangeError('The value "'+y+'" is invalid for option "size"');var w=new Uint8Array(y);return w.__proto__=c.prototype,w}function c(y,w,A){if(typeof y=="number"){if(typeof w=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return d(y)}return h(y,w,A)}function h(y,w,A){if(typeof y=="string")return function(E,j){if(typeof j=="string"&&j!==""||(j="utf8"),!c.isEncoding(j))throw new TypeError("Unknown encoding: "+j);var Y=0|p(E,j),K=s(Y),G=K.write(E,j);return G!==Y&&(K=K.slice(0,G)),K}(y,w);if(ArrayBuffer.isView(y))return v(y);if(y==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof y);if(J(y,ArrayBuffer)||y&&J(y.buffer,ArrayBuffer))return function(E,j,Y){if(j<0||E.byteLength<j)throw new RangeError('"offset" is outside of buffer bounds');if(E.byteLength<j+(Y||0))throw new RangeError('"length" is outside of buffer bounds');var K;return K=j===void 0&&Y===void 0?new Uint8Array(E):Y===void 0?new Uint8Array(E,j):new Uint8Array(E,j,Y),K.__proto__=c.prototype,K}(y,w,A);if(typeof y=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var O=y.valueOf&&y.valueOf();if(O!=null&&O!==y)return c.from(O,w,A);var S=function(E){if(c.isBuffer(E)){var j=0|g(E.length),Y=s(j);return Y.length===0||E.copy(Y,0,0,j),Y}if(E.length!==void 0)return typeof E.length!="number"||te(E.length)?s(0):v(E);if(E.type==="Buffer"&&Array.isArray(E.data))return v(E.data)}(y);if(S)return S;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof y[Symbol.toPrimitive]=="function")return c.from(y[Symbol.toPrimitive]("string"),w,A);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof y)}function f(y){if(typeof y!="number")throw new TypeError('"size" argument must be of type number');if(y<0)throw new RangeError('The value "'+y+'" is invalid for option "size"')}function d(y){return f(y),s(y<0?0:0|g(y))}function v(y){for(var w=y.length<0?0:0|g(y.length),A=s(w),O=0;O<w;O+=1)A[O]=255&y[O];return A}function g(y){if(y>=u)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+u.toString(16)+" bytes");return 0|y}function p(y,w){if(c.isBuffer(y))return y.length;if(ArrayBuffer.isView(y)||J(y,ArrayBuffer))return y.byteLength;if(typeof y!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof y);var A=y.length,O=arguments.length>2&&arguments[2]===!0;if(!O&&A===0)return 0;for(var S=!1;;)switch(w){case"ascii":case"latin1":case"binary":return A;case"utf8":case"utf-8":return X(y).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*A;case"hex":return A>>>1;case"base64":return $(y).length;default:if(S)return O?-1:X(y).length;w=(""+w).toLowerCase(),S=!0}}function b(y,w,A){var O=y[w];y[w]=y[A],y[A]=O}function x(y,w,A,O,S){if(y.length===0)return-1;if(typeof A=="string"?(O=A,A=0):A>2147483647?A=2147483647:A<-2147483648&&(A=-2147483648),te(A=+A)&&(A=S?0:y.length-1),A<0&&(A=y.length+A),A>=y.length){if(S)return-1;A=y.length-1}else if(A<0){if(!S)return-1;A=0}if(typeof w=="string"&&(w=c.from(w,O)),c.isBuffer(w))return w.length===0?-1:m(y,w,A,O,S);if(typeof w=="number")return w&=255,typeof Uint8Array.prototype.indexOf=="function"?S?Uint8Array.prototype.indexOf.call(y,w,A):Uint8Array.prototype.lastIndexOf.call(y,w,A):m(y,[w],A,O,S);throw new TypeError("val must be string, number or Buffer")}function m(y,w,A,O,S){var E,j=1,Y=y.length,K=w.length;if(O!==void 0&&((O=String(O).toLowerCase())==="ucs2"||O==="ucs-2"||O==="utf16le"||O==="utf-16le")){if(y.length<2||w.length<2)return-1;j=2,Y/=2,K/=2,A/=2}function G(re,ae){return j===1?re[ae]:re.readUInt16BE(ae*j)}if(S){var ee=-1;for(E=A;E<Y;E++)if(G(y,E)===G(w,ee===-1?0:E-ee)){if(ee===-1&&(ee=E),E-ee+1===K)return ee*j}else ee!==-1&&(E-=E-ee),ee=-1}else for(A+K>Y&&(A=Y-K),E=A;E>=0;E--){for(var ie=!0,ne=0;ne<K;ne++)if(G(y,E+ne)!==G(w,ne)){ie=!1;break}if(ie)return E}return-1}function _(y,w,A,O){A=Number(A)||0;var S=y.length-A;O?(O=Number(O))>S&&(O=S):O=S;var E=w.length;O>E/2&&(O=E/2);for(var j=0;j<O;++j){var Y=parseInt(w.substr(2*j,2),16);if(te(Y))return j;y[A+j]=Y}return j}function P(y,w,A,O){return Z(X(w,y.length-A),y,A,O)}function R(y,w,A,O){return Z(function(S){for(var E=[],j=0;j<S.length;++j)E.push(255&S.charCodeAt(j));return E}(w),y,A,O)}function L(y,w,A,O){return R(y,w,A,O)}function I(y,w,A,O){return Z($(w),y,A,O)}function V(y,w,A,O){return Z(function(S,E){for(var j,Y,K,G=[],ee=0;ee<S.length&&!((E-=2)<0);++ee)j=S.charCodeAt(ee),Y=j>>8,K=j%256,G.push(K),G.push(Y);return G}(w,y.length-A),y,A,O)}function Q(y,w,A){return w===0&&A===y.length?a.fromByteArray(y):a.fromByteArray(y.slice(w,A))}function T(y,w,A){A=Math.min(y.length,A);for(var O=[],S=w;S<A;){var E,j,Y,K,G=y[S],ee=null,ie=G>239?4:G>223?3:G>191?2:1;if(S+ie<=A)switch(ie){case 1:G<128&&(ee=G);break;case 2:(192&(E=y[S+1]))==128&&(K=(31&G)<<6|63&E)>127&&(ee=K);break;case 3:E=y[S+1],j=y[S+2],(192&E)==128&&(192&j)==128&&(K=(15&G)<<12|(63&E)<<6|63&j)>2047&&(K<55296||K>57343)&&(ee=K);break;case 4:E=y[S+1],j=y[S+2],Y=y[S+3],(192&E)==128&&(192&j)==128&&(192&Y)==128&&(K=(15&G)<<18|(63&E)<<12|(63&j)<<6|63&Y)>65535&&K<1114112&&(ee=K)}ee===null?(ee=65533,ie=1):ee>65535&&(ee-=65536,O.push(ee>>>10&1023|55296),ee=56320|1023&ee),O.push(ee),S+=ie}return function(ne){var re=ne.length;if(re<=k)return String.fromCharCode.apply(String,ne);for(var ae="",oe=0;oe<re;)ae+=String.fromCharCode.apply(String,ne.slice(oe,oe+=k));return ae}(O)}r.kMaxLength=u,c.TYPED_ARRAY_SUPPORT=function(){try{var y=new Uint8Array(1);return y.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},y.foo()===42}catch{return!1}}(),c.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),typeof Symbol<"u"&&Symbol.species!=null&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),c.poolSize=8192,c.from=function(y,w,A){return h(y,w,A)},c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,c.alloc=function(y,w,A){return function(O,S,E){return f(O),O<=0?s(O):S!==void 0?typeof E=="string"?s(O).fill(S,E):s(O).fill(S):s(O)}(y,w,A)},c.allocUnsafe=function(y){return d(y)},c.allocUnsafeSlow=function(y){return d(y)},c.isBuffer=function(y){return y!=null&&y._isBuffer===!0&&y!==c.prototype},c.compare=function(y,w){if(J(y,Uint8Array)&&(y=c.from(y,y.offset,y.byteLength)),J(w,Uint8Array)&&(w=c.from(w,w.offset,w.byteLength)),!c.isBuffer(y)||!c.isBuffer(w))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(y===w)return 0;for(var A=y.length,O=w.length,S=0,E=Math.min(A,O);S<E;++S)if(y[S]!==w[S]){A=y[S],O=w[S];break}return A<O?-1:O<A?1:0},c.isEncoding=function(y){switch(String(y).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(y,w){if(!Array.isArray(y))throw new TypeError('"list" argument must be an Array of Buffers');if(y.length===0)return c.alloc(0);var A;if(w===void 0)for(w=0,A=0;A<y.length;++A)w+=y[A].length;var O=c.allocUnsafe(w),S=0;for(A=0;A<y.length;++A){var E=y[A];if(J(E,Uint8Array)&&(E=c.from(E)),!c.isBuffer(E))throw new TypeError('"list" argument must be an Array of Buffers');E.copy(O,S),S+=E.length}return O},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var y=this.length;if(y%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var w=0;w<y;w+=2)b(this,w,w+1);return this},c.prototype.swap32=function(){var y=this.length;if(y%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var w=0;w<y;w+=4)b(this,w,w+3),b(this,w+1,w+2);return this},c.prototype.swap64=function(){var y=this.length;if(y%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var w=0;w<y;w+=8)b(this,w,w+7),b(this,w+1,w+6),b(this,w+2,w+5),b(this,w+3,w+4);return this},c.prototype.toString=function(){var y=this.length;return y===0?"":arguments.length===0?T(this,0,y):function(w,A,O){var S=!1;if((A===void 0||A<0)&&(A=0),A>this.length||((O===void 0||O>this.length)&&(O=this.length),O<=0)||(O>>>=0)<=(A>>>=0))return"";for(w||(w="utf8");;)switch(w){case"hex":return B(this,A,O);case"utf8":case"utf-8":return T(this,A,O);case"ascii":return M(this,A,O);case"latin1":case"binary":return C(this,A,O);case"base64":return Q(this,A,O);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return H(this,A,O);default:if(S)throw new TypeError("Unknown encoding: "+w);w=(w+"").toLowerCase(),S=!0}}.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(y){if(!c.isBuffer(y))throw new TypeError("Argument must be a Buffer");return this===y||c.compare(this,y)===0},c.prototype.inspect=function(){var y="",w=r.INSPECT_MAX_BYTES;return y=this.toString("hex",0,w).replace(/(.{2})/g,"$1 ").trim(),this.length>w&&(y+=" ... "),"<Buffer "+y+">"},c.prototype.compare=function(y,w,A,O,S){if(J(y,Uint8Array)&&(y=c.from(y,y.offset,y.byteLength)),!c.isBuffer(y))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof y);if(w===void 0&&(w=0),A===void 0&&(A=y?y.length:0),O===void 0&&(O=0),S===void 0&&(S=this.length),w<0||A>y.length||O<0||S>this.length)throw new RangeError("out of range index");if(O>=S&&w>=A)return 0;if(O>=S)return-1;if(w>=A)return 1;if(w>>>=0,A>>>=0,O>>>=0,S>>>=0,this===y)return 0;for(var E=S-O,j=A-w,Y=Math.min(E,j),K=this.slice(O,S),G=y.slice(w,A),ee=0;ee<Y;++ee)if(K[ee]!==G[ee]){E=K[ee],j=G[ee];break}return E<j?-1:j<E?1:0},c.prototype.includes=function(y,w,A){return this.indexOf(y,w,A)!==-1},c.prototype.indexOf=function(y,w,A){return x(this,y,w,A,!0)},c.prototype.lastIndexOf=function(y,w,A){return x(this,y,w,A,!1)},c.prototype.write=function(y,w,A,O){if(w===void 0)O="utf8",A=this.length,w=0;else if(A===void 0&&typeof w=="string")O=w,A=this.length,w=0;else{if(!isFinite(w))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");w>>>=0,isFinite(A)?(A>>>=0,O===void 0&&(O="utf8")):(O=A,A=void 0)}var S=this.length-w;if((A===void 0||A>S)&&(A=S),y.length>0&&(A<0||w<0)||w>this.length)throw new RangeError("Attempt to write outside buffer bounds");O||(O="utf8");for(var E=!1;;)switch(O){case"hex":return _(this,y,w,A);case"utf8":case"utf-8":return P(this,y,w,A);case"ascii":return R(this,y,w,A);case"latin1":case"binary":return L(this,y,w,A);case"base64":return I(this,y,w,A);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,y,w,A);default:if(E)throw new TypeError("Unknown encoding: "+O);O=(""+O).toLowerCase(),E=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function M(y,w,A){var O="";A=Math.min(y.length,A);for(var S=w;S<A;++S)O+=String.fromCharCode(127&y[S]);return O}function C(y,w,A){var O="";A=Math.min(y.length,A);for(var S=w;S<A;++S)O+=String.fromCharCode(y[S]);return O}function B(y,w,A){var O=y.length;(!w||w<0)&&(w=0),(!A||A<0||A>O)&&(A=O);for(var S="",E=w;E<A;++E)S+=q(y[E]);return S}function H(y,w,A){for(var O=y.slice(w,A),S="",E=0;E<O.length;E+=2)S+=String.fromCharCode(O[E]+256*O[E+1]);return S}function W(y,w,A){if(y%1!=0||y<0)throw new RangeError("offset is not uint");if(y+w>A)throw new RangeError("Trying to access beyond buffer length")}function F(y,w,A,O,S,E){if(!c.isBuffer(y))throw new TypeError('"buffer" argument must be a Buffer instance');if(w>S||w<E)throw new RangeError('"value" argument is out of bounds');if(A+O>y.length)throw new RangeError("Index out of range")}function D(y,w,A,O,S,E){if(A+O>y.length)throw new RangeError("Index out of range");if(A<0)throw new RangeError("Index out of range")}function z(y,w,A,O,S){return w=+w,A>>>=0,S||D(y,0,A,4),l.write(y,w,A,O,23,4),A+4}function U(y,w,A,O,S){return w=+w,A>>>=0,S||D(y,0,A,8),l.write(y,w,A,O,52,8),A+8}c.prototype.slice=function(y,w){var A=this.length;y=~~y,w=w===void 0?A:~~w,y<0?(y+=A)<0&&(y=0):y>A&&(y=A),w<0?(w+=A)<0&&(w=0):w>A&&(w=A),w<y&&(w=y);var O=this.subarray(y,w);return O.__proto__=c.prototype,O},c.prototype.readUIntLE=function(y,w,A){y>>>=0,w>>>=0,A||W(y,w,this.length);for(var O=this[y],S=1,E=0;++E<w&&(S*=256);)O+=this[y+E]*S;return O},c.prototype.readUIntBE=function(y,w,A){y>>>=0,w>>>=0,A||W(y,w,this.length);for(var O=this[y+--w],S=1;w>0&&(S*=256);)O+=this[y+--w]*S;return O},c.prototype.readUInt8=function(y,w){return y>>>=0,w||W(y,1,this.length),this[y]},c.prototype.readUInt16LE=function(y,w){return y>>>=0,w||W(y,2,this.length),this[y]|this[y+1]<<8},c.prototype.readUInt16BE=function(y,w){return y>>>=0,w||W(y,2,this.length),this[y]<<8|this[y+1]},c.prototype.readUInt32LE=function(y,w){return y>>>=0,w||W(y,4,this.length),(this[y]|this[y+1]<<8|this[y+2]<<16)+16777216*this[y+3]},c.prototype.readUInt32BE=function(y,w){return y>>>=0,w||W(y,4,this.length),16777216*this[y]+(this[y+1]<<16|this[y+2]<<8|this[y+3])},c.prototype.readIntLE=function(y,w,A){y>>>=0,w>>>=0,A||W(y,w,this.length);for(var O=this[y],S=1,E=0;++E<w&&(S*=256);)O+=this[y+E]*S;return O>=(S*=128)&&(O-=Math.pow(2,8*w)),O},c.prototype.readIntBE=function(y,w,A){y>>>=0,w>>>=0,A||W(y,w,this.length);for(var O=w,S=1,E=this[y+--O];O>0&&(S*=256);)E+=this[y+--O]*S;return E>=(S*=128)&&(E-=Math.pow(2,8*w)),E},c.prototype.readInt8=function(y,w){return y>>>=0,w||W(y,1,this.length),128&this[y]?-1*(255-this[y]+1):this[y]},c.prototype.readInt16LE=function(y,w){y>>>=0,w||W(y,2,this.length);var A=this[y]|this[y+1]<<8;return 32768&A?4294901760|A:A},c.prototype.readInt16BE=function(y,w){y>>>=0,w||W(y,2,this.length);var A=this[y+1]|this[y]<<8;return 32768&A?4294901760|A:A},c.prototype.readInt32LE=function(y,w){return y>>>=0,w||W(y,4,this.length),this[y]|this[y+1]<<8|this[y+2]<<16|this[y+3]<<24},c.prototype.readInt32BE=function(y,w){return y>>>=0,w||W(y,4,this.length),this[y]<<24|this[y+1]<<16|this[y+2]<<8|this[y+3]},c.prototype.readFloatLE=function(y,w){return y>>>=0,w||W(y,4,this.length),l.read(this,y,!0,23,4)},c.prototype.readFloatBE=function(y,w){return y>>>=0,w||W(y,4,this.length),l.read(this,y,!1,23,4)},c.prototype.readDoubleLE=function(y,w){return y>>>=0,w||W(y,8,this.length),l.read(this,y,!0,52,8)},c.prototype.readDoubleBE=function(y,w){return y>>>=0,w||W(y,8,this.length),l.read(this,y,!1,52,8)},c.prototype.writeUIntLE=function(y,w,A,O){y=+y,w>>>=0,A>>>=0,O||F(this,y,w,A,Math.pow(2,8*A)-1,0);var S=1,E=0;for(this[w]=255&y;++E<A&&(S*=256);)this[w+E]=y/S&255;return w+A},c.prototype.writeUIntBE=function(y,w,A,O){y=+y,w>>>=0,A>>>=0,O||F(this,y,w,A,Math.pow(2,8*A)-1,0);var S=A-1,E=1;for(this[w+S]=255&y;--S>=0&&(E*=256);)this[w+S]=y/E&255;return w+A},c.prototype.writeUInt8=function(y,w,A){return y=+y,w>>>=0,A||F(this,y,w,1,255,0),this[w]=255&y,w+1},c.prototype.writeUInt16LE=function(y,w,A){return y=+y,w>>>=0,A||F(this,y,w,2,65535,0),this[w]=255&y,this[w+1]=y>>>8,w+2},c.prototype.writeUInt16BE=function(y,w,A){return y=+y,w>>>=0,A||F(this,y,w,2,65535,0),this[w]=y>>>8,this[w+1]=255&y,w+2},c.prototype.writeUInt32LE=function(y,w,A){return y=+y,w>>>=0,A||F(this,y,w,4,4294967295,0),this[w+3]=y>>>24,this[w+2]=y>>>16,this[w+1]=y>>>8,this[w]=255&y,w+4},c.prototype.writeUInt32BE=function(y,w,A){return y=+y,w>>>=0,A||F(this,y,w,4,4294967295,0),this[w]=y>>>24,this[w+1]=y>>>16,this[w+2]=y>>>8,this[w+3]=255&y,w+4},c.prototype.writeIntLE=function(y,w,A,O){if(y=+y,w>>>=0,!O){var S=Math.pow(2,8*A-1);F(this,y,w,A,S-1,-S)}var E=0,j=1,Y=0;for(this[w]=255&y;++E<A&&(j*=256);)y<0&&Y===0&&this[w+E-1]!==0&&(Y=1),this[w+E]=(y/j>>0)-Y&255;return w+A},c.prototype.writeIntBE=function(y,w,A,O){if(y=+y,w>>>=0,!O){var S=Math.pow(2,8*A-1);F(this,y,w,A,S-1,-S)}var E=A-1,j=1,Y=0;for(this[w+E]=255&y;--E>=0&&(j*=256);)y<0&&Y===0&&this[w+E+1]!==0&&(Y=1),this[w+E]=(y/j>>0)-Y&255;return w+A},c.prototype.writeInt8=function(y,w,A){return y=+y,w>>>=0,A||F(this,y,w,1,127,-128),y<0&&(y=255+y+1),this[w]=255&y,w+1},c.prototype.writeInt16LE=function(y,w,A){return y=+y,w>>>=0,A||F(this,y,w,2,32767,-32768),this[w]=255&y,this[w+1]=y>>>8,w+2},c.prototype.writeInt16BE=function(y,w,A){return y=+y,w>>>=0,A||F(this,y,w,2,32767,-32768),this[w]=y>>>8,this[w+1]=255&y,w+2},c.prototype.writeInt32LE=function(y,w,A){return y=+y,w>>>=0,A||F(this,y,w,4,2147483647,-2147483648),this[w]=255&y,this[w+1]=y>>>8,this[w+2]=y>>>16,this[w+3]=y>>>24,w+4},c.prototype.writeInt32BE=function(y,w,A){return y=+y,w>>>=0,A||F(this,y,w,4,2147483647,-2147483648),y<0&&(y=4294967295+y+1),this[w]=y>>>24,this[w+1]=y>>>16,this[w+2]=y>>>8,this[w+3]=255&y,w+4},c.prototype.writeFloatLE=function(y,w,A){return z(this,y,w,!0,A)},c.prototype.writeFloatBE=function(y,w,A){return z(this,y,w,!1,A)},c.prototype.writeDoubleLE=function(y,w,A){return U(this,y,w,!0,A)},c.prototype.writeDoubleBE=function(y,w,A){return U(this,y,w,!1,A)},c.prototype.copy=function(y,w,A,O){if(!c.isBuffer(y))throw new TypeError("argument should be a Buffer");if(A||(A=0),O||O===0||(O=this.length),w>=y.length&&(w=y.length),w||(w=0),O>0&&O<A&&(O=A),O===A||y.length===0||this.length===0)return 0;if(w<0)throw new RangeError("targetStart out of bounds");if(A<0||A>=this.length)throw new RangeError("Index out of range");if(O<0)throw new RangeError("sourceEnd out of bounds");O>this.length&&(O=this.length),y.length-w<O-A&&(O=y.length-w+A);var S=O-A;if(this===y&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(w,A,O);else if(this===y&&A<w&&w<O)for(var E=S-1;E>=0;--E)y[E+w]=this[E+A];else Uint8Array.prototype.set.call(y,this.subarray(A,O),w);return S},c.prototype.fill=function(y,w,A,O){if(typeof y=="string"){if(typeof w=="string"?(O=w,w=0,A=this.length):typeof A=="string"&&(O=A,A=this.length),O!==void 0&&typeof O!="string")throw new TypeError("encoding must be a string");if(typeof O=="string"&&!c.isEncoding(O))throw new TypeError("Unknown encoding: "+O);if(y.length===1){var S=y.charCodeAt(0);(O==="utf8"&&S<128||O==="latin1")&&(y=S)}}else typeof y=="number"&&(y&=255);if(w<0||this.length<w||this.length<A)throw new RangeError("Out of range index");if(A<=w)return this;var E;if(w>>>=0,A=A===void 0?this.length:A>>>0,y||(y=0),typeof y=="number")for(E=w;E<A;++E)this[E]=y;else{var j=c.isBuffer(y)?y:c.from(y,O),Y=j.length;if(Y===0)throw new TypeError('The value "'+y+'" is invalid for argument "value"');for(E=0;E<A-w;++E)this[E+w]=j[E%Y]}return this};var N=/[^+/0-9A-Za-z-_]/g;function q(y){return y<16?"0"+y.toString(16):y.toString(16)}function X(y,w){var A;w=w||1/0;for(var O=y.length,S=null,E=[],j=0;j<O;++j){if((A=y.charCodeAt(j))>55295&&A<57344){if(!S){if(A>56319){(w-=3)>-1&&E.push(239,191,189);continue}if(j+1===O){(w-=3)>-1&&E.push(239,191,189);continue}S=A;continue}if(A<56320){(w-=3)>-1&&E.push(239,191,189),S=A;continue}A=65536+(S-55296<<10|A-56320)}else S&&(w-=3)>-1&&E.push(239,191,189);if(S=null,A<128){if((w-=1)<0)break;E.push(A)}else if(A<2048){if((w-=2)<0)break;E.push(A>>6|192,63&A|128)}else if(A<65536){if((w-=3)<0)break;E.push(A>>12|224,A>>6&63|128,63&A|128)}else{if(!(A<1114112))throw new Error("Invalid code point");if((w-=4)<0)break;E.push(A>>18|240,A>>12&63|128,A>>6&63|128,63&A|128)}}return E}function $(y){return a.toByteArray(function(w){if((w=(w=w.split("=")[0]).trim().replace(N,"")).length<2)return"";for(;w.length%4!=0;)w+="=";return w}(y))}function Z(y,w,A,O){for(var S=0;S<O&&!(S+A>=w.length||S>=y.length);++S)w[S+A]=y[S];return S}function J(y,w){return y instanceof w||y!=null&&y.constructor!=null&&y.constructor.name!=null&&y.constructor.name===w.name}function te(y){return y!=y}}).call(this)}).call(this,i("buffer").Buffer)},{"base64-js":13,buffer:17,ieee754:23}],18:[function(i,n,r){(function(o){(function(){r.formatArgs=function(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let s=0,c=0;l[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&h==="%c"&&(c=++s)}),l.splice(c,0,u)},r.save=function(l){try{l?r.storage.setItem("debug",l):r.storage.removeItem("debug")}catch{}},r.load=function(){let l;try{l=r.storage.getItem("debug")}catch{}return!l&&o!==void 0&&"env"in o&&(l=o.env.DEBUG),l},r.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage=function(){try{return localStorage}catch{}}(),r.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],r.log=console.debug||console.log||(()=>{}),n.exports=i("./common")(r);const{formatters:a}=n.exports;a.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}}).call(this)}).call(this,i("_process"))},{"./common":19,_process:50}],19:[function(i,n,r){n.exports=function(o){function a(s){let c,h,f,d=null;function v(...g){if(!v.enabled)return;const p=v,b=Number(new Date),x=b-(c||b);p.diff=x,p.prev=c,p.curr=b,c=b,g[0]=a.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");let m=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,(_,P)=>{if(_==="%%")return"%";m++;const R=a.formatters[P];if(typeof R=="function"){const L=g[m];_=R.call(p,L),g.splice(m,1),m--}return _}),a.formatArgs.call(p,g),(p.log||a.log).apply(p,g)}return v.namespace=s,v.useColors=a.useColors(),v.color=a.selectColor(s),v.extend=l,v.destroy=a.destroy,Object.defineProperty(v,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(h!==a.namespaces&&(h=a.namespaces,f=a.enabled(s)),f),set:g=>{d=g}}),typeof a.init=="function"&&a.init(v),v}function l(s,c){const h=a(this.namespace+(c===void 0?":":c)+s);return h.log=this.log,h}function u(s){return s.toString().substring(2,s.toString().length-2).replace(/\.\*\?$/,"*")}return a.debug=a,a.default=a,a.coerce=function(s){return s instanceof Error?s.stack||s.message:s},a.disable=function(){const s=[...a.names.map(u),...a.skips.map(u).map(c=>"-"+c)].join(",");return a.enable(""),s},a.enable=function(s){let c;a.save(s),a.namespaces=s,a.names=[],a.skips=[];const h=(typeof s=="string"?s:"").split(/[\s,]+/),f=h.length;for(c=0;c<f;c++)h[c]&&((s=h[c].replace(/\*/g,".*?"))[0]==="-"?a.skips.push(new RegExp("^"+s.substr(1)+"$")):a.names.push(new RegExp("^"+s+"$")))},a.enabled=function(s){if(s[s.length-1]==="*")return!0;let c,h;for(c=0,h=a.skips.length;c<h;c++)if(a.skips[c].test(s))return!1;for(c=0,h=a.names.length;c<h;c++)if(a.names[c].test(s))return!0;return!1},a.humanize=i("ms"),a.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(o).forEach(s=>{a[s]=o[s]}),a.names=[],a.skips=[],a.formatters={},a.selectColor=function(s){let c=0;for(let h=0;h<s.length;h++)c=(c<<5)-c+s.charCodeAt(h),c|=0;return a.colors[Math.abs(c)%a.colors.length]},a.enable(a.load()),a}},{ms:45}],20:[function(i,n,r){(function(o,a){(function(){var l=i("readable-stream"),u=i("end-of-stream"),s=i("inherits"),c=i("stream-shift"),h=a.from&&a.from!==Uint8Array.from?a.from([0]):new a([0]),f=function(p,b){p._corked?p.once("uncork",b):b()},d=function(p,b){return function(x){x?function(m,_){m._autoDestroy&&m.destroy(_)}(p,x.message==="premature close"?null:x):b&&!p._ended&&p.end()}},v=function(){},g=function(p,b,x){if(!(this instanceof g))return new g(p,b,x);l.Duplex.call(this,x),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!x||x.autoDestroy!==!1,this._forwardDestroy=!x||x.destroy!==!1,this._forwardEnd=!x||x.end!==!1,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,p&&this.setWritable(p),b&&this.setReadable(b)};s(g,l.Duplex),g.obj=function(p,b,x){return x||(x={}),x.objectMode=!0,x.highWaterMark=16,new g(p,b,x)},g.prototype.cork=function(){++this._corked==1&&this.emit("cork")},g.prototype.uncork=function(){this._corked&&--this._corked==0&&this.emit("uncork")},g.prototype.setWritable=function(p){if(this._unwrite&&this._unwrite(),this.destroyed)p&&p.destroy&&p.destroy();else if(p!==null&&p!==!1){var b=this,x=u(p,{writable:!0,readable:!1},d(this,this._forwardEnd)),m=function(){var _=b._ondrain;b._ondrain=null,_&&_()};this._unwrite&&o.nextTick(m),this._writable=p,this._writable.on("drain",m),this._unwrite=function(){b._writable.removeListener("drain",m),x()},this.uncork()}else this.end()},g.prototype.setReadable=function(p){if(this._unread&&this._unread(),this.destroyed)p&&p.destroy&&p.destroy();else{if(p===null||p===!1)return this.push(null),void this.resume();var b,x=this,m=u(p,{writable:!1,readable:!0},d(this)),_=function(){x._forward()},P=function(){x.push(null)};this._drained=!0,this._readable=p,this._readable2=p._readableState?p:(b=p,new l.Readable({objectMode:!0,highWaterMark:16}).wrap(b)),this._readable2.on("readable",_),this._readable2.on("end",P),this._unread=function(){x._readable2.removeListener("readable",_),x._readable2.removeListener("end",P),m()},this._forward()}},g.prototype._read=function(){this._drained=!0,this._forward()},g.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){var p;for(this._forwarding=!0;this._drained&&(p=c(this._readable2))!==null;)this.destroyed||(this._drained=this.push(p));this._forwarding=!1}},g.prototype.destroy=function(p,b){if(b||(b=v),this.destroyed)return b(null);this.destroyed=!0;var x=this;o.nextTick(function(){x._destroy(p),b(null)})},g.prototype._destroy=function(p){if(p){var b=this._ondrain;this._ondrain=null,b?b(p):this.emit("error",p)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")},g.prototype._write=function(p,b,x){if(!this.destroyed)return this._corked?f(this,this._write.bind(this,p,b,x)):p===h?this._finish(x):this._writable?void(this._writable.write(p)===!1?this._ondrain=x:this.destroyed||x()):x()},g.prototype._finish=function(p){var b=this;this.emit("preend"),f(this,function(){var x,m;x=b._forwardEnd&&b._writable,m=function(){b._writableState.prefinished===!1&&(b._writableState.prefinished=!0),b.emit("prefinish"),f(b,p)},x?x._writableState&&x._writableState.finished?m():x._writableState?x.end(m):(x.end(),m()):m()})},g.prototype.end=function(p,b,x){return typeof p=="function"?this.end(null,null,p):typeof b=="function"?this.end(p,null,b):(this._ended=!0,p&&this.write(p),this._writableState.ending||this._writableState.destroyed||this.write(h),l.Writable.prototype.end.call(this,x))},n.exports=g}).call(this)}).call(this,i("_process"),i("buffer").Buffer)},{_process:50,buffer:17,"end-of-stream":21,inherits:24,"readable-stream":69,"stream-shift":74}],21:[function(i,n,r){(function(o){(function(){var a=i("once"),l=function(){},u=function(s,c,h){if(typeof c=="function")return u(s,null,c);c||(c={}),h=a(h||l);var f=s._writableState,d=s._readableState,v=c.readable||c.readable!==!1&&s.readable,g=c.writable||c.writable!==!1&&s.writable,p=!1,b=function(){s.writable||x()},x=function(){g=!1,v||h.call(s)},m=function(){v=!1,g||h.call(s)},_=function(V){h.call(s,V?new Error("exited with error code: "+V):null)},P=function(V){h.call(s,V)},R=function(){o.nextTick(L)},L=function(){if(!p)return(!v||d&&d.ended&&!d.destroyed)&&(!g||f&&f.ended&&!f.destroyed)?void 0:h.call(s,new Error("premature close"))},I=function(){s.req.on("finish",x)};return function(V){return V.setHeader&&typeof V.abort=="function"}(s)?(s.on("complete",x),s.on("abort",R),s.req?I():s.on("request",I)):g&&!f&&(s.on("end",b),s.on("close",b)),function(V){return V.stdio&&Array.isArray(V.stdio)&&V.stdio.length===3}(s)&&s.on("exit",_),s.on("end",m),s.on("finish",x),c.error!==!1&&s.on("error",P),s.on("close",R),function(){p=!0,s.removeListener("complete",x),s.removeListener("abort",R),s.removeListener("request",I),s.req&&s.req.removeListener("finish",x),s.removeListener("end",b),s.removeListener("close",b),s.removeListener("finish",x),s.removeListener("exit",_),s.removeListener("end",m),s.removeListener("error",P),s.removeListener("close",R)}};n.exports=u}).call(this)}).call(this,i("_process"))},{_process:50,once:48}],22:[function(i,n,r){var o=Object.create||function(m){var _=function(){};return _.prototype=m,new _},a=Object.keys||function(m){var _=[];for(var P in m)Object.prototype.hasOwnProperty.call(m,P)&&_.push(P);return P},l=Function.prototype.bind||function(m){var _=this;return function(){return _.apply(m,arguments)}};function u(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=o(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}n.exports=u,u.EventEmitter=u,u.prototype._events=void 0,u.prototype._maxListeners=void 0;var s,c=10;try{var h={};Object.defineProperty&&Object.defineProperty(h,"x",{value:0}),s=h.x===0}catch{s=!1}function f(m){return m._maxListeners===void 0?u.defaultMaxListeners:m._maxListeners}function d(m,_,P,R){var L,I,V;if(typeof P!="function")throw new TypeError('"listener" argument must be a function');if((I=m._events)?(I.newListener&&(m.emit("newListener",_,P.listener?P.listener:P),I=m._events),V=I[_]):(I=m._events=o(null),m._eventsCount=0),V){if(typeof V=="function"?V=I[_]=R?[P,V]:[V,P]:R?V.unshift(P):V.push(P),!V.warned&&(L=f(m))&&L>0&&V.length>L){V.warned=!0;var Q=new Error("Possible EventEmitter memory leak detected. "+V.length+' "'+String(_)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');Q.name="MaxListenersExceededWarning",Q.emitter=m,Q.type=_,Q.count=V.length,typeof console=="object"&&console.warn&&console.warn("%s: %s",Q.name,Q.message)}}else V=I[_]=P,++m._eventsCount;return m}function v(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var m=new Array(arguments.length),_=0;_<m.length;++_)m[_]=arguments[_];this.listener.apply(this.target,m)}}function g(m,_,P){var R={fired:!1,wrapFn:void 0,target:m,type:_,listener:P},L=l.call(v,R);return L.listener=P,R.wrapFn=L,L}function p(m,_,P){var R=m._events;if(!R)return[];var L=R[_];return L?typeof L=="function"?P?[L.listener||L]:[L]:P?function(I){for(var V=new Array(I.length),Q=0;Q<V.length;++Q)V[Q]=I[Q].listener||I[Q];return V}(L):x(L,L.length):[]}function b(m){var _=this._events;if(_){var P=_[m];if(typeof P=="function")return 1;if(P)return P.length}return 0}function x(m,_){for(var P=new Array(_),R=0;R<_;++R)P[R]=m[R];return P}s?Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(m){if(typeof m!="number"||m<0||m!=m)throw new TypeError('"defaultMaxListeners" must be a positive number');c=m}}):u.defaultMaxListeners=c,u.prototype.setMaxListeners=function(m){if(typeof m!="number"||m<0||isNaN(m))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=m,this},u.prototype.getMaxListeners=function(){return f(this)},u.prototype.emit=function(m){var _,P,R,L,I,V,Q=m==="error";if(V=this._events)Q=Q&&V.error==null;else if(!Q)return!1;if(Q){if(arguments.length>1&&(_=arguments[1]),_ instanceof Error)throw _;var T=new Error('Unhandled "error" event. ('+_+")");throw T.context=_,T}if(!(P=V[m]))return!1;var k=typeof P=="function";switch(R=arguments.length){case 1:(function(M,C,B){if(C)M.call(B);else for(var H=M.length,W=x(M,H),F=0;F<H;++F)W[F].call(B)})(P,k,this);break;case 2:(function(M,C,B,H){if(C)M.call(B,H);else for(var W=M.length,F=x(M,W),D=0;D<W;++D)F[D].call(B,H)})(P,k,this,arguments[1]);break;case 3:(function(M,C,B,H,W){if(C)M.call(B,H,W);else for(var F=M.length,D=x(M,F),z=0;z<F;++z)D[z].call(B,H,W)})(P,k,this,arguments[1],arguments[2]);break;case 4:(function(M,C,B,H,W,F){if(C)M.call(B,H,W,F);else for(var D=M.length,z=x(M,D),U=0;U<D;++U)z[U].call(B,H,W,F)})(P,k,this,arguments[1],arguments[2],arguments[3]);break;default:for(L=new Array(R-1),I=1;I<R;I++)L[I-1]=arguments[I];(function(M,C,B,H){if(C)M.apply(B,H);else for(var W=M.length,F=x(M,W),D=0;D<W;++D)F[D].apply(B,H)})(P,k,this,L)}return!0},u.prototype.addListener=function(m,_){return d(this,m,_,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(m,_){return d(this,m,_,!0)},u.prototype.once=function(m,_){if(typeof _!="function")throw new TypeError('"listener" argument must be a function');return this.on(m,g(this,m,_)),this},u.prototype.prependOnceListener=function(m,_){if(typeof _!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(m,g(this,m,_)),this},u.prototype.removeListener=function(m,_){var P,R,L,I,V;if(typeof _!="function")throw new TypeError('"listener" argument must be a function');if(!(R=this._events))return this;if(!(P=R[m]))return this;if(P===_||P.listener===_)--this._eventsCount==0?this._events=o(null):(delete R[m],R.removeListener&&this.emit("removeListener",m,P.listener||_));else if(typeof P!="function"){for(L=-1,I=P.length-1;I>=0;I--)if(P[I]===_||P[I].listener===_){V=P[I].listener,L=I;break}if(L<0)return this;L===0?P.shift():function(Q,T){for(var k=T,M=k+1,C=Q.length;M<C;k+=1,M+=1)Q[k]=Q[M];Q.pop()}(P,L),P.length===1&&(R[m]=P[0]),R.removeListener&&this.emit("removeListener",m,V||_)}return this},u.prototype.removeAllListeners=function(m){var _,P,R;if(!(P=this._events))return this;if(!P.removeListener)return arguments.length===0?(this._events=o(null),this._eventsCount=0):P[m]&&(--this._eventsCount==0?this._events=o(null):delete P[m]),this;if(arguments.length===0){var L,I=a(P);for(R=0;R<I.length;++R)(L=I[R])!=="removeListener"&&this.removeAllListeners(L);return this.removeAllListeners("removeListener"),this._events=o(null),this._eventsCount=0,this}if(typeof(_=P[m])=="function")this.removeListener(m,_);else if(_)for(R=_.length-1;R>=0;R--)this.removeListener(m,_[R]);return this},u.prototype.listeners=function(m){return p(this,m,!0)},u.prototype.rawListeners=function(m){return p(this,m,!1)},u.listenerCount=function(m,_){return typeof m.listenerCount=="function"?m.listenerCount(_):b.call(m,_)},u.prototype.listenerCount=b,u.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],23:[function(i,n,r){r.read=function(o,a,l,u,s){var c,h,f=8*s-u-1,d=(1<<f)-1,v=d>>1,g=-7,p=l?s-1:0,b=l?-1:1,x=o[a+p];for(p+=b,c=x&(1<<-g)-1,x>>=-g,g+=f;g>0;c=256*c+o[a+p],p+=b,g-=8);for(h=c&(1<<-g)-1,c>>=-g,g+=u;g>0;h=256*h+o[a+p],p+=b,g-=8);if(c===0)c=1-v;else{if(c===d)return h?NaN:1/0*(x?-1:1);h+=Math.pow(2,u),c-=v}return(x?-1:1)*h*Math.pow(2,c-u)},r.write=function(o,a,l,u,s,c){var h,f,d,v=8*c-s-1,g=(1<<v)-1,p=g>>1,b=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,x=u?0:c-1,m=u?1:-1,_=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(f=isNaN(a)?1:0,h=g):(h=Math.floor(Math.log(a)/Math.LN2),a*(d=Math.pow(2,-h))<1&&(h--,d*=2),(a+=h+p>=1?b/d:b*Math.pow(2,1-p))*d>=2&&(h++,d/=2),h+p>=g?(f=0,h=g):h+p>=1?(f=(a*d-1)*Math.pow(2,s),h+=p):(f=a*Math.pow(2,p-1)*Math.pow(2,s),h=0));s>=8;o[l+x]=255&f,x+=m,f/=256,s-=8);for(h=h<<s|f,v+=s;v>0;o[l+x]=255&h,x+=m,h/=256,v-=8);o[l+x-m]|=128*_}},{}],24:[function(i,n,r){typeof Object.create=="function"?n.exports=function(o,a){a&&(o.super_=a,o.prototype=Object.create(a.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}))}:n.exports=function(o,a){if(a){o.super_=a;var l=function(){};l.prototype=a.prototype,o.prototype=new l,o.prototype.constructor=o}}},{}],25:[function(i,n,r){Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function a(l,u){this.color=!0,this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0,this.leftChild=void 0,this.rightChild=void 0,this.key=l,this.value=u}return a.prototype.rotateLeft=function(){var l=this.parent,u=this.brother,s=this.leftChild,c=this.rightChild;if(!c)throw new Error("unknown error");var h=c.leftChild,f=c.rightChild;return l&&(l.leftChild===this?l.leftChild=c:l.rightChild===this&&(l.rightChild=c)),c.parent=l,c.brother=u,c.leftChild=this,c.rightChild=f,u&&(u.brother=c),this.parent=c,this.brother=f,this.leftChild=s,this.rightChild=h,f&&(f.parent=c,f.brother=this),s&&(s.parent=this,s.brother=h),h&&(h.parent=this,h.brother=s),c},a.prototype.rotateRight=function(){var l=this.parent,u=this.brother,s=this.leftChild;if(!s)throw new Error("unknown error");var c=this.rightChild,h=s.leftChild,f=s.rightChild;return l&&(l.leftChild===this?l.leftChild=s:l.rightChild===this&&(l.rightChild=s)),s.parent=l,s.brother=u,s.leftChild=h,s.rightChild=this,u&&(u.brother=s),h&&(h.parent=s,h.brother=this),this.parent=s,this.brother=h,this.leftChild=f,this.rightChild=c,f&&(f.parent=this,f.brother=c),c&&(c.parent=this,c.brother=f),s},a.prototype.remove=function(){if(this.leftChild||this.rightChild)throw new Error("can only remove leaf node");this.parent&&(this===this.parent.leftChild?this.parent.leftChild=void 0:this===this.parent.rightChild&&(this.parent.rightChild=void 0)),this.brother&&(this.brother.brother=void 0),this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0},a.TreeNodeColorType={red:!0,black:!1},a}();Object.freeze(o),r.default=o},{}],26:[function(i,n,r){var o=this&&this.__generator||function(l,u){var s,c,h,f,d={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return f={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function v(g){return function(p){return function(b){if(s)throw new TypeError("Generator is already executing.");for(;d;)try{if(s=1,c&&(h=2&b[0]?c.return:b[0]?c.throw||((h=c.return)&&h.call(c),0):c.next)&&!(h=h.call(c,b[1])).done)return h;switch(c=0,h&&(b=[2&b[0],h.value]),b[0]){case 0:case 1:h=b;break;case 4:return d.label++,{value:b[1],done:!1};case 5:d.label++,c=b[1],b=[0];continue;case 7:b=d.ops.pop(),d.trys.pop();continue;default:if(!(h=(h=d.trys).length>0&&h[h.length-1])&&(b[0]===6||b[0]===2)){d=0;continue}if(b[0]===3&&(!h||b[1]>h[0]&&b[1]<h[3])){d.label=b[1];break}if(b[0]===6&&d.label<h[1]){d.label=h[1],h=b;break}if(h&&d.label<h[2]){d.label=h[2],d.ops.push(b);break}h[2]&&d.ops.pop(),d.trys.pop();continue}b=u.call(l,d)}catch(x){b=[6,x],c=0}finally{s=h=0}if(5&b[0])throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}([g,p])}}};function a(l){var u=this;l===void 0&&(l=[]);var s=[],c=0,h=0,f=0,d=0,v=0,g=0;this.size=function(){return g},this.empty=function(){return g===0},this.clear=function(){c=f=h=d=v=g=0,b.call(this,a.bucketSize),g=0},this.front=function(){return s[c][h]},this.back=function(){return s[f][d]},this.forEach=function(x){if(!this.empty()){var m=0;if(c!==f){for(P=h;P<a.bucketSize;++P)x(s[c][P],m++);for(P=c+1;P<f;++P)for(var _=0;_<a.bucketSize;++_)x(s[P][_],m++);for(P=0;P<=d;++P)x(s[f][P],m++)}else for(var P=h;P<=d;++P)x(s[c][P],m++)}};var p=function(x){var m=c*a.bucketSize+h,_=m+x,P=f*a.bucketSize+d;if(_<m||_>P)throw new Error("pos should more than 0 and less than queue's size");return{curNodeBucketIndex:Math.floor(_/a.bucketSize),curNodePointerIndex:_%a.bucketSize}};this.getElementByPos=function(x){var m=p(x),_=m.curNodeBucketIndex,P=m.curNodePointerIndex;return s[_][P]},this.eraseElementByPos=function(x){var m=this;if(x<0||x>g)throw new Error("pos should more than 0 and less than queue's size");if(x===0)this.popFront();else if(x===this.size())this.popBack();else{for(var _=[],P=x+1;P<g;++P)_.push(this.getElementByPos(P));this.cut(x),this.popBack(),_.forEach(function(R){return m.pushBack(R)})}},this.eraseElementByValue=function(x){if(!this.empty()){var m=[];this.forEach(function(R){R!==x&&m.push(R)});for(var _=m.length,P=0;P<_;++P)this.setElementByPos(P,m[P]);this.cut(_-1)}};var b=function(x){for(var m=[],_=x*a.sigma,P=Math.max(Math.ceil(_/a.bucketSize),2),R=0;R<P;++R)m.push(new Array(a.bucketSize));var L=Math.ceil(x/a.bucketSize),I=Math.floor(P/2)-Math.floor(L/2),V=I,Q=0;if(this.size())for(R=0;R<L;++R){for(var T=0;T<a.bucketSize;++T)if(m[I+R][T]=this.front(),this.popFront(),this.empty()){V=I+R,Q=T;break}if(this.empty())break}s=m,c=I,h=0,f=V,d=Q,v=P,g=x};this.pushBack=function(x){this.empty()||(f===v-1&&d===a.bucketSize-1&&b.call(this,this.size()),d<a.bucketSize-1?++d:f<v-1&&(++f,d=0)),++g,s[f][d]=x},this.popBack=function(){this.empty()||(this.size()!==1&&(d>0?--d:c<f&&(--f,d=a.bucketSize-1)),g>0&&--g)},this.setElementByPos=function(x,m){var _=p(x),P=_.curNodeBucketIndex,R=_.curNodePointerIndex;s[P][R]=m},this.insert=function(x,m,_){var P=this;if(_===void 0&&(_=1),x===0)for(;_--;)this.pushFront(m);else if(x===this.size())for(;_--;)this.pushBack(m);else{for(var R=[],L=x;L<g;++L)R.push(this.getElementByPos(L));for(this.cut(x-1),L=0;L<_;++L)this.pushBack(m);R.forEach(function(I){return P.pushBack(I)})}},this.find=function(x){if(c===f){for(var m=h;m<=d;++m)if(s[c][m]===x)return!0;return!1}for(m=h;m<a.bucketSize;++m)if(s[c][m]===x)return!0;for(m=c+1;m<f;++m)for(var _=0;_<a.bucketSize;++_)if(s[m][_]===x)return!0;for(m=0;m<=d;++m)if(s[f][m]===x)return!0;return!1},this.reverse=function(){for(var x=0,m=g-1;x<m;){var _=this.getElementByPos(x);this.setElementByPos(x,this.getElementByPos(m)),this.setElementByPos(m,_),++x,--m}},this.unique=function(){if(!this.empty()){var x=[],m=this.front();this.forEach(function(P,R){R!==0&&P===m||(x.push(P),m=P)});for(var _=0;_<g;++_)this.setElementByPos(_,x[_]);this.cut(x.length-1)}},this.sort=function(x){var m=[];this.forEach(function(P){m.push(P)}),m.sort(x);for(var _=0;_<g;++_)this.setElementByPos(_,m[_])},this.pushFront=function(x){this.empty()||(c===0&&h===0&&b.call(this,this.size()),h>0?--h:c>0&&(--c,h=a.bucketSize-1)),++g,s[c][h]=x},this.popFront=function(){this.empty()||(this.size()!==1&&(h<a.bucketSize-1?++h:c<f&&(++c,h=0)),g>0&&--g)},this.shrinkToFit=function(){var x=this,m=[];this.forEach(function(L){m.push(L)});var _=m.length;s=[];for(var P=Math.ceil(_/a.bucketSize),R=0;R<P;++R)s.push(new Array(a.bucketSize));this.clear(),m.forEach(function(L){return x.pushBack(L)})},this.cut=function(x){if(x<0)this.clear();else{var m=p(x),_=m.curNodeBucketIndex,P=m.curNodePointerIndex;f=_,d=P,g=x+1}},this[Symbol.iterator]=function(){return function(){var x,m;return o(this,function(_){switch(_.label){case 0:if(g===0)return[2];if(c!==f)return[3,5];m=h,_.label=1;case 1:return m<=d?[4,s[c][m]]:[3,4];case 2:_.sent(),_.label=3;case 3:return++m,[3,1];case 4:return[2];case 5:m=h,_.label=6;case 6:return m<a.bucketSize?[4,s[c][m]]:[3,9];case 7:_.sent(),_.label=8;case 8:return++m,[3,6];case 9:m=c+1,_.label=10;case 10:if(!(m<f))return[3,15];x=0,_.label=11;case 11:return x<a.bucketSize?[4,s[m][x]]:[3,14];case 12:_.sent(),_.label=13;case 13:return++x,[3,11];case 14:return++m,[3,10];case 15:m=0,_.label=16;case 16:return m<=d?[4,s[f][m]]:[3,19];case 17:_.sent(),_.label=18;case 18:return++m,[3,16];case 19:return[2]}})}()},function(){var x=a.bucketSize;l.size?x=l.size():l.length&&(x=l.length);var m=x*a.sigma;v=Math.ceil(m/a.bucketSize),v=Math.max(v,3);for(var _=0;_<v;++_)s.push(new Array(a.bucketSize));var P=Math.ceil(x/a.bucketSize);c=Math.floor(v/2)-Math.floor(P/2),f=c,l.forEach(function(R){return u.pushBack(R)})}(),Object.freeze(this)}Object.defineProperty(r,"__esModule",{value:!0}),a.sigma=3,a.bucketSize=5e3,Object.freeze(a),r.default=a},{}],27:[function(i,n,r){var o=this&&this.__generator||function(c,h){var f,d,v,g,p={label:0,sent:function(){if(1&v[0])throw v[1];return v[1]},trys:[],ops:[]};return g={next:b(0),throw:b(1),return:b(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function b(x){return function(m){return function(_){if(f)throw new TypeError("Generator is already executing.");for(;p;)try{if(f=1,d&&(v=2&_[0]?d.return:_[0]?d.throw||((v=d.return)&&v.call(d),0):d.next)&&!(v=v.call(d,_[1])).done)return v;switch(d=0,v&&(_=[2&_[0],v.value]),_[0]){case 0:case 1:v=_;break;case 4:return p.label++,{value:_[1],done:!1};case 5:p.label++,d=_[1],_=[0];continue;case 7:_=p.ops.pop(),p.trys.pop();continue;default:if(!(v=(v=p.trys).length>0&&v[v.length-1])&&(_[0]===6||_[0]===2)){p=0;continue}if(_[0]===3&&(!v||_[1]>v[0]&&_[1]<v[3])){p.label=_[1];break}if(_[0]===6&&p.label<v[1]){p.label=v[1],v=_;break}if(v&&p.label<v[2]){p.label=v[2],p.ops.push(_);break}v[2]&&p.ops.pop(),p.trys.pop();continue}_=h.call(c,p)}catch(P){_=[6,P],d=0}finally{f=v=0}if(5&_[0])throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}([x,m])}}},a=this&&this.__values||function(c){var h=typeof Symbol=="function"&&Symbol.iterator,f=h&&c[h],d=0;if(f)return f.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&d>=c.length&&(c=void 0),{value:c&&c[d++],done:!c}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var l=i("../LinkList/LinkList"),u=i("../Map/Map");function s(c,h,f){var d=this;if(c===void 0&&(c=[]),h===void 0&&(h=s.initSize),f=f||function(b){var x,m,_=0,P="";if(typeof b=="number")_=((_=Math.floor(b))<<5)-_,_&=_;else{P=typeof b!="string"?JSON.stringify(b):b;try{for(var R=a(P),L=R.next();!L.done;L=R.next())_=(_<<5)-_+L.value.charCodeAt(0),_&=_}catch(I){x={error:I}}finally{try{L&&!L.done&&(m=R.return)&&m.call(R)}finally{if(x)throw x.error}}}return _^=_>>>16},(h&h-1)!=0)throw new Error("initBucketNum must be 2 to the power of n");var v=0,g=[],p=Math.max(s.initSize,Math.min(s.maxSize,h));this.size=function(){return v},this.empty=function(){return v===0},this.clear=function(){v=0,p=h,g=[]},this.forEach=function(b){var x=0;g.forEach(function(m){m.forEach(function(_){b(_,x++)})})},this.setElement=function(b,x){var m,_;if(b==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(x!=null){var P=f(b)&p-1;if(g[P]){var R=g[P].size();if(g[P]instanceof l.default){try{for(var L=a(g[P]),I=L.next();!I.done;I=L.next()){var V=I.value;if(V.key===b)return void(V.value=x)}}catch(T){m={error:T}}finally{try{I&&!I.done&&(_=L.return)&&_.call(L)}finally{if(m)throw m.error}}g[P].pushBack({key:b,value:x}),g[P].size()>=s.treeifyThreshold&&(g[P]=new u.default(g[P]))}else g[P].setElement(b,x);var Q=g[P].size();v+=Q-R}else++v,g[P]=new l.default([{key:b,value:x}]);v>p*s.sigma&&function(T){if(!(T>=s.maxSize)){p=2*T;var k=[];g.forEach(function(M,C){if(!M.empty()){if(M instanceof l.default&&M.size()===1){var B=M.front(),H=B.key,W=B.value;k[f(H)&p-1]=new l.default([{key:H,value:W}])}else if(M instanceof u.default){var F=new l.default,D=new l.default;M.forEach(function(N){(f(N.key)&T)==0?F.pushBack(N):D.pushBack(N)}),F.size()>s.untreeifyThreshold?k[C]=new u.default(F):F.size()&&(k[C]=F),D.size()>s.untreeifyThreshold?k[C+T]=new u.default(D):D.size()&&(k[C+T]=D)}else{var z=new l.default,U=new l.default;M.forEach(function(N){(f(N.key)&T)==0?z.pushBack(N):U.pushBack(N)}),z.size()&&(k[C]=z),U.size()&&(k[C+T]=U)}g[C].clear()}}),g=k}}.call(this,p)}else this.eraseElementByKey(b)},this.getElementByKey=function(b){var x,m,_=f(b)&p-1;if(g[_]){if(g[_]instanceof u.default)return g[_].getElementByKey(b);try{for(var P=a(g[_]),R=P.next();!R.done;R=P.next()){var L=R.value;if(L.key===b)return L.value}}catch(I){x={error:I}}finally{try{R&&!R.done&&(m=P.return)&&m.call(P)}finally{if(x)throw x.error}}}},this.eraseElementByKey=function(b){var x,m,_=f(b)&p-1;if(g[_]){var P=g[_].size();if(g[_]instanceof u.default)g[_].eraseElementByKey(b),g[_].size()<=s.untreeifyThreshold&&(g[_]=new l.default(g[_]));else{var R=-1;try{for(var L=a(g[_]),I=L.next();!I.done;I=L.next())if(++R,I.value.key===b){g[_].eraseElementByPos(R);break}}catch(Q){x={error:Q}}finally{try{I&&!I.done&&(m=L.return)&&m.call(L)}finally{if(x)throw x.error}}}var V=g[_].size();v+=V-P}},this.find=function(b){var x,m,_=f(b)&p-1;if(!g[_])return!1;if(g[_]instanceof u.default)return g[_].find(b);try{for(var P=a(g[_]),R=P.next();!R.done;R=P.next())if(R.value.key===b)return!0}catch(L){x={error:L}}finally{try{R&&!R.done&&(m=P.return)&&m.call(P)}finally{if(x)throw x.error}}return!1},this[Symbol.iterator]=function(){return function(){var b,x,m,_,P,R;return o(this,function(L){switch(L.label){case 0:b=0,L.label=1;case 1:if(!(b<p))return[3,10];for(;b<p&&!g[b];)++b;if(b>=p)return[3,10];L.label=2;case 2:L.trys.push([2,7,8,9]),P=void 0,x=a(g[b]),m=x.next(),L.label=3;case 3:return m.done?[3,6]:[4,m.value];case 4:L.sent(),L.label=5;case 5:return m=x.next(),[3,3];case 6:return[3,9];case 7:return _=L.sent(),P={error:_},[3,9];case 8:try{m&&!m.done&&(R=x.return)&&R.call(x)}finally{if(P)throw P.error}return[7];case 9:return++b,[3,1];case 10:return[2]}})}()},c.forEach(function(b){var x=b.key,m=b.value;return d.setElement(x,m)}),Object.freeze(this)}s.initSize=16,s.maxSize=1<<30,s.sigma=.75,s.treeifyThreshold=8,s.untreeifyThreshold=6,s.minTreeifySize=64,Object.freeze(s),r.default=s},{"../LinkList/LinkList":29,"../Map/Map":30}],28:[function(i,n,r){var o=this&&this.__generator||function(c,h){var f,d,v,g,p={label:0,sent:function(){if(1&v[0])throw v[1];return v[1]},trys:[],ops:[]};return g={next:b(0),throw:b(1),return:b(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function b(x){return function(m){return function(_){if(f)throw new TypeError("Generator is already executing.");for(;p;)try{if(f=1,d&&(v=2&_[0]?d.return:_[0]?d.throw||((v=d.return)&&v.call(d),0):d.next)&&!(v=v.call(d,_[1])).done)return v;switch(d=0,v&&(_=[2&_[0],v.value]),_[0]){case 0:case 1:v=_;break;case 4:return p.label++,{value:_[1],done:!1};case 5:p.label++,d=_[1],_=[0];continue;case 7:_=p.ops.pop(),p.trys.pop();continue;default:if(!(v=(v=p.trys).length>0&&v[v.length-1])&&(_[0]===6||_[0]===2)){p=0;continue}if(_[0]===3&&(!v||_[1]>v[0]&&_[1]<v[3])){p.label=_[1];break}if(_[0]===6&&p.label<v[1]){p.label=v[1],v=_;break}if(v&&p.label<v[2]){p.label=v[2],p.ops.push(_);break}v[2]&&p.ops.pop(),p.trys.pop();continue}_=h.call(c,p)}catch(P){_=[6,P],d=0}finally{f=v=0}if(5&_[0])throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}([x,m])}}},a=this&&this.__values||function(c){var h=typeof Symbol=="function"&&Symbol.iterator,f=h&&c[h],d=0;if(f)return f.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&d>=c.length&&(c=void 0),{value:c&&c[d++],done:!c}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var l=i("../Set/Set"),u=i("../LinkList/LinkList");function s(c,h,f){var d=this;if(c===void 0&&(c=[]),h===void 0&&(h=s.initSize),f=f||function(b){var x=0,m="";if(typeof b=="number")x=((x=Math.floor(b))<<5)-x,x&=x;else{m=typeof b!="string"?JSON.stringify(b):b;for(var _=0;_<m.length;_++)x=(x<<5)-x+m.charCodeAt(_),x&=x}return x^=x>>>16},(h&h-1)!=0)throw new Error("initBucketNum must be 2 to the power of n");var v=0,g=[],p=Math.max(s.initSize,Math.min(s.maxSize,h));this.size=function(){return v},this.empty=function(){return v===0},this.clear=function(){v=0,p=h,g=[]},this.forEach=function(b){var x=0;g.forEach(function(m){m.forEach(function(_){b(_,x++)})})},this.insert=function(b){if(b==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");var x=f(b)&p-1;if(g[x]){var m=g[x].size();if(g[x]instanceof u.default){if(g[x].find(b))return;g[x].pushBack(b),g[x].size()>=s.treeifyThreshold&&(g[x]=new l.default(g[x]))}else g[x].insert(b);var _=g[x].size();v+=_-m}else g[x]=new u.default([b]),++v;v>p*s.sigma&&function(P){if(!(P>=s.maxSize)){p=2*P;var R=[];g.forEach(function(L,I){if(!L.empty()){if(L instanceof u.default&&L.size()===1){var V=L.front();if(V===void 0)throw new Error("unknown error");R[f(V)&p-1]=new u.default([V])}else if(L instanceof l.default){var Q=new u.default,T=new u.default;L.forEach(function(C){(f(C)&P)==0?Q.pushBack(C):T.pushBack(C)}),Q.size()>s.untreeifyThreshold?R[I]=new l.default(Q):Q.size()&&(R[I]=Q),T.size()>s.untreeifyThreshold?R[I+P]=new l.default(T):T.size()&&(R[I+P]=T)}else{var k=new u.default,M=new u.default;L.forEach(function(C){(f(C)&P)==0?k.pushBack(C):M.pushBack(C)}),k.size()&&(R[I]=k),M.size()&&(R[I+P]=M)}g[I].clear()}}),g=R}}.call(this,p)},this.eraseElementByValue=function(b){var x=f(b)&p-1;if(g[x]){var m=g[x].size();g[x].eraseElementByValue(b),g[x]instanceof l.default&&g[x].size()<=s.untreeifyThreshold&&(g[x]=new u.default(g[x]));var _=g[x].size();v+=_-m}},this.find=function(b){var x=f(b)&p-1;return!!g[x]&&g[x].find(b)},this[Symbol.iterator]=function(){return function(){var b,x,m,_,P,R;return o(this,function(L){switch(L.label){case 0:b=0,L.label=1;case 1:if(!(b<p))return[3,10];for(;b<p&&!g[b];)++b;if(b>=p)return[3,10];L.label=2;case 2:L.trys.push([2,7,8,9]),P=void 0,x=a(g[b]),m=x.next(),L.label=3;case 3:return m.done?[3,6]:[4,m.value];case 4:L.sent(),L.label=5;case 5:return m=x.next(),[3,3];case 6:return[3,9];case 7:return _=L.sent(),P={error:_},[3,9];case 8:try{m&&!m.done&&(R=x.return)&&R.call(x)}finally{if(P)throw P.error}return[7];case 9:return++b,[3,1];case 10:return[2]}})}()},c.forEach(function(b){return d.insert(b)}),Object.freeze(this)}s.initSize=16,s.maxSize=1<<30,s.sigma=.75,s.treeifyThreshold=8,s.untreeifyThreshold=6,s.minTreeifySize=64,Object.freeze(s),r.default=s},{"../LinkList/LinkList":29,"../Set/Set":33}],29:[function(i,n,r){var o=this&&this.__generator||function(u,s){var c,h,f,d,v={label:0,sent:function(){if(1&f[0])throw f[1];return f[1]},trys:[],ops:[]};return d={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function g(p){return function(b){return function(x){if(c)throw new TypeError("Generator is already executing.");for(;v;)try{if(c=1,h&&(f=2&x[0]?h.return:x[0]?h.throw||((f=h.return)&&f.call(h),0):h.next)&&!(f=f.call(h,x[1])).done)return f;switch(h=0,f&&(x=[2&x[0],f.value]),x[0]){case 0:case 1:f=x;break;case 4:return v.label++,{value:x[1],done:!1};case 5:v.label++,h=x[1],x=[0];continue;case 7:x=v.ops.pop(),v.trys.pop();continue;default:if(!(f=(f=v.trys).length>0&&f[f.length-1])&&(x[0]===6||x[0]===2)){v=0;continue}if(x[0]===3&&(!f||x[1]>f[0]&&x[1]<f[3])){v.label=x[1];break}if(x[0]===6&&v.label<f[1]){v.label=f[1],f=x;break}if(f&&v.label<f[2]){v.label=f[2],v.ops.push(x);break}f[2]&&v.ops.pop(),v.trys.pop();continue}x=s.call(u,v)}catch(m){x=[6,m],h=0}finally{c=f=0}if(5&x[0])throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}([p,b])}}};Object.defineProperty(r,"__esModule",{value:!0});var a=function(){return function(u){this.value=void 0,this.pre=void 0,this.next=void 0,this.value=u}}();function l(u){var s=this;u===void 0&&(u=[]);var c=0,h=void 0,f=void 0;this.size=function(){return c},this.empty=function(){return c===0},this.clear=function(){h=f=void 0,c=0},this.front=function(){return h==null?void 0:h.value},this.back=function(){return f==null?void 0:f.value},this.forEach=function(d){for(var v=h,g=0;v;){if(v.value===void 0)throw new Error("unknown error");d(v.value,g++),v=v.next}},this.getElementByPos=function(d){if(d<0||d>=c)throw new Error("pos must more then 0 and less then the list length");for(var v=h;d--&&v;)v=v.next;if(!v||v.value===void 0)throw new Error("unknown error");return v.value},this.eraseElementByPos=function(d){if(d<0||d>=c)throw new Error("erase pos must more then 0 and less then the list length");if(d===0)this.popFront();else if(d===c-1)this.popBack();else{for(var v=h;d--;){if(!(v!=null&&v.next))throw new Error("unknown error");v=v.next}if(!v||!v.pre||!v.next)throw new Error("unknown error");var g=v.pre,p=v.next;p.pre=g,g.next=p,c>0&&--c}},this.eraseElementByValue=function(d){for(;h&&h.value===d;)this.popFront();for(;f&&f.value===d;)this.popBack();if(h)for(var v=h;v;){if(v.value===d){var g=v.pre,p=v.next;p&&(p.pre=g),g&&(g.next=p),c>0&&--c}v=v.next}},this.pushBack=function(d){if(d==null)throw new Error("you can't push null or undefined here");++c;var v=new a(d);f?(f.next=v,v.pre=f,f=v):h=f=v},this.popBack=function(){f&&(c>0&&--c,f&&(h===f?h=f=void 0:(f=f.pre)&&(f.next=void 0)))},this.setElementByPos=function(d,v){if(v==null)throw new Error("you can't set null or undefined here");if(d<0||d>=c)throw new Error("pos must more then 0 and less then the list length");for(var g=h;d--;){if(!g)throw new Error("unknown error");g=g.next}g&&(g.value=v)},this.insert=function(d,v,g){if(g===void 0&&(g=1),v==null)throw new Error("you can't insert null or undefined here");if(d<0||d>c)throw new Error("insert pos must more then 0 and less then or equal to the list length");if(g<0)throw new Error("insert size must more than 0");if(d===0)for(;g--;)this.pushFront(v);else if(d===c)for(;g--;)this.pushBack(v);else{for(var p=h,b=1;b<d;++b){if(!(p!=null&&p.next))throw new Error("unknown error");p=p==null?void 0:p.next}if(!p)throw new Error("unknown error");var x=p.next;for(c+=g;g--;)p.next=new a(v),p.next.pre=p,p=p.next;p.next=x,x&&(x.pre=p)}},this.find=function(d){for(var v=h;v;){if(v.value===d)return!0;v=v.next}return!1},this.reverse=function(){for(var d=h,v=f,g=0;d&&v&&2*g<c;){var p=d.value;d.value=v.value,v.value=p,d=d.next,v=v.pre,++g}},this.unique=function(){for(var d=h;d;){for(var v=d;v&&v.next&&v.value===v.next.value;)v=v.next,c>0&&--c;d.next=v.next,d.next&&(d.next.pre=d),d=d.next}},this.sort=function(d){var v=[];this.forEach(function(p){v.push(p)}),v.sort(d);var g=h;v.forEach(function(p){g&&(g.value=p,g=g.next)})},this.pushFront=function(d){if(d==null)throw new Error("you can't push null or undefined here");++c;var v=new a(d);h?(v.next=h,h.pre=v,h=v):h=f=v},this.popFront=function(){h&&(c>0&&--c,h&&(h===f?h=f=void 0:(h=h.next)&&(h.pre=void 0)))},this.merge=function(d){var v=this,g=h;d.forEach(function(p){for(;g&&g.value!==void 0&&g.value<=p;)g=g.next;if(g===void 0)v.pushBack(p),g=f;else if(g===h)v.pushFront(p),g=h;else{++c;var b=g.pre;b&&(b.next=new a(p),b.next.pre=b,b.next.next=g,g&&(g.pre=b.next))}})},this[Symbol.iterator]=function(){return function(){var d;return o(this,function(v){switch(v.label){case 0:d=h,v.label=1;case 1:if(d===void 0)return[3,3];if(!d.value)throw new Error("unknown error");return[4,d.value];case 2:return v.sent(),d=d.next,[3,1];case 3:return[2]}})}()},u.forEach(function(d){return s.pushBack(d)}),Object.freeze(this)}Object.freeze(l),r.default=l},{}],30:[function(i,n,r){var o=this&&this.__generator||function(s,c){var h,f,d,v,g={label:0,sent:function(){if(1&d[0])throw d[1];return d[1]},trys:[],ops:[]};return v={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function p(b){return function(x){return function(m){if(h)throw new TypeError("Generator is already executing.");for(;g;)try{if(h=1,f&&(d=2&m[0]?f.return:m[0]?f.throw||((d=f.return)&&d.call(f),0):f.next)&&!(d=d.call(f,m[1])).done)return d;switch(f=0,d&&(m=[2&m[0],d.value]),m[0]){case 0:case 1:d=m;break;case 4:return g.label++,{value:m[1],done:!1};case 5:g.label++,f=m[1],m=[0];continue;case 7:m=g.ops.pop(),g.trys.pop();continue;default:if(!(d=(d=g.trys).length>0&&d[d.length-1])&&(m[0]===6||m[0]===2)){g=0;continue}if(m[0]===3&&(!d||m[1]>d[0]&&m[1]<d[3])){g.label=m[1];break}if(m[0]===6&&g.label<d[1]){g.label=d[1],d=m;break}if(d&&g.label<d[2]){g.label=d[2],g.ops.push(m);break}d[2]&&g.ops.pop(),g.trys.pop();continue}m=c.call(s,g)}catch(_){m=[6,_],f=0}finally{h=d=0}if(5&m[0])throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}([b,x])}}},a=this&&this.__values||function(s){var c=typeof Symbol=="function"&&Symbol.iterator,h=c&&s[c],f=0;if(h)return h.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&f>=s.length&&(s=void 0),{value:s&&s[f++],done:!s}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var l=i("../Base/TreeNode");function u(s,c){var h=this;s===void 0&&(s=[]),c=c||function(T,k){return T<k?-1:T>k?1:0};var f=0,d=new l.default;d.color=l.default.TreeNodeColorType.black,this.size=function(){return f},this.empty=function(){return f===0},this.clear=function(){f=0,d.key=d.value=void 0,d.leftChild=d.rightChild=d.brother=void 0};var v=function(T){if(!T||T.key===void 0)throw new Error("unknown error");return T.leftChild?v(T.leftChild):T},g=function(T){if(!T||T.key===void 0)throw new Error("unknown error");return T.rightChild?g(T.rightChild):T};this.front=function(){if(!this.empty()){var T=v(d);if(T.key===void 0||T.value===void 0)throw new Error("unknown error");return{key:T.key,value:T.value}}},this.back=function(){if(!this.empty()){var T=g(d);if(T.key===void 0||T.value===void 0)throw new Error("unknown error");return{key:T.key,value:T.value}}},this.forEach=function(T){var k,M,C=0;try{for(var B=a(this),H=B.next();!H.done;H=B.next())T(H.value,C++)}catch(W){k={error:W}}finally{try{H&&!H.done&&(M=B.return)&&M.call(B)}finally{if(k)throw k.error}}},this.getElementByPos=function(T){var k,M;if(T<0||T>=this.size())throw new Error("pos must more than 0 and less than set's size");var C=0;try{for(var B=a(this),H=B.next();!H.done;H=B.next()){var W=H.value;if(C===T)return W;++C}}catch(F){k={error:F}}finally{try{H&&!H.done&&(M=B.return)&&M.call(B)}finally{if(k)throw k.error}}throw new Error("unknown Error")};var p=function(T,k){if(T&&T.key!==void 0&&T.value!==void 0){var M=c(T.key,k);return M===0?{key:T.key,value:T.value}:M<0?p(T.rightChild,k):p(T.leftChild,k)||{key:T.key,value:T.value}}};this.lowerBound=function(T){return p(d,T)};var b=function(T,k){if(T&&T.key!==void 0&&T.value!==void 0)return c(T.key,k)<=0?b(T.rightChild,k):b(T.leftChild,k)||{key:T.key,value:T.value}};this.upperBound=function(T){return b(d,T)};var x=function(T,k){if(T&&T.key!==void 0&&T.value!==void 0){var M=c(T.key,k);return M===0?{key:T.key,value:T.value}:M>0?x(T.leftChild,k):x(T.rightChild,k)||{key:T.key,value:T.value}}};this.reverseLowerBound=function(T){return x(d,T)};var m=function(T,k){if(T&&T.key!==void 0&&T.value!==void 0)return c(T.key,k)>=0?m(T.leftChild,k):m(T.rightChild,k)||{key:T.key,value:T.value}};this.reverseUpperBound=function(T){return m(d,T)};var _=function(T){var k=T.parent;if(!k){if(T===d)return;throw new Error("unknown error")}if(T.color!==l.default.TreeNodeColorType.red){var M=T.brother;if(!M)throw new Error("unknown error");if(T===k.leftChild)if(M.color===l.default.TreeNodeColorType.red){M.color=l.default.TreeNodeColorType.black,k.color=l.default.TreeNodeColorType.red;var C=k.rotateLeft();d===k&&(d=C),_(T)}else M.color===l.default.TreeNodeColorType.black&&(M.rightChild&&M.rightChild.color===l.default.TreeNodeColorType.red?(M.color=k.color,k.color=l.default.TreeNodeColorType.black,M.rightChild&&(M.rightChild.color=l.default.TreeNodeColorType.black),C=k.rotateLeft(),d===k&&(d=C),T.color=l.default.TreeNodeColorType.black):M.rightChild&&M.rightChild.color!==l.default.TreeNodeColorType.black||!M.leftChild||M.leftChild.color!==l.default.TreeNodeColorType.red?M.leftChild&&M.leftChild.color!==l.default.TreeNodeColorType.black||M.rightChild&&M.rightChild.color!==l.default.TreeNodeColorType.black||(M.color=l.default.TreeNodeColorType.red,_(k)):(M.color=l.default.TreeNodeColorType.red,M.leftChild&&(M.leftChild.color=l.default.TreeNodeColorType.black),C=M.rotateRight(),d===M&&(d=C),_(T)));else T===k.rightChild&&(M.color===l.default.TreeNodeColorType.red?(M.color=l.default.TreeNodeColorType.black,k.color=l.default.TreeNodeColorType.red,C=k.rotateRight(),d===k&&(d=C),_(T)):M.color===l.default.TreeNodeColorType.black&&(M.leftChild&&M.leftChild.color===l.default.TreeNodeColorType.red?(M.color=k.color,k.color=l.default.TreeNodeColorType.black,M.leftChild&&(M.leftChild.color=l.default.TreeNodeColorType.black),C=k.rotateRight(),d===k&&(d=C),T.color=l.default.TreeNodeColorType.black):M.leftChild&&M.leftChild.color!==l.default.TreeNodeColorType.black||!M.rightChild||M.rightChild.color!==l.default.TreeNodeColorType.red?M.leftChild&&M.leftChild.color!==l.default.TreeNodeColorType.black||M.rightChild&&M.rightChild.color!==l.default.TreeNodeColorType.black||(M.color=l.default.TreeNodeColorType.red,_(k)):(M.color=l.default.TreeNodeColorType.red,M.rightChild&&(M.rightChild.color=l.default.TreeNodeColorType.black),C=M.rotateLeft(),d===M&&(d=C),_(T))))}else T.color=l.default.TreeNodeColorType.black},P=function(T){for(var k=T;k.leftChild||k.rightChild;){if(k.rightChild){k=v(k.rightChild);var M=T.key;T.key=k.key,k.key=M;var C=T.value;T.value=k.value,k.value=C,T=k}k.leftChild&&(k=g(k.leftChild),M=T.key,T.key=k.key,k.key=M,C=T.value,T.value=k.value,k.value=C,T=k)}_(k),k&&k.remove(),--f,d.color=l.default.TreeNodeColorType.black},R=function(T,k){return!(!T||T.key===void 0)&&(!!R(T.leftChild,k)||!!k(T)||R(T.rightChild,k))};this.eraseElementByPos=function(T){if(T<0||T>=f)throw new Error("pos must more than 0 and less than set's size");var k=0;R(d,function(M){return T===k?(P(M),!0):(++k,!1)})},this.eraseElementByKey=function(T){if(!this.empty()){var k=V(d,T);k!==void 0&&k.key!==void 0&&c(k.key,T)===0&&P(k)}};var L=function(T,k){if(!T||T.key===void 0)throw new Error("unknown error");var M=c(k,T.key);return M<0?T.leftChild?L(T.leftChild,k):(T.leftChild=new l.default,T.leftChild.parent=T,T.leftChild.brother=T.rightChild,T.rightChild&&(T.rightChild.brother=T.leftChild),T.leftChild):M>0?T.rightChild?L(T.rightChild,k):(T.rightChild=new l.default,T.rightChild.parent=T,T.rightChild.brother=T.leftChild,T.leftChild&&(T.leftChild.brother=T.rightChild),T.rightChild):T},I=function(T){var k=T.parent;if(!k){if(T===d)return;throw new Error("unknown error")}if(k.color!==l.default.TreeNodeColorType.black&&k.color===l.default.TreeNodeColorType.red){var M=k.brother,C=k.parent;if(!C)throw new Error("unknown error");if(M&&M.color===l.default.TreeNodeColorType.red)M.color=k.color=l.default.TreeNodeColorType.black,C.color=l.default.TreeNodeColorType.red,I(C);else if(!M||M.color===l.default.TreeNodeColorType.black)if(k===C.leftChild)if(T===k.leftChild){k.color=l.default.TreeNodeColorType.black,C.color=l.default.TreeNodeColorType.red;var B=C.rotateRight();C===d&&(d=B)}else T===k.rightChild&&(B=k.rotateLeft(),C===d&&(d=B),I(k));else k===C.rightChild&&(T===k.leftChild?(B=k.rotateRight(),C===d&&(d=B),I(k)):T===k.rightChild&&(k.color=l.default.TreeNodeColorType.black,C.color=l.default.TreeNodeColorType.red,B=C.rotateLeft(),C===d&&(d=B)))}};this.setElement=function(T,k){if(T==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(k!=null){if(this.empty())return++f,d.key=T,d.value=k,void(d.color=l.default.TreeNodeColorType.black);var M=L(d,T);M.key===void 0||c(M.key,T)!==0?(++f,M.key=T,M.value=k,I(M),d.color=l.default.TreeNodeColorType.black):M.value=k}else this.eraseElementByKey(T)};var V=function(T,k){if(T&&T.key!==void 0){var M=c(k,T.key);return M<0?V(T.leftChild,k):M>0?V(T.rightChild,k):T}};this.find=function(T){return!!V(d,T)},this.getElementByKey=function(T){var k=V(d,T);if((k==null?void 0:k.key)===void 0||(k==null?void 0:k.value)===void 0)throw new Error("unknown error");return k.value},this.union=function(T){var k=this;T.forEach(function(M){var C=M.key,B=M.value;return k.setElement(C,B)})},this.getHeight=function(){if(this.empty())return 0;var T=function(k){return k?Math.max(T(k.leftChild),T(k.rightChild))+1:1};return T(d)};var Q=function(T){return o(this,function(k){switch(k.label){case 0:return T&&T.key!==void 0&&T.value!==void 0?[5,a(Q(T.leftChild))]:[2];case 1:return k.sent(),[4,{key:T.key,value:T.value}];case 2:return k.sent(),[5,a(Q(T.rightChild))];case 3:return k.sent(),[2]}})};this[Symbol.iterator]=function(){return Q(d)},s.forEach(function(T){var k=T.key,M=T.value;return h.setElement(k,M)}),Object.freeze(this)}Object.freeze(u),r.default=u},{"../Base/TreeNode":25}],31:[function(i,n,r){function o(a,l){a===void 0&&(a=[]),l=l||function(f,d){return f>d?-1:f<d?1:0};var u=[];a.forEach(function(f){return u.push(f)});var s=u.length,c=function(f,d){if(f<0||f>=s)throw new Error("unknown error");if(d<0||d>=s)throw new Error("unknown error");var v=u[f];u[f]=u[d],u[d]=v},h=function(f){if(f<0||f>=s)throw new Error("unknown error");var d=2*f+1,v=2*f+2;d<s&&l(u[f],u[d])>0&&c(f,d),v<s&&l(u[f],u[v])>0&&c(f,v)};(function(){for(var f=Math.floor((s-1)/2);f>=0;--f)for(var d=f,v=2*d+1;v<s;){var g=v+1,p=v;if(g<s&&l(u[v],u[g])>0&&(p=g),l(u[d],u[p])<=0)break;c(d,p),v=2*(d=p)+1}})(),this.size=function(){return s},this.empty=function(){return s===0},this.clear=function(){s=0,u.length=0},this.push=function(f){if(u.push(f),++s!==1)for(var d=s-1;d>0;){var v=Math.floor((d-1)/2);if(l(u[v],f)<=0)break;h(v),d=v}},this.pop=function(){if(!this.empty())if(this.size()!==1){var f=u[s-1];--s;for(var d=0;d<this.size();){var v=2*d+1,g=2*d+2;if(v>=this.size())break;var p=v;if(g<this.size()&&l(u[v],u[g])>0&&(p=g),l(u[p],f)>=0)break;u[d]=u[p],d=p}u[d]=f}else--s},this.top=function(){return u[0]},Object.freeze(this)}Object.defineProperty(r,"__esModule",{value:!0}),Object.freeze(o),r.default=o},{}],32:[function(i,n,r){Object.defineProperty(r,"__esModule",{value:!0});var o=i("../LinkList/LinkList");function a(l){l===void 0&&(l=[]);var u=new o.default(l);this.size=function(){return u.size()},this.empty=function(){return u.empty()},this.clear=function(){u.clear()},this.push=function(s){u.pushBack(s)},this.pop=function(){u.popFront()},this.front=function(){return u.front()},Object.freeze(this)}Object.freeze(a),r.default=a},{"../LinkList/LinkList":29}],33:[function(i,n,r){var o=this&&this.__generator||function(s,c){var h,f,d,v,g={label:0,sent:function(){if(1&d[0])throw d[1];return d[1]},trys:[],ops:[]};return v={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function p(b){return function(x){return function(m){if(h)throw new TypeError("Generator is already executing.");for(;g;)try{if(h=1,f&&(d=2&m[0]?f.return:m[0]?f.throw||((d=f.return)&&d.call(f),0):f.next)&&!(d=d.call(f,m[1])).done)return d;switch(f=0,d&&(m=[2&m[0],d.value]),m[0]){case 0:case 1:d=m;break;case 4:return g.label++,{value:m[1],done:!1};case 5:g.label++,f=m[1],m=[0];continue;case 7:m=g.ops.pop(),g.trys.pop();continue;default:if(!(d=(d=g.trys).length>0&&d[d.length-1])&&(m[0]===6||m[0]===2)){g=0;continue}if(m[0]===3&&(!d||m[1]>d[0]&&m[1]<d[3])){g.label=m[1];break}if(m[0]===6&&g.label<d[1]){g.label=d[1],d=m;break}if(d&&g.label<d[2]){g.label=d[2],g.ops.push(m);break}d[2]&&g.ops.pop(),g.trys.pop();continue}m=c.call(s,g)}catch(_){m=[6,_],f=0}finally{h=d=0}if(5&m[0])throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}([b,x])}}},a=this&&this.__values||function(s){var c=typeof Symbol=="function"&&Symbol.iterator,h=c&&s[c],f=0;if(h)return h.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&f>=s.length&&(s=void 0),{value:s&&s[f++],done:!s}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var l=i("../Base/TreeNode");function u(s,c){var h=this;s===void 0&&(s=[]),c=c||function(T,k){return T<k?-1:T>k?1:0};var f=0,d=new l.default;d.color=l.default.TreeNodeColorType.black,this.size=function(){return f},this.empty=function(){return f===0},this.clear=function(){f=0,d.key=void 0,d.leftChild=d.rightChild=d.brother=d.parent=void 0,d.color=l.default.TreeNodeColorType.black};var v=function(T){if(!T||T.key===void 0)throw new Error("unknown error");return T.leftChild?v(T.leftChild):T},g=function(T){if(!T||T.key===void 0)throw new Error("unknown error");return T.rightChild?g(T.rightChild):T};this.front=function(){if(!this.empty())return v(d).key},this.back=function(){if(!this.empty())return g(d).key},this.forEach=function(T){var k,M,C=0;try{for(var B=a(this),H=B.next();!H.done;H=B.next())T(H.value,C++)}catch(W){k={error:W}}finally{try{H&&!H.done&&(M=B.return)&&M.call(B)}finally{if(k)throw k.error}}},this.getElementByPos=function(T){var k,M;if(T<0||T>=this.size())throw new Error("pos must more than 0 and less than set's size");var C=0;try{for(var B=a(this),H=B.next();!H.done;H=B.next()){var W=H.value;if(C===T)return W;++C}}catch(F){k={error:F}}finally{try{H&&!H.done&&(M=B.return)&&M.call(B)}finally{if(k)throw k.error}}throw new Error("unknown error")};var p=function(T){var k=T.parent;if(!k){if(T===d)return;throw new Error("unknown error")}if(T.color!==l.default.TreeNodeColorType.red){var M=T.brother;if(!M)throw new Error("unknown error");if(T===k.leftChild)if(M.color===l.default.TreeNodeColorType.red){M.color=l.default.TreeNodeColorType.black,k.color=l.default.TreeNodeColorType.red;var C=k.rotateLeft();d===k&&(d=C),p(T)}else M.color===l.default.TreeNodeColorType.black&&(M.rightChild&&M.rightChild.color===l.default.TreeNodeColorType.red?(M.color=k.color,k.color=l.default.TreeNodeColorType.black,M.rightChild&&(M.rightChild.color=l.default.TreeNodeColorType.black),C=k.rotateLeft(),d===k&&(d=C),T.color=l.default.TreeNodeColorType.black):M.rightChild&&M.rightChild.color!==l.default.TreeNodeColorType.black||!M.leftChild||M.leftChild.color!==l.default.TreeNodeColorType.red?M.leftChild&&M.leftChild.color!==l.default.TreeNodeColorType.black||M.rightChild&&M.rightChild.color!==l.default.TreeNodeColorType.black||(M.color=l.default.TreeNodeColorType.red,p(k)):(M.color=l.default.TreeNodeColorType.red,M.leftChild&&(M.leftChild.color=l.default.TreeNodeColorType.black),C=M.rotateRight(),d===M&&(d=C),p(T)));else T===k.rightChild&&(M.color===l.default.TreeNodeColorType.red?(M.color=l.default.TreeNodeColorType.black,k.color=l.default.TreeNodeColorType.red,C=k.rotateRight(),d===k&&(d=C),p(T)):M.color===l.default.TreeNodeColorType.black&&(M.leftChild&&M.leftChild.color===l.default.TreeNodeColorType.red?(M.color=k.color,k.color=l.default.TreeNodeColorType.black,M.leftChild&&(M.leftChild.color=l.default.TreeNodeColorType.black),C=k.rotateRight(),d===k&&(d=C),T.color=l.default.TreeNodeColorType.black):M.leftChild&&M.leftChild.color!==l.default.TreeNodeColorType.black||!M.rightChild||M.rightChild.color!==l.default.TreeNodeColorType.red?M.leftChild&&M.leftChild.color!==l.default.TreeNodeColorType.black||M.rightChild&&M.rightChild.color!==l.default.TreeNodeColorType.black||(M.color=l.default.TreeNodeColorType.red,p(k)):(M.color=l.default.TreeNodeColorType.red,M.rightChild&&(M.rightChild.color=l.default.TreeNodeColorType.black),C=M.rotateLeft(),d===M&&(d=C),p(T))))}else T.color=l.default.TreeNodeColorType.black},b=function(T){for(var k=T;k.leftChild||k.rightChild;){if(k.rightChild){k=v(k.rightChild);var M=T.key;T.key=k.key,k.key=M,T=k}k.leftChild&&(k=g(k.leftChild),M=T.key,T.key=k.key,k.key=M,T=k)}p(k),k&&k.remove(),--f,d.color=l.default.TreeNodeColorType.black},x=function(T,k){return!(!T||T.key===void 0)&&(!!x(T.leftChild,k)||!!k(T)||x(T.rightChild,k))};this.eraseElementByPos=function(T){if(T<0||T>=f)throw new Error("pos must more than 0 and less than set's size");var k=0;x(d,function(M){return T===k?(b(M),!0):(++k,!1)})},this.eraseElementByValue=function(T){if(!this.empty()){var k=P(d,T);k!==void 0&&k.key!==void 0&&c(k.key,T)===0&&b(k)}};var m=function(T,k){if(!T||T.key===void 0)throw new Error("unknown error");var M=c(k,T.key);return M<0?T.leftChild?m(T.leftChild,k):(T.leftChild=new l.default,T.leftChild.parent=T,T.leftChild.brother=T.rightChild,T.rightChild&&(T.rightChild.brother=T.leftChild),T.leftChild):M>0?T.rightChild?m(T.rightChild,k):(T.rightChild=new l.default,T.rightChild.parent=T,T.rightChild.brother=T.leftChild,T.leftChild&&(T.leftChild.brother=T.rightChild),T.rightChild):T},_=function(T){var k=T.parent;if(!k){if(T===d)return;throw new Error("unknown error")}if(k.color!==l.default.TreeNodeColorType.black&&k.color===l.default.TreeNodeColorType.red){var M=k.brother,C=k.parent;if(!C)throw new Error("unknown error");if(M&&M.color===l.default.TreeNodeColorType.red)M.color=k.color=l.default.TreeNodeColorType.black,C.color=l.default.TreeNodeColorType.red,_(C);else if(!M||M.color===l.default.TreeNodeColorType.black)if(k===C.leftChild)if(T===k.leftChild){k.color=l.default.TreeNodeColorType.black,C.color=l.default.TreeNodeColorType.red;var B=C.rotateRight();C===d&&(d=B)}else T===k.rightChild&&(B=k.rotateLeft(),C===d&&(d=B),_(k));else k===C.rightChild&&(T===k.leftChild?(B=k.rotateRight(),C===d&&(d=B),_(k)):T===k.rightChild&&(k.color=l.default.TreeNodeColorType.black,C.color=l.default.TreeNodeColorType.red,B=C.rotateLeft(),C===d&&(d=B)))}};this.insert=function(T){if(T==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(this.empty())return++f,d.key=T,void(d.color=l.default.TreeNodeColorType.black);var k=m(d,T);k.key!==void 0&&c(k.key,T)===0||(++f,k.key=T,_(k),d.color=l.default.TreeNodeColorType.black)};var P=function(T,k){if(T&&T.key!==void 0){var M=c(k,T.key);return M<0?P(T.leftChild,k):M>0?P(T.rightChild,k):T}};this.find=function(T){var k=P(d,T);return k!==void 0&&k.key!==void 0&&c(k.key,T)===0};var R=function(T,k){if(T&&T.key!==void 0){var M=c(T.key,k);if(M===0)return T.key;if(M<0)return R(T.rightChild,k);var C=R(T.leftChild,k);return C!==void 0?C:T.key}};this.lowerBound=function(T){return R(d,T)};var L=function(T,k){if(T&&T.key!==void 0){if(c(T.key,k)<=0)return L(T.rightChild,k);var M=L(T.leftChild,k);return M!==void 0?M:T.key}};this.upperBound=function(T){return L(d,T)};var I=function(T,k){if(T&&T.key!==void 0){var M=c(T.key,k);if(M===0)return T.key;if(M>0)return I(T.leftChild,k);var C=I(T.rightChild,k);return C!==void 0?C:T.key}};this.reverseLowerBound=function(T){return I(d,T)};var V=function(T,k){if(T&&T.key!==void 0){if(c(T.key,k)>=0)return V(T.leftChild,k);var M=V(T.rightChild,k);return M!==void 0?M:T.key}};this.reverseUpperBound=function(T){return V(d,T)},this.union=function(T){var k=this;T.forEach(function(M){return k.insert(M)})},this.getHeight=function(){if(this.empty())return 0;var T=function(k){return k?Math.max(T(k.leftChild),T(k.rightChild))+1:1};return T(d)};var Q=function(T){return o(this,function(k){switch(k.label){case 0:return T&&T.key!==void 0?[5,a(Q(T.leftChild))]:[2];case 1:return k.sent(),[4,T.key];case 2:return k.sent(),[5,a(Q(T.rightChild))];case 3:return k.sent(),[2]}})};this[Symbol.iterator]=function(){return Q(d)},s.forEach(function(T){return h.insert(T)}),Object.freeze(this)}Object.freeze(u),r.default=u},{"../Base/TreeNode":25}],34:[function(i,n,r){function o(a){var l=this;a===void 0&&(a=[]);var u=0,s=[];this.size=function(){return u},this.empty=function(){return u===0},this.clear=function(){u=0,s.length=0},this.push=function(c){s.push(c),++u},this.pop=function(){s.pop(),u>0&&--u},this.top=function(){return s[u-1]},a.forEach(function(c){return l.push(c)}),Object.freeze(this)}Object.defineProperty(r,"__esModule",{value:!0}),Object.freeze(o),r.default=o},{}],35:[function(i,n,r){var o=this&&this.__generator||function(c,h){var f,d,v,g,p={label:0,sent:function(){if(1&v[0])throw v[1];return v[1]},trys:[],ops:[]};return g={next:b(0),throw:b(1),return:b(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function b(x){return function(m){return function(_){if(f)throw new TypeError("Generator is already executing.");for(;p;)try{if(f=1,d&&(v=2&_[0]?d.return:_[0]?d.throw||((v=d.return)&&v.call(d),0):d.next)&&!(v=v.call(d,_[1])).done)return v;switch(d=0,v&&(_=[2&_[0],v.value]),_[0]){case 0:case 1:v=_;break;case 4:return p.label++,{value:_[1],done:!1};case 5:p.label++,d=_[1],_=[0];continue;case 7:_=p.ops.pop(),p.trys.pop();continue;default:if(!(v=(v=p.trys).length>0&&v[v.length-1])&&(_[0]===6||_[0]===2)){p=0;continue}if(_[0]===3&&(!v||_[1]>v[0]&&_[1]<v[3])){p.label=_[1];break}if(_[0]===6&&p.label<v[1]){p.label=v[1],v=_;break}if(v&&p.label<v[2]){p.label=v[2],p.ops.push(_);break}v[2]&&p.ops.pop(),p.trys.pop();continue}_=h.call(c,p)}catch(P){_=[6,P],d=0}finally{f=v=0}if(5&_[0])throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}([x,m])}}},a=this&&this.__read||function(c,h){var f=typeof Symbol=="function"&&c[Symbol.iterator];if(!f)return c;var d,v,g=f.call(c),p=[];try{for(;(h===void 0||h-- >0)&&!(d=g.next()).done;)p.push(d.value)}catch(b){v={error:b}}finally{try{d&&!d.done&&(f=g.return)&&f.call(g)}finally{if(v)throw v.error}}return p},l=this&&this.__spreadArray||function(c,h,f){if(f||arguments.length===2)for(var d,v=0,g=h.length;v<g;v++)!d&&v in h||(d||(d=Array.prototype.slice.call(h,0,v)),d[v]=h[v]);return c.concat(d||Array.prototype.slice.call(h))},u=this&&this.__values||function(c){var h=typeof Symbol=="function"&&Symbol.iterator,f=h&&c[h],d=0;if(f)return f.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&d>=c.length&&(c=void 0),{value:c&&c[d++],done:!c}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")};function s(c){var h=this;c===void 0&&(c=[]);var f=0,d=[];this.size=function(){return f},this.empty=function(){return f===0},this.clear=function(){f=0,d.length=0},this.front=function(){if(!this.empty())return d[0]},this.back=function(){if(!this.empty())return d[f-1]},this.forEach=function(v){d.forEach(v)},this.getElementByPos=function(v){if(v<0||v>=f)throw new Error("pos must more than 0 and less than vector's size");return d[v]},this.eraseElementByPos=function(v){if(v<0||v>=f)throw new Error("pos must more than 0 and less than vector's size");for(var g=v;g<f-1;++g)d[g]=d[g+1];this.popBack()},this.eraseElementByValue=function(v){var g=[];this.forEach(function(b){b!==v&&g.push(b)}),g.forEach(function(b,x){d[x]=b});for(var p=g.length;f>p;)this.popBack()},this.pushBack=function(v){d.push(v),++f},this.popBack=function(){d.pop(),f>0&&--f},this.setElementByPos=function(v,g){if(v<0||v>=f)throw new Error("pos must more than 0 and less than vector's size");d[v]=g},this.insert=function(v,g,p){if(p===void 0&&(p=1),v<0||v>f)throw new Error("pos must more than 0 and less than or equal to vector's size");d.splice.apply(d,l([v,0],a(new Array(p).fill(g)),!1)),f+=p},this.find=function(v){return d.includes(v)},this.reverse=function(){d.reverse()},this.unique=function(){var v,g=[];this.forEach(function(b,x){x!==0&&b===v||(g.push(b),v=b)}),g.forEach(function(b,x){d[x]=b});for(var p=g.length;f>p;)this.popBack()},this.sort=function(v){d.sort(v)},this[Symbol.iterator]=function(){return function(){return o(this,function(v){switch(v.label){case 0:return[5,u(d)];case 1:return[2,v.sent()]}})}()},c.forEach(function(v){return h.pushBack(v)}),Object.freeze(this)}Object.defineProperty(r,"__esModule",{value:!0}),Object.freeze(s),r.default=s},{}],36:[function(i,n,r){Object.defineProperty(r,"__esModule",{value:!0}),r.HashMap=r.HashSet=r.Map=r.Set=r.PriorityQueue=r.Deque=r.LinkList=r.Queue=r.Stack=r.Vector=void 0;var o=i("./Vector/Vector");r.Vector=o.default;var a=i("./Stack/Stack");r.Stack=a.default;var l=i("./Queue/Queue");r.Queue=l.default;var u=i("./LinkList/LinkList");r.LinkList=u.default;var s=i("./Deque/Deque");r.Deque=s.default;var c=i("./PriorityQueue/PriorityQueue");r.PriorityQueue=c.default;var h=i("./Set/Set");r.Set=h.default;var f=i("./Map/Map");r.Map=f.default;var d=i("./HashSet/HashSet");r.HashSet=d.default;var v=i("./HashMap/HashMap");r.HashMap=v.default},{"./Deque/Deque":26,"./HashMap/HashMap":27,"./HashSet/HashSet":28,"./LinkList/LinkList":29,"./Map/Map":30,"./PriorityQueue/PriorityQueue":31,"./Queue/Queue":32,"./Set/Set":33,"./Stack/Stack":34,"./Vector/Vector":35}],37:[function(i,n,r){const o=i("yallist"),a=Symbol("max"),l=Symbol("length"),u=Symbol("lengthCalculator"),s=Symbol("allowStale"),c=Symbol("maxAge"),h=Symbol("dispose"),f=Symbol("noDisposeOnSet"),d=Symbol("lruList"),v=Symbol("cache"),g=Symbol("updateAgeOnGet"),p=()=>1,b=(L,I,V)=>{const Q=L[v].get(I);if(Q){const T=Q.value;if(x(L,T)){if(_(L,Q),!L[s])return}else V&&(L[g]&&(Q.value.now=Date.now()),L[d].unshiftNode(Q));return T.value}},x=(L,I)=>{if(!I||!I.maxAge&&!L[c])return!1;const V=Date.now()-I.now;return I.maxAge?V>I.maxAge:L[c]&&V>L[c]},m=L=>{if(L[l]>L[a])for(let I=L[d].tail;L[l]>L[a]&&I!==null;){const V=I.prev;_(L,I),I=V}},_=(L,I)=>{if(I){const V=I.value;L[h]&&L[h](V.key,V.value),L[l]-=V.length,L[v].delete(V.key),L[d].removeNode(I)}};class P{constructor(I,V,Q,T,k){this.key=I,this.value=V,this.length=Q,this.now=T,this.maxAge=k||0}}const R=(L,I,V,Q)=>{let T=V.value;x(L,T)&&(_(L,V),L[s]||(T=void 0)),T&&I.call(Q,T.value,T.key,L)};n.exports=class{constructor(L){if(typeof L=="number"&&(L={max:L}),L||(L={}),L.max&&(typeof L.max!="number"||L.max<0))throw new TypeError("max must be a non-negative number");this[a]=L.max||1/0;const I=L.length||p;if(this[u]=typeof I!="function"?p:I,this[s]=L.stale||!1,L.maxAge&&typeof L.maxAge!="number")throw new TypeError("maxAge must be a number");this[c]=L.maxAge||0,this[h]=L.dispose,this[f]=L.noDisposeOnSet||!1,this[g]=L.updateAgeOnGet||!1,this.reset()}set max(L){if(typeof L!="number"||L<0)throw new TypeError("max must be a non-negative number");this[a]=L||1/0,m(this)}get max(){return this[a]}set allowStale(L){this[s]=!!L}get allowStale(){return this[s]}set maxAge(L){if(typeof L!="number")throw new TypeError("maxAge must be a non-negative number");this[c]=L,m(this)}get maxAge(){return this[c]}set lengthCalculator(L){typeof L!="function"&&(L=p),L!==this[u]&&(this[u]=L,this[l]=0,this[d].forEach(I=>{I.length=this[u](I.value,I.key),this[l]+=I.length})),m(this)}get lengthCalculator(){return this[u]}get length(){return this[l]}get itemCount(){return this[d].length}rforEach(L,I){I=I||this;for(let V=this[d].tail;V!==null;){const Q=V.prev;R(this,L,V,I),V=Q}}forEach(L,I){I=I||this;for(let V=this[d].head;V!==null;){const Q=V.next;R(this,L,V,I),V=Q}}keys(){return this[d].toArray().map(L=>L.key)}values(){return this[d].toArray().map(L=>L.value)}reset(){this[h]&&this[d]&&this[d].length&&this[d].forEach(L=>this[h](L.key,L.value)),this[v]=new Map,this[d]=new o,this[l]=0}dump(){return this[d].map(L=>!x(this,L)&&{k:L.key,v:L.value,e:L.now+(L.maxAge||0)}).toArray().filter(L=>L)}dumpLru(){return this[d]}set(L,I,V){if((V=V||this[c])&&typeof V!="number")throw new TypeError("maxAge must be a number");const Q=V?Date.now():0,T=this[u](I,L);if(this[v].has(L)){if(T>this[a])return _(this,this[v].get(L)),!1;const M=this[v].get(L).value;return this[h]&&(this[f]||this[h](L,M.value)),M.now=Q,M.maxAge=V,M.value=I,this[l]+=T-M.length,M.length=T,this.get(L),m(this),!0}const k=new P(L,I,T,Q,V);return k.length>this[a]?(this[h]&&this[h](L,I),!1):(this[l]+=k.length,this[d].unshift(k),this[v].set(L,this[d].head),m(this),!0)}has(L){if(!this[v].has(L))return!1;const I=this[v].get(L).value;return!x(this,I)}get(L){return b(this,L,!0)}peek(L){return b(this,L,!1)}pop(){const L=this[d].tail;return L?(_(this,L),L.value):null}del(L){_(this,this[v].get(L))}load(L){this.reset();const I=Date.now();for(let V=L.length-1;V>=0;V--){const Q=L[V],T=Q.e||0;if(T===0)this.set(Q.k,Q.v);else{const k=T-I;k>0&&this.set(Q.k,Q.v,k)}}}prune(){this[v].forEach((L,I)=>b(this,I,!1))}}},{yallist:83}],38:[function(i,n,r){(function(o){(function(){const a=n.exports;a.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},a.codes={};for(const u in a.types){const s=a.types[u];a.codes[s]=u}a.CMD_SHIFT=4,a.CMD_MASK=240,a.DUP_MASK=8,a.QOS_MASK=3,a.QOS_SHIFT=1,a.RETAIN_MASK=1,a.VARBYTEINT_MASK=127,a.VARBYTEINT_FIN_MASK=128,a.VARBYTEINT_MAX=268435455,a.SESSIONPRESENT_MASK=1,a.SESSIONPRESENT_HEADER=o.from([a.SESSIONPRESENT_MASK]),a.CONNACK_HEADER=o.from([a.codes.connack<<a.CMD_SHIFT]),a.USERNAME_MASK=128,a.PASSWORD_MASK=64,a.WILL_RETAIN_MASK=32,a.WILL_QOS_MASK=24,a.WILL_QOS_SHIFT=3,a.WILL_FLAG_MASK=4,a.CLEAN_SESSION_MASK=2,a.CONNECT_HEADER=o.from([a.codes.connect<<a.CMD_SHIFT]),a.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},a.propertiesCodes={};for(const u in a.properties){const s=a.properties[u];a.propertiesCodes[s]=u}function l(u){return[0,1,2].map(s=>[0,1].map(c=>[0,1].map(h=>{const f=o.alloc(1);return f.writeUInt8(a.codes[u]<<a.CMD_SHIFT|(c?a.DUP_MASK:0)|s<<a.QOS_SHIFT|h,0,!0),f})))}a.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"},a.PUBLISH_HEADER=l("publish"),a.SUBSCRIBE_HEADER=l("subscribe"),a.SUBSCRIBE_OPTIONS_QOS_MASK=3,a.SUBSCRIBE_OPTIONS_NL_MASK=1,a.SUBSCRIBE_OPTIONS_NL_SHIFT=2,a.SUBSCRIBE_OPTIONS_RAP_MASK=1,a.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,a.SUBSCRIBE_OPTIONS_RH_MASK=3,a.SUBSCRIBE_OPTIONS_RH_SHIFT=4,a.SUBSCRIBE_OPTIONS_RH=[0,16,32],a.SUBSCRIBE_OPTIONS_NL=4,a.SUBSCRIBE_OPTIONS_RAP=8,a.SUBSCRIBE_OPTIONS_QOS=[0,1,2],a.UNSUBSCRIBE_HEADER=l("unsubscribe"),a.ACKS={unsuback:l("unsuback"),puback:l("puback"),pubcomp:l("pubcomp"),pubrel:l("pubrel"),pubrec:l("pubrec")},a.SUBACK_HEADER=o.from([a.codes.suback<<a.CMD_SHIFT]),a.VERSION3=o.from([3]),a.VERSION4=o.from([4]),a.VERSION5=o.from([5]),a.VERSION131=o.from([131]),a.VERSION132=o.from([132]),a.QOS=[0,1,2].map(u=>o.from([u])),a.EMPTY={pingreq:o.from([a.codes.pingreq<<4,0]),pingresp:o.from([a.codes.pingresp<<4,0]),disconnect:o.from([a.codes.disconnect<<4,0])}}).call(this)}).call(this,i("buffer").Buffer)},{buffer:17}],39:[function(i,n,r){(function(o){(function(){const a=i("./writeToStream"),l=i("events");class u extends l{constructor(){super(),this._array=new Array(20),this._i=0}write(c){return this._array[this._i++]=c,!0}concat(){let c=0;const h=new Array(this._array.length),f=this._array;let d,v=0;for(d=0;d<f.length&&f[d]!==void 0;d++)typeof f[d]!="string"?h[d]=f[d].length:h[d]=o.byteLength(f[d]),c+=h[d];const g=o.allocUnsafe(c);for(d=0;d<f.length&&f[d]!==void 0;d++)typeof f[d]!="string"?(f[d].copy(g,v),v+=h[d]):(g.write(f[d],v),v+=h[d]);return g}}n.exports=function(s,c){const h=new u;return a(s,h,c),h.concat()}}).call(this)}).call(this,i("buffer").Buffer)},{"./writeToStream":44,buffer:17,events:22}],40:[function(i,n,r){r.parser=i("./parser").parser,r.generate=i("./generate"),r.writeToStream=i("./writeToStream")},{"./generate":39,"./parser":43,"./writeToStream":44}],41:[function(i,n,r){(function(o){(function(){const l={},u=o.isBuffer(o.from([1,2]).subarray(0,1));function s(c){const h=o.allocUnsafe(2);return h.writeUInt8(c>>8,0),h.writeUInt8(255&c,1),h}n.exports={cache:l,generateCache:function(){for(let c=0;c<65536;c++)l[c]=s(c)},generateNumber:s,genBufVariableByteInt:function(c){let h=0,f=0;const d=o.allocUnsafe(4);do h=c%128|0,(c=c/128|0)>0&&(h|=128),d.writeUInt8(h,f++);while(c>0&&f<4);return c>0&&(f=0),u?d.subarray(0,f):d.slice(0,f)},generate4ByteBuffer:function(c){const h=o.allocUnsafe(4);return h.writeUInt32BE(c,0),h}}}).call(this)}).call(this,i("buffer").Buffer)},{buffer:17}],42:[function(i,n,r){n.exports=class{constructor(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}}},{}],43:[function(i,n,r){const o=i("bl"),a=i("events"),l=i("./packet"),u=i("./constants"),s=i("debug")("mqtt-packet:parser");class c extends a{constructor(){super(),this.parser=this.constructor.parser}static parser(f){return this instanceof c?(this.settings=f||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):new c().parser(f)}_resetState(){s("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new l,this.error=null,this._list=o(),this._stateCounter=0}parse(f){for(this.error&&this._resetState(),this._list.append(f),s("parse: current state: %s",this._states[this._stateCounter]);(this.packet.length!==-1||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,s("parse: state complete. _stateCounter is now: %d",this._stateCounter),s("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return s("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}_parseHeader(){const f=this._list.readUInt8(0);return this.packet.cmd=u.types[f>>u.CMD_SHIFT],this.packet.retain=(f&u.RETAIN_MASK)!=0,this.packet.qos=f>>u.QOS_SHIFT&u.QOS_MASK,this.packet.dup=(f&u.DUP_MASK)!=0,s("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0}_parseLength(){const f=this._parseVarByteNum(!0);return f&&(this.packet.length=f.value,this._list.consume(f.bytes)),s("_parseLength %d",f.value),!!f}_parsePayload(){s("_parsePayload: payload %O",this._list);let f=!1;if(this.packet.length===0||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}f=!0}return s("_parsePayload complete result: %s",f),f}_parseConnect(){let f,d,v,g;s("_parseConnect");const p={},b=this.packet,x=this._parseString();if(x===null)return this._emitError(new Error("Cannot parse protocolId"));if(x!=="MQTT"&&x!=="MQIsdp")return this._emitError(new Error("Invalid protocolId"));if(b.protocolId=x,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(b.protocolVersion=this._list.readUInt8(this._pos),b.protocolVersion>=128&&(b.bridgeMode=!0,b.protocolVersion=b.protocolVersion-128),b.protocolVersion!==3&&b.protocolVersion!==4&&b.protocolVersion!==5)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(p.username=this._list.readUInt8(this._pos)&u.USERNAME_MASK,p.password=this._list.readUInt8(this._pos)&u.PASSWORD_MASK,p.will=this._list.readUInt8(this._pos)&u.WILL_FLAG_MASK,p.will&&(b.will={},b.will.retain=(this._list.readUInt8(this._pos)&u.WILL_RETAIN_MASK)!=0,b.will.qos=(this._list.readUInt8(this._pos)&u.WILL_QOS_MASK)>>u.WILL_QOS_SHIFT),b.clean=(this._list.readUInt8(this._pos)&u.CLEAN_SESSION_MASK)!=0,this._pos++,b.keepalive=this._parseNum(),b.keepalive===-1)return this._emitError(new Error("Packet too short"));if(b.protocolVersion===5){const _=this._parseProperties();Object.getOwnPropertyNames(_).length&&(b.properties=_)}const m=this._parseString();if(m===null)return this._emitError(new Error("Packet too short"));if(b.clientId=m,s("_parseConnect: packet.clientId: %s",b.clientId),p.will){if(b.protocolVersion===5){const _=this._parseProperties();Object.getOwnPropertyNames(_).length&&(b.will.properties=_)}if((f=this._parseString())===null)return this._emitError(new Error("Cannot parse will topic"));if(b.will.topic=f,s("_parseConnect: packet.will.topic: %s",b.will.topic),(d=this._parseBuffer())===null)return this._emitError(new Error("Cannot parse will payload"));b.will.payload=d,s("_parseConnect: packet.will.paylaod: %s",b.will.payload)}if(p.username){if((g=this._parseString())===null)return this._emitError(new Error("Cannot parse username"));b.username=g,s("_parseConnect: packet.username: %s",b.username)}if(p.password){if((v=this._parseBuffer())===null)return this._emitError(new Error("Cannot parse password"));b.password=v}return this.settings=b,s("_parseConnect: complete"),b}_parseConnack(){s("_parseConnack");const f=this.packet;if(this._list.length<1)return null;if(f.sessionPresent=!!(this._list.readUInt8(this._pos++)&u.SESSIONPRESENT_MASK),this.settings.protocolVersion===5)this._list.length>=2?f.reasonCode=this._list.readUInt8(this._pos++):f.reasonCode=0;else{if(this._list.length<2)return null;f.returnCode=this._list.readUInt8(this._pos++)}if(f.returnCode===-1||f.reasonCode===-1)return this._emitError(new Error("Cannot parse return code"));if(this.settings.protocolVersion===5){const d=this._parseProperties();Object.getOwnPropertyNames(d).length&&(f.properties=d)}s("_parseConnack: complete")}_parsePublish(){s("_parsePublish");const f=this.packet;if(f.topic=this._parseString(),f.topic===null)return this._emitError(new Error("Cannot parse topic"));if(!(f.qos>0)||this._parseMessageId()){if(this.settings.protocolVersion===5){const d=this._parseProperties();Object.getOwnPropertyNames(d).length&&(f.properties=d)}f.payload=this._list.slice(this._pos,f.length),s("_parsePublish: payload from buffer list: %o",f.payload)}}_parseSubscribe(){s("_parseSubscribe");const f=this.packet;let d,v,g,p,b,x,m;if(f.qos!==1)return this._emitError(new Error("Wrong subscribe header"));if(f.subscriptions=[],this._parseMessageId()){if(this.settings.protocolVersion===5){const _=this._parseProperties();Object.getOwnPropertyNames(_).length&&(f.properties=_)}for(;this._pos<f.length;){if((d=this._parseString())===null)return this._emitError(new Error("Cannot parse topic"));if(this._pos>=f.length)return this._emitError(new Error("Malformed Subscribe Payload"));g=(v=this._parseByte())&u.SUBSCRIBE_OPTIONS_QOS_MASK,x=(v>>u.SUBSCRIBE_OPTIONS_NL_SHIFT&u.SUBSCRIBE_OPTIONS_NL_MASK)!=0,b=(v>>u.SUBSCRIBE_OPTIONS_RAP_SHIFT&u.SUBSCRIBE_OPTIONS_RAP_MASK)!=0,p=v>>u.SUBSCRIBE_OPTIONS_RH_SHIFT&u.SUBSCRIBE_OPTIONS_RH_MASK,m={topic:d,qos:g},this.settings.protocolVersion===5?(m.nl=x,m.rap=b,m.rh=p):this.settings.bridgeMode&&(m.rh=0,m.rap=!0,m.nl=!0),s("_parseSubscribe: push subscription `%s` to subscription",m),f.subscriptions.push(m)}}}_parseSuback(){s("_parseSuback");const f=this.packet;if(this.packet.granted=[],this._parseMessageId()){if(this.settings.protocolVersion===5){const d=this._parseProperties();Object.getOwnPropertyNames(d).length&&(f.properties=d)}for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}_parseUnsubscribe(){s("_parseUnsubscribe");const f=this.packet;if(f.unsubscriptions=[],this._parseMessageId()){if(this.settings.protocolVersion===5){const d=this._parseProperties();Object.getOwnPropertyNames(d).length&&(f.properties=d)}for(;this._pos<f.length;){const d=this._parseString();if(d===null)return this._emitError(new Error("Cannot parse topic"));s("_parseUnsubscribe: push topic `%s` to unsubscriptions",d),f.unsubscriptions.push(d)}}}_parseUnsuback(){s("_parseUnsuback");const f=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if(this.settings.protocolVersion===5){const d=this._parseProperties();for(Object.getOwnPropertyNames(d).length&&(f.properties=d),f.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}_parseConfirmation(){s("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);const f=this.packet;if(this._parseMessageId(),this.settings.protocolVersion===5&&(f.length>2?(f.reasonCode=this._parseByte(),s("_parseConfirmation: packet.reasonCode `%d`",f.reasonCode)):f.reasonCode=0,f.length>3)){const d=this._parseProperties();Object.getOwnPropertyNames(d).length&&(f.properties=d)}return!0}_parseDisconnect(){const f=this.packet;if(s("_parseDisconnect"),this.settings.protocolVersion===5){this._list.length>0?f.reasonCode=this._parseByte():f.reasonCode=0;const d=this._parseProperties();Object.getOwnPropertyNames(d).length&&(f.properties=d)}return s("_parseDisconnect result: true"),!0}_parseAuth(){s("_parseAuth");const f=this.packet;if(this.settings.protocolVersion!==5)return this._emitError(new Error("Not supported auth packet for this version MQTT"));f.reasonCode=this._parseByte();const d=this._parseProperties();return Object.getOwnPropertyNames(d).length&&(f.properties=d),s("_parseAuth: result: true"),!0}_parseMessageId(){const f=this.packet;return f.messageId=this._parseNum(),f.messageId===null?(this._emitError(new Error("Cannot parse messageId")),!1):(s("_parseMessageId: packet.messageId %d",f.messageId),!0)}_parseString(f){const d=this._parseNum(),v=d+this._pos;if(d===-1||v>this._list.length||v>this.packet.length)return null;const g=this._list.toString("utf8",this._pos,v);return this._pos+=d,s("_parseString: result: %s",g),g}_parseStringPair(){return s("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}_parseBuffer(){const f=this._parseNum(),d=f+this._pos;if(f===-1||d>this._list.length||d>this.packet.length)return null;const v=this._list.slice(this._pos,d);return this._pos+=f,s("_parseBuffer: result: %o",v),v}_parseNum(){if(this._list.length-this._pos<2)return-1;const f=this._list.readUInt16BE(this._pos);return this._pos+=2,s("_parseNum: result: %s",f),f}_parse4ByteNum(){if(this._list.length-this._pos<4)return-1;const f=this._list.readUInt32BE(this._pos);return this._pos+=4,s("_parse4ByteNum: result: %s",f),f}_parseVarByteNum(f){s("_parseVarByteNum");let d,v=0,g=1,p=0,b=!1;const x=this._pos?this._pos:0;for(;v<4&&x+v<this._list.length;){if(p+=g*((d=this._list.readUInt8(x+v++))&u.VARBYTEINT_MASK),g*=128,(d&u.VARBYTEINT_FIN_MASK)==0){b=!0;break}if(this._list.length<=v)break}return!b&&v===4&&this._list.length>=v&&this._emitError(new Error("Invalid variable byte integer")),x&&(this._pos+=v),s("_parseVarByteNum: result: %o",b=!!b&&(f?{bytes:v,value:p}:p)),b}_parseByte(){let f;return this._pos<this._list.length&&(f=this._list.readUInt8(this._pos),this._pos++),s("_parseByte: result: %o",f),f}_parseByType(f){switch(s("_parseByType: type: %s",f),f){case"byte":return this._parseByte()!==0;case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}_parseProperties(){s("_parseProperties");const f=this._parseVarByteNum(),d=this._pos+f,v={};for(;this._pos<d;){const g=this._parseByte();if(!g)return this._emitError(new Error("Cannot parse property code type")),!1;const p=u.propertiesCodes[g];if(!p)return this._emitError(new Error("Unknown property")),!1;if(p!=="userProperties")v[p]?Array.isArray(v[p])?v[p].push(this._parseByType(u.propertiesTypes[p])):(v[p]=[v[p]],v[p].push(this._parseByType(u.propertiesTypes[p]))):v[p]=this._parseByType(u.propertiesTypes[p]);else{v[p]||(v[p]=Object.create(null));const b=this._parseByType(u.propertiesTypes[p]);if(v[p][b.name])if(Array.isArray(v[p][b.name]))v[p][b.name].push(b.value);else{const x=v[p][b.name];v[p][b.name]=[x],v[p][b.name].push(b.value)}else v[p][b.name]=b.value}}return v}_newPacket(){return s("_newPacket"),this.packet&&(this._list.consume(this.packet.length),s("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),s("_newPacket: new packet"),this.packet=new l,this._pos=0,!0}_emitError(f){s("_emitError"),this.error=f,this.emit("error",f)}}n.exports=c},{"./constants":38,"./packet":42,bl:15,debug:18,events:22}],44:[function(i,n,r){(function(o){(function(){const a=i("./constants"),l=o.allocUnsafe(0),u=o.from([0]),s=i("./numbers"),c=i("process-nextick-args").nextTick,h=i("debug")("mqtt-packet:writeToStream"),f=s.cache,d=s.generateNumber,v=s.generateCache,g=s.genBufVariableByteInt,p=s.generate4ByteBuffer;let b=V,x=!0;function m(F,D,z){switch(h("generate called"),D.cork&&(D.cork(),c(_,D)),x&&(x=!1,v()),h("generate: packet.cmd: %s",F.cmd),F.cmd){case"connect":return function(U,N,q){const X=U||{},$=X.protocolId||"MQTT";let Z=X.protocolVersion||4;const J=X.will;let te=X.clean;const y=X.keepalive||0,w=X.clientId||"",A=X.username,O=X.password,S=X.properties;te===void 0&&(te=!0);let E=0;if(!$||typeof $!="string"&&!o.isBuffer($))return N.emit("error",new Error("Invalid protocolId")),!1;if(E+=$.length+2,Z!==3&&Z!==4&&Z!==5)return N.emit("error",new Error("Invalid protocol version")),!1;if(E+=1,(typeof w=="string"||o.isBuffer(w))&&(w||Z>=4)&&(w||te))E+=o.byteLength(w)+2;else{if(Z<4)return N.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(1*te==0)return N.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}if(typeof y!="number"||y<0||y>65535||y%1!=0)return N.emit("error",new Error("Invalid keepalive")),!1;if(E+=2,E+=1,Z===5){var j=k(N,S);if(!j)return!1;E+=j.length}if(J){if(typeof J!="object")return N.emit("error",new Error("Invalid will")),!1;if(!J.topic||typeof J.topic!="string")return N.emit("error",new Error("Invalid will topic")),!1;if(E+=o.byteLength(J.topic)+2,E+=2,J.payload){if(!(J.payload.length>=0))return N.emit("error",new Error("Invalid will payload")),!1;typeof J.payload=="string"?E+=o.byteLength(J.payload):E+=J.payload.length}var Y={};if(Z===5){if(!(Y=k(N,J.properties)))return!1;E+=Y.length}}let K=!1;if(A!=null){if(!W(A))return N.emit("error",new Error("Invalid username")),!1;K=!0,E+=o.byteLength(A)+2}if(O!=null){if(!K)return N.emit("error",new Error("Username is required to use password")),!1;if(!W(O))return N.emit("error",new Error("Invalid password")),!1;E+=H(O)+2}N.write(a.CONNECT_HEADER),R(N,E),T(N,$),X.bridgeMode&&(Z+=128),N.write(Z===131?a.VERSION131:Z===132?a.VERSION132:Z===4?a.VERSION4:Z===5?a.VERSION5:a.VERSION3);let G=0;return G|=A!=null?a.USERNAME_MASK:0,G|=O!=null?a.PASSWORD_MASK:0,G|=J&&J.retain?a.WILL_RETAIN_MASK:0,G|=J&&J.qos?J.qos<<a.WILL_QOS_SHIFT:0,G|=J?a.WILL_FLAG_MASK:0,G|=te?a.CLEAN_SESSION_MASK:0,N.write(o.from([G])),b(N,y),Z===5&&j.write(),T(N,w),J&&(Z===5&&Y.write(),L(N,J.topic),T(N,J.payload)),A!=null&&T(N,A),O!=null&&T(N,O),!0}(F,D);case"connack":return function(U,N,q){const X=q?q.protocolVersion:4,$=U||{},Z=X===5?$.reasonCode:$.returnCode,J=$.properties;let te=2;if(typeof Z!="number")return N.emit("error",new Error("Invalid return code")),!1;let y=null;if(X===5){if(!(y=k(N,J)))return!1;te+=y.length}return N.write(a.CONNACK_HEADER),R(N,te),N.write($.sessionPresent?a.SESSIONPRESENT_HEADER:u),N.write(o.from([Z])),y!=null&&y.write(),!0}(F,D,z);case"publish":return function(U,N,q){h("publish: packet: %o",U);const X=q?q.protocolVersion:4,$=U||{},Z=$.qos||0,J=$.retain?a.RETAIN_MASK:0,te=$.topic,y=$.payload||l,w=$.messageId,A=$.properties;let O=0;if(typeof te=="string")O+=o.byteLength(te)+2;else{if(!o.isBuffer(te))return N.emit("error",new Error("Invalid topic")),!1;O+=te.length+2}if(o.isBuffer(y)?O+=y.length:O+=o.byteLength(y),Z&&typeof w!="number")return N.emit("error",new Error("Invalid messageId")),!1;Z&&(O+=2);let S=null;if(X===5){if(!(S=k(N,A)))return!1;O+=S.length}return N.write(a.PUBLISH_HEADER[Z][$.dup?1:0][J?1:0]),R(N,O),b(N,H(te)),N.write(te),Z>0&&b(N,w),S!=null&&S.write(),h("publish: payload: %o",y),N.write(y)}(F,D,z);case"puback":case"pubrec":case"pubrel":case"pubcomp":return function(U,N,q){const X=q?q.protocolVersion:4,$=U||{},Z=$.cmd||"puback",J=$.messageId,te=$.dup&&Z==="pubrel"?a.DUP_MASK:0;let y=0;const w=$.reasonCode,A=$.properties;let O=X===5?3:2;if(Z==="pubrel"&&(y=1),typeof J!="number")return N.emit("error",new Error("Invalid messageId")),!1;let S=null;if(X===5&&typeof A=="object"){if(!(S=M(N,A,q,O)))return!1;O+=S.length}return N.write(a.ACKS[Z][y][te][0]),R(N,O),b(N,J),X===5&&N.write(o.from([w])),S!==null&&S.write(),!0}(F,D,z);case"subscribe":return function(U,N,q){h("subscribe: packet: ");const X=q?q.protocolVersion:4,$=U||{},Z=$.dup?a.DUP_MASK:0,J=$.messageId,te=$.subscriptions,y=$.properties;let w=0;if(typeof J!="number")return N.emit("error",new Error("Invalid messageId")),!1;w+=2;let A=null;if(X===5){if(!(A=k(N,y)))return!1;w+=A.length}if(typeof te!="object"||!te.length)return N.emit("error",new Error("Invalid subscriptions")),!1;for(let S=0;S<te.length;S+=1){const E=te[S].topic,j=te[S].qos;if(typeof E!="string")return N.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if(typeof j!="number")return N.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;if(X===5){if(typeof(te[S].nl||!1)!="boolean")return N.emit("error",new Error("Invalid subscriptions - invalid No Local")),!1;if(typeof(te[S].rap||!1)!="boolean")return N.emit("error",new Error("Invalid subscriptions - invalid Retain as Published")),!1;const G=te[S].rh||0;if(typeof G!="number"||G>2)return N.emit("error",new Error("Invalid subscriptions - invalid Retain Handling")),!1}w+=o.byteLength(E)+2+1}h("subscribe: writing to stream: %o",a.SUBSCRIBE_HEADER),N.write(a.SUBSCRIBE_HEADER[1][Z?1:0][0]),R(N,w),b(N,J),A!==null&&A.write();let O=!0;for(const S of te){const E=S.topic,j=S.qos,Y=+S.nl,K=+S.rap,G=S.rh;let ee;L(N,E),ee=a.SUBSCRIBE_OPTIONS_QOS[j],X===5&&(ee|=Y?a.SUBSCRIBE_OPTIONS_NL:0,ee|=K?a.SUBSCRIBE_OPTIONS_RAP:0,ee|=G?a.SUBSCRIBE_OPTIONS_RH[G]:0),O=N.write(o.from([ee]))}return O}(F,D,z);case"suback":return function(U,N,q){const X=q?q.protocolVersion:4,$=U||{},Z=$.messageId,J=$.granted,te=$.properties;let y=0;if(typeof Z!="number")return N.emit("error",new Error("Invalid messageId")),!1;if(y+=2,typeof J!="object"||!J.length)return N.emit("error",new Error("Invalid qos vector")),!1;for(let A=0;A<J.length;A+=1){if(typeof J[A]!="number")return N.emit("error",new Error("Invalid qos vector")),!1;y+=1}let w=null;if(X===5){if(!(w=M(N,te,q,y)))return!1;y+=w.length}return N.write(a.SUBACK_HEADER),R(N,y),b(N,Z),w!==null&&w.write(),N.write(o.from(J))}(F,D,z);case"unsubscribe":return function(U,N,q){const X=q?q.protocolVersion:4,$=U||{},Z=$.messageId,J=$.dup?a.DUP_MASK:0,te=$.unsubscriptions,y=$.properties;let w=0;if(typeof Z!="number")return N.emit("error",new Error("Invalid messageId")),!1;if(w+=2,typeof te!="object"||!te.length)return N.emit("error",new Error("Invalid unsubscriptions")),!1;for(let S=0;S<te.length;S+=1){if(typeof te[S]!="string")return N.emit("error",new Error("Invalid unsubscriptions")),!1;w+=o.byteLength(te[S])+2}let A=null;if(X===5){if(!(A=k(N,y)))return!1;w+=A.length}N.write(a.UNSUBSCRIBE_HEADER[1][J?1:0][0]),R(N,w),b(N,Z),A!==null&&A.write();let O=!0;for(let S=0;S<te.length;S++)O=L(N,te[S]);return O}(F,D,z);case"unsuback":return function(U,N,q){const X=q?q.protocolVersion:4,$=U||{},Z=$.messageId,J=$.dup?a.DUP_MASK:0,te=$.granted,y=$.properties,w=$.cmd;let A=2;if(typeof Z!="number")return N.emit("error",new Error("Invalid messageId")),!1;if(X===5){if(typeof te!="object"||!te.length)return N.emit("error",new Error("Invalid qos vector")),!1;for(let S=0;S<te.length;S+=1){if(typeof te[S]!="number")return N.emit("error",new Error("Invalid qos vector")),!1;A+=1}}let O=null;if(X===5){if(!(O=M(N,y,q,A)))return!1;A+=O.length}return N.write(a.ACKS[w][0][J][0]),R(N,A),b(N,Z),O!==null&&O.write(),X===5&&N.write(o.from(te)),!0}(F,D,z);case"pingreq":case"pingresp":return function(U,N,q){return N.write(a.EMPTY[U.cmd])}(F,D);case"disconnect":return function(U,N,q){const X=q?q.protocolVersion:4,$=U||{},Z=$.reasonCode,J=$.properties;let te=X===5?1:0,y=null;if(X===5){if(!(y=M(N,J,q,te)))return!1;te+=y.length}return N.write(o.from([a.codes.disconnect<<4])),R(N,te),X===5&&N.write(o.from([Z])),y!==null&&y.write(),!0}(F,D,z);case"auth":return function(U,N,q){const X=q?q.protocolVersion:4,$=U||{},Z=$.reasonCode,J=$.properties;let te=X===5?1:0;X!==5&&N.emit("error",new Error("Invalid mqtt version for auth packet"));const y=M(N,J,q,te);return y?(te+=y.length,N.write(o.from([a.codes.auth<<4])),R(N,te),N.write(o.from([Z])),y!==null&&y.write(),!0):!1}(F,D,z);default:return D.emit("error",new Error("Unknown command")),!1}}function _(F){F.uncork()}Object.defineProperty(m,"cacheNumbers",{get:()=>b===V,set(F){F?(f&&Object.keys(f).length!==0||(x=!0),b=V):(x=!1,b=Q)}});const P={};function R(F,D){if(D>a.VARBYTEINT_MAX)return F.emit("error",new Error(`Invalid variable byte integer: ${D}`)),!1;let z=P[D];return z||(z=g(D),D<16384&&(P[D]=z)),h("writeVarByteInt: writing to stream: %o",z),F.write(z)}function L(F,D){const z=o.byteLength(D);return b(F,z),h("writeString: %s",D),F.write(D,"utf8")}function I(F,D,z){L(F,D),L(F,z)}function V(F,D){return h("writeNumberCached: number: %d",D),h("writeNumberCached: %o",f[D]),F.write(f[D])}function Q(F,D){const z=d(D);return h("writeNumberGenerated: %o",z),F.write(z)}function T(F,D){typeof D=="string"?L(F,D):D?(b(F,D.length),F.write(D)):b(F,0)}function k(F,D){if(typeof D!="object"||D.length!=null)return{length:1,write(){B(F,{},0)}};let z=0;function U(N,q){let X=0;switch(a.propertiesTypes[N]){case"byte":if(typeof q!="boolean")return F.emit("error",new Error(`Invalid ${N}: ${q}`)),!1;X+=2;break;case"int8":if(typeof q!="number"||q<0||q>255)return F.emit("error",new Error(`Invalid ${N}: ${q}`)),!1;X+=2;break;case"binary":if(q&&q===null)return F.emit("error",new Error(`Invalid ${N}: ${q}`)),!1;X+=1+o.byteLength(q)+2;break;case"int16":if(typeof q!="number"||q<0||q>65535)return F.emit("error",new Error(`Invalid ${N}: ${q}`)),!1;X+=3;break;case"int32":if(typeof q!="number"||q<0||q>4294967295)return F.emit("error",new Error(`Invalid ${N}: ${q}`)),!1;X+=5;break;case"var":if(typeof q!="number"||q<0||q>268435455)return F.emit("error",new Error(`Invalid ${N}: ${q}`)),!1;X+=1+o.byteLength(g(q));break;case"string":if(typeof q!="string")return F.emit("error",new Error(`Invalid ${N}: ${q}`)),!1;X+=3+o.byteLength(q.toString());break;case"pair":if(typeof q!="object")return F.emit("error",new Error(`Invalid ${N}: ${q}`)),!1;X+=Object.getOwnPropertyNames(q).reduce(($,Z)=>{const J=q[Z];return Array.isArray(J)?$+=J.reduce((te,y)=>te+=3+o.byteLength(Z.toString())+2+o.byteLength(y.toString()),0):$+=3+o.byteLength(Z.toString())+2+o.byteLength(q[Z].toString()),$},0);break;default:return F.emit("error",new Error(`Invalid property ${N}: ${q}`)),!1}return X}if(D)for(const N in D){let q=0,X=0;const $=D[N];if(Array.isArray($))for(let Z=0;Z<$.length;Z++){if(!(X=U(N,$[Z])))return!1;q+=X}else{if(!(X=U(N,$)))return!1;q=X}if(!q)return!1;z+=q}return{length:o.byteLength(g(z))+z,write(){B(F,D,z)}}}function M(F,D,z,U){const N=["reasonString","userProperties"],q=z&&z.properties&&z.properties.maximumPacketSize?z.properties.maximumPacketSize:0;let X=k(F,D);if(q)for(;U+X.length>q;){const $=N.shift();if(!$||!D[$])return!1;delete D[$],X=k(F,D)}return X}function C(F,D,z){switch(a.propertiesTypes[D]){case"byte":F.write(o.from([a.properties[D]])),F.write(o.from([+z]));break;case"int8":F.write(o.from([a.properties[D]])),F.write(o.from([z]));break;case"binary":F.write(o.from([a.properties[D]])),T(F,z);break;case"int16":F.write(o.from([a.properties[D]])),b(F,z);break;case"int32":F.write(o.from([a.properties[D]])),function(U,N){const q=p(N);h("write4ByteNumber: %o",q),U.write(q)}(F,z);break;case"var":F.write(o.from([a.properties[D]])),R(F,z);break;case"string":F.write(o.from([a.properties[D]])),L(F,z);break;case"pair":Object.getOwnPropertyNames(z).forEach(U=>{const N=z[U];Array.isArray(N)?N.forEach(q=>{F.write(o.from([a.properties[D]])),I(F,U.toString(),q.toString())}):(F.write(o.from([a.properties[D]])),I(F,U.toString(),N.toString()))});break;default:return F.emit("error",new Error(`Invalid property ${D} value: ${z}`)),!1}}function B(F,D,z){R(F,z);for(const U in D)if(Object.prototype.hasOwnProperty.call(D,U)&&D[U]!==null){const N=D[U];if(Array.isArray(N))for(let q=0;q<N.length;q++)C(F,U,N[q]);else C(F,U,N)}}function H(F){return F?F instanceof o?F.length:o.byteLength(F):0}function W(F){return typeof F=="string"||F instanceof o}n.exports=m}).call(this)}).call(this,i("buffer").Buffer)},{"./constants":38,"./numbers":41,buffer:17,debug:18,"process-nextick-args":49}],45:[function(i,n,r){var o=1e3,a=60*o,l=60*a,u=24*l,s=7*u,c=365.25*u;function h(f,d,v,g){var p=d>=1.5*v;return Math.round(f/v)+" "+g+(p?"s":"")}n.exports=function(f,d){d=d||{};var v=typeof f;if(v==="string"&&f.length>0)return function(g){if(!((g=String(g)).length>100)){var p=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(g);if(!!p){var b=parseFloat(p[1]);switch((p[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return b*c;case"weeks":case"week":case"w":return b*s;case"days":case"day":case"d":return b*u;case"hours":case"hour":case"hrs":case"hr":case"h":return b*l;case"minutes":case"minute":case"mins":case"min":case"m":return b*a;case"seconds":case"second":case"secs":case"sec":case"s":return b*o;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return b;default:return}}}}(f);if(v==="number"&&isFinite(f))return d.long?function(g){var p=Math.abs(g);return p>=u?h(g,p,u,"day"):p>=l?h(g,p,l,"hour"):p>=a?h(g,p,a,"minute"):p>=o?h(g,p,o,"second"):g+" ms"}(f):function(g){var p=Math.abs(g);return p>=u?Math.round(g/u)+"d":p>=l?Math.round(g/l)+"h":p>=a?Math.round(g/a)+"m":p>=o?Math.round(g/o)+"s":g+"ms"}(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))}},{}],46:[function(i,n,r){const o=i("./lib/number-allocator.js");n.exports.NumberAllocator=o},{"./lib/number-allocator.js":47}],47:[function(i,n,r){const o=i("js-sdsl").Set,a=i("debug")("number-allocator:trace"),l=i("debug")("number-allocator:error");function u(c,h){this.low=c,this.high=h}function s(c,h){if(!(this instanceof s))return new s(c,h);this.min=c,this.max=h,this.ss=new o([],(f,d)=>f.compare(d)),a("Create"),this.clear()}u.prototype.equals=function(c){return this.low===c.low&&this.high===c.high},u.prototype.compare=function(c){return this.low<c.low&&this.high<c.low?-1:c.low<this.low&&c.high<this.low?1:0},s.prototype.firstVacant=function(){return this.ss.size()===0?null:this.ss.front().low},s.prototype.alloc=function(){if(this.ss.size()===0)return a("alloc():empty"),null;const c=this.ss.front(),h=c.low;return h+1<=c.high?++c.low:this.ss.eraseElementByPos(0),a("alloc():"+h),h},s.prototype.use=function(c){const h=new u(c,c),f=this.ss.lowerBound(h);if(f){if(f.equals(h))return this.ss.eraseElementByValue(f),a("use():"+c),!0;if(f.low>c)return!1;if(f.low===c)return++f.low,a("use():"+c),!0;if(f.high===c)return--f.high,a("use():"+c),!0;const d=f.low;return f.low=c+1,this.ss.insert(new u(d,c-1)),a("use():"+c),!0}return a("use():failed"),!1},s.prototype.free=function(c){if(c<this.min||c>this.max)return void l("free():"+c+" is out of range");const h=new u(c,c),f=this.ss.lowerBound(h);if(f){if(f.low<=c&&c<=f.high)return void l("free():"+c+" has already been vacant");if(f===this.ss.front())c+1===f.low?--f.low:this.ss.insert(h);else{const d=this.ss.reverseLowerBound(h);d.high+1===c?c+1===f.low?(this.ss.eraseElementByValue(d),f.low=d.low):d.high=c:c+1===f.low?f.low=c:this.ss.insert(h)}}else{if(f===this.ss.front())return void this.ss.insert(h);const d=this.ss.reverseLowerBound(h);d.high+1===c?d.high=c:this.ss.insert(h)}a("free():"+c)},s.prototype.clear=function(){a("clear()"),this.ss.clear(),this.ss.insert(new u(this.min,this.max))},s.prototype.intervalCount=function(){return this.ss.size()},s.prototype.dump=function(){console.log("length:"+this.ss.size());for(const c of this.ss)console.log(c)},n.exports=s},{debug:18,"js-sdsl":36}],48:[function(i,n,r){var o=i("wrappy");function a(u){var s=function(){return s.called?s.value:(s.called=!0,s.value=u.apply(this,arguments))};return s.called=!1,s}function l(u){var s=function(){if(s.called)throw new Error(s.onceError);return s.called=!0,s.value=u.apply(this,arguments)},c=u.name||"Function wrapped with `once`";return s.onceError=c+" shouldn't be called more than once",s.called=!1,s}n.exports=o(a),n.exports.strict=o(l),a.proto=a(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return a(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return l(this)},configurable:!0})})},{wrappy:79}],49:[function(i,n,r){(function(o){(function(){o===void 0||!o.version||o.version.indexOf("v0.")===0||o.version.indexOf("v1.")===0&&o.version.indexOf("v1.8.")!==0?n.exports={nextTick:function(a,l,u,s){if(typeof a!="function")throw new TypeError('"callback" argument must be a function');var c,h,f=arguments.length;switch(f){case 0:case 1:return o.nextTick(a);case 2:return o.nextTick(function(){a.call(null,l)});case 3:return o.nextTick(function(){a.call(null,l,u)});case 4:return o.nextTick(function(){a.call(null,l,u,s)});default:for(c=new Array(f-1),h=0;h<c.length;)c[h++]=arguments[h];return o.nextTick(function(){a.apply(null,c)})}}}:n.exports=o}).call(this)}).call(this,i("_process"))},{_process:50}],50:[function(i,n,r){var o,a,l=n.exports={};function u(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(m){if(o===setTimeout)return setTimeout(m,0);if((o===u||!o)&&setTimeout)return o=setTimeout,setTimeout(m,0);try{return o(m,0)}catch{try{return o.call(null,m,0)}catch{return o.call(this,m,0)}}}(function(){try{o=typeof setTimeout=="function"?setTimeout:u}catch{o=u}try{a=typeof clearTimeout=="function"?clearTimeout:s}catch{a=s}})();var h,f=[],d=!1,v=-1;function g(){d&&h&&(d=!1,h.length?f=h.concat(f):v=-1,f.length&&p())}function p(){if(!d){var m=c(g);d=!0;for(var _=f.length;_;){for(h=f,f=[];++v<_;)h&&h[v].run();v=-1,_=f.length}h=null,d=!1,function(P){if(a===clearTimeout)return clearTimeout(P);if((a===s||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(P);try{a(P)}catch{try{return a.call(null,P)}catch{return a.call(this,P)}}}(m)}}function b(m,_){this.fun=m,this.array=_}function x(){}l.nextTick=function(m){var _=new Array(arguments.length-1);if(arguments.length>1)for(var P=1;P<arguments.length;P++)_[P-1]=arguments[P];f.push(new b(m,_)),f.length!==1||d||c(p)},b.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=x,l.addListener=x,l.once=x,l.off=x,l.removeListener=x,l.removeAllListeners=x,l.emit=x,l.prependListener=x,l.prependOnceListener=x,l.listeners=function(m){return[]},l.binding=function(m){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(m){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},{}],51:[function(i,n,r){(function(o){(function(){(function(a){var l=typeof r=="object"&&r&&!r.nodeType&&r,u=typeof n=="object"&&n&&!n.nodeType&&n,s=typeof o=="object"&&o;s.global!==s&&s.window!==s&&s.self!==s||(a=s);var c,h,f=2147483647,d=36,v=1,g=26,p=38,b=700,x=72,m=128,_="-",P=/^xn--/,R=/[^\x20-\x7E]/,L=/[\x2E\u3002\uFF0E\uFF61]/g,I={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},V=d-v,Q=Math.floor,T=String.fromCharCode;function k(U){throw new RangeError(I[U])}function M(U,N){for(var q=U.length,X=[];q--;)X[q]=N(U[q]);return X}function C(U,N){var q=U.split("@"),X="";return q.length>1&&(X=q[0]+"@",U=q[1]),X+M((U=U.replace(L,".")).split("."),N).join(".")}function B(U){for(var N,q,X=[],$=0,Z=U.length;$<Z;)(N=U.charCodeAt($++))>=55296&&N<=56319&&$<Z?(64512&(q=U.charCodeAt($++)))==56320?X.push(((1023&N)<<10)+(1023&q)+65536):(X.push(N),$--):X.push(N);return X}function H(U){return M(U,function(N){var q="";return N>65535&&(q+=T((N-=65536)>>>10&1023|55296),N=56320|1023&N),q+=T(N)}).join("")}function W(U,N){return U+22+75*(U<26)-((N!=0)<<5)}function F(U,N,q){var X=0;for(U=q?Q(U/b):U>>1,U+=Q(U/N);U>V*g>>1;X+=d)U=Q(U/V);return Q(X+(V+1)*U/(U+p))}function D(U){var N,q,X,$,Z,J,te,y,w,A,O,S=[],E=U.length,j=0,Y=m,K=x;for((q=U.lastIndexOf(_))<0&&(q=0),X=0;X<q;++X)U.charCodeAt(X)>=128&&k("not-basic"),S.push(U.charCodeAt(X));for($=q>0?q+1:0;$<E;){for(Z=j,J=1,te=d;$>=E&&k("invalid-input"),((y=(O=U.charCodeAt($++))-48<10?O-22:O-65<26?O-65:O-97<26?O-97:d)>=d||y>Q((f-j)/J))&&k("overflow"),j+=y*J,!(y<(w=te<=K?v:te>=K+g?g:te-K));te+=d)J>Q(f/(A=d-w))&&k("overflow"),J*=A;K=F(j-Z,N=S.length+1,Z==0),Q(j/N)>f-Y&&k("overflow"),Y+=Q(j/N),j%=N,S.splice(j++,0,Y)}return H(S)}function z(U){var N,q,X,$,Z,J,te,y,w,A,O,S,E,j,Y,K=[];for(S=(U=B(U)).length,N=m,q=0,Z=x,J=0;J<S;++J)(O=U[J])<128&&K.push(T(O));for(X=$=K.length,$&&K.push(_);X<S;){for(te=f,J=0;J<S;++J)(O=U[J])>=N&&O<te&&(te=O);for(te-N>Q((f-q)/(E=X+1))&&k("overflow"),q+=(te-N)*E,N=te,J=0;J<S;++J)if((O=U[J])<N&&++q>f&&k("overflow"),O==N){for(y=q,w=d;!(y<(A=w<=Z?v:w>=Z+g?g:w-Z));w+=d)Y=y-A,j=d-A,K.push(T(W(A+Y%j,0))),y=Q(Y/j);K.push(T(W(y,0))),Z=F(q,E,X==$),q=0,++X}++q,++N}return K.join("")}if(c={version:"1.4.1",ucs2:{decode:B,encode:H},decode:D,encode:z,toASCII:function(U){return C(U,function(N){return R.test(N)?"xn--"+z(N):N})},toUnicode:function(U){return C(U,function(N){return P.test(N)?D(N.slice(4).toLowerCase()):N})}},l&&u)if(n.exports==l)u.exports=c;else for(h in c)c.hasOwnProperty(h)&&(l[h]=c[h]);else a.punycode=c})(this)}).call(this)}).call(this,typeof ht<"u"?ht:typeof self<"u"?self:typeof window<"u"?window:{})},{}],52:[function(i,n,r){function o(l,u){return Object.prototype.hasOwnProperty.call(l,u)}n.exports=function(l,u,s,c){u=u||"&",s=s||"=";var h={};if(typeof l!="string"||l.length===0)return h;var f=/\+/g;l=l.split(u);var d=1e3;c&&typeof c.maxKeys=="number"&&(d=c.maxKeys);var v=l.length;d>0&&v>d&&(v=d);for(var g=0;g<v;++g){var p,b,x,m,_=l[g].replace(f,"%20"),P=_.indexOf(s);P>=0?(p=_.substr(0,P),b=_.substr(P+1)):(p=_,b=""),x=decodeURIComponent(p),m=decodeURIComponent(b),o(h,x)?a(h[x])?h[x].push(m):h[x]=[h[x],m]:h[x]=m}return h};var a=Array.isArray||function(l){return Object.prototype.toString.call(l)==="[object Array]"}},{}],53:[function(i,n,r){var o=function(s){switch(typeof s){case"string":return s;case"boolean":return s?"true":"false";case"number":return isFinite(s)?s:"";default:return""}};n.exports=function(s,c,h,f){return c=c||"&",h=h||"=",s===null&&(s=void 0),typeof s=="object"?l(u(s),function(d){var v=encodeURIComponent(o(d))+h;return a(s[d])?l(s[d],function(g){return v+encodeURIComponent(o(g))}).join(c):v+encodeURIComponent(o(s[d]))}).join(c):f?encodeURIComponent(o(f))+h+encodeURIComponent(o(s)):""};var a=Array.isArray||function(s){return Object.prototype.toString.call(s)==="[object Array]"};function l(s,c){if(s.map)return s.map(c);for(var h=[],f=0;f<s.length;f++)h.push(c(s[f],f));return h}var u=Object.keys||function(s){var c=[];for(var h in s)Object.prototype.hasOwnProperty.call(s,h)&&c.push(h);return c}},{}],54:[function(i,n,r){r.decode=r.parse=i("./decode"),r.encode=r.stringify=i("./encode")},{"./decode":52,"./encode":53}],55:[function(i,n,r){var o={};function a(u,s,c){c||(c=Error);var h=function(f){var d,v;function g(p,b,x){return f.call(this,function(m,_,P){return typeof s=="string"?s:s(m,_,P)}(p,b,x))||this}return v=f,(d=g).prototype=Object.create(v.prototype),d.prototype.constructor=d,d.__proto__=v,g}(c);h.prototype.name=c.name,h.prototype.code=u,o[u]=h}function l(u,s){if(Array.isArray(u)){var c=u.length;return u=u.map(function(h){return String(h)}),c>2?"one of ".concat(s," ").concat(u.slice(0,c-1).join(", "),", or ")+u[c-1]:c===2?"one of ".concat(s," ").concat(u[0]," or ").concat(u[1]):"of ".concat(s," ").concat(u[0])}return"of ".concat(s," ").concat(String(u))}a("ERR_INVALID_OPT_VALUE",function(u,s){return'The value "'+s+'" is invalid for option "'+u+'"'},TypeError),a("ERR_INVALID_ARG_TYPE",function(u,s,c){var h,f,d;if(typeof s=="string"&&(f="not ",s.substr(0,f.length)===f)?(h="must not be",s=s.replace(/^not /,"")):h="must be",function(g,p,b){return(b===void 0||b>g.length)&&(b=g.length),g.substring(b-p.length,b)===p}(u," argument"))d="The ".concat(u," ").concat(h," ").concat(l(s,"type"));else{var v=function(g,p,b){return typeof b!="number"&&(b=0),!(b+p.length>g.length)&&g.indexOf(p,b)!==-1}(u,".")?"property":"argument";d='The "'.concat(u,'" ').concat(v," ").concat(h," ").concat(l(s,"type"))}return d+=". Received type ".concat(typeof c)},TypeError),a("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),a("ERR_METHOD_NOT_IMPLEMENTED",function(u){return"The "+u+" method is not implemented"}),a("ERR_STREAM_PREMATURE_CLOSE","Premature close"),a("ERR_STREAM_DESTROYED",function(u){return"Cannot call "+u+" after a stream was destroyed"}),a("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),a("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),a("ERR_STREAM_WRITE_AFTER_END","write after end"),a("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),a("ERR_UNKNOWN_ENCODING",function(u){return"Unknown encoding: "+u},TypeError),a("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),n.exports.codes=o},{}],56:[function(i,n,r){(function(o){(function(){var a=Object.keys||function(g){var p=[];for(var b in g)p.push(b);return p};n.exports=f;var l=i("./_stream_readable"),u=i("./_stream_writable");i("inherits")(f,l);for(var s=a(u.prototype),c=0;c<s.length;c++){var h=s[c];f.prototype[h]||(f.prototype[h]=u.prototype[h])}function f(g){if(!(this instanceof f))return new f(g);l.call(this,g),u.call(this,g),this.allowHalfOpen=!0,g&&(g.readable===!1&&(this.readable=!1),g.writable===!1&&(this.writable=!1),g.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",d)))}function d(){this._writableState.ended||o.nextTick(v,this)}function v(g){g.end()}Object.defineProperty(f.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(f.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(f.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(f.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(g){this._readableState!==void 0&&this._writableState!==void 0&&(this._readableState.destroyed=g,this._writableState.destroyed=g)}})}).call(this)}).call(this,i("_process"))},{"./_stream_readable":58,"./_stream_writable":60,_process:50,inherits:24}],57:[function(i,n,r){n.exports=a;var o=i("./_stream_transform");function a(l){if(!(this instanceof a))return new a(l);o.call(this,l)}i("inherits")(a,o),a.prototype._transform=function(l,u,s){s(null,l)}},{"./_stream_transform":59,inherits:24}],58:[function(i,n,r){(function(o,a){(function(){var l;n.exports=k,k.ReadableState=T,i("events").EventEmitter;var u=function(y,w){return y.listeners(w).length},s=i("./internal/streams/stream"),c=i("buffer").Buffer,h=a.Uint8Array||function(){},f,d=i("util");f=d&&d.debuglog?d.debuglog("stream"):function(){};var v,g,p,b=i("./internal/streams/buffer_list"),x=i("./internal/streams/destroy"),m=i("./internal/streams/state").getHighWaterMark,_=i("../errors").codes,P=_.ERR_INVALID_ARG_TYPE,R=_.ERR_STREAM_PUSH_AFTER_EOF,L=_.ERR_METHOD_NOT_IMPLEMENTED,I=_.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;i("inherits")(k,s);var V=x.errorOrDestroy,Q=["error","close","destroy","pause","resume"];function T(y,w,A){l=l||i("./_stream_duplex"),y=y||{},typeof A!="boolean"&&(A=w instanceof l),this.objectMode=!!y.objectMode,A&&(this.objectMode=this.objectMode||!!y.readableObjectMode),this.highWaterMark=m(this,y,"readableHighWaterMark",A),this.buffer=new b,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=y.emitClose!==!1,this.autoDestroy=!!y.autoDestroy,this.destroyed=!1,this.defaultEncoding=y.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,y.encoding&&(v||(v=i("string_decoder/").StringDecoder),this.decoder=new v(y.encoding),this.encoding=y.encoding)}function k(y){if(l=l||i("./_stream_duplex"),!(this instanceof k))return new k(y);var w=this instanceof l;this._readableState=new T(y,this,w),this.readable=!0,y&&(typeof y.read=="function"&&(this._read=y.read),typeof y.destroy=="function"&&(this._destroy=y.destroy)),s.call(this)}function M(y,w,A,O,S){f("readableAddChunk",w);var E,j=y._readableState;if(w===null)j.reading=!1,function(Y,K){if(f("onEofChunk"),!K.ended){if(K.decoder){var G=K.decoder.end();G&&G.length&&(K.buffer.push(G),K.length+=K.objectMode?1:G.length)}K.ended=!0,K.sync?W(Y):(K.needReadable=!1,K.emittedReadable||(K.emittedReadable=!0,F(Y)))}}(y,j);else if(S||(E=function(Y,K){var G;ee=K,c.isBuffer(ee)||ee instanceof h||typeof K=="string"||K===void 0||Y.objectMode||(G=new P("chunk",["string","Buffer","Uint8Array"],K));var ee;return G}(j,w)),E)V(y,E);else if(j.objectMode||w&&w.length>0)if(typeof w=="string"||j.objectMode||Object.getPrototypeOf(w)===c.prototype||(w=function(Y){return c.from(Y)}(w)),O)j.endEmitted?V(y,new I):C(y,j,w,!0);else if(j.ended)V(y,new R);else{if(j.destroyed)return!1;j.reading=!1,j.decoder&&!A?(w=j.decoder.write(w),j.objectMode||w.length!==0?C(y,j,w,!1):D(y,j)):C(y,j,w,!1)}else O||(j.reading=!1,D(y,j));return!j.ended&&(j.length<j.highWaterMark||j.length===0)}function C(y,w,A,O){w.flowing&&w.length===0&&!w.sync?(w.awaitDrain=0,y.emit("data",A)):(w.length+=w.objectMode?1:A.length,O?w.buffer.unshift(A):w.buffer.push(A),w.needReadable&&W(y)),D(y,w)}Object.defineProperty(k.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(y){this._readableState&&(this._readableState.destroyed=y)}}),k.prototype.destroy=x.destroy,k.prototype._undestroy=x.undestroy,k.prototype._destroy=function(y,w){w(y)},k.prototype.push=function(y,w){var A,O=this._readableState;return O.objectMode?A=!0:typeof y=="string"&&((w=w||O.defaultEncoding)!==O.encoding&&(y=c.from(y,w),w=""),A=!0),M(this,y,w,!1,A)},k.prototype.unshift=function(y){return M(this,y,null,!0,!1)},k.prototype.isPaused=function(){return this._readableState.flowing===!1},k.prototype.setEncoding=function(y){v||(v=i("string_decoder/").StringDecoder);var w=new v(y);this._readableState.decoder=w,this._readableState.encoding=this._readableState.decoder.encoding;for(var A=this._readableState.buffer.head,O="";A!==null;)O+=w.write(A.data),A=A.next;return this._readableState.buffer.clear(),O!==""&&this._readableState.buffer.push(O),this._readableState.length=O.length,this};var B=1073741824;function H(y,w){return y<=0||w.length===0&&w.ended?0:w.objectMode?1:y!=y?w.flowing&&w.length?w.buffer.head.data.length:w.length:(y>w.highWaterMark&&(w.highWaterMark=function(A){return A>=B?A=B:(A--,A|=A>>>1,A|=A>>>2,A|=A>>>4,A|=A>>>8,A|=A>>>16,A++),A}(y)),y<=w.length?y:w.ended?w.length:(w.needReadable=!0,0))}function W(y){var w=y._readableState;f("emitReadable",w.needReadable,w.emittedReadable),w.needReadable=!1,w.emittedReadable||(f("emitReadable",w.flowing),w.emittedReadable=!0,o.nextTick(F,y))}function F(y){var w=y._readableState;f("emitReadable_",w.destroyed,w.length,w.ended),w.destroyed||!w.length&&!w.ended||(y.emit("readable"),w.emittedReadable=!1),w.needReadable=!w.flowing&&!w.ended&&w.length<=w.highWaterMark,X(y)}function D(y,w){w.readingMore||(w.readingMore=!0,o.nextTick(z,y,w))}function z(y,w){for(;!w.reading&&!w.ended&&(w.length<w.highWaterMark||w.flowing&&w.length===0);){var A=w.length;if(f("maybeReadMore read 0"),y.read(0),A===w.length)break}w.readingMore=!1}function U(y){var w=y._readableState;w.readableListening=y.listenerCount("readable")>0,w.resumeScheduled&&!w.paused?w.flowing=!0:y.listenerCount("data")>0&&y.resume()}function N(y){f("readable nexttick read 0"),y.read(0)}function q(y,w){f("resume",w.reading),w.reading||y.read(0),w.resumeScheduled=!1,y.emit("resume"),X(y),w.flowing&&!w.reading&&y.read(0)}function X(y){var w=y._readableState;for(f("flow",w.flowing);w.flowing&&y.read()!==null;);}function $(y,w){return w.length===0?null:(w.objectMode?A=w.buffer.shift():!y||y>=w.length?(A=w.decoder?w.buffer.join(""):w.buffer.length===1?w.buffer.first():w.buffer.concat(w.length),w.buffer.clear()):A=w.buffer.consume(y,w.decoder),A);var A}function Z(y){var w=y._readableState;f("endReadable",w.endEmitted),w.endEmitted||(w.ended=!0,o.nextTick(J,w,y))}function J(y,w){if(f("endReadableNT",y.endEmitted,y.length),!y.endEmitted&&y.length===0&&(y.endEmitted=!0,w.readable=!1,w.emit("end"),y.autoDestroy)){var A=w._writableState;(!A||A.autoDestroy&&A.finished)&&w.destroy()}}function te(y,w){for(var A=0,O=y.length;A<O;A++)if(y[A]===w)return A;return-1}k.prototype.read=function(y){f("read",y),y=parseInt(y,10);var w=this._readableState,A=y;if(y!==0&&(w.emittedReadable=!1),y===0&&w.needReadable&&((w.highWaterMark!==0?w.length>=w.highWaterMark:w.length>0)||w.ended))return f("read: emitReadable",w.length,w.ended),w.length===0&&w.ended?Z(this):W(this),null;if((y=H(y,w))===0&&w.ended)return w.length===0&&Z(this),null;var O,S=w.needReadable;return f("need readable",S),(w.length===0||w.length-y<w.highWaterMark)&&f("length less than watermark",S=!0),w.ended||w.reading?f("reading or ended",S=!1):S&&(f("do read"),w.reading=!0,w.sync=!0,w.length===0&&(w.needReadable=!0),this._read(w.highWaterMark),w.sync=!1,w.reading||(y=H(A,w))),(O=y>0?$(y,w):null)===null?(w.needReadable=w.length<=w.highWaterMark,y=0):(w.length-=y,w.awaitDrain=0),w.length===0&&(w.ended||(w.needReadable=!0),A!==y&&w.ended&&Z(this)),O!==null&&this.emit("data",O),O},k.prototype._read=function(y){V(this,new L("_read()"))},k.prototype.pipe=function(y,w){var A=this,O=this._readableState;switch(O.pipesCount){case 0:O.pipes=y;break;case 1:O.pipes=[O.pipes,y];break;default:O.pipes.push(y)}O.pipesCount+=1,f("pipe count=%d opts=%j",O.pipesCount,w);var S=(!w||w.end!==!1)&&y!==o.stdout&&y!==o.stderr?j:re;function E(ae,oe){f("onunpipe"),ae===A&&oe&&oe.hasUnpiped===!1&&(oe.hasUnpiped=!0,f("cleanup"),y.removeListener("close",ie),y.removeListener("finish",ne),y.removeListener("drain",Y),y.removeListener("error",ee),y.removeListener("unpipe",E),A.removeListener("end",j),A.removeListener("end",re),A.removeListener("data",G),K=!0,!O.awaitDrain||y._writableState&&!y._writableState.needDrain||Y())}function j(){f("onend"),y.end()}O.endEmitted?o.nextTick(S):A.once("end",S),y.on("unpipe",E);var Y=function(ae){return function(){var oe=ae._readableState;f("pipeOnDrain",oe.awaitDrain),oe.awaitDrain&&oe.awaitDrain--,oe.awaitDrain===0&&u(ae,"data")&&(oe.flowing=!0,X(ae))}}(A);y.on("drain",Y);var K=!1;function G(ae){f("ondata");var oe=y.write(ae);f("dest.write",oe),oe===!1&&((O.pipesCount===1&&O.pipes===y||O.pipesCount>1&&te(O.pipes,y)!==-1)&&!K&&(f("false write response, pause",O.awaitDrain),O.awaitDrain++),A.pause())}function ee(ae){f("onerror",ae),re(),y.removeListener("error",ee),u(y,"error")===0&&V(y,ae)}function ie(){y.removeListener("finish",ne),re()}function ne(){f("onfinish"),y.removeListener("close",ie),re()}function re(){f("unpipe"),A.unpipe(y)}return A.on("data",G),function(ae,oe,le){if(typeof ae.prependListener=="function")return ae.prependListener(oe,le);ae._events&&ae._events[oe]?Array.isArray(ae._events[oe])?ae._events[oe].unshift(le):ae._events[oe]=[le,ae._events[oe]]:ae.on(oe,le)}(y,"error",ee),y.once("close",ie),y.once("finish",ne),y.emit("pipe",A),O.flowing||(f("pipe resume"),A.resume()),y},k.prototype.unpipe=function(y){var w=this._readableState,A={hasUnpiped:!1};if(w.pipesCount===0)return this;if(w.pipesCount===1)return y&&y!==w.pipes?this:(y||(y=w.pipes),w.pipes=null,w.pipesCount=0,w.flowing=!1,y&&y.emit("unpipe",this,A),this);if(!y){var O=w.pipes,S=w.pipesCount;w.pipes=null,w.pipesCount=0,w.flowing=!1;for(var E=0;E<S;E++)O[E].emit("unpipe",this,{hasUnpiped:!1});return this}var j=te(w.pipes,y);return j===-1?this:(w.pipes.splice(j,1),w.pipesCount-=1,w.pipesCount===1&&(w.pipes=w.pipes[0]),y.emit("unpipe",this,A),this)},k.prototype.on=function(y,w){var A=s.prototype.on.call(this,y,w),O=this._readableState;return y==="data"?(O.readableListening=this.listenerCount("readable")>0,O.flowing!==!1&&this.resume()):y==="readable"&&(O.endEmitted||O.readableListening||(O.readableListening=O.needReadable=!0,O.flowing=!1,O.emittedReadable=!1,f("on readable",O.length,O.reading),O.length?W(this):O.reading||o.nextTick(N,this))),A},k.prototype.addListener=k.prototype.on,k.prototype.removeListener=function(y,w){var A=s.prototype.removeListener.call(this,y,w);return y==="readable"&&o.nextTick(U,this),A},k.prototype.removeAllListeners=function(y){var w=s.prototype.removeAllListeners.apply(this,arguments);return y!=="readable"&&y!==void 0||o.nextTick(U,this),w},k.prototype.resume=function(){var y=this._readableState;return y.flowing||(f("resume"),y.flowing=!y.readableListening,function(w,A){A.resumeScheduled||(A.resumeScheduled=!0,o.nextTick(q,w,A))}(this,y)),y.paused=!1,this},k.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},k.prototype.wrap=function(y){var w=this,A=this._readableState,O=!1;for(var S in y.on("end",function(){if(f("wrapped end"),A.decoder&&!A.ended){var j=A.decoder.end();j&&j.length&&w.push(j)}w.push(null)}),y.on("data",function(j){f("wrapped data"),A.decoder&&(j=A.decoder.write(j)),(!A.objectMode||j!=null)&&(A.objectMode||j&&j.length)&&(w.push(j)||(O=!0,y.pause()))}),y)this[S]===void 0&&typeof y[S]=="function"&&(this[S]=function(j){return function(){return y[j].apply(y,arguments)}}(S));for(var E=0;E<Q.length;E++)y.on(Q[E],this.emit.bind(this,Q[E]));return this._read=function(j){f("wrapped _read",j),O&&(O=!1,y.resume())},this},typeof Symbol=="function"&&(k.prototype[Symbol.asyncIterator]=function(){return g===void 0&&(g=i("./internal/streams/async_iterator")),g(this)}),Object.defineProperty(k.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(k.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(k.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(y){this._readableState&&(this._readableState.flowing=y)}}),k._fromList=$,Object.defineProperty(k.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(k.from=function(y,w){return p===void 0&&(p=i("./internal/streams/from")),p(k,y,w)})}).call(this)}).call(this,i("_process"),typeof ht<"u"?ht:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":55,"./_stream_duplex":56,"./internal/streams/async_iterator":61,"./internal/streams/buffer_list":62,"./internal/streams/destroy":63,"./internal/streams/from":65,"./internal/streams/state":67,"./internal/streams/stream":68,_process:50,buffer:17,events:22,inherits:24,"string_decoder/":75,util:16}],59:[function(i,n,r){n.exports=h;var o=i("../errors").codes,a=o.ERR_METHOD_NOT_IMPLEMENTED,l=o.ERR_MULTIPLE_CALLBACK,u=o.ERR_TRANSFORM_ALREADY_TRANSFORMING,s=o.ERR_TRANSFORM_WITH_LENGTH_0,c=i("./_stream_duplex");function h(v){if(!(this instanceof h))return new h(v);c.call(this,v),this._transformState={afterTransform:function(g,p){var b=this._transformState;b.transforming=!1;var x=b.writecb;if(x===null)return this.emit("error",new l);b.writechunk=null,b.writecb=null,p!=null&&this.push(p),x(g);var m=this._readableState;m.reading=!1,(m.needReadable||m.length<m.highWaterMark)&&this._read(m.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,v&&(typeof v.transform=="function"&&(this._transform=v.transform),typeof v.flush=="function"&&(this._flush=v.flush)),this.on("prefinish",f)}function f(){var v=this;typeof this._flush!="function"||this._readableState.destroyed?d(this,null,null):this._flush(function(g,p){d(v,g,p)})}function d(v,g,p){if(g)return v.emit("error",g);if(p!=null&&v.push(p),v._writableState.length)throw new s;if(v._transformState.transforming)throw new u;return v.push(null)}i("inherits")(h,c),h.prototype.push=function(v,g){return this._transformState.needTransform=!1,c.prototype.push.call(this,v,g)},h.prototype._transform=function(v,g,p){p(new a("_transform()"))},h.prototype._write=function(v,g,p){var b=this._transformState;if(b.writecb=p,b.writechunk=v,b.writeencoding=g,!b.transforming){var x=this._readableState;(b.needTransform||x.needReadable||x.length<x.highWaterMark)&&this._read(x.highWaterMark)}},h.prototype._read=function(v){var g=this._transformState;g.writechunk===null||g.transforming?g.needTransform=!0:(g.transforming=!0,this._transform(g.writechunk,g.writeencoding,g.afterTransform))},h.prototype._destroy=function(v,g){c.prototype._destroy.call(this,v,function(p){g(p)})}},{"../errors":55,"./_stream_duplex":56,inherits:24}],60:[function(i,n,r){(function(o,a){(function(){function l(D){var z=this;this.next=null,this.entry=null,this.finish=function(){(function(U,N,q){var X=U.entry;for(U.entry=null;X;){var $=X.callback;N.pendingcb--,$(q),X=X.next}N.corkedRequestsFree.next=U})(z,D)}}var u;n.exports=k,k.WritableState=T;var s={deprecate:i("util-deprecate")},c=i("./internal/streams/stream"),h=i("buffer").Buffer,f=a.Uint8Array||function(){},d,v=i("./internal/streams/destroy"),g=i("./internal/streams/state").getHighWaterMark,p=i("../errors").codes,b=p.ERR_INVALID_ARG_TYPE,x=p.ERR_METHOD_NOT_IMPLEMENTED,m=p.ERR_MULTIPLE_CALLBACK,_=p.ERR_STREAM_CANNOT_PIPE,P=p.ERR_STREAM_DESTROYED,R=p.ERR_STREAM_NULL_VALUES,L=p.ERR_STREAM_WRITE_AFTER_END,I=p.ERR_UNKNOWN_ENCODING,V=v.errorOrDestroy;function Q(){}function T(D,z,U){u=u||i("./_stream_duplex"),D=D||{},typeof U!="boolean"&&(U=z instanceof u),this.objectMode=!!D.objectMode,U&&(this.objectMode=this.objectMode||!!D.writableObjectMode),this.highWaterMark=g(this,D,"writableHighWaterMark",U),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var N=D.decodeStrings===!1;this.decodeStrings=!N,this.defaultEncoding=D.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(q){(function(X,$){var Z=X._writableState,J=Z.sync,te=Z.writecb;if(typeof te!="function")throw new m;if(function(w){w.writing=!1,w.writecb=null,w.length-=w.writelen,w.writelen=0}(Z),$)(function(w,A,O,S,E){--A.pendingcb,O?(o.nextTick(E,S),o.nextTick(F,w,A),w._writableState.errorEmitted=!0,V(w,S)):(E(S),w._writableState.errorEmitted=!0,V(w,S),F(w,A))})(X,Z,J,$,te);else{var y=H(Z)||X.destroyed;y||Z.corked||Z.bufferProcessing||!Z.bufferedRequest||B(X,Z),J?o.nextTick(C,X,Z,y,te):C(X,Z,y,te)}})(z,q)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=D.emitClose!==!1,this.autoDestroy=!!D.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new l(this)}function k(D){var z=this instanceof(u=u||i("./_stream_duplex"));if(!z&&!d.call(k,this))return new k(D);this._writableState=new T(D,this,z),this.writable=!0,D&&(typeof D.write=="function"&&(this._write=D.write),typeof D.writev=="function"&&(this._writev=D.writev),typeof D.destroy=="function"&&(this._destroy=D.destroy),typeof D.final=="function"&&(this._final=D.final)),c.call(this)}function M(D,z,U,N,q,X,$){z.writelen=N,z.writecb=$,z.writing=!0,z.sync=!0,z.destroyed?z.onwrite(new P("write")):U?D._writev(q,z.onwrite):D._write(q,X,z.onwrite),z.sync=!1}function C(D,z,U,N){U||function(q,X){X.length===0&&X.needDrain&&(X.needDrain=!1,q.emit("drain"))}(D,z),z.pendingcb--,N(),F(D,z)}function B(D,z){z.bufferProcessing=!0;var U=z.bufferedRequest;if(D._writev&&U&&U.next){var N=z.bufferedRequestCount,q=new Array(N),X=z.corkedRequestsFree;X.entry=U;for(var $=0,Z=!0;U;)q[$]=U,U.isBuf||(Z=!1),U=U.next,$+=1;q.allBuffers=Z,M(D,z,!0,z.length,q,"",X.finish),z.pendingcb++,z.lastBufferedRequest=null,X.next?(z.corkedRequestsFree=X.next,X.next=null):z.corkedRequestsFree=new l(z),z.bufferedRequestCount=0}else{for(;U;){var J=U.chunk,te=U.encoding,y=U.callback;if(M(D,z,!1,z.objectMode?1:J.length,J,te,y),U=U.next,z.bufferedRequestCount--,z.writing)break}U===null&&(z.lastBufferedRequest=null)}z.bufferedRequest=U,z.bufferProcessing=!1}function H(D){return D.ending&&D.length===0&&D.bufferedRequest===null&&!D.finished&&!D.writing}function W(D,z){D._final(function(U){z.pendingcb--,U&&V(D,U),z.prefinished=!0,D.emit("prefinish"),F(D,z)})}function F(D,z){var U=H(z);if(U&&(function(q,X){X.prefinished||X.finalCalled||(typeof q._final!="function"||X.destroyed?(X.prefinished=!0,q.emit("prefinish")):(X.pendingcb++,X.finalCalled=!0,o.nextTick(W,q,X)))}(D,z),z.pendingcb===0&&(z.finished=!0,D.emit("finish"),z.autoDestroy))){var N=D._readableState;(!N||N.autoDestroy&&N.endEmitted)&&D.destroy()}return U}i("inherits")(k,c),T.prototype.getBuffer=function(){for(var D=this.bufferedRequest,z=[];D;)z.push(D),D=D.next;return z},function(){try{Object.defineProperty(T.prototype,"buffer",{get:s.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}(),typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(d=Function.prototype[Symbol.hasInstance],Object.defineProperty(k,Symbol.hasInstance,{value:function(D){return!!d.call(this,D)||this===k&&D&&D._writableState instanceof T}})):d=function(D){return D instanceof this},k.prototype.pipe=function(){V(this,new _)},k.prototype.write=function(D,z,U){var N,q=this._writableState,X=!1,$=!q.objectMode&&(N=D,h.isBuffer(N)||N instanceof f);return $&&!h.isBuffer(D)&&(D=function(Z){return h.from(Z)}(D)),typeof z=="function"&&(U=z,z=null),$?z="buffer":z||(z=q.defaultEncoding),typeof U!="function"&&(U=Q),q.ending?function(Z,J){var te=new L;V(Z,te),o.nextTick(J,te)}(this,U):($||function(Z,J,te,y){var w;return te===null?w=new R:typeof te=="string"||J.objectMode||(w=new b("chunk",["string","Buffer"],te)),!w||(V(Z,w),o.nextTick(y,w),!1)}(this,q,D,U))&&(q.pendingcb++,X=function(Z,J,te,y,w,A){if(!te){var O=function(Y,K,G){return Y.objectMode||Y.decodeStrings===!1||typeof K!="string"||(K=h.from(K,G)),K}(J,y,w);y!==O&&(te=!0,w="buffer",y=O)}var S=J.objectMode?1:y.length;J.length+=S;var E=J.length<J.highWaterMark;if(E||(J.needDrain=!0),J.writing||J.corked){var j=J.lastBufferedRequest;J.lastBufferedRequest={chunk:y,encoding:w,isBuf:te,callback:A,next:null},j?j.next=J.lastBufferedRequest:J.bufferedRequest=J.lastBufferedRequest,J.bufferedRequestCount+=1}else M(Z,J,!1,S,y,w,A);return E}(this,q,$,D,z,U)),X},k.prototype.cork=function(){this._writableState.corked++},k.prototype.uncork=function(){var D=this._writableState;D.corked&&(D.corked--,D.writing||D.corked||D.bufferProcessing||!D.bufferedRequest||B(this,D))},k.prototype.setDefaultEncoding=function(D){if(typeof D=="string"&&(D=D.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((D+"").toLowerCase())>-1))throw new I(D);return this._writableState.defaultEncoding=D,this},Object.defineProperty(k.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(k.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),k.prototype._write=function(D,z,U){U(new x("_write()"))},k.prototype._writev=null,k.prototype.end=function(D,z,U){var N=this._writableState;return typeof D=="function"?(U=D,D=null,z=null):typeof z=="function"&&(U=z,z=null),D!=null&&this.write(D,z),N.corked&&(N.corked=1,this.uncork()),N.ending||function(q,X,$){X.ending=!0,F(q,X),$&&(X.finished?o.nextTick($):q.once("finish",$)),X.ended=!0,q.writable=!1}(this,N,U),this},Object.defineProperty(k.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(k.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(D){this._writableState&&(this._writableState.destroyed=D)}}),k.prototype.destroy=v.destroy,k.prototype._undestroy=v.undestroy,k.prototype._destroy=function(D,z){z(D)}}).call(this)}).call(this,i("_process"),typeof ht<"u"?ht:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":55,"./_stream_duplex":56,"./internal/streams/destroy":63,"./internal/streams/state":67,"./internal/streams/stream":68,_process:50,buffer:17,inherits:24,"util-deprecate":78}],61:[function(i,n,r){(function(o){(function(){var a;function l(_,P,R){return P in _?Object.defineProperty(_,P,{value:R,enumerable:!0,configurable:!0,writable:!0}):_[P]=R,_}var u=i("./end-of-stream"),s=Symbol("lastResolve"),c=Symbol("lastReject"),h=Symbol("error"),f=Symbol("ended"),d=Symbol("lastPromise"),v=Symbol("handlePromise"),g=Symbol("stream");function p(_,P){return{value:_,done:P}}function b(_){var P=_[s];if(P!==null){var R=_[g].read();R!==null&&(_[d]=null,_[s]=null,_[c]=null,P(p(R,!1)))}}var x=Object.getPrototypeOf(function(){}),m=Object.setPrototypeOf((l(a={get stream(){return this[g]},next:function(){var _=this,P=this[h];if(P!==null)return Promise.reject(P);if(this[f])return Promise.resolve(p(void 0,!0));if(this[g].destroyed)return new Promise(function(V,Q){o.nextTick(function(){_[h]?Q(_[h]):V(p(void 0,!0))})});var R,L=this[d];if(L)R=new Promise(function(V,Q){return function(T,k){V.then(function(){Q[f]?T(p(void 0,!0)):Q[v](T,k)},k)}}(L,this));else{var I=this[g].read();if(I!==null)return Promise.resolve(p(I,!1));R=new Promise(this[v])}return this[d]=R,R}},Symbol.asyncIterator,function(){return this}),l(a,"return",function(){var _=this;return new Promise(function(P,R){_[g].destroy(null,function(L){L?R(L):P(p(void 0,!0))})})}),a),x);n.exports=function(_){var P,R=Object.create(m,(l(P={},g,{value:_,writable:!0}),l(P,s,{value:null,writable:!0}),l(P,c,{value:null,writable:!0}),l(P,h,{value:null,writable:!0}),l(P,f,{value:_._readableState.endEmitted,writable:!0}),l(P,v,{value:function(L,I){var V=R[g].read();V?(R[d]=null,R[s]=null,R[c]=null,L(p(V,!1))):(R[s]=L,R[c]=I)},writable:!0}),P));return R[d]=null,u(_,function(L){if(L&&L.code!=="ERR_STREAM_PREMATURE_CLOSE"){var I=R[c];return I!==null&&(R[d]=null,R[s]=null,R[c]=null,I(L)),void(R[h]=L)}var V=R[s];V!==null&&(R[d]=null,R[s]=null,R[c]=null,V(p(void 0,!0))),R[f]=!0}),_.on("readable",function(L){o.nextTick(b,L)}.bind(null,R)),R}}).call(this)}).call(this,i("_process"))},{"./end-of-stream":64,_process:50}],62:[function(i,n,r){function o(h,f){var d=Object.keys(h);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(h);f&&(v=v.filter(function(g){return Object.getOwnPropertyDescriptor(h,g).enumerable})),d.push.apply(d,v)}return d}function a(h,f,d){return f in h?Object.defineProperty(h,f,{value:d,enumerable:!0,configurable:!0,writable:!0}):h[f]=d,h}function l(h,f){for(var d=0;d<f.length;d++){var v=f[d];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(h,v.key,v)}}var u=i("buffer").Buffer,s=i("util").inspect,c=s&&s.custom||"inspect";n.exports=function(){function h(){(function(v,g){if(!(v instanceof g))throw new TypeError("Cannot call a class as a function")})(this,h),this.head=null,this.tail=null,this.length=0}var f,d;return f=h,(d=[{key:"push",value:function(v){var g={data:v,next:null};this.length>0?this.tail.next=g:this.head=g,this.tail=g,++this.length}},{key:"unshift",value:function(v){var g={data:v,next:this.head};this.length===0&&(this.tail=g),this.head=g,++this.length}},{key:"shift",value:function(){if(this.length!==0){var v=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,v}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(v){if(this.length===0)return"";for(var g=this.head,p=""+g.data;g=g.next;)p+=v+g.data;return p}},{key:"concat",value:function(v){if(this.length===0)return u.alloc(0);for(var g,p,b,x=u.allocUnsafe(v>>>0),m=this.head,_=0;m;)g=m.data,p=x,b=_,u.prototype.copy.call(g,p,b),_+=m.data.length,m=m.next;return x}},{key:"consume",value:function(v,g){var p;return v<this.head.data.length?(p=this.head.data.slice(0,v),this.head.data=this.head.data.slice(v)):p=v===this.head.data.length?this.shift():g?this._getString(v):this._getBuffer(v),p}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(v){var g=this.head,p=1,b=g.data;for(v-=b.length;g=g.next;){var x=g.data,m=v>x.length?x.length:v;if(m===x.length?b+=x:b+=x.slice(0,v),(v-=m)===0){m===x.length?(++p,g.next?this.head=g.next:this.head=this.tail=null):(this.head=g,g.data=x.slice(m));break}++p}return this.length-=p,b}},{key:"_getBuffer",value:function(v){var g=u.allocUnsafe(v),p=this.head,b=1;for(p.data.copy(g),v-=p.data.length;p=p.next;){var x=p.data,m=v>x.length?x.length:v;if(x.copy(g,g.length-v,0,m),(v-=m)===0){m===x.length?(++b,p.next?this.head=p.next:this.head=this.tail=null):(this.head=p,p.data=x.slice(m));break}++b}return this.length-=b,g}},{key:c,value:function(v,g){return s(this,function(p){for(var b=1;b<arguments.length;b++){var x=arguments[b]!=null?arguments[b]:{};b%2?o(Object(x),!0).forEach(function(m){a(p,m,x[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(x)):o(Object(x)).forEach(function(m){Object.defineProperty(p,m,Object.getOwnPropertyDescriptor(x,m))})}return p}({},g,{depth:0,customInspect:!1}))}}])&&l(f.prototype,d),h}()},{buffer:17,util:16}],63:[function(i,n,r){(function(o){(function(){function a(s,c){u(s,c),l(s)}function l(s){s._writableState&&!s._writableState.emitClose||s._readableState&&!s._readableState.emitClose||s.emit("close")}function u(s,c){s.emit("error",c)}n.exports={destroy:function(s,c){var h=this,f=this._readableState&&this._readableState.destroyed,d=this._writableState&&this._writableState.destroyed;return f||d?(c?c(s):s&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,o.nextTick(u,this,s)):o.nextTick(u,this,s)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(s||null,function(v){!c&&v?h._writableState?h._writableState.errorEmitted?o.nextTick(l,h):(h._writableState.errorEmitted=!0,o.nextTick(a,h,v)):o.nextTick(a,h,v):c?(o.nextTick(l,h),c(v)):o.nextTick(l,h)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(s,c){var h=s._readableState,f=s._writableState;h&&h.autoDestroy||f&&f.autoDestroy?s.destroy(c):s.emit("error",c)}}}).call(this)}).call(this,i("_process"))},{_process:50}],64:[function(i,n,r){var o=i("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function a(){}n.exports=function l(u,s,c){if(typeof s=="function")return l(u,null,s);s||(s={}),c=function(P){var R=!1;return function(){if(!R){R=!0;for(var L=arguments.length,I=new Array(L),V=0;V<L;V++)I[V]=arguments[V];P.apply(this,I)}}}(c||a);var h=s.readable||s.readable!==!1&&u.readable,f=s.writable||s.writable!==!1&&u.writable,d=function(){u.writable||g()},v=u._writableState&&u._writableState.finished,g=function(){f=!1,v=!0,h||c.call(u)},p=u._readableState&&u._readableState.endEmitted,b=function(){h=!1,p=!0,f||c.call(u)},x=function(P){c.call(u,P)},m=function(){var P;return h&&!p?(u._readableState&&u._readableState.ended||(P=new o),c.call(u,P)):f&&!v?(u._writableState&&u._writableState.ended||(P=new o),c.call(u,P)):void 0},_=function(){u.req.on("finish",g)};return function(P){return P.setHeader&&typeof P.abort=="function"}(u)?(u.on("complete",g),u.on("abort",m),u.req?_():u.on("request",_)):f&&!u._writableState&&(u.on("end",d),u.on("close",d)),u.on("end",b),u.on("finish",g),s.error!==!1&&u.on("error",x),u.on("close",m),function(){u.removeListener("complete",g),u.removeListener("abort",m),u.removeListener("request",_),u.req&&u.req.removeListener("finish",g),u.removeListener("end",d),u.removeListener("close",d),u.removeListener("finish",g),u.removeListener("end",b),u.removeListener("error",x),u.removeListener("close",m)}}},{"../../../errors":55}],65:[function(i,n,r){n.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],66:[function(i,n,r){var o,a=i("../../../errors").codes,l=a.ERR_MISSING_ARGS,u=a.ERR_STREAM_DESTROYED;function s(f){if(f)throw f}function c(f){f()}function h(f,d){return f.pipe(d)}n.exports=function(){for(var f=arguments.length,d=new Array(f),v=0;v<f;v++)d[v]=arguments[v];var g,p=function(x){return x.length?typeof x[x.length-1]!="function"?s:x.pop():s}(d);if(Array.isArray(d[0])&&(d=d[0]),d.length<2)throw new l("streams");var b=d.map(function(x,m){var _=m<d.length-1;return function(P,R,L,I){I=function(T){var k=!1;return function(){k||(k=!0,T.apply(void 0,arguments))}}(I);var V=!1;P.on("close",function(){V=!0}),o===void 0&&(o=i("./end-of-stream")),o(P,{readable:R,writable:L},function(T){if(T)return I(T);V=!0,I()});var Q=!1;return function(T){if(!V&&!Q)return Q=!0,function(k){return k.setHeader&&typeof k.abort=="function"}(P)?P.abort():typeof P.destroy=="function"?P.destroy():void I(T||new u("pipe"))}}(x,_,m>0,function(P){g||(g=P),P&&b.forEach(c),_||(b.forEach(c),p(g))})});return d.reduce(h)}},{"../../../errors":55,"./end-of-stream":64}],67:[function(i,n,r){var o=i("../../../errors").codes.ERR_INVALID_OPT_VALUE;n.exports={getHighWaterMark:function(a,l,u,s){var c=function(h,f,d){return h.highWaterMark!=null?h.highWaterMark:f?h[d]:null}(l,s,u);if(c!=null){if(!isFinite(c)||Math.floor(c)!==c||c<0)throw new o(s?u:"highWaterMark",c);return Math.floor(c)}return a.objectMode?16:16384}}},{"../../../errors":55}],68:[function(i,n,r){n.exports=i("events").EventEmitter},{events:22}],69:[function(i,n,r){(r=n.exports=i("./lib/_stream_readable.js")).Stream=r,r.Readable=r,r.Writable=i("./lib/_stream_writable.js"),r.Duplex=i("./lib/_stream_duplex.js"),r.Transform=i("./lib/_stream_transform.js"),r.PassThrough=i("./lib/_stream_passthrough.js"),r.finished=i("./lib/internal/streams/end-of-stream.js"),r.pipeline=i("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":56,"./lib/_stream_passthrough.js":57,"./lib/_stream_readable.js":58,"./lib/_stream_transform.js":59,"./lib/_stream_writable.js":60,"./lib/internal/streams/end-of-stream.js":64,"./lib/internal/streams/pipeline.js":66}],70:[function(i,n,r){n.exports=function(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("interval needed");var o;if(arguments.length>0){o=new Array(arguments.length-2);for(var a=0;a<o.length;a++)o[a]=arguments[a+2]}return new function(l,u,s){var c=this;this._callback=l,this._args=s,this._interval=setInterval(l,u,this._args),this.reschedule=function(h){h||(h=c._interval),c._interval&&clearInterval(c._interval),c._interval=setInterval(c._callback,h,c._args)},this.clear=function(){c._interval&&(clearInterval(c._interval),c._interval=void 0)},this.destroy=function(){c._interval&&clearInterval(c._interval),c._callback=void 0,c._interval=void 0,c._args=void 0}}(arguments[0],arguments[1],o)}},{}],71:[function(i,n,r){n.exports=i("./index.js")()},{"./index.js":72}],72:[function(i,n,r){(function(o){(function(){function a(l){return l instanceof o?o.from(l):new l.constructor(l.buffer.slice(),l.byteOffset,l.length)}n.exports=function(l){return(l=l||{}).circles?function(s){var c=[],h=[];return s.proto?function d(v){if(typeof v!="object"||v===null)return v;if(v instanceof Date)return new Date(v);if(Array.isArray(v))return f(v,d);if(v instanceof Map)return new Map(f(Array.from(v),d));if(v instanceof Set)return new Set(f(Array.from(v),d));var g={};for(var p in c.push(v),h.push(g),v){var b=v[p];if(typeof b!="object"||b===null)g[p]=b;else if(b instanceof Date)g[p]=new Date(b);else if(b instanceof Map)g[p]=new Map(f(Array.from(b),d));else if(b instanceof Set)g[p]=new Set(f(Array.from(b),d));else if(ArrayBuffer.isView(b))g[p]=a(b);else{var x=c.indexOf(b);g[p]=x!==-1?h[x]:d(b)}}return c.pop(),h.pop(),g}:function d(v){if(typeof v!="object"||v===null)return v;if(v instanceof Date)return new Date(v);if(Array.isArray(v))return f(v,d);if(v instanceof Map)return new Map(f(Array.from(v),d));if(v instanceof Set)return new Set(f(Array.from(v),d));var g={};for(var p in c.push(v),h.push(g),v)if(Object.hasOwnProperty.call(v,p)!==!1){var b=v[p];if(typeof b!="object"||b===null)g[p]=b;else if(b instanceof Date)g[p]=new Date(b);else if(b instanceof Map)g[p]=new Map(f(Array.from(b),d));else if(b instanceof Set)g[p]=new Set(f(Array.from(b),d));else if(ArrayBuffer.isView(b))g[p]=a(b);else{var x=c.indexOf(b);g[p]=x!==-1?h[x]:d(b)}}return c.pop(),h.pop(),g};function f(d,v){for(var g=Object.keys(d),p=new Array(g.length),b=0;b<g.length;b++){var x=g[b],m=d[x];if(typeof m!="object"||m===null)p[x]=m;else if(m instanceof Date)p[x]=new Date(m);else if(ArrayBuffer.isView(m))p[x]=a(m);else{var _=c.indexOf(m);p[x]=_!==-1?h[_]:v(m)}}return p}}(l):l.proto?function s(c){if(typeof c!="object"||c===null)return c;if(c instanceof Date)return new Date(c);if(Array.isArray(c))return u(c,s);if(c instanceof Map)return new Map(u(Array.from(c),s));if(c instanceof Set)return new Set(u(Array.from(c),s));var h={};for(var f in c){var d=c[f];typeof d!="object"||d===null?h[f]=d:d instanceof Date?h[f]=new Date(d):d instanceof Map?h[f]=new Map(u(Array.from(d),s)):d instanceof Set?h[f]=new Set(u(Array.from(d),s)):ArrayBuffer.isView(d)?h[f]=a(d):h[f]=s(d)}return h}:function s(c){if(typeof c!="object"||c===null)return c;if(c instanceof Date)return new Date(c);if(Array.isArray(c))return u(c,s);if(c instanceof Map)return new Map(u(Array.from(c),s));if(c instanceof Set)return new Set(u(Array.from(c),s));var h={};for(var f in c)if(Object.hasOwnProperty.call(c,f)!==!1){var d=c[f];typeof d!="object"||d===null?h[f]=d:d instanceof Date?h[f]=new Date(d):d instanceof Map?h[f]=new Map(u(Array.from(d),s)):d instanceof Set?h[f]=new Set(u(Array.from(d),s)):ArrayBuffer.isView(d)?h[f]=a(d):h[f]=s(d)}return h};function u(s,c){for(var h=Object.keys(s),f=new Array(h.length),d=0;d<h.length;d++){var v=h[d],g=s[v];typeof g!="object"||g===null?f[v]=g:g instanceof Date?f[v]=new Date(g):ArrayBuffer.isView(g)?f[v]=a(g):f[v]=c(g)}return f}}}).call(this)}).call(this,i("buffer").Buffer)},{buffer:17}],73:[function(i,n,r){var o=i("buffer"),a=o.Buffer;function l(s,c){for(var h in s)c[h]=s[h]}function u(s,c,h){return a(s,c,h)}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?n.exports=o:(l(o,r),r.Buffer=u),u.prototype=Object.create(a.prototype),l(a,u),u.from=function(s,c,h){if(typeof s=="number")throw new TypeError("Argument must not be a number");return a(s,c,h)},u.alloc=function(s,c,h){if(typeof s!="number")throw new TypeError("Argument must be a number");var f=a(s);return c!==void 0?typeof h=="string"?f.fill(c,h):f.fill(c):f.fill(0),f},u.allocUnsafe=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return a(s)},u.allocUnsafeSlow=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return o.SlowBuffer(s)}},{buffer:17}],74:[function(i,n,r){n.exports=function(o){var a=o._readableState;return a?a.objectMode||typeof o._duplexState=="number"?o.read():o.read((l=a,l.buffer.length?l.buffer.head?l.buffer.head.data.length:l.buffer[0].length:l.length)):null;var l}},{}],75:[function(i,n,r){var o=i("safe-buffer").Buffer,a=o.isEncoding||function(p){switch((p=""+p)&&p.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function l(p){var b;switch(this.encoding=function(x){var m=function(_){if(!_)return"utf8";for(var P;;)switch(_){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return _;default:if(P)return;_=(""+_).toLowerCase(),P=!0}}(x);if(typeof m!="string"&&(o.isEncoding===a||!a(x)))throw new Error("Unknown encoding: "+x);return m||x}(p),this.encoding){case"utf16le":this.text=c,this.end=h,b=4;break;case"utf8":this.fillLast=s,b=4;break;case"base64":this.text=f,this.end=d,b=3;break;default:return this.write=v,void(this.end=g)}this.lastNeed=0,this.lastTotal=0,this.lastChar=o.allocUnsafe(b)}function u(p){return p<=127?0:p>>5==6?2:p>>4==14?3:p>>3==30?4:p>>6==2?-1:-2}function s(p){var b=this.lastTotal-this.lastNeed,x=function(m,_,P){if((192&_[0])!=128)return m.lastNeed=0,"\uFFFD";if(m.lastNeed>1&&_.length>1){if((192&_[1])!=128)return m.lastNeed=1,"\uFFFD";if(m.lastNeed>2&&_.length>2&&(192&_[2])!=128)return m.lastNeed=2,"\uFFFD"}}(this,p);return x!==void 0?x:this.lastNeed<=p.length?(p.copy(this.lastChar,b,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(p.copy(this.lastChar,b,0,p.length),void(this.lastNeed-=p.length))}function c(p,b){if((p.length-b)%2==0){var x=p.toString("utf16le",b);if(x){var m=x.charCodeAt(x.length-1);if(m>=55296&&m<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=p[p.length-2],this.lastChar[1]=p[p.length-1],x.slice(0,-1)}return x}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=p[p.length-1],p.toString("utf16le",b,p.length-1)}function h(p){var b=p&&p.length?this.write(p):"";if(this.lastNeed){var x=this.lastTotal-this.lastNeed;return b+this.lastChar.toString("utf16le",0,x)}return b}function f(p,b){var x=(p.length-b)%3;return x===0?p.toString("base64",b):(this.lastNeed=3-x,this.lastTotal=3,x===1?this.lastChar[0]=p[p.length-1]:(this.lastChar[0]=p[p.length-2],this.lastChar[1]=p[p.length-1]),p.toString("base64",b,p.length-x))}function d(p){var b=p&&p.length?this.write(p):"";return this.lastNeed?b+this.lastChar.toString("base64",0,3-this.lastNeed):b}function v(p){return p.toString(this.encoding)}function g(p){return p&&p.length?this.write(p):""}r.StringDecoder=l,l.prototype.write=function(p){if(p.length===0)return"";var b,x;if(this.lastNeed){if((b=this.fillLast(p))===void 0)return"";x=this.lastNeed,this.lastNeed=0}else x=0;return x<p.length?b?b+this.text(p,x):this.text(p,x):b||""},l.prototype.end=function(p){var b=p&&p.length?this.write(p):"";return this.lastNeed?b+"\uFFFD":b},l.prototype.text=function(p,b){var x=function(_,P,R){var L=P.length-1;if(L<R)return 0;var I=u(P[L]);return I>=0?(I>0&&(_.lastNeed=I-1),I):--L<R||I===-2?0:(I=u(P[L]))>=0?(I>0&&(_.lastNeed=I-2),I):--L<R||I===-2?0:(I=u(P[L]))>=0?(I>0&&(I===2?I=0:_.lastNeed=I-3),I):0}(this,p,b);if(!this.lastNeed)return p.toString("utf8",b);this.lastTotal=x;var m=p.length-(x-this.lastNeed);return p.copy(this.lastChar,0,m),p.toString("utf8",b,m)},l.prototype.fillLast=function(p){if(this.lastNeed<=p.length)return p.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);p.copy(this.lastChar,this.lastTotal-this.lastNeed,0,p.length),this.lastNeed-=p.length}},{"safe-buffer":73}],76:[function(i,n,r){var o=i("punycode"),a=i("./util");function l(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}r.parse=P,r.resolve=function(R,L){return P(R,!1,!0).resolve(L)},r.resolveObject=function(R,L){return R?P(R,!1,!0).resolveObject(L):L},r.format=function(R){return a.isString(R)&&(R=P(R)),R instanceof l?R.format():l.prototype.format.call(R)},r.Url=l;var u=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,h=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r",`
`,"	"]),f=["'"].concat(h),d=["%","/","?",";","#"].concat(f),v=["/","?","#"],g=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,b={javascript:!0,"javascript:":!0},x={javascript:!0,"javascript:":!0},m={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},_=i("querystring");function P(R,L,I){if(R&&a.isObject(R)&&R instanceof l)return R;var V=new l;return V.parse(R,L,I),V}l.prototype.parse=function(R,L,I){if(!a.isString(R))throw new TypeError("Parameter 'url' must be a string, not "+typeof R);var V=R.indexOf("?"),Q=V!==-1&&V<R.indexOf("#")?"?":"#",T=R.split(Q);T[0]=T[0].replace(/\\/g,"/");var k=R=T.join(Q);if(k=k.trim(),!I&&R.split("#").length===1){var M=c.exec(k);if(M)return this.path=k,this.href=k,this.pathname=M[1],M[2]?(this.search=M[2],this.query=L?_.parse(this.search.substr(1)):this.search.substr(1)):L&&(this.search="",this.query={}),this}var C=u.exec(k);if(C){var B=(C=C[0]).toLowerCase();this.protocol=B,k=k.substr(C.length)}if(I||C||k.match(/^\/\/[^@\/]+@[^@\/]+/)){var H=k.substr(0,2)==="//";!H||C&&x[C]||(k=k.substr(2),this.slashes=!0)}if(!x[C]&&(H||C&&!m[C])){for(var W,F,D=-1,z=0;z<v.length;z++)(U=k.indexOf(v[z]))!==-1&&(D===-1||U<D)&&(D=U);for((F=D===-1?k.lastIndexOf("@"):k.lastIndexOf("@",D))!==-1&&(W=k.slice(0,F),k=k.slice(F+1),this.auth=decodeURIComponent(W)),D=-1,z=0;z<d.length;z++){var U;(U=k.indexOf(d[z]))!==-1&&(D===-1||U<D)&&(D=U)}D===-1&&(D=k.length),this.host=k.slice(0,D),k=k.slice(D),this.parseHost(),this.hostname=this.hostname||"";var N=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!N)for(var q=this.hostname.split(/\./),X=(z=0,q.length);z<X;z++){var $=q[z];if($&&!$.match(g)){for(var Z="",J=0,te=$.length;J<te;J++)$.charCodeAt(J)>127?Z+="x":Z+=$[J];if(!Z.match(g)){var y=q.slice(0,z),w=q.slice(z+1),A=$.match(p);A&&(y.push(A[1]),w.unshift(A[2])),w.length&&(k="/"+w.join(".")+k),this.hostname=y.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),N||(this.hostname=o.toASCII(this.hostname));var O=this.port?":"+this.port:"",S=this.hostname||"";this.host=S+O,this.href+=this.host,N&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),k[0]!=="/"&&(k="/"+k))}if(!b[B])for(z=0,X=f.length;z<X;z++){var E=f[z];if(k.indexOf(E)!==-1){var j=encodeURIComponent(E);j===E&&(j=escape(E)),k=k.split(E).join(j)}}var Y=k.indexOf("#");Y!==-1&&(this.hash=k.substr(Y),k=k.slice(0,Y));var K=k.indexOf("?");if(K!==-1?(this.search=k.substr(K),this.query=k.substr(K+1),L&&(this.query=_.parse(this.query)),k=k.slice(0,K)):L&&(this.search="",this.query={}),k&&(this.pathname=k),m[B]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){O=this.pathname||"";var G=this.search||"";this.path=O+G}return this.href=this.format(),this},l.prototype.format=function(){var R=this.auth||"";R&&(R=(R=encodeURIComponent(R)).replace(/%3A/i,":"),R+="@");var L=this.protocol||"",I=this.pathname||"",V=this.hash||"",Q=!1,T="";this.host?Q=R+this.host:this.hostname&&(Q=R+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(Q+=":"+this.port)),this.query&&a.isObject(this.query)&&Object.keys(this.query).length&&(T=_.stringify(this.query));var k=this.search||T&&"?"+T||"";return L&&L.substr(-1)!==":"&&(L+=":"),this.slashes||(!L||m[L])&&Q!==!1?(Q="//"+(Q||""),I&&I.charAt(0)!=="/"&&(I="/"+I)):Q||(Q=""),V&&V.charAt(0)!=="#"&&(V="#"+V),k&&k.charAt(0)!=="?"&&(k="?"+k),L+Q+(I=I.replace(/[?#]/g,function(M){return encodeURIComponent(M)}))+(k=k.replace("#","%23"))+V},l.prototype.resolve=function(R){return this.resolveObject(P(R,!1,!0)).format()},l.prototype.resolveObject=function(R){if(a.isString(R)){var L=new l;L.parse(R,!1,!0),R=L}for(var I=new l,V=Object.keys(this),Q=0;Q<V.length;Q++){var T=V[Q];I[T]=this[T]}if(I.hash=R.hash,R.href==="")return I.href=I.format(),I;if(R.slashes&&!R.protocol){for(var k=Object.keys(R),M=0;M<k.length;M++){var C=k[M];C!=="protocol"&&(I[C]=R[C])}return m[I.protocol]&&I.hostname&&!I.pathname&&(I.path=I.pathname="/"),I.href=I.format(),I}if(R.protocol&&R.protocol!==I.protocol){if(!m[R.protocol]){for(var B=Object.keys(R),H=0;H<B.length;H++){var W=B[H];I[W]=R[W]}return I.href=I.format(),I}if(I.protocol=R.protocol,R.host||x[R.protocol])I.pathname=R.pathname;else{for(var F=(R.pathname||"").split("/");F.length&&!(R.host=F.shift()););R.host||(R.host=""),R.hostname||(R.hostname=""),F[0]!==""&&F.unshift(""),F.length<2&&F.unshift(""),I.pathname=F.join("/")}if(I.search=R.search,I.query=R.query,I.host=R.host||"",I.auth=R.auth,I.hostname=R.hostname||R.host,I.port=R.port,I.pathname||I.search){var D=I.pathname||"",z=I.search||"";I.path=D+z}return I.slashes=I.slashes||R.slashes,I.href=I.format(),I}var U=I.pathname&&I.pathname.charAt(0)==="/",N=R.host||R.pathname&&R.pathname.charAt(0)==="/",q=N||U||I.host&&R.pathname,X=q,$=I.pathname&&I.pathname.split("/")||[],Z=(F=R.pathname&&R.pathname.split("/")||[],I.protocol&&!m[I.protocol]);if(Z&&(I.hostname="",I.port=null,I.host&&($[0]===""?$[0]=I.host:$.unshift(I.host)),I.host="",R.protocol&&(R.hostname=null,R.port=null,R.host&&(F[0]===""?F[0]=R.host:F.unshift(R.host)),R.host=null),q=q&&(F[0]===""||$[0]==="")),N)I.host=R.host||R.host===""?R.host:I.host,I.hostname=R.hostname||R.hostname===""?R.hostname:I.hostname,I.search=R.search,I.query=R.query,$=F;else if(F.length)$||($=[]),$.pop(),$=$.concat(F),I.search=R.search,I.query=R.query;else if(!a.isNullOrUndefined(R.search))return Z&&(I.hostname=I.host=$.shift(),(A=!!(I.host&&I.host.indexOf("@")>0)&&I.host.split("@"))&&(I.auth=A.shift(),I.host=I.hostname=A.shift())),I.search=R.search,I.query=R.query,a.isNull(I.pathname)&&a.isNull(I.search)||(I.path=(I.pathname?I.pathname:"")+(I.search?I.search:"")),I.href=I.format(),I;if(!$.length)return I.pathname=null,I.search?I.path="/"+I.search:I.path=null,I.href=I.format(),I;for(var J=$.slice(-1)[0],te=(I.host||R.host||$.length>1)&&(J==="."||J==="..")||J==="",y=0,w=$.length;w>=0;w--)(J=$[w])==="."?$.splice(w,1):J===".."?($.splice(w,1),y++):y&&($.splice(w,1),y--);if(!q&&!X)for(;y--;y)$.unshift("..");!q||$[0]===""||$[0]&&$[0].charAt(0)==="/"||$.unshift(""),te&&$.join("/").substr(-1)!=="/"&&$.push("");var A,O=$[0]===""||$[0]&&$[0].charAt(0)==="/";return Z&&(I.hostname=I.host=O?"":$.length?$.shift():"",(A=!!(I.host&&I.host.indexOf("@")>0)&&I.host.split("@"))&&(I.auth=A.shift(),I.host=I.hostname=A.shift())),(q=q||I.host&&$.length)&&!O&&$.unshift(""),$.length?I.pathname=$.join("/"):(I.pathname=null,I.path=null),a.isNull(I.pathname)&&a.isNull(I.search)||(I.path=(I.pathname?I.pathname:"")+(I.search?I.search:"")),I.auth=R.auth||I.auth,I.slashes=I.slashes||R.slashes,I.href=I.format(),I},l.prototype.parseHost=function(){var R=this.host,L=s.exec(R);L&&((L=L[0])!==":"&&(this.port=L.substr(1)),R=R.substr(0,R.length-L.length)),R&&(this.hostname=R)}},{"./util":77,punycode:51,querystring:54}],77:[function(i,n,r){n.exports={isString:function(o){return typeof o=="string"},isObject:function(o){return typeof o=="object"&&o!==null},isNull:function(o){return o===null},isNullOrUndefined:function(o){return o==null}}},{}],78:[function(i,n,r){(function(o){(function(){function a(l){try{if(!o.localStorage)return!1}catch{return!1}var u=o.localStorage[l];return u!=null&&String(u).toLowerCase()==="true"}n.exports=function(l,u){if(a("noDeprecation"))return l;var s=!1;return function(){if(!s){if(a("throwDeprecation"))throw new Error(u);a("traceDeprecation")?console.trace(u):console.warn(u),s=!0}return l.apply(this,arguments)}}}).call(this)}).call(this,typeof ht<"u"?ht:typeof self<"u"?self:typeof window<"u"?window:{})},{}],79:[function(i,n,r){n.exports=function o(a,l){if(a&&l)return o(a)(l);if(typeof a!="function")throw new TypeError("need wrapper function");return Object.keys(a).forEach(function(s){u[s]=a[s]}),u;function u(){for(var s=new Array(arguments.length),c=0;c<s.length;c++)s[c]=arguments[c];var h=a.apply(this,s),f=s[s.length-1];return typeof h=="function"&&h!==f&&Object.keys(f).forEach(function(d){h[d]=f[d]}),h}}},{}],80:[function(i,n,r){n.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},{}],81:[function(i,n,r){n.exports=function(){for(var a={},l=0;l<arguments.length;l++){var u=arguments[l];for(var s in u)o.call(u,s)&&(a[s]=u[s])}return a};var o=Object.prototype.hasOwnProperty},{}],82:[function(i,n,r){n.exports=function(o){o.prototype[Symbol.iterator]=function*(){for(let a=this.head;a;a=a.next)yield a.value}}},{}],83:[function(i,n,r){function o(c){var h=this;if(h instanceof o||(h=new o),h.tail=null,h.head=null,h.length=0,c&&typeof c.forEach=="function")c.forEach(function(v){h.push(v)});else if(arguments.length>0)for(var f=0,d=arguments.length;f<d;f++)h.push(arguments[f]);return h}function a(c,h,f){var d=h===c.head?new s(f,null,h,c):new s(f,h,h.next,c);return d.next===null&&(c.tail=d),d.prev===null&&(c.head=d),c.length++,d}function l(c,h){c.tail=new s(h,c.tail,null,c),c.head||(c.head=c.tail),c.length++}function u(c,h){c.head=new s(h,null,c.head,c),c.tail||(c.tail=c.head),c.length++}function s(c,h,f,d){if(!(this instanceof s))return new s(c,h,f,d);this.list=d,this.value=c,h?(h.next=this,this.prev=h):this.prev=null,f?(f.prev=this,this.next=f):this.next=null}n.exports=o,o.Node=s,o.create=o,o.prototype.removeNode=function(c){if(c.list!==this)throw new Error("removing node which does not belong to this list");var h=c.next,f=c.prev;return h&&(h.prev=f),f&&(f.next=h),c===this.head&&(this.head=h),c===this.tail&&(this.tail=f),c.list.length--,c.next=null,c.prev=null,c.list=null,h},o.prototype.unshiftNode=function(c){if(c!==this.head){c.list&&c.list.removeNode(c);var h=this.head;c.list=this,c.next=h,h&&(h.prev=c),this.head=c,this.tail||(this.tail=c),this.length++}},o.prototype.pushNode=function(c){if(c!==this.tail){c.list&&c.list.removeNode(c);var h=this.tail;c.list=this,c.prev=h,h&&(h.next=c),this.tail=c,this.head||(this.head=c),this.length++}},o.prototype.push=function(){for(var c=0,h=arguments.length;c<h;c++)l(this,arguments[c]);return this.length},o.prototype.unshift=function(){for(var c=0,h=arguments.length;c<h;c++)u(this,arguments[c]);return this.length},o.prototype.pop=function(){if(this.tail){var c=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,c}},o.prototype.shift=function(){if(this.head){var c=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,c}},o.prototype.forEach=function(c,h){h=h||this;for(var f=this.head,d=0;f!==null;d++)c.call(h,f.value,d,this),f=f.next},o.prototype.forEachReverse=function(c,h){h=h||this;for(var f=this.tail,d=this.length-1;f!==null;d--)c.call(h,f.value,d,this),f=f.prev},o.prototype.get=function(c){for(var h=0,f=this.head;f!==null&&h<c;h++)f=f.next;if(h===c&&f!==null)return f.value},o.prototype.getReverse=function(c){for(var h=0,f=this.tail;f!==null&&h<c;h++)f=f.prev;if(h===c&&f!==null)return f.value},o.prototype.map=function(c,h){h=h||this;for(var f=new o,d=this.head;d!==null;)f.push(c.call(h,d.value,this)),d=d.next;return f},o.prototype.mapReverse=function(c,h){h=h||this;for(var f=new o,d=this.tail;d!==null;)f.push(c.call(h,d.value,this)),d=d.prev;return f},o.prototype.reduce=function(c,h){var f,d=this.head;if(arguments.length>1)f=h;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");d=this.head.next,f=this.head.value}for(var v=0;d!==null;v++)f=c(f,d.value,v),d=d.next;return f},o.prototype.reduceReverse=function(c,h){var f,d=this.tail;if(arguments.length>1)f=h;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");d=this.tail.prev,f=this.tail.value}for(var v=this.length-1;d!==null;v--)f=c(f,d.value,v),d=d.prev;return f},o.prototype.toArray=function(){for(var c=new Array(this.length),h=0,f=this.head;f!==null;h++)c[h]=f.value,f=f.next;return c},o.prototype.toArrayReverse=function(){for(var c=new Array(this.length),h=0,f=this.tail;f!==null;h++)c[h]=f.value,f=f.prev;return c},o.prototype.slice=function(c,h){(h=h||this.length)<0&&(h+=this.length),(c=c||0)<0&&(c+=this.length);var f=new o;if(h<c||h<0)return f;c<0&&(c=0),h>this.length&&(h=this.length);for(var d=0,v=this.head;v!==null&&d<c;d++)v=v.next;for(;v!==null&&d<h;d++,v=v.next)f.push(v.value);return f},o.prototype.sliceReverse=function(c,h){(h=h||this.length)<0&&(h+=this.length),(c=c||0)<0&&(c+=this.length);var f=new o;if(h<c||h<0)return f;c<0&&(c=0),h>this.length&&(h=this.length);for(var d=this.length,v=this.tail;v!==null&&d>h;d--)v=v.prev;for(;v!==null&&d>c;d--,v=v.prev)f.push(v.value);return f},o.prototype.splice=function(c,h,...f){c>this.length&&(c=this.length-1),c<0&&(c=this.length+c);for(var d=0,v=this.head;v!==null&&d<c;d++)v=v.next;var g=[];for(d=0;v&&d<h;d++)g.push(v.value),v=this.removeNode(v);for(v===null&&(v=this.tail),v!==this.head&&v!==this.tail&&(v=v.prev),d=0;d<f.length;d++)v=a(this,v,f[d]);return g},o.prototype.reverse=function(){for(var c=this.head,h=this.tail,f=c;f!==null;f=f.prev){var d=f.prev;f.prev=f.next,f.next=d}return this.head=h,this.tail=c,this};try{i("./iterator.js")(o)}catch{}},{"./iterator.js":82}]},{},[12])(12)})})(Ps);var et=globalThis&&globalThis.__assign||function(){return et=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},et.apply(this,arguments)},gr=globalThis&&globalThis.__awaiter||function(e,t,i,n){function r(o){return o instanceof i?o:new i(function(a){a(o)})}return new(i||(i=Promise))(function(o,a){function l(c){try{s(n.next(c))}catch(h){a(h)}}function u(c){try{s(n.throw(c))}catch(h){a(h)}}function s(c){c.done?o(c.value):r(c.value).then(l,u)}s((n=n.apply(e,t||[])).next())})},mr=globalThis&&globalThis.__generator||function(e,t){var i={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(c){return u([s,c])}}function u(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=s[0]&2?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[s[0]&2,o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!(o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){i=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(s[0]===6&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(c){s=[6,c],r=0}finally{n=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},St=globalThis&&globalThis.__values||function(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ei=globalThis&&globalThis.__read||function(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var n=i.call(e),r,o=[],a;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(a)throw a.error}}return o},Kt=globalThis&&globalThis.__spreadArray||function(e,t,i){if(i||arguments.length===2)for(var n=0,r=t.length,o;n<r;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},Vf=function(){function e(t,i){var n=this;i===void 0&&(i={}),this.events={},this.facePen=ar,this.getWords=ts,this.calcTextLines=Mi,this.calcTextRect=xr,this.calcTextDrawRect=es,this.register=Iu,this.registerCanvasDraw=Lu,this.registerAnchors=Mu,this.onEvent=function(r,o){var a;switch(r){case"add":o.forEach(function(l){var u;(u=l.onAdd)===null||u===void 0||u.call(l,l)}),n.onSizeUpdate();break;case"enter":o&&o.onMouseEnter&&o.onMouseEnter(o,n.canvas.mousePos),n.store.data.locked&&n.doEvent(o,r);break;case"leave":o&&o.onMouseLeave&&o.onMouseLeave(o,n.canvas.mousePos),n.store.data.locked&&n.doEvent(o,r);break;case"active":case"inactive":n.store.data.locked&&o.forEach(function(l){n.doEvent(l,r)});break;case"click":o.pen&&o.pen.onClick&&o.pen.onClick(o.pen,n.canvas.mousePos),n.store.data.locked&&o.pen&&n.doEvent(o.pen,r);break;case"mousedown":o.pen&&o.pen.onMouseDown&&o.pen.onMouseDown(o.pen,n.canvas.mousePos),n.store.data.locked&&o.pen&&n.doEvent(o.pen,r);break;case"mouseup":o.pen&&o.pen.onMouseUp&&o.pen.onMouseUp(o.pen,n.canvas.mousePos),n.store.data.locked&&o.pen&&n.doEvent(o.pen,r);break;case"dblclick":n.store.data.locked&&o.pen&&n.doEvent(o.pen,r);break;case"valueUpdate":(a=o.onValue)===null||a===void 0||a.call(o,o),n.store.data.locked&&n.doEvent(o,r),n.canvas.tooltip.updateText(o);break;case"update":case"delete":case"translatePens":case"rotatePens":case"resizePens":n.onSizeUpdate();break}},this.doEvent=function(r,o){var a;!r||((a=r.events)===null||a===void 0||a.forEach(function(l){if(n.events[l.action]&&l.name===o){var u=!l.where;if(l.where){var s=l.where,c=s.fn,h=s.fnJs,f=s.comparison,d=s.key,v=s.value;if(c)u=c(r);else if(h){try{l.where.fn=new Function("pen",h)}catch(g){console.error("Error: make function:",g)}l.where.fn&&(u=l.where.fn(r))}else switch(f){case">":u=r[d]>+v;break;case">=":u=r[d]>=+v;break;case"<":u=r[d]<+v;break;case"<=":u=r[d]<=+v;break;case"=":case"==":u=r[d]==v;break;case"!=":u=r[d]!=v;break;case"[)":u=Mo(+r[d],v);break;case"![)":u=!Mo(+r[d],v);break;case"[]":u=Oo(+r[d],v);break;case"![]":u=!Oo(+r[d],v);break}}u&&n.events[l.action](r,l)}}),n.doEvent(n.store.pens[r.parentId],o))},this.renderPenRaw=us,this.setElemPosition=_t,this.store=Nu(be()),this.setOptions(i),this.init(t),this.register(Ff()),this.registerCanvasDraw({cube:Zh}),this.registerAnchors(zf()),window&&(window.topology=this),this.initEventFns(),this.store.emitter.on("*",this.onEvent)}return Object.defineProperty(e.prototype,"beforeAddPen",{get:function(){return this.canvas.beforeAddPen},set:function(t){this.canvas.beforeAddPen=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"beforeAddPens",{get:function(){return this.canvas.beforeAddPens},set:function(t){this.canvas.beforeAddPens=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"beforeAddAnchor",{get:function(){return this.canvas.beforeAddAnchor},set:function(t){this.canvas.beforeAddAnchor=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"beforeRemovePens",{get:function(){return this.canvas.beforeRemovePens},set:function(t){this.canvas.beforeRemovePens=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"beforeRemoveAnchor",{get:function(){return this.canvas.beforeRemoveAnchor},set:function(t){this.canvas.beforeRemoveAnchor=t},enumerable:!1,configurable:!0}),e.prototype.setOptions=function(t){t===void 0&&(t={}),this.store.options=Object.assign(this.store.options,t)},e.prototype.getOptions=function(){return this.store.options},e.prototype.init=function(t){typeof t=="string"?this.canvas=new ia(this,document.getElementById(t),this.store):this.canvas=new ia(this,t,this.store),this.resize(),this.canvas.listen()},e.prototype.initEventFns=function(){var t=this;this.events[Ke.Link]=function(i,n){var r;if(n.value&&typeof n.value=="string"){window.open(n.value,(r=n.params)!==null&&r!==void 0?r:"_blank");return}console.warn("[topology] Link param is not a string")},this.events[Ke.SetProps]=function(i,n){var r=n.value;if(r&&typeof r=="object"){var o=n.params?t.find(n.params):[i];o.forEach(function(a){r.hasOwnProperty("visible")&&t.setVisible(a,r.visible),t._setValue(et({id:a.id},r))}),t.render();return}console.warn("[topology] SetProps value is not an object")},this.events[Ke.StartAnimate]=function(i,n){if(!n.value||typeof n.value=="string"){t.startAnimate(n.value||[i]);return}console.warn("[topology] StartAnimate value is not a string")},this.events[Ke.PauseAnimate]=function(i,n){if(!n.value||typeof n.value=="string"){t.pauseAnimate(n.value||[i]);return}console.warn("[topology] PauseAnimate value is not a string")},this.events[Ke.StopAnimate]=function(i,n){if(!n.value||typeof n.value=="string"){t.stopAnimate(n.value||[i]);return}console.warn("[topology] StopAnimate event value is not a string")},this.events[Ke.StartVideo]=function(i,n){if(!n.value||typeof n.value=="string"){t.startVideo(n.value||[i]);return}console.warn("[topology] StartVideo value is not a string")},this.events[Ke.PauseVideo]=function(i,n){if(!n.value||typeof n.value=="string"){t.pauseVideo(n.value||[i]);return}console.warn("[topology] PauseVideo value is not a string")},this.events[Ke.StopVideo]=function(i,n){if(!n.value||typeof n.value=="string"){t.stopVideo(n.value||[i]);return}console.warn("[topology] StopVideo event value is not a string")},this.events[Ke.Function]=function(i,n){var r;if(n.value&&!n.fn)try{if(typeof n.value!="string")throw new Error("[topology] Function value must be string");var o=n.value,a=o.replaceAll?o.replaceAll(".setValue(","._setValue("):o.replace(/.setValue\(/g,"._setValue(");n.fn=new Function("pen","params",a)}catch(l){console.error("[topology]: Error on make a function:",l)}(r=n.fn)===null||r===void 0||r.call(n,i,n.params)},this.events[Ke.WindowFn]=function(i,n){if(typeof n.value!="string"){console.warn("[topology] WindowFn value must be a string");return}window&&window[n.value]&&window[n.value](i,n.params)},this.events[Ke.Emit]=function(i,n){if(typeof n.value!="string"){console.warn("[topology] Emit value must be a string");return}t.store.emitter.emit(n.value,{pen:i,params:n.params})}},e.prototype.resize=function(t,i){this.canvas.resize(t,i),this.render(),this.store.emitter.emit("resize",{width:t,height:i}),this.canvas.scroll&&this.canvas.scroll.isShow&&this.canvas.scroll.init()},e.prototype.addPen=function(t,i){return gr(this,void 0,void 0,function(){return mr(this,function(n){switch(n.label){case 0:return[4,this.canvas.addPen(t,i)];case 1:return[2,n.sent()]}})})},e.prototype.addPens=function(t,i){return gr(this,void 0,void 0,function(){return mr(this,function(n){switch(n.label){case 0:return[4,this.canvas.addPens(t,i)];case 1:return[2,n.sent()]}})})},e.prototype.render=function(t){this.canvas.render(t)},e.prototype.setBackgroundImage=function(t){var i=this;if(this.store.data.bkImage=t,this.canvas.canvasImageBottom.canvas.style.backgroundImage=t?"url("+t+")":"",t){var n=new Image;n.src=t,n.onload=function(){i.store.bkImg=n}}else this.store.bkImg=null},e.prototype.setBackgroundColor=function(t){t===void 0&&(t=this.store.data.background),this.store.data.background=t,this.store.dirtyBackground=!0},e.prototype.setGrid=function(t){var i=t===void 0?{}:t,n=i.grid,r=n===void 0?this.store.data.grid:n,o=i.gridColor,a=o===void 0?this.store.data.gridColor:o,l=i.gridSize,u=l===void 0?this.store.data.gridSize:l,s=i.gridRotate,c=s===void 0?this.store.data.gridRotate:s;this.store.data.grid=r,this.store.data.gridColor=a,this.store.data.gridSize=u,this.store.data.gridRotate=c,this.store.dirtyBackground=!0},e.prototype.setRule=function(t){var i=t===void 0?{}:t,n=i.rule,r=n===void 0?this.store.data.rule:n,o=i.ruleColor,a=o===void 0?this.store.data.ruleColor:o;this.store.data.rule=r,this.store.data.ruleColor=a,this.store.dirtyTop=!0},e.prototype.open=function(t){var i,n,r,o;if(this.clear(!1),t){this.setBackgroundImage(t.bkImage),Object.assign(this.store.data,t),this.store.data.pens=[];try{for(var a=St(t.pens),l=a.next();!l.done;l=a.next()){var u=l.value;u.id||(u.id=be()),!u.calculative&&(u.calculative={canvas:this.canvas}),this.store.pens[u.id]=u}}catch(h){i={error:h}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}try{for(var s=St(t.pens),c=s.next();!c.done;c=s.next()){var u=c.value;this.canvas.makePen(u)}}catch(h){r={error:h}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}}this.render(),this.listenSocket(),this.connectSocket(),this.startAnimate(),this.startVideo(),this.doInitJS(),this.store.emitter.emit("opened"),this.canvas.scroll&&this.canvas.scroll.isShow&&this.canvas.scroll.init()},e.prototype.connectSocket=function(){this.connectWebsocket(),this.connectMqtt(),this.connectHttp()},e.prototype.doInitJS=function(){var t=this.store.data.initJs;if(t&&t.trim())try{var i=new Function(t);i()}catch(n){console.warn("initJs error",n)}},e.prototype.drawLine=function(t){t&&Cs(this.store),this.canvas.drawingLineName=t},e.prototype.drawingPencil=function(){this.canvas.drawingPencil()},e.prototype.stopPencil=function(){this.canvas.stopPencil()},e.prototype.lock=function(t){this.store.data.locked=t,this.finishDrawLine(!0),this.canvas.drawingLineName="",this.stopPencil()},e.prototype.finishDrawLine=function(t){return gr(this,void 0,void 0,function(){return mr(this,function(i){switch(i.label){case 0:return[4,this.canvas.finishDrawline(t)];case 1:return i.sent(),[2]}})})},e.prototype.finishPencil=function(){return gr(this,void 0,void 0,function(){return mr(this,function(t){switch(t.label){case 0:return[4,this.canvas.finishPencil()];case 1:return t.sent(),[2]}})})},e.prototype.updateLineType=function(t,i){if(!(!t||t.name!="line"||!i||!this.canvas[i])){t.lineName=i;var n=Oe(t),r=Ae(t);n.prev=void 0,n.next=void 0,r.prev=void 0,r.next=void 0,t.calculative.worldAnchors=[n,r],t.calculative.activeAnchor=n,this.canvas[i](this.store,t,r),t.lineName==="curve"&&(n.prev={penId:n.penId,x:n.x-50,y:n.y},n.next={penId:n.penId,x:n.x+50,y:n.y},r.prev={penId:r.penId,x:r.x-50,y:r.y},r.next={penId:r.penId,x:r.x+50,y:r.y}),t.calculative.activeAnchor=void 0,this.canvas.initLineRect(t),this.render()}},e.prototype.addDrawLineFn=function(t,i){this.canvas[t]=i,this.canvas.drawLineFns.push(t)},e.prototype.removeDrawLineFn=function(t){var i=this.canvas.drawLineFns.indexOf(t);i>-1&&this.canvas.drawLineFns.splice(i,1)},e.prototype.showMagnifier=function(){this.canvas.showMagnifier()},e.prototype.hideMagnifier=function(){this.canvas.hideMagnifier()},e.prototype.toggleMagnifier=function(){this.canvas.toggleMagnifier()},e.prototype.clear=function(t){var i,n,r;t===void 0&&(t=!0);try{for(var o=St(this.store.data.pens),a=o.next();!a.done;a=o.next()){var l=a.value;(r=l.onDestroy)===null||r===void 0||r.call(l,l)}}catch(u){i={error:u}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}ju(this.store),this.hideInput(),this.canvas.tooltip.hide(),this.canvas.clearCanvas(),this.store.dirtyBackground=!0,this.store.dirtyTop=!0,this.setBackgroundImage(void 0),t&&this.render()},e.prototype.emit=function(t,i){this.store.emitter.emit(t,i)},e.prototype.on=function(t,i){return this.store.emitter.on(t,i),this},e.prototype.off=function(t,i){return this.store.emitter.off(t,i),this},e.prototype.registerMoveDock=function(t){this.canvas.customeMoveDock=t},e.prototype.registerResizeDock=function(t){this.canvas.customeResizeDock=t},e.prototype.find=function(t){return this.canvas.find(t)},e.prototype.findOne=function(t){return this.canvas.findOne(t)},e.prototype.getPenRect=function(t){return this.canvas.getPenRect(t)},e.prototype.setPenRect=function(t,i,n){n===void 0&&(n=!0),this.canvas.setPenRect(t,i,n)},e.prototype.startAnimate=function(t){var i=this,n;t?typeof t=="string"?n=this.find(t):n=t:n=this.store.data.pens.filter(function(r){return(r.type||r.frames)&&r.autoPlay}),n.forEach(function(r){if(r.calculative.pause){var o=Date.now()-r.calculative.pause;r.calculative.pause=void 0,r.calculative.frameStart+=o,r.calculative.frameEnd+=o}else i.store.animates.add(r)}),this.canvas.canvasImage.init(),this.canvas.canvasImageBottom.init(),this.canvas.animate()},e.prototype.pauseAnimate=function(t){var i=[];t?typeof t=="string"?i=this.find(t):i=t:this.store.animates.forEach(function(n){i.push(n)}),i.forEach(function(n){n.calculative.pause||(n.calculative.pause=Date.now())})},e.prototype.stopAnimate=function(t){var i=this,n=[];t?typeof t=="string"?n=this.find(t):n=t:this.store.animates.forEach(function(r){n.push(r)}),n.forEach(function(r){r.calculative.pause=void 0,r.calculative.start=void 0,r.calculative.duration=void 0,r.calculative.animatePos=0,i.store.animates.delete(r),i.canvas.restoreNodeAnimate(r)}),this.initImageCanvas(n),setTimeout(function(){i.canvas.calcActiveRect(),i.render()},20)},e.prototype.startVideo=function(t){var i;t?typeof t=="string"?i=this.find(t):i=t:i=this.store.data.pens.filter(function(n){return(n.video||n.audio)&&n.autoPlay}),i.forEach(function(n){var r,o;(r=n.calculative.media)===null||r===void 0||r.play(),(o=n.onStartVideo)===null||o===void 0||o.call(n,n)})},e.prototype.pauseVideo=function(t){var i=[];t?typeof t=="string"?i=this.find(t):i=t:i=this.store.data.pens.filter(function(n){return(n.video||n.audio)&&n.autoPlay}),i.forEach(function(n){var r,o;(r=n.calculative.media)===null||r===void 0||r.pause(),(o=n.onPauseVideo)===null||o===void 0||o.call(n,n)})},e.prototype.stopVideo=function(t){var i=[];t?typeof t=="string"?i=this.find(t):i=t:i=this.store.data.pens.filter(function(n){return(n.video||n.audio)&&n.autoPlay}),i.forEach(function(n){var r;n.calculative.media&&(n.calculative.media.currentTime=0,n.calculative.media.pause()),(r=n.onStopVideo)===null||r===void 0||r.call(n,n)})},e.prototype.calcAnimateDuration=function(t){return t.frames.reduce(function(i,n){return i+n.duration},0)},e.prototype.combine=function(t,i){if(t===void 0&&(t=this.store.active),!(!t||!t.length)){var n=se(t);if(t.length===1&&t[0].type){t[0].type=Pe.Node,this.canvas.active(t),this.pushHistory({type:de.Update,initPens:n,pens:se(t,!0)}),this.render();return}var r=wt(t),o=et(et({id:be(),name:"combine"},r),{children:[],showChild:i}),a=t.find(function(s){return s.width===r.width&&s.height===r.height}),l=a&&i==null;l?(a.children||(a.children=[]),o=a):this.canvas.makePen(o),t.forEach(function(s){var c;if(!(s===o||s.parentId===o.id)){o.children.push(s.id),s.parentId=o.id;var h=ai(s.calculative.worldRect,r);Object.assign(s,h),s.locked=(c=s.lockedOnCombine)!==null&&c!==void 0?c:Ce.DisableMove}}),this.canvas.active([o]);var u=1;l||(u=2,this.pushHistory({type:de.Add,pens:[o],step:u}),this.store.emitter.emit("add",[o])),this.pushHistory({type:de.Update,initPens:n,pens:t,step:u}),i!=null&&(t.forEach(function(s){Rr(s,!0)}),this.initImageCanvas([o])),this.render()}},e.prototype.uncombine=function(t){var i=this;if(!t&&this.store.active&&(t=this.store.active[0]),!(!t||!t.children)){var n=t.children.map(function(a){return i.store.pens[a]}),r=se(n);n.forEach(function(a){a.parentId=void 0,a.x=a.calculative.worldRect.x,a.y=a.calculative.worldRect.y,a.width=a.calculative.worldRect.width,a.height=a.calculative.worldRect.height,a.locked=Ce.None,a.calculative.active=void 0,a.calculative.hover=!1,i.setVisible(a,!0)});var o=t.name==="combine"?3:2;this.pushHistory({type:de.Update,initPens:r,pens:n,step:o}),r=[se(t)],t.children=void 0,this.pushHistory({type:de.Update,initPens:r,pens:[t],step:o}),t.name==="combine"&&(this.delete([t]),this.store.histories[this.store.histories.length-1].step=o),this.inactive()}},e.prototype.active=function(t,i){i===void 0&&(i=!0),this.canvas.active(t,i)},e.prototype.inactive=function(){this.canvas.inactive()},e.prototype.delete=function(t,i){i===void 0&&(i=!1),this.canvas.delete(t,i)},e.prototype.scale=function(t,i){i===void 0&&(i={x:0,y:0}),this.canvas.scale(t,i)},e.prototype.translate=function(t,i){this.canvas.translate(t,i)},e.prototype.translatePens=function(t,i,n){this.canvas.translatePens(t,i,n)},e.prototype.getParent=function(t,i){return Zt(t,i)},e.prototype.data=function(){var t=se(this.store.data),i=this.store.data,n=i.pens,r=i.paths;t.version=Za.version,t.paths={};var o=function(l){Object.prototype.hasOwnProperty.call(r,l)&&n.find(function(u){return u.pathId===l})&&(t.paths[l]=r[l])};for(var a in r)o(a);return t},e.prototype.copy=function(t){this.canvas.copy(t)},e.prototype.cut=function(t){this.canvas.cut(t)},e.prototype.paste=function(){this.canvas.paste()},e.prototype.undo=function(){this.canvas.undo()},e.prototype.redo=function(){this.canvas.redo()},e.prototype.listenSocket=function(){try{var t=void 0,i=this.store.data.socketCbJs;if(i&&(t=new Function("e","topic",i)),!t)return!1;this.socketFn=t}catch(n){return console.error("Create the function for socket:",n),!1}return!0},e.prototype.connectWebsocket=function(t){var i=this;this.closeWebsocket(),t&&(this.store.data.websocket=t),this.store.data.websocket&&(this.websocket=new WebSocket(this.store.data.websocket),this.websocket.onmessage=function(n){i.doSocket(n.data)},this.websocket.onclose=function(){console.info("Canvas websocket closed and reconneting..."),i.connectWebsocket()})},e.prototype.closeWebsocket=function(){this.websocket&&(this.websocket.onclose=void 0,this.websocket.close(),this.websocket=void 0)},e.prototype.connectMqtt=function(t){var i=this;this.closeMqtt(),t&&(this.store.data.mqtt=t.mqtt,this.store.data.mqttTopics=t.mqttTopics,this.store.data.mqttOptions=t.mqttOptions),this.store.data.mqtt&&(this.store.data.mqttOptions.clientId&&!this.store.data.mqttOptions.customClientId&&(this.store.data.mqttOptions.clientId=be()),this.mqttClient=Ps.exports.connect(this.store.data.mqtt,this.store.data.mqttOptions),this.mqttClient.on("message",function(n,r){i.doSocket(r.toString(),n)}),this.store.data.mqttTopics&&this.mqttClient.subscribe(this.store.data.mqttTopics.split(",")))},e.prototype.closeMqtt=function(){var t;(t=this.mqttClient)===null||t===void 0||t.end()},e.prototype.connectHttp=function(){var t=this;this.closeHttp();var i=this.store.data,n=i.http,r=i.httpTimeInterval;n&&(this.httpTimer=setInterval(function(){return gr(t,void 0,void 0,function(){var o,a;return mr(this,function(l){switch(l.label){case 0:return[4,fetch(n)];case 1:return o=l.sent(),o.ok?[4,o.text()]:[3,3];case 2:a=l.sent(),this.doSocket(a),l.label=3;case 3:return[2]}})})},r||1e3))},e.prototype.closeHttp=function(){clearInterval(this.httpTimer),this.httpTimer=void 0},e.prototype.doSocket=function(t,i){var n=this;if(i===void 0&&(i=""),this.socketFn){this.socketFn(t,i);return}try{var r=JSON.parse(t),o=Array.isArray(r)?r:[r],a=this.store.data.pens.filter(function(u){return u.form}),l=o.filter(function(u){return u.dataId});l.length&&this.setValuesByDataId(a,l),o.forEach(function(u){u.dataId||n.setValue(u,{render:!1})}),this.render()}catch(u){console.warn("Invalid socket data:",u)}},e.prototype.setValuesByDataId=function(t,i){var n=this;t===void 0&&(t=[]);var r=[];t.forEach(function(o){var a;(a=o.form)===null||a===void 0||a.forEach(function(l){var u,s=l.dataIds;if(!!s)if(Array.isArray(s))typeof o.onBinds=="function"?r.push.apply(r,Kt([],ei(o.onBinds(o,i,l)),!1)):console.warn("Not support onBinds for pen:",o);else{var c=i.find(function(h){return h.dataId===s.dataId});c&&r.push((u={id:o.id},u[l.key]=c.value,u))}})}),r.forEach(function(o){n.setValue(o,{render:!1})})},e.prototype.setValue=function(t,i){var n=this,r=i===void 0?{}:i,o=r.render,a=o===void 0?!0:o;this._setValue(t).forEach(function(l){n.store.emitter.emit("valueUpdate",l)}),a&&this.render()},e.prototype._setValue=function(t){var i=this,n=[];if(t.id){var r=this.store.pens[t.id];r&&n.push(r)}else n=this.find(t.tag);return n.forEach(function(o){var a,l=o.onBeforeValue?o.onBeforeValue(o,t):t;i.canvas.updateValue(o,l),(a=o.onValue)===null||a===void 0||a.call(o,o)}),!this.store.data.locked&&this.store.active.length&&!this.canvas.movingPens&&this.canvas.calcActiveRect(),n},e.prototype.pushHistory=function(t){this.canvas.pushHistory(t)},e.prototype.showInput=function(t,i){this.canvas.showInput(t,i)},e.prototype.hideInput=function(){this.canvas.hideInput()},e.prototype.clearDropdownList=function(){this.canvas.clearDropdownList()},e.prototype.pushChildren=function(t,i){var n=this,r=[se(t,!0)],o=[];t.children||(t.children=[]);var a=[];i.forEach(function(u){var s,c=se(u,!0);if((!u.id||!n.store.pens[u.id])&&(n.canvas.makePen(u),c=null),u.parentId){var h=n.store.pens[u.parentId],f=h.children.findIndex(function(v){return v===u.id});r.push(se(h,!0)),h.children.splice(f,1),a.push(se(h,!0))}t.children.push(u.id),u.parentId=t.id;var d=ai(u.calculative.worldRect,t.calculative.worldRect);Object.assign(u,d),u.locked=(s=u.lockedOnCombine)!==null&&s!==void 0?s:Ce.DisableMove,c?(r.push(c),a.push(se(u,!0))):o.push(se(u,!0))}),a.push(se(t,!0));var l=1;o.length&&(l=2,this.pushHistory({type:de.Add,pens:o,step:l})),this.pushHistory({type:de.Update,initPens:r,pens:a,step:l})},e.prototype.toPng=function(t,i,n){return n===void 0&&(n=!1),this.canvas.toPng(t,i,n)},e.prototype.downloadPng=function(t,i){var n=document.createElement("a");n.setAttribute("download",t||"le5le.topology.png"),n.setAttribute("href",this.toPng(i,void 0,!0));var r=document.createEvent("MouseEvents");r.initEvent("click",!0,!0),n.dispatchEvent(r)},e.prototype.getRect=function(t){return t===void 0&&(t=this.store.data.pens),wt(t)},e.prototype.fitView=function(t,i){if(t===void 0&&(t=!0),i===void 0&&(i=10),!!this.hasView()){var n=this.canvas.canvas,r=n.offsetWidth,o=n.offsetHeight;this.resize(r,o);var a=Yn(i),l=this.getRect(),u=(r-a[1]-a[3])/l.width,s=(o-a[0]-a[2])/l.height,c=u;t?c=u>s?s:u:c=u>s?u:s,this.scale(c*this.store.data.scale),this.centerView()}},e.prototype.centerView=function(){if(!!this.hasView()){var t=this.getRect(),i=this.getViewCenter(),n=this.getPenRect(t);Ie(n);var r=n.center,o=this.store.data,a=o.scale,l=o.origin,u=o.x,s=o.y;this.translate((i.x-l.x)/a-r.x-u/a,(i.y-l.y)/a-r.y-s/a);var c=this.canvas.canvas,h=(c.scrollWidth-c.offsetWidth)/2,f=(c.scrollHeight-c.offsetHeight)/2;c.scrollTo(h,f)}},e.prototype.hasView=function(){return!!this.store.data.pens.filter(function(t){return!t.isRuleLine}).length},e.prototype.getViewCenter=function(){var t=this.canvas,i=t.width,n=t.height;return{x:i/2,y:n/2}},e.prototype.beSameByFirst=function(t){t===void 0&&(t=this.store.data.pens);var i=se(t),n=t[0],r=this.getPenRect(n),o=r.width,a=r.height,l={};hu.forEach(function(c){l[c]=n[c]});for(var u=1;u<t.length;u++){var s=t[u];this._setValue(et({id:s.id,width:o,height:a},l))}this.render(),this.pushHistory({type:de.Update,initPens:i,pens:t})},e.prototype.alignNodes=function(t,i,n){var r,o;i===void 0&&(i=this.store.data.pens),!n&&(n=this.getPenRect(this.getRect(i)));var a=se(i);try{for(var l=St(i),u=l.next();!u.done;u=l.next()){var s=u.value;this.alignPen(t,s,n)}}catch(c){r={error:c}}finally{try{u&&!u.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}this.render(),this.pushHistory({type:de.Update,initPens:a,pens:i})},e.prototype.alignNodesByFirst=function(t,i){i===void 0&&(i=this.store.data.pens);for(var n=se(i),r=i[0],o=this.getPenRect(r),a=1;a<i.length;a++){var l=i[a];this.alignPen(t,l,o)}this.render(),this.pushHistory({type:de.Update,initPens:n,pens:i})},e.prototype.alignPen=function(t,i,n){var r=this.getPenRect(i);switch(t){case"left":r.x=n.x;break;case"right":r.x=n.x+n.width-r.width;break;case"top":r.y=n.y;break;case"bottom":r.y=n.y+n.height-r.height;break;case"center":r.x=n.x+n.width/2-r.width/2;break;case"middle":r.y=n.y+n.height/2-r.height/2;break}this._setValue(et({id:i.id},r))},e.prototype.spaceBetweenByDirection=function(t,i,n){var r,o,a=this;if(i===void 0&&(i=this.store.data.pens),!n&&(n=this.getPenRect(this.getRect(i))[t]),i=i.filter(function(p){return!p.parentId}),!(i.length<=2)){var l=se(i),u=i.reduce(function(p,b){var x=a.getPenRect(b);return p+x[t]},0),s=(n-u)/(i.length-1);i=i.sort(function(p,b){return t==="width"?p.x-b.x:p.y-b.y});var c=this.getPenRect(i[0]),h=t==="width"?c.x:c.y;try{for(var f=St(i),d=f.next();!d.done;d=f.next()){var v=d.value,g=this.getPenRect(v);t==="width"?g.x=h:g.y=h,h+=g[t]+s,this._setValue(et({id:v.id},g))}}catch(p){r={error:p}}finally{try{d&&!d.done&&(o=f.return)&&o.call(f)}finally{if(r)throw r.error}}this.render(),this.pushHistory({type:de.Update,initPens:l,pens:i})}},e.prototype.spaceBetween=function(t,i){this.spaceBetweenByDirection("width",t,i)},e.prototype.spaceBetweenColumn=function(t,i){this.spaceBetweenByDirection("height",t,i)},e.prototype.layout=function(t,i,n){var r=this;t===void 0&&(t=this.store.data.pens),n===void 0&&(n=30);var o=this.getPenRect(wt(t));!i&&(i=o.width),t=t.filter(function(c){return!c.type&&!c.parentId});var a=se(t),l=0;t.forEach(function(c){var h=r.getPenRect(c);h.height>l&&(l=h.height)});var u=o.x,s=o.y;t.forEach(function(c,h){var f=r.getPenRect(c);if(f.x=u,f.y=s+l/2-f.height/2,r._setValue(et({id:c.id},f)),h!==t.length-1){var d=u+f.width-o.x,v=r.getPenRect(t[h+1]);Math.round(i-d)>=Math.round(v.width+n)?u+=f.width+n:(u=o.x,s+=l+n)}}),this.render(),this.pushHistory({type:de.Update,initPens:a,pens:t})},e.prototype.gotoView=function(t){var i=this.getViewCenter(),n=i.x-t.calculative.worldRect.x-t.calculative.worldRect.width/2,r=i.y-t.calculative.worldRect.y-t.calculative.worldRect.height/2;this.canvas.scroll&&this.canvas.scroll.isShow&&this.canvas.scroll.translate(n-this.store.data.x,r-this.store.data.y),this.store.data.x=n,this.store.data.y=r,this.canvas.canvasImage.init(),this.canvas.canvasImageBottom.init(),this.render()},e.prototype.showMap=function(){this.map||(this.map=new Wf(this.canvas)),this.map.show()},e.prototype.hideMap=function(){this.map.hide()},e.prototype.onSizeUpdate=function(){var t=this;this.mapTimer&&(clearTimeout(this.mapTimer),this.mapTimer=void 0),this.mapTimer=setTimeout(function(){t.map&&t.map.isShow&&t.map.show(),t.canvas.scroll&&t.canvas.scroll.isShow&&t.canvas.scroll.resize()},500)},e.prototype.toggleAnchorMode=function(){this.canvas.toggleAnchorMode()},e.prototype.addAnchorHand=function(){this.canvas.addAnchorHand()},e.prototype.removeAnchorHand=function(){this.canvas.removeAnchorHand()},e.prototype.toggleAnchorHand=function(){this.canvas.toggleAnchorHand()},e.prototype.top=function(t,i){var n=this;i===void 0&&(i=this.store.data.pens);var r=Kt(Kt([],ei(yi(t,this.store)),!1),[t],!1).map(function(a){return a.id}),o=i.filter(function(a){return r.includes(a.id)});o.forEach(function(a){var l=i.findIndex(function(u){return u.id===a.id});l>-1&&(i.push(i[l]),i.splice(l,1),n.initImageCanvas([a]))})},e.prototype.initImageCanvas=function(t){this.canvas.initImageCanvas(t)},e.prototype.bottom=function(t,i){i===void 0&&(i=this.store.data.pens);for(var n=Kt(Kt([],ei(yi(t,this.store)),!1),[t],!1).map(function(u){return u.id}),r=i.filter(function(u){return n.includes(u.id)}),o=function(u){var s=r[u],c=i.findIndex(function(h){return h.id===s.id});c>-1&&(i.unshift(i[c]),i.splice(c+1,1),a.initImageCanvas([s]))},a=this,l=r.length-1;l>=0;l--)o(l)},e.prototype.up=function(t,i){i===void 0&&(i=this.store.data.pens);var n=i.findIndex(function(r){return r.id===t.id});n>-1&&n!==i.length-1&&(i.splice(n+2,0,i[n]),i.splice(n,1),this.initImageCanvas([t]))},e.prototype.down=function(t,i){i===void 0&&(i=this.store.data.pens);var n=i.findIndex(function(r){return r.id===t.id});n>-1&&n!==0&&(i.splice(n-1,0,i[n]),i.splice(n+1,1),this.initImageCanvas([t]))},e.prototype.setLayer=function(t,i,n){n===void 0&&(n=this.store.data.pens);var r=n.findIndex(function(o){return o.id===t.id});r>-1&&(r>i?(n.splice(i,0,n[r]),n.splice(r+1,1)):r<i&&(n.splice(i,0,n[r]),n.splice(r,1)))},e.prototype.changePenId=function(t,i){this.canvas.changePenId(t,i)},e.prototype.getLines=function(t,i){var n=this,r;if(i===void 0&&(i="all"),t.type===Pe.Line)return[];var o=[];return(r=t.connectedLines)===null||r===void 0||r.forEach(function(a){var l=a.lineId,u=n.store.pens[l];if(!u){console.warn(t,"node contain a error connectedLine");return}switch(i){case"all":o.push(u);break;case"in":Ae(u).connectTo===t.id&&o.push(u);break;case"out":Oe(u).connectTo===t.id&&o.push(u);break}}),o},e.prototype.nextNode=function(t){var i=this;if(t.type===Pe.Line){var n=this.store.pens[Ae(t).connectTo];return n?[n]:[]}else{var r=this.getLines(t,"out"),o=[];return r.forEach(function(a){var l,u,s=i.nextNode(a),c=function(v){var g=o.find(function(p){return p.id===v.id});!g&&o.push(v)};try{for(var h=St(s),f=h.next();!f.done;f=h.next()){var d=f.value;c(d)}}catch(v){l={error:v}}finally{try{f&&!f.done&&(u=h.return)&&u.call(h)}finally{if(l)throw l.error}}}),o}},e.prototype.previousNode=function(t){var i=this;if(t.type===Pe.Line){var n=this.store.pens[Oe(t).connectTo];return n?[n]:[]}else{var r=this.getLines(t,"in"),o=[];return r.forEach(function(a){var l,u,s=i.previousNode(a),c=function(v){var g=o.find(function(p){return p.id===v.id});!g&&o.push(v)};try{for(var h=St(s),f=h.next();!f.done;f=h.next()){var d=f.value;c(d)}}catch(v){l={error:v}}finally{try{f&&!f.done&&(u=h.return)&&u.call(h)}finally{if(l)throw l.error}}}),o}},e.prototype.toComponent=function(t,i){if(t===void 0&&(t=this.store.data.pens),t.length===1){var n=se(t[0]);return n.type=Pe.Node,n.id=void 0,[n]}var r=se(t,!0),o=wt(r),a=et(et({id:be(),name:"combine"},o),{children:[],showChild:i}),l=r.find(function(s){return s.width===o.width&&s.height===o.height}),u=l&&i===void 0;return u&&(l.children||(l.children=[]),a=l),r.forEach(function(s){var c;if(!(s===a||s.parentId===a.id)&&!s.parentId){a.children.push(s.id),s.parentId=a.id;var h=ai(s.calculative.worldRect,o);Object.assign(s,h),s.locked=(c=s.lockedOnCombine)!==null&&c!==void 0?c:Ce.DisableMove}}),se(u?r:Kt([a],ei(r),!1))},e.prototype.setVisible=function(t,i,n){var r,o;if(n===void 0&&(n=!0),this.onSizeUpdate(),this._setValue({id:t.id,visible:i}),t.children)try{for(var a=St(t.children),l=a.next();!l.done;l=a.next()){var u=l.value,s=this.store.pens[u];s&&this.setVisible(s,i,!1)}}catch(c){r={error:c}}finally{try{l&&!l.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}n&&this.render()},e.prototype.clearHover=function(){this.canvas.clearHover()},e.prototype.closeSocket=function(){this.closeWebsocket(),this.closeMqtt(),this.closeHttp()},e.prototype.destroy=function(t){this.clear(!1),this.closeSocket(),this.store.emitter.all.clear(),this.canvas.destroy(),he[this.store.id]=void 0,he.path2dDraws={},this.canvas=void 0,t&&(he.htmlElements={})},e}();const Kf={onMounted:{type:Function}};const $f=ur({name:"TopologyCavas",props:Kf,setup(e,{emit:t}){const i=_a(null);return ja(()=>{if(!i.value)return;const n=new Vf(i.value,{grid:!0,color:"#f77e45",activeColor:"red",rule:!0});e.onMounted&&t("mounted",n)}),()=>me("div",{class:"topology-canvas"},[me("div",{class:"topology-canvas",ref:i},null)])}}),Yf=[{group:"\u57FA\u672C\u5F62\u72B6",children:[{name:"rectangle",icon:"icon-rect",data:{text:"\u77E9\u5F62",width:100,height:50,paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10,name:"rectangle"}},{name:"rectangle",icon:"icon-rectangle",data:{text:"\u5706\u89D2\u77E9\u5F62",width:100,height:50,paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10,borderRadius:.1,name:"rectangle"}},{name:"circle",icon:"icon-circle",data:{text:"\u5706",width:100,height:100,name:"circle",textMaxLine:1}},{name:"triangle",icon:"icon-triangle",data:{text:"\u4E09\u89D2\u5F62",width:100,height:100,name:"triangle"}},{name:"diamond",icon:"icon-diamond",data:{text:"\u83F1\u5F62",width:100,height:100,name:"diamond"}},{name:"pentagon",icon:"icon-pentagon",data:{text:"\u4E94\u8FB9\u5F62",width:100,height:100,name:"pentagon"}},{name:"hexagon",icon:"icon-hexagon",data:{text:"\u516D\u8FB9\u5F62",width:100,height:100,paddingTop:10,paddingBottom:10,name:"hexagon"}},{name:"pentagram",icon:"icon-pentagram",data:{text:"\u4E94\u89D2\u661F",width:100,height:100,name:"pentagram"}},{name:"leftArrow",icon:"icon-arrow-left",data:{text:"\u5DE6\u7BAD\u5934",width:200,height:100,name:"leftArrow"}},{name:"rightArrow",icon:"icon-arrow-right",data:{text:"\u53F3\u7BAD\u5934",width:200,height:100,name:"rightArrow"}},{name:"twowayArrow",icon:"icon-twoway-arrow",data:{text:"\u53CC\u5411\u7BAD\u5934",width:200,height:100,name:"twowayArrow"}},{name:"line",icon:"icon-line",data:{text:"\u76F4\u7EBF",width:100,height:5,name:"line"}},{name:"cloud",icon:"icon-cloud",data:{text:"\u4E91",width:100,height:100,name:"cloud"}},{name:"message",icon:"icon-msg",data:{text:"\u6D88\u606F\u6846",width:100,height:100,paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10,name:"message"}},{name:"file",icon:"icon-file",data:{text:"\u6587\u6863",width:80,height:100,paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10,name:"file"}},{name:"text",icon:"icon-text",data:{text:"This is a text.",width:160,height:30,name:"text"}},{name:"image",icon:"icon-image",data:{text:"",width:100,height:100,name:"image",image:"./demo.png"}},{name:"cube",icon:"icon-cube",data:{width:50,height:70,is3D:!0,z:10,zRotate:15,fillStyle:"#ddd",name:"cube"}},{name:"people",icon:"icon-people",data:{width:70,height:100,name:"people"}}]}];const Xf=ur({name:"TopologyTools",setup(){const e=Yf,t=(i,n)=>{var r;(r=i.dataTransfer)==null||r.setData("text/plain",JSON.stringify(n))};return()=>me("div",{class:"topology-tools"},[e.map(i=>me("div",{class:"topology-tools-group"},[me("h4",{class:"topology-tools-group_title"},[di(" "),i.group,di(" ")]),me("div",{class:"topology-tools-group_content"},[i.children.map(n=>me("i",{class:["iconfont",n.icon],title:n.name,draggable:!0,onDragstart:r=>t(r,n.data)},null))])]))])}}),Qf=[{type:"\u753B\u7B14\u4FE1\u606F",children:[{label:"\u5185\u5BB9",value:"text"},{label:"\u7C7B\u578B",value:"name"}]},{type:"\u4F4D\u7F6E\u548C\u5927\u5C0F",children:[{label:"X",value:"x"},{label:"Y",value:"y"},{label:"\u5BBD",value:"width"},{label:"\u9AD8",value:"height"},{label:"\u65CB\u8F6C",value:"rotate"}]},{type:"\u80CC\u666F",penName:"image",children:[{label:"\u56FE\u7247",value:"image",hasImage:!0}]}],Gf={activedPen:Object},Jf=ur({name:"TopologyPenPros",props:Gf,setup(e,{emit:t}){const i=Qf,n=vi(()=>{var l;return((l=e.activedPen)==null?void 0:l.pen)||{}}),r=vi(()=>{var l;return(l=e.activedPen)==null?void 0:l.ver}),o=l=>typeof l=="number"?l.toFixed(2):l,a=l=>{var c;const s=(c=l.target.files)==null?void 0:c[0];if(s){const h=new FileReader;h.addEventListener("load",function(){t("updatePen",{id:n.value.id,image:h.result})},!1),h.readAsDataURL(s)}};return()=>me("div",{class:"topology-properties","data-ver":r.value},[i.filter(l=>l.penName?l.penName===n.value.name:!0).map(l=>me("div",{class:"topology-properties_type"},[me("h4",{class:"topology-properties_type-name"},[l.type]),l.children.map(u=>me("div",{class:"topology-properties-item"},[me("span",{class:"topology-properties-item_name"},[u.label]),u.hasImage&&me("input",{onChange:a,type:"file"},null)||me("span",{class:"topology-properties-item_value"},[o(n.value[u.value])])]))]))])}}),Zf={show:Boolean,"onUpdate:show":Function,topology:Object,position:{type:Object,required:!0}};function $t(e=1){return function(t){return!!(t&&t.length<e)}}const Ji="combine",ed=[[{type:"top",name:"\u7F6E\u9876",disabled:$t(),onClick:function(e,t){t.forEach(i=>e.top(i))}},{type:"bottom",name:"\u7F6E\u5E95",disabled:$t(),onClick:function(e,t){t.forEach(i=>e.bottom(i))}}],[{type:Ji,name:"\u7EC4\u5408",disabled:function(e){return e.length<2},hidden:function(e){return e.length===1&&e[0].name===Ji},onClick:(e,t)=>{e.combine(t)}},{type:"uncombine",name:"\u53D6\u6D88\u7EC4\u5408",hidden:function(e){return!(e.length===1&&e[0].name===Ji)},onClick:(e,t)=>{e.uncombine(t[0])}},{type:"unlocked",name:"\u9501\u5B9A",disabled:$t(),hidden:function(e){return e.findIndex(i=>i.locked===1)>=0},onClick:function(e,t){t.forEach(i=>i.locked=1)}},{type:"locked",name:"\u89E3\u9501",hidden:function(e){return e.findIndex(i=>i.locked===1)<0},onClick:function(e,t){t.forEach(i=>i.locked=0)}}],[{type:"delete",name:"\u5220\u9664",disabled:$t(),onClick:function(e,t){e.delete(t)}}],[{type:"undo",name:"\u64A4\u9500",shortcutKey:"Ctrl + Z",disabled:function(e,t){var n;return(((n=t==null?void 0:t.store.histories)==null?void 0:n.length)||0)<1},onClick:function(e){e.undo()}},{type:"redo",name:"\u6062\u590D",shortcutKey:"Shift + Z",disabled:function(e,t){const i=(t==null?void 0:t.store.histories)||[],n=t==null?void 0:t.store.historyIndex;return n==null||n>i.length-2},onClick:function(e){e.redo()}}],[{type:"cut",name:"\u526A\u5207",shortcutKey:"Ctrl + X",disabled:$t(),onClick:function(e,t){e.cut(t)}},{type:"copy",name:"\u590D\u5236",shortcutKey:"Ctrl + C",disabled:$t(),onClick:function(e,t){e.copy(t)}},{type:"paste",name:"\u7C98\u8D34",shortcutKey:"Ctrl + V",onClick:function(e){e.store.clipboard&&e.paste()}}]],td=ur({name:"TopologyContextmenu",props:Zf,emits:["update:show"],setup(e,{emit:t}){const i=vi(()=>({top:e.position.top+"px",left:e.position.left+"px"})),n=()=>{var o;return((o=e.topology)==null?void 0:o.store.active)||[]},r=o=>{var l,u;const a=(l=o.disabled)==null?void 0:l.call(o,n(),e.topology);return(u=o.hidden)!=null&&u.call(o,n())?null:me("a",{class:a?"menu-a-disabled":"menu-a",onClick:()=>{var s;a||((s=o.onClick)==null||s.call(o,e.topology,n()),t("update:show",!1))}},[o.name,o.shortcutKey&&me("span",{class:"ml50"},[o.shortcutKey])])};return()=>Jl(me("ul",{class:"context-menus",id:"canvas_menus",style:i.value},[ed.map(o=>me(dt,null,[o.map(a=>me("li",null,[r(a)])),me("div",{class:"line"},null)]))]),[[Zc,e.show]])}}),rd=ur({name:"TopologyVue",setup(e,{slots:t}){const i=_a(),n=Mr({pen:null,ver:0}),r=Mr({show:!1,position:{left:0,top:0}}),o=a=>{i.value=a,a.on("add",function(...l){console.log("add",l)}),a.on("contextmenu",function({clientRect:l,e:u}){r.position.left=document.body.scrollLeft+u.clientX+2,r.position.top=document.body.scrollTop+u.clientY;const s=r.position.top+320-l.height;if(s>0){const c=r.position.top-s;r.position.top=c>0?c:5}r.show=!0}),a.on("click",function(){console.log("click"),r.show=!1}),a.on("active",function(){const l=a.store.active;(l==null?void 0:l.length)===1?n.pen=l[0]:(n.pen=null,n.ver=0)}),a.on("inactive",function(){n.pen=null,n.ver=0}),a.on("resizePens",function(){n.ver++}),a.on("rotatePens",function(){n.ver++}),a.on("mouseup",function(){n.ver++})};return Un(()=>{var a;(a=i.value)==null||a.destroy()}),()=>me("div",{class:"topology-container"},[me(Xf,null,null),me($f,{onMounted:o},null),me(Jf,{activedPen:n},null),me(td,{show:r.show,"onUpdate:show":a=>r.show=a,position:r.position,topology:i.value},null)])}}),id=di(" slot-colorPicker "),nd=Xa("input",{type:"color"},null,-1),od=ur({__name:"App",setup(e){return(t,i)=>(gc(),bc(ka(rd),null,{colorPicker:Ma(()=>[id,nd]),_:1}))}}),ad=ru(od);ad.mount("#app");
